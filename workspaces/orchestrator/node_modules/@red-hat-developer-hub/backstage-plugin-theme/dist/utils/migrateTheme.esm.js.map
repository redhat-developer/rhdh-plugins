{"version":3,"file":"migrateTheme.esm.js","sources":["../../src/utils/migrateTheme.ts"],"sourcesContent":["/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BackstagePaletteAdditions } from '@backstage/theme';\nimport type { SimplePaletteColorOptions } from '@mui/material/styles';\nimport type { ThemeConfig } from '../types';\n\nexport interface DeprecatedRHDH10to12ThemeColors {\n  /**\n   * primaryColor Configuration for the instance\n   * The following formats are supported: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color()\n   */\n  primaryColor?: string;\n  /**\n   * Header Theme color Configuration for the instance\n   * The following formats are supported: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color()\n   */\n  headerColor1?: string;\n  /**\n   * Header Theme color Configuration for the instance\n   * The following formats are supported: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color()\n   */\n  headerColor2?: string;\n  /**\n   * Navigation Side Bar Indicator color Configuration for the instance\n   * The following formats are supported: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color()\n   */\n  navigationIndicatorColor?: string;\n}\n\nfunction isObject(\n  objectOrValue: unknown,\n): objectOrValue is Record<string, unknown> {\n  return typeof objectOrValue === 'object' && !Array.isArray(objectOrValue);\n}\n\nexport const migrateThemeConfig = (\n  themeConfig: ThemeConfig & DeprecatedRHDH10to12ThemeColors,\n): ThemeConfig => {\n  if (!themeConfig) {\n    return { palette: {} };\n  }\n\n  // Drop deprecated values from the root level!\n  const migrated: ThemeConfig = {\n    palette: themeConfig.palette ?? {},\n    defaultPageTheme: themeConfig.defaultPageTheme,\n    pageTheme: themeConfig.pageTheme,\n    fontFamily: themeConfig.fontFamily,\n    htmlFontSize: themeConfig.htmlFontSize,\n    typography: themeConfig.typography,\n    options: themeConfig.options,\n  };\n\n  if (themeConfig.primaryColor) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      '[deprecated] Automatically migrate theme configuration from `primaryColor` to `palette.primary.main`',\n    );\n    if (isObject(migrated.palette?.primary)) {\n      if (!(migrated.palette.primary as SimplePaletteColorOptions).main) {\n        (migrated.palette.primary as SimplePaletteColorOptions).main =\n          themeConfig.primaryColor;\n      }\n    } else if (migrated.palette) {\n      migrated.palette.primary = { main: themeConfig.primaryColor };\n    }\n  }\n\n  if (themeConfig.navigationIndicatorColor) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      '[deprecated] Automatically migrate theme configuration from `navigationIndicatorColor` to `palette.navigation.indicator`',\n    );\n    if (isObject(migrated.palette?.navigation)) {\n      if (!migrated.palette.navigation.indicator) {\n        migrated.palette.navigation.indicator =\n          themeConfig.navigationIndicatorColor;\n      }\n    } else if (migrated.palette) {\n      migrated.palette.navigation = {\n        indicator: themeConfig.navigationIndicatorColor,\n      } as BackstagePaletteAdditions['navigation'];\n    }\n  }\n\n  if (themeConfig.headerColor1) {\n    if (themeConfig.pageTheme) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        '[deprecated] Ignore theme configuration `headerColor1` and `headerColor2` because `pageTheme` is defined!',\n      );\n    } else {\n      // eslint-disable-next-line no-console\n      console.warn(\n        '[deprecated] Automatically migrate theme configuration from `headerColor1` and `headerColor2` to `pageTheme.home.backgroundColor`',\n      );\n      migrated.defaultPageTheme = 'home';\n      migrated.pageTheme = {\n        home: {\n          backgroundColor: !themeConfig.headerColor2\n            ? themeConfig.headerColor1\n            : [themeConfig.headerColor1, themeConfig.headerColor2],\n        },\n      };\n    }\n  }\n\n  return migrated;\n};\n"],"names":[],"mappings":"AA2CA,SAAS,SACP,aAC0C,EAAA;AAC1C,EAAA,OAAO,OAAO,aAAkB,KAAA,QAAA,IAAY,CAAC,KAAA,CAAM,QAAQ,aAAa,CAAA;AAC1E;AAEa,MAAA,kBAAA,GAAqB,CAChC,WACgB,KAAA;AAChB,EAAA,IAAI,CAAC,WAAa,EAAA;AAChB,IAAO,OAAA,EAAE,OAAS,EAAA,EAAG,EAAA;AAAA;AAIvB,EAAA,MAAM,QAAwB,GAAA;AAAA,IAC5B,OAAA,EAAS,WAAY,CAAA,OAAA,IAAW,EAAC;AAAA,IACjC,kBAAkB,WAAY,CAAA,gBAAA;AAAA,IAC9B,WAAW,WAAY,CAAA,SAAA;AAAA,IACvB,YAAY,WAAY,CAAA,UAAA;AAAA,IACxB,cAAc,WAAY,CAAA,YAAA;AAAA,IAC1B,YAAY,WAAY,CAAA,UAAA;AAAA,IACxB,SAAS,WAAY,CAAA;AAAA,GACvB;AAEA,EAAA,IAAI,YAAY,YAAc,EAAA;AAE5B,IAAQ,OAAA,CAAA,IAAA;AAAA,MACN;AAAA,KACF;AACA,IAAA,IAAI,QAAS,CAAA,QAAA,CAAS,OAAS,EAAA,OAAO,CAAG,EAAA;AACvC,MAAA,IAAI,CAAE,QAAA,CAAS,OAAQ,CAAA,OAAA,CAAsC,IAAM,EAAA;AACjE,QAAC,QAAS,CAAA,OAAA,CAAQ,OAAsC,CAAA,IAAA,GACtD,WAAY,CAAA,YAAA;AAAA;AAChB,KACF,MAAA,IAAW,SAAS,OAAS,EAAA;AAC3B,MAAA,QAAA,CAAS,OAAQ,CAAA,OAAA,GAAU,EAAE,IAAA,EAAM,YAAY,YAAa,EAAA;AAAA;AAC9D;AAGF,EAAA,IAAI,YAAY,wBAA0B,EAAA;AAExC,IAAQ,OAAA,CAAA,IAAA;AAAA,MACN;AAAA,KACF;AACA,IAAA,IAAI,QAAS,CAAA,QAAA,CAAS,OAAS,EAAA,UAAU,CAAG,EAAA;AAC1C,MAAA,IAAI,CAAC,QAAA,CAAS,OAAQ,CAAA,UAAA,CAAW,SAAW,EAAA;AAC1C,QAAS,QAAA,CAAA,OAAA,CAAQ,UAAW,CAAA,SAAA,GAC1B,WAAY,CAAA,wBAAA;AAAA;AAChB,KACF,MAAA,IAAW,SAAS,OAAS,EAAA;AAC3B,MAAA,QAAA,CAAS,QAAQ,UAAa,GAAA;AAAA,QAC5B,WAAW,WAAY,CAAA;AAAA,OACzB;AAAA;AACF;AAGF,EAAA,IAAI,YAAY,YAAc,EAAA;AAC5B,IAAA,IAAI,YAAY,SAAW,EAAA;AAEzB,MAAQ,OAAA,CAAA,IAAA;AAAA,QACN;AAAA,OACF;AAAA,KACK,MAAA;AAEL,MAAQ,OAAA,CAAA,IAAA;AAAA,QACN;AAAA,OACF;AACA,MAAA,QAAA,CAAS,gBAAmB,GAAA,MAAA;AAC5B,MAAA,QAAA,CAAS,SAAY,GAAA;AAAA,QACnB,IAAM,EAAA;AAAA,UACJ,eAAA,EAAiB,CAAC,WAAA,CAAY,YAC1B,GAAA,WAAA,CAAY,eACZ,CAAC,WAAA,CAAY,YAAc,EAAA,WAAA,CAAY,YAAY;AAAA;AACzD,OACF;AAAA;AACF;AAGF,EAAO,OAAA,QAAA;AACT;;;;"}