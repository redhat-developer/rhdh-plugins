{"version":3,"file":"EditRolePage.esm.js","sources":["../../../src/components/CreateRole/EditRolePage.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport { useParams } from 'react-router-dom';\n\nimport {\n  Content,\n  ErrorPage,\n  Header,\n  Page,\n  Progress,\n  useQueryParamState,\n} from '@backstage/core-components';\n\nimport { usePermissionPolicies } from '../../hooks/usePermissionPolicies';\nimport { useSelectedMembers } from '../../hooks/useSelectedMembers';\nimport { RoleForm } from './RoleForm';\nimport { RoleFormValues } from './types';\n\nexport const EditRolePage = () => {\n  const { roleName, roleNamespace, roleKind } = useParams();\n  const [queryParamState] = useQueryParamState<number>('activeStep');\n  const {\n    selectedMembers,\n    members,\n    role,\n    loading: loadingMembers,\n    roleError,\n    membersError,\n    canReadUsersAndGroups,\n  } = useSelectedMembers(\n    roleName ? `${roleKind}:${roleNamespace}/${roleName}` : '',\n  );\n\n  const { data, loading: loadingPolicies } = usePermissionPolicies(\n    `${roleKind}:${roleNamespace}/${roleName}`,\n  );\n\n  const initialValues: RoleFormValues = {\n    name: roleName || '',\n    namespace: roleNamespace || 'default',\n    kind: roleKind || 'role',\n    description: role?.metadata?.description ?? '',\n    selectedMembers,\n    permissionPoliciesRows: data,\n  };\n\n  if (loadingMembers || loadingPolicies) {\n    return <Progress />;\n  }\n  if (roleError.name) {\n    return (\n      <ErrorPage status={roleError.name} statusMessage={roleError.message} />\n    );\n  }\n  if (!canReadUsersAndGroups) {\n    return <ErrorPage statusMessage=\"Unauthorized to edit role\" />;\n  }\n\n  return (\n    <Page themeId=\"tool\">\n      <Header title=\"Edit role\" type=\"RBAC\" typeLink=\"..\" />\n      <Content>\n        <RoleForm\n          initialValues={initialValues}\n          titles={{\n            formTitle: 'Edit Role',\n            nameAndDescriptionTitle: 'Edit name and description of role ',\n            usersAndGroupsTitle: 'Edit users and groups',\n            permissionPoliciesTitle: 'Edit permission policies',\n          }}\n          roleName={roleName ? `${roleKind}:${roleNamespace}/${roleName}` : ''}\n          step={Number(queryParamState)}\n          membersData={{\n            members,\n            loading: loadingMembers,\n            error: membersError,\n          }}\n          submitLabel=\"Save\"\n        />\n      </Content>\n    </Page>\n  );\n};\n"],"names":[],"mappings":";;;;;;;AAgCO,MAAM,eAAe,MAAM;AAChC,EAAA,MAAM,EAAE,QAAA,EAAU,aAAe,EAAA,QAAA,KAAa,SAAU,EAAA;AACxD,EAAA,MAAM,CAAC,eAAe,CAAI,GAAA,kBAAA,CAA2B,YAAY,CAAA;AACjE,EAAM,MAAA;AAAA,IACJ,eAAA;AAAA,IACA,OAAA;AAAA,IACA,IAAA;AAAA,IACA,OAAS,EAAA,cAAA;AAAA,IACT,SAAA;AAAA,IACA,YAAA;AAAA,IACA;AAAA,GACE,GAAA,kBAAA;AAAA,IACF,WAAW,CAAG,EAAA,QAAQ,IAAI,aAAa,CAAA,CAAA,EAAI,QAAQ,CAAK,CAAA,GAAA;AAAA,GAC1D;AAEA,EAAA,MAAM,EAAE,IAAA,EAAM,OAAS,EAAA,eAAA,EAAoB,GAAA,qBAAA;AAAA,IACzC,CAAG,EAAA,QAAQ,CAAI,CAAA,EAAA,aAAa,IAAI,QAAQ,CAAA;AAAA,GAC1C;AAEA,EAAA,MAAM,aAAgC,GAAA;AAAA,IACpC,MAAM,QAAY,IAAA,EAAA;AAAA,IAClB,WAAW,aAAiB,IAAA,SAAA;AAAA,IAC5B,MAAM,QAAY,IAAA,MAAA;AAAA,IAClB,WAAA,EAAa,IAAM,EAAA,QAAA,EAAU,WAAe,IAAA,EAAA;AAAA,IAC5C,eAAA;AAAA,IACA,sBAAwB,EAAA;AAAA,GAC1B;AAEA,EAAA,IAAI,kBAAkB,eAAiB,EAAA;AACrC,IAAA,2CAAQ,QAAS,EAAA,IAAA,CAAA;AAAA;AAEnB,EAAA,IAAI,UAAU,IAAM,EAAA;AAClB,IAAA,2CACG,SAAU,EAAA,EAAA,MAAA,EAAQ,UAAU,IAAM,EAAA,aAAA,EAAe,UAAU,OAAS,EAAA,CAAA;AAAA;AAGzE,EAAA,IAAI,CAAC,qBAAuB,EAAA;AAC1B,IAAO,uBAAA,KAAA,CAAA,aAAA,CAAC,SAAU,EAAA,EAAA,aAAA,EAAc,2BAA4B,EAAA,CAAA;AAAA;AAG9D,EAAA,uBACG,KAAA,CAAA,aAAA,CAAA,IAAA,EAAA,EAAK,OAAQ,EAAA,MAAA,EAAA,sCACX,MAAO,EAAA,EAAA,KAAA,EAAM,WAAY,EAAA,IAAA,EAAK,MAAO,EAAA,QAAA,EAAS,IAAK,EAAA,CAAA,sCACnD,OACC,EAAA,IAAA,kBAAA,KAAA,CAAA,aAAA;AAAA,IAAC,QAAA;AAAA,IAAA;AAAA,MACC,aAAA;AAAA,MACA,MAAQ,EAAA;AAAA,QACN,SAAW,EAAA,WAAA;AAAA,QACX,uBAAyB,EAAA,oCAAA;AAAA,QACzB,mBAAqB,EAAA,uBAAA;AAAA,QACrB,uBAAyB,EAAA;AAAA,OAC3B;AAAA,MACA,QAAA,EAAU,WAAW,CAAG,EAAA,QAAQ,IAAI,aAAa,CAAA,CAAA,EAAI,QAAQ,CAAK,CAAA,GAAA,EAAA;AAAA,MAClE,IAAA,EAAM,OAAO,eAAe,CAAA;AAAA,MAC5B,WAAa,EAAA;AAAA,QACX,OAAA;AAAA,QACA,OAAS,EAAA,cAAA;AAAA,QACT,KAAO,EAAA;AAAA,OACT;AAAA,MACA,WAAY,EAAA;AAAA;AAAA,GAEhB,CACF,CAAA;AAEJ;;;;"}