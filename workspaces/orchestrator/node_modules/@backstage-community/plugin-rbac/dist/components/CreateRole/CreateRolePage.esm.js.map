{"version":3,"file":"CreateRolePage.esm.js","sources":["../../../src/components/CreateRole/CreateRolePage.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport { useAsync } from 'react-use';\n\nimport {\n  Content,\n  ErrorPage,\n  Header,\n  Page,\n  Progress,\n} from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\n\nimport { rbacApiRef } from '../../api/RBACBackendClient';\nimport { MemberEntity } from '../../types';\nimport { initialPermissionPolicyRowValue } from './const';\nimport { RoleForm } from './RoleForm';\nimport { RoleFormValues } from './types';\n\nexport const CreateRolePage = () => {\n  const rbacApi = useApi(rbacApiRef);\n  const {\n    loading: membersLoading,\n    value: members,\n    error: membersError,\n  } = useAsync(async () => {\n    return await rbacApi.getMembers();\n  });\n\n  const canReadUsersAndGroups =\n    !membersLoading &&\n    !membersError &&\n    Array.isArray(members) &&\n    members.length > 0;\n\n  const initialValues: RoleFormValues = {\n    name: '',\n    namespace: 'default',\n    kind: 'role',\n    description: '',\n    selectedMembers: [],\n    permissionPoliciesRows: [initialPermissionPolicyRowValue],\n  };\n\n  if (membersLoading) {\n    return <Progress />;\n  }\n\n  return canReadUsersAndGroups ? (\n    <Page themeId=\"tool\">\n      <Header title=\"Create role\" type=\"RBAC\" typeLink=\"..\" />\n      <Content>\n        <RoleForm\n          initialValues={initialValues}\n          titles={{\n            formTitle: 'Create Role',\n            nameAndDescriptionTitle: 'Enter name and description of role ',\n            usersAndGroupsTitle: 'Add users and groups',\n            permissionPoliciesTitle: 'Add permission policies',\n          }}\n          membersData={{\n            members: Array.isArray(members) ? members : ([] as MemberEntity[]),\n            loading: membersLoading,\n            error: (membersError as unknown as Error) || {\n              name: (members as unknown as Response)?.status,\n              message: (members as unknown as Response)?.statusText,\n            },\n          }}\n        />\n      </Content>\n    </Page>\n  ) : (\n    <ErrorPage statusMessage=\"Unauthorized to create role\" />\n  );\n};\n"],"names":[],"mappings":";;;;;;;;AAiCO,MAAM,iBAAiB,MAAM;AAClC,EAAM,MAAA,OAAA,GAAU,OAAO,UAAU,CAAA;AACjC,EAAM,MAAA;AAAA,IACJ,OAAS,EAAA,cAAA;AAAA,IACT,KAAO,EAAA,OAAA;AAAA,IACP,KAAO,EAAA;AAAA,GACT,GAAI,SAAS,YAAY;AACvB,IAAO,OAAA,MAAM,QAAQ,UAAW,EAAA;AAAA,GACjC,CAAA;AAED,EAAM,MAAA,qBAAA,GACJ,CAAC,cAAA,IACD,CAAC,YAAA,IACD,MAAM,OAAQ,CAAA,OAAO,CACrB,IAAA,OAAA,CAAQ,MAAS,GAAA,CAAA;AAEnB,EAAA,MAAM,aAAgC,GAAA;AAAA,IACpC,IAAM,EAAA,EAAA;AAAA,IACN,SAAW,EAAA,SAAA;AAAA,IACX,IAAM,EAAA,MAAA;AAAA,IACN,WAAa,EAAA,EAAA;AAAA,IACb,iBAAiB,EAAC;AAAA,IAClB,sBAAA,EAAwB,CAAC,+BAA+B;AAAA,GAC1D;AAEA,EAAA,IAAI,cAAgB,EAAA;AAClB,IAAA,2CAAQ,QAAS,EAAA,IAAA,CAAA;AAAA;AAGnB,EAAA,OAAO,qBACL,mBAAA,KAAA,CAAA,aAAA,CAAC,IAAK,EAAA,EAAA,OAAA,EAAQ,0BACX,KAAA,CAAA,aAAA,CAAA,MAAA,EAAA,EAAO,KAAM,EAAA,aAAA,EAAc,MAAK,MAAO,EAAA,QAAA,EAAS,IAAK,EAAA,CAAA,sCACrD,OACC,EAAA,IAAA,kBAAA,KAAA,CAAA,aAAA;AAAA,IAAC,QAAA;AAAA,IAAA;AAAA,MACC,aAAA;AAAA,MACA,MAAQ,EAAA;AAAA,QACN,SAAW,EAAA,aAAA;AAAA,QACX,uBAAyB,EAAA,qCAAA;AAAA,QACzB,mBAAqB,EAAA,sBAAA;AAAA,QACrB,uBAAyB,EAAA;AAAA,OAC3B;AAAA,MACA,WAAa,EAAA;AAAA,QACX,SAAS,KAAM,CAAA,OAAA,CAAQ,OAAO,CAAA,GAAI,UAAW,EAAC;AAAA,QAC9C,OAAS,EAAA,cAAA;AAAA,QACT,OAAQ,YAAqC,IAAA;AAAA,UAC3C,MAAO,OAAiC,EAAA,MAAA;AAAA,UACxC,SAAU,OAAiC,EAAA;AAAA;AAC7C;AACF;AAAA,GAEJ,CACF,CAAA,mBAEC,KAAA,CAAA,aAAA,CAAA,SAAA,EAAA,EAAU,eAAc,6BAA8B,EAAA,CAAA;AAE3D;;;;"}