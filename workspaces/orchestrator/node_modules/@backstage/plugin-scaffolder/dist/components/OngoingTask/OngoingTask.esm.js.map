{"version":3,"file":"OngoingTask.esm.js","sources":["../../../src/components/OngoingTask/OngoingTask.tsx"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ComponentType,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport { Content, ErrorPanel, Header, Page } from '@backstage/core-components';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Paper from '@material-ui/core/Paper';\nimport { makeStyles } from '@material-ui/core/styles';\nimport {\n  scaffolderApiRef,\n  ScaffolderTaskOutput,\n  useTaskEventStream,\n} from '@backstage/plugin-scaffolder-react';\nimport { selectedTemplateRouteRef } from '../../routes';\nimport {\n  AnalyticsContext,\n  useAnalytics,\n  useApi,\n  useRouteRef,\n} from '@backstage/core-plugin-api';\nimport qs from 'qs';\nimport { ContextMenu } from './ContextMenu';\nimport {\n  DefaultTemplateOutputs,\n  TaskLogStream,\n  TaskSteps,\n} from '@backstage/plugin-scaffolder-react/alpha';\nimport { useAsync } from '@react-hookz/web';\nimport { usePermission } from '@backstage/plugin-permission-react';\nimport {\n  taskCancelPermission,\n  taskCreatePermission,\n  taskReadPermission,\n} from '@backstage/plugin-scaffolder-common/alpha';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\nimport { scaffolderTranslationRef } from '../../translation';\nimport { entityPresentationApiRef } from '@backstage/plugin-catalog-react';\nimport { default as reactUseAsync } from 'react-use/esm/useAsync';\nimport { stringifyEntityRef } from '@backstage/catalog-model';\n\nconst useStyles = makeStyles(theme => ({\n  contentWrapper: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  buttonBar: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'right',\n  },\n  cancelButton: {\n    marginRight: theme.spacing(1),\n  },\n  retryButton: {\n    marginRight: theme.spacing(1),\n  },\n  logsVisibilityButton: {\n    marginRight: theme.spacing(1),\n  },\n}));\n\n/**\n * @public\n */\nexport const OngoingTask = (props: {\n  TemplateOutputsComponent?: ComponentType<{\n    output?: ScaffolderTaskOutput;\n  }>;\n}) => {\n  // todo(blam): check that task Id actually exists, and that it's valid. otherwise redirect to something more useful.\n  const { taskId } = useParams();\n  const taskStream = useTaskEventStream(taskId!);\n  const { namespace, name } =\n    taskStream.task?.spec.templateInfo?.entity?.metadata ?? {};\n\n  return (\n    <AnalyticsContext\n      attributes={{\n        entityRef:\n          name &&\n          stringifyEntityRef({\n            kind: 'template',\n            namespace,\n            name,\n          }),\n        taskId,\n      }}\n    >\n      <Page themeId=\"website\">\n        <OngoingTaskContent {...props} />\n      </Page>\n    </AnalyticsContext>\n  );\n};\n\nfunction OngoingTaskContent(props: {\n  TemplateOutputsComponent?: ComponentType<{\n    output?: ScaffolderTaskOutput;\n  }>;\n}) {\n  const { taskId } = useParams();\n  const templateRouteRef = useRouteRef(selectedTemplateRouteRef);\n  const navigate = useNavigate();\n  const analytics = useAnalytics();\n  const scaffolderApi = useApi(scaffolderApiRef);\n  const entityPresentationApi = useApi(entityPresentationApiRef);\n  const taskStream = useTaskEventStream(taskId!);\n  const classes = useStyles();\n  const steps = useMemo(\n    () =>\n      taskStream.task?.spec.steps.map(step => ({\n        ...step,\n        ...taskStream?.steps?.[step.id],\n      })) ?? [],\n    [taskStream],\n  );\n  const { t } = useTranslationRef(scaffolderTranslationRef);\n\n  const [logsVisible, setLogVisibleState] = useState(false);\n  const [buttonBarVisible, setButtonBarVisibleState] = useState(true);\n\n  const { allowed: canCancelTask } = usePermission({\n    permission: taskCancelPermission,\n    resourceRef: taskId,\n  });\n\n  const { allowed: canReadTask } = usePermission({\n    permission: taskReadPermission,\n    resourceRef: taskId,\n  });\n\n  const { allowed: canCreateTask } = usePermission({\n    permission: taskCreatePermission,\n  });\n\n  // Start Over endpoint requires user to have both read (to grab parameters) and create (to create new task) permissions\n  const canStartOver = canReadTask && canCreateTask;\n\n  useEffect(() => {\n    if (taskStream.error) {\n      setLogVisibleState(true);\n    }\n  }, [taskStream.error]);\n\n  useEffect(() => {\n    if (taskStream.completed && !taskStream.error) {\n      setLogVisibleState(true);\n      setButtonBarVisibleState(false);\n    }\n  }, [taskStream.error, taskStream.completed]);\n\n  const { value: presentation } = reactUseAsync(async () => {\n    const templateEntityRef = taskStream.task?.spec.templateInfo?.entityRef;\n    if (!templateEntityRef) {\n      return undefined;\n    }\n    return entityPresentationApi.forEntity(templateEntityRef).promise;\n  }, [entityPresentationApi, taskStream.task?.spec.templateInfo?.entityRef]);\n\n  const activeStep = useMemo(() => {\n    for (let i = steps.length - 1; i >= 0; i--) {\n      if (steps[i].status !== 'open') {\n        return i;\n      }\n    }\n\n    return 0;\n  }, [steps]);\n\n  const isRetryableTask =\n    taskStream.task?.spec.EXPERIMENTAL_recovery?.EXPERIMENTAL_strategy ===\n    'startOver';\n\n  const canRetry = canReadTask && canCreateTask && isRetryableTask;\n\n  const startOver = useCallback(() => {\n    const { namespace, name } =\n      taskStream.task?.spec.templateInfo?.entity?.metadata ?? {};\n\n    const formData = taskStream.task?.spec.parameters ?? {};\n\n    if (!namespace || !name) {\n      return;\n    }\n\n    analytics.captureEvent('click', `Task has been started over`);\n\n    navigate({\n      pathname: templateRouteRef({\n        namespace,\n        templateName: name,\n      }),\n      search: `?${qs.stringify({ formData: JSON.stringify(formData) })}`,\n    });\n  }, [\n    analytics,\n    navigate,\n    taskStream.task?.spec.parameters,\n    taskStream.task?.spec.templateInfo?.entity?.metadata,\n    templateRouteRef,\n  ]);\n\n  const [, { execute: triggerRetry }] = useAsync(async () => {\n    if (taskId) {\n      analytics.captureEvent('retried', 'Template has been retried');\n      await scaffolderApi.retry?.(taskId);\n    }\n  });\n\n  const [{ status: cancelStatus }, { execute: triggerCancel }] = useAsync(\n    async () => {\n      if (taskId) {\n        analytics.captureEvent('cancelled', 'Template has been cancelled');\n        await scaffolderApi.cancelTask(taskId);\n      }\n    },\n  );\n\n  const Outputs = props.TemplateOutputsComponent ?? DefaultTemplateOutputs;\n\n  const cancelEnabled = !(taskStream.cancelled || taskStream.completed);\n  const isCancelButtonDisabled =\n    !cancelEnabled || cancelStatus !== 'not-executed' || !canCancelTask;\n\n  return (\n    <>\n      <Header\n        pageTitleOverride={\n          presentation\n            ? t('ongoingTask.pageTitle.hasTemplateName', {\n                templateName: presentation.primaryTitle,\n              })\n            : t('ongoingTask.pageTitle.noTemplateName')\n        }\n        title={\n          <div>\n            {t('ongoingTask.title')}{' '}\n            <code>{presentation ? presentation.primaryTitle : ''}</code>\n          </div>\n        }\n        subtitle={t('ongoingTask.subtitle', { taskId: taskId as string })}\n      >\n        <ContextMenu\n          cancelEnabled={cancelEnabled}\n          canRetry={canRetry}\n          isRetryableTask={isRetryableTask}\n          logsVisible={logsVisible}\n          buttonBarVisible={buttonBarVisible}\n          onStartOver={startOver}\n          onRetry={triggerRetry}\n          onToggleLogs={setLogVisibleState}\n          onToggleButtonBar={setButtonBarVisibleState}\n          taskId={taskId}\n          onCancel={triggerCancel}\n          isCancelButtonDisabled={isCancelButtonDisabled}\n        />\n      </Header>\n      <Content className={classes.contentWrapper}>\n        {taskStream.error ? (\n          <Box paddingBottom={2}>\n            <ErrorPanel\n              error={taskStream.error}\n              titleFormat=\"markdown\"\n              title={taskStream.error.message}\n            />\n          </Box>\n        ) : null}\n\n        <Box paddingBottom={2}>\n          <TaskSteps\n            steps={steps}\n            activeStep={activeStep}\n            isComplete={taskStream.completed}\n            isError={Boolean(taskStream.error)}\n          />\n        </Box>\n\n        <Outputs output={taskStream.output} />\n\n        {buttonBarVisible ? (\n          <Box paddingBottom={2}>\n            <Paper>\n              <Box padding={2}>\n                <div className={classes.buttonBar}>\n                  <Button\n                    className={classes.cancelButton}\n                    disabled={\n                      !cancelEnabled ||\n                      (cancelStatus !== 'not-executed' && !isRetryableTask) ||\n                      !canCancelTask\n                    }\n                    onClick={triggerCancel}\n                    data-testid=\"cancel-button\"\n                  >\n                    {t('ongoingTask.cancelButtonTitle')}\n                  </Button>\n                  {isRetryableTask && (\n                    <Button\n                      className={classes.retryButton}\n                      disabled={cancelEnabled || !canRetry}\n                      onClick={triggerRetry}\n                      data-testid=\"retry-button\"\n                    >\n                      {t('ongoingTask.retryButtonTitle')}\n                    </Button>\n                  )}\n                  <Button\n                    className={classes.logsVisibilityButton}\n                    color=\"primary\"\n                    variant=\"outlined\"\n                    onClick={() => setLogVisibleState(!logsVisible)}\n                  >\n                    {logsVisible\n                      ? t('ongoingTask.hideLogsButtonTitle')\n                      : t('ongoingTask.showLogsButtonTitle')}\n                  </Button>\n                  <Button\n                    variant=\"contained\"\n                    color=\"primary\"\n                    disabled={cancelEnabled || !canStartOver}\n                    onClick={startOver}\n                    data-testid=\"start-over-button\"\n                  >\n                    {t('ongoingTask.startOverButtonTitle')}\n                  </Button>\n                </div>\n              </Box>\n            </Paper>\n          </Box>\n        ) : null}\n\n        {logsVisible ? (\n          <Paper style={{ height: '100%' }}>\n            <Box padding={2} height=\"100%\">\n              <TaskLogStream logs={taskStream.stepLogs} />\n            </Box>\n          </Paper>\n        ) : null}\n      </Content>\n    </>\n  );\n}\n"],"names":["reactUseAsync","useAsync"],"mappings":"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"}