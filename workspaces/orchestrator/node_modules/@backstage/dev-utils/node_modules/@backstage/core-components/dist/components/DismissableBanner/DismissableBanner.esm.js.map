{"version":3,"file":"DismissableBanner.esm.js","sources":["../../../src/components/DismissableBanner/DismissableBanner.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode, useMemo } from 'react';\nimport { useApi, storageApiRef } from '@backstage/core-plugin-api';\nimport useObservable from 'react-use/esm/useObservable';\nimport classNames from 'classnames';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\nimport IconButton from '@material-ui/core/IconButton';\nimport Close from '@material-ui/icons/Close';\n\n/** @public */\nexport type DismissableBannerClassKey =\n  | 'root'\n  | 'topPosition'\n  | 'icon'\n  | 'content'\n  | 'message'\n  | 'info'\n  | 'error';\n\n/**\n * @public\n * @deprecated This type contained a typo, please use DismissableBannerClassKey instead\n */\nexport type DismissbleBannerClassKey = DismissableBannerClassKey;\n\nconst useStyles = makeStyles(\n  theme => ({\n    root: {\n      padding: theme.spacing(0),\n      marginBottom: theme.spacing(0),\n      marginTop: theme.spacing(0),\n      display: 'flex',\n      flexFlow: 'row nowrap',\n    },\n    // showing on top\n    topPosition: {\n      position: 'relative',\n      marginBottom: theme.spacing(6),\n      marginTop: -theme.spacing(3),\n      zIndex: 'unset',\n    },\n    icon: {\n      fontSize: theme.typography.h6.fontSize,\n    },\n    content: {\n      width: '100%',\n      maxWidth: 'inherit',\n      flexWrap: 'nowrap',\n      color: theme.palette.banner.text,\n    },\n    message: {\n      display: 'flex',\n      alignItems: 'center',\n      '& a': {\n        color: theme.palette.banner.link,\n      },\n    },\n    button: {\n      color: theme.palette.banner.closeButtonColor ?? 'inherit',\n    },\n    info: {\n      backgroundColor: theme.palette.banner.info,\n    },\n    error: {\n      backgroundColor: theme.palette.banner.error,\n    },\n    warning: {\n      backgroundColor:\n        theme.palette.banner.warning ?? theme.palette.banner.error,\n    },\n  }),\n  { name: 'BackstageDismissableBanner' },\n);\n\nexport type Props = {\n  variant: 'info' | 'error' | 'warning';\n  message: ReactNode;\n  id: string;\n  fixed?: boolean;\n};\n\n/** @public */\nexport const DismissableBanner = (props: Props) => {\n  const { variant, message, id, fixed = false } = props;\n  const classes = useStyles();\n  const storageApi = useApi(storageApiRef);\n  const notificationsStore = storageApi.forBucket('notifications');\n  const observedItems = useObservable(\n    notificationsStore.observe$<string[]>('dismissedBanners'),\n    notificationsStore.snapshot<string[]>('dismissedBanners'),\n  );\n\n  const dismissedBanners = useMemo(\n    () => new Set(observedItems.value ?? []),\n    [observedItems.value],\n  );\n\n  const loadingSettings = observedItems.presence === 'unknown';\n\n  const handleClick = () => {\n    notificationsStore.set('dismissedBanners', [...dismissedBanners, id]);\n  };\n\n  return (\n    <Snackbar\n      anchorOrigin={\n        fixed\n          ? { vertical: 'bottom', horizontal: 'center' }\n          : { vertical: 'top', horizontal: 'center' }\n      }\n      open={!loadingSettings && !dismissedBanners.has(id)}\n      classes={{\n        root: classNames(classes.root, !fixed && classes.topPosition),\n      }}\n    >\n      <SnackbarContent\n        classes={{\n          root: classNames(classes.content, classes[variant]),\n          message: classes.message,\n        }}\n        message={message}\n        action={[\n          <IconButton\n            key=\"dismiss\"\n            title=\"Permanently dismiss this message\"\n            className={classes.button}\n            onClick={handleClick}\n          >\n            <Close className={classes.icon} />\n          </IconButton>,\n        ]}\n      />\n    </Snackbar>\n  );\n};\n"],"names":["Close"],"mappings":"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"}