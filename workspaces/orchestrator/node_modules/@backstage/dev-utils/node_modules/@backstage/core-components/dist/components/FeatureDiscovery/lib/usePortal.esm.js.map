{"version":3,"file":"usePortal.esm.js","sources":["../../../../src/components/FeatureDiscovery/lib/usePortal.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useRef, useEffect } from 'react';\n\n/**\n * Creates DOM element to be used as React root.\n */\nfunction createRootElement(id: string): Element {\n  const rootContainer = document.createElement('div');\n  rootContainer.setAttribute('id', id);\n  return rootContainer;\n}\n\n/**\n * Appends element as last child of body.\n */\nfunction addRootElement(rootElem: Element): void {\n  document.body.insertBefore(\n    rootElem,\n    document.body.lastElementChild!.nextElementSibling,\n  );\n}\n\n/**\n * Hook to create a React Portal.\n *\n * Automatically handles creating and tearing-down the root elements (no SRR\n * makes this trivial), so there is no need to ensure the parent target already\n * exists.\n *\n * @example\n * const target = usePortal(id, [id]);\n * return createPortal(children, target);\n *\n * @param id - The id of the target container, e.g 'modal' or 'spotlight'\n * @returns The DOM node to use as the Portal target.\n */\nexport function usePortal(id: string): HTMLElement {\n  const rootElemRef = useRef<HTMLElement | null>(null);\n\n  useEffect(\n    function setupElement() {\n      // Look for existing target dom element to append to\n      const existingParent = document.querySelector(`#${id}`);\n      // Parent is either a new root or the existing dom element\n      const parentElem = existingParent || createRootElement(id);\n\n      // If there is no existing DOM element, add a new one.\n      if (!existingParent) {\n        addRootElement(parentElem);\n      }\n\n      // Add the detached element to the parent\n      parentElem.appendChild(rootElemRef.current!);\n\n      return function removeElement() {\n        rootElemRef.current!.remove();\n        if (parentElem.childNodes.length === -1) {\n          parentElem.remove();\n        }\n      };\n    },\n    [id],\n  );\n\n  /**\n   * It's important we evaluate this lazily:\n   * - We need first render to contain the DOM element, so it shouldn't happen\n   *   in useEffect. We would normally put this in the constructor().\n   * - We can't do 'const rootElemRef = useRef(document.createElement('div))',\n   *   since this will run every single render (that's a lot).\n   * - We want the ref to consistently point to the same DOM element and only\n   *   ever run once.\n   * @link https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\n   */\n  function getRootElem() {\n    if (!rootElemRef.current) {\n      rootElemRef.current = document.createElement('div');\n    }\n    return rootElemRef.current;\n  }\n\n  return getRootElem();\n}\n\nexport default usePortal;\n"],"names":[],"mappings":";;AAoBA,SAAS,kBAAkB,EAAA,EAAqB;AAC9C,EAAA,MAAM,aAAA,GAAgB,QAAA,CAAS,aAAA,CAAc,KAAK,CAAA;AAClD,EAAA,aAAA,CAAc,YAAA,CAAa,MAAM,EAAE,CAAA;AACnC,EAAA,OAAO,aAAA;AACT;AAKA,SAAS,eAAe,QAAA,EAAyB;AAC/C,EAAA,QAAA,CAAS,IAAA,CAAK,YAAA;AAAA,IACZ,QAAA;AAAA,IACA,QAAA,CAAS,KAAK,gBAAA,CAAkB;AAAA,GAClC;AACF;AAgBO,SAAS,UAAU,EAAA,EAAyB;AACjD,EAAA,MAAM,WAAA,GAAc,OAA2B,IAAI,CAAA;AAEnD,EAAA,SAAA;AAAA,IACE,SAAS,YAAA,GAAe;AAEtB,MAAA,MAAM,cAAA,GAAiB,QAAA,CAAS,aAAA,CAAc,CAAA,CAAA,EAAI,EAAE,CAAA,CAAE,CAAA;AAEtD,MAAA,MAAM,UAAA,GAAa,cAAA,IAAkB,iBAAA,CAAkB,EAAE,CAAA;AAGzD,MAAA,IAAI,CAAC,cAAA,EAAgB;AACnB,QAAA,cAAA,CAAe,UAAU,CAAA;AAAA,MAC3B;AAGA,MAAA,UAAA,CAAW,WAAA,CAAY,YAAY,OAAQ,CAAA;AAE3C,MAAA,OAAO,SAAS,aAAA,GAAgB;AAC9B,QAAA,WAAA,CAAY,QAAS,MAAA,EAAO;AAC5B,QAAA,IAAI,UAAA,CAAW,UAAA,CAAW,MAAA,KAAW,EAAA,EAAI;AACvC,UAAA,UAAA,CAAW,MAAA,EAAO;AAAA,QACpB;AAAA,MACF,CAAA;AAAA,IACF,CAAA;AAAA,IACA,CAAC,EAAE;AAAA,GACL;AAYA,EAAA,SAAS,WAAA,GAAc;AACrB,IAAA,IAAI,CAAC,YAAY,OAAA,EAAS;AACxB,MAAA,WAAA,CAAY,OAAA,GAAU,QAAA,CAAS,aAAA,CAAc,KAAK,CAAA;AAAA,IACpD;AACA,IAAA,OAAO,WAAA,CAAY,OAAA;AAAA,EACrB;AAEA,EAAA,OAAO,WAAA,EAAY;AACrB;;;;"}