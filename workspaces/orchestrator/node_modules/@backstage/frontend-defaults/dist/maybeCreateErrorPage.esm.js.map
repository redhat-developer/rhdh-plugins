{"version":3,"file":"maybeCreateErrorPage.esm.js","sources":["../src/maybeCreateErrorPage.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FrontendPluginInfo } from '@backstage/frontend-plugin-api';\nimport { JSX, useEffect, useState } from 'react';\nimport { AppError, AppErrorTypes } from '@backstage/frontend-app-api';\n\nconst DEFAULT_WARNING_CODES: Array<keyof AppErrorTypes> = [\n  'EXTENSION_IGNORED',\n  'INVALID_EXTENSION_CONFIG_KEY',\n  'EXTENSION_INPUT_DATA_IGNORED',\n  'EXTENSION_OUTPUT_IGNORED',\n];\n\nfunction AppErrorItem(props: { error: AppError }): JSX.Element {\n  const { context } = props.error;\n\n  const node = 'node' in context ? context.node : undefined;\n  const extensionId =\n    'extensionId' in context ? context.extensionId : node?.spec.id;\n  const routeId = 'routeId' in context ? context.routeId : undefined;\n  const plugin = 'plugin' in context ? context.plugin : node?.spec.plugin;\n  const pluginId = plugin?.id ?? 'N/A';\n\n  const [info, setInfo] = useState<FrontendPluginInfo | undefined>(undefined);\n  useEffect(() => {\n    plugin?.info().then(setInfo, error => {\n      // eslint-disable-next-line no-console\n      console.error(`Failed to load info for plugin ${plugin.id}: ${error}`);\n    });\n  }, [plugin]);\n\n  return (\n    <div>\n      <b>{props.error.code}</b>: {props.error.message}\n      <pre style={{ marginLeft: '1rem' }}>\n        {extensionId && <div>extensionId: {extensionId}</div>}\n        {routeId && <div>routeId: {routeId}</div>}\n        {pluginId && <div>pluginId: {pluginId}</div>}\n        {info && (\n          <div>\n            package: {info.packageName}@{info.version}\n          </div>\n        )}\n      </pre>\n    </div>\n  );\n}\n\nfunction AppErrorPage(props: { errors: AppError[] }): JSX.Element {\n  return (\n    <div style={{ margin: '1rem' }}>\n      <h2>App startup failed</h2>\n      {props.errors.map((error, index) => (\n        <AppErrorItem error={error} key={index} />\n      ))}\n    </div>\n  );\n}\n\n/**\n * If there are any unrecoverable errors in the app, this will return an error page in the form of a JSX element.\n *\n * If there are any recoverable errors, they will always be logged as warnings in the console.\n * @public\n */\nexport function maybeCreateErrorPage(\n  app: { errors?: AppError[] },\n  options?: {\n    warningCodes?: Array<keyof AppErrorTypes>;\n  },\n): JSX.Element | undefined {\n  if (!app.errors) {\n    return undefined;\n  }\n\n  const errors = new Array<AppError>();\n  const warnings = new Array<AppError>();\n\n  const warningCodes = new Set(options?.warningCodes ?? DEFAULT_WARNING_CODES);\n  for (const error of app.errors) {\n    if (warningCodes.has(error.code)) {\n      warnings.push(error);\n    } else {\n      errors.push(error);\n    }\n  }\n\n  if (warnings.length > 0) {\n    // eslint-disable-next-line no-console\n    console.warn('App startup encountered warnings:');\n    for (const warning of warnings) {\n      // eslint-disable-next-line no-console\n      console.warn(`${warning.code}: ${warning.message}`);\n    }\n  }\n\n  if (errors.length === 0) {\n    return undefined;\n  }\n\n  return <AppErrorPage errors={errors} />;\n}\n"],"names":[],"mappings":"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"}