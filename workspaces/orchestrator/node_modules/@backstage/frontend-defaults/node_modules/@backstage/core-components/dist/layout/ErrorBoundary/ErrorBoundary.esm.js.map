{"version":3,"file":"ErrorBoundary.esm.js","sources":["../../../src/layout/ErrorBoundary/ErrorBoundary.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Typography from '@material-ui/core/Typography';\nimport { PropsWithChildren, ComponentClass, Component, ErrorInfo } from 'react';\nimport { LinkButton } from '../../components/LinkButton';\nimport { ErrorPanel } from '../../components/ErrorPanel';\nimport { coreComponentsTranslationRef } from '../../translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\ntype SlackChannel = {\n  name: string;\n  href?: string;\n};\n\n/** @public */\nexport type ErrorBoundaryProps = PropsWithChildren<{\n  slackChannel?: string | SlackChannel;\n  onError?: (error: Error, errorInfo: string) => null;\n}>;\n\ntype State = {\n  error?: Error;\n  errorInfo?: ErrorInfo;\n};\n\nconst SlackLink = (props: { slackChannel?: string | SlackChannel }) => {\n  const { slackChannel } = props;\n  const { t } = useTranslationRef(coreComponentsTranslationRef);\n\n  if (!slackChannel) {\n    return null;\n  } else if (typeof slackChannel === 'string') {\n    return (\n      <Typography>{t('errorBoundary.title', { slackChannel })}</Typography>\n    );\n  } else if (!slackChannel.href) {\n    return (\n      <Typography>\n        {t('errorBoundary.title', {\n          slackChannel: slackChannel.name,\n        })}\n      </Typography>\n    );\n  }\n\n  return (\n    <LinkButton to={slackChannel.href} variant=\"contained\">\n      {slackChannel.name}\n    </LinkButton>\n  );\n};\n\n/** @public */\nexport const ErrorBoundary: ComponentClass<\n  ErrorBoundaryProps,\n  State\n> = class ErrorBoundary extends Component<ErrorBoundaryProps, State> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      error: undefined,\n      errorInfo: undefined,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // eslint-disable-next-line no-console\n    console.error(`ErrorBoundary, error: ${error}`, { error, errorInfo });\n    this.setState({ error, errorInfo });\n  }\n\n  render() {\n    const { slackChannel, children } = this.props;\n    const { error } = this.state;\n\n    if (!error) {\n      return children;\n    }\n\n    return (\n      <ErrorPanel title=\"Something Went Wrong\" error={error}>\n        <SlackLink slackChannel={slackChannel} />\n      </ErrorPanel>\n    );\n  }\n};\n"],"names":["ErrorBoundary"],"mappings":";;;;;;;;AAuCA,MAAM,SAAA,GAAY,CAAC,KAAA,KAAoD;AACrE,EAAA,MAAM,EAAE,cAAa,GAAI,KAAA;AACzB,EAAA,MAAM,EAAE,CAAA,EAAE,GAAI,iBAAA,CAAkB,4BAA4B,CAAA;AAE5D,EAAA,IAAI,CAAC,YAAA,EAAc;AACjB,IAAA,OAAO,IAAA;AAAA,EACT,CAAA,MAAA,IAAW,OAAO,YAAA,KAAiB,QAAA,EAAU;AAC3C,IAAA,2BACG,UAAA,EAAA,EAAY,QAAA,EAAA,CAAA,CAAE,uBAAuB,EAAE,YAAA,EAAc,CAAA,EAAE,CAAA;AAAA,EAE5D,CAAA,MAAA,IAAW,CAAC,YAAA,CAAa,IAAA,EAAM;AAC7B,IAAA,uBACE,GAAA,CAAC,UAAA,EAAA,EACE,QAAA,EAAA,CAAA,CAAE,qBAAA,EAAuB;AAAA,MACxB,cAAc,YAAA,CAAa;AAAA,KAC5B,CAAA,EACH,CAAA;AAAA,EAEJ;AAEA,EAAA,uBACE,GAAA,CAAC,cAAW,EAAA,EAAI,YAAA,CAAa,MAAM,OAAA,EAAQ,WAAA,EACxC,uBAAa,IAAA,EAChB,CAAA;AAEJ,CAAA;AAGO,MAAM,aAAA,GAGT,MAAMA,cAAAA,SAAsB,SAAA,CAAqC;AAAA,EACnE,YAAY,KAAA,EAA2B;AACrC,IAAA,KAAA,CAAM,KAAK,CAAA;AACX,IAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,MACX,KAAA,EAAO,MAAA;AAAA,MACP,SAAA,EAAW;AAAA,KACb;AAAA,EACF;AAAA,EAEA,iBAAA,CAAkB,OAAc,SAAA,EAAsB;AAEpD,IAAA,OAAA,CAAQ,MAAM,CAAA,sBAAA,EAAyB,KAAK,IAAI,EAAE,KAAA,EAAO,WAAW,CAAA;AACpE,IAAA,IAAA,CAAK,QAAA,CAAS,EAAE,KAAA,EAAO,SAAA,EAAW,CAAA;AAAA,EACpC;AAAA,EAEA,MAAA,GAAS;AACP,IAAA,MAAM,EAAE,YAAA,EAAc,QAAA,EAAS,GAAI,IAAA,CAAK,KAAA;AACxC,IAAA,MAAM,EAAE,KAAA,EAAM,GAAI,IAAA,CAAK,KAAA;AAEvB,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,OAAO,QAAA;AAAA,IACT;AAEA,IAAA,uBACE,GAAA,CAAC,cAAW,KAAA,EAAM,sBAAA,EAAuB,OACvC,QAAA,kBAAA,GAAA,CAAC,SAAA,EAAA,EAAU,cAA4B,CAAA,EACzC,CAAA;AAAA,EAEJ;AACF;;;;"}