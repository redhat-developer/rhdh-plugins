{"version":3,"file":"ReportIssueContent.esm.js","sources":["../../src/ReportIssue/ReportIssueContent.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useEffect } from 'react';\nimport { makeStyles, Portal, Paper } from '@material-ui/core';\nimport { useGitTemplate } from './hooks';\nimport {\n  PAGE_MAIN_CONTENT_SELECTOR,\n  PAGE_FEEDBACK_LINK_SELECTOR,\n  ADDON_FEEDBACK_CONTAINER_ID,\n  ADDON_FEEDBACK_CONTAINER_SELECTOR,\n} from './constants';\nimport { IssueLink } from './IssueLink';\nimport {\n  useShadowRootElements,\n  useShadowRootSelection,\n} from '@backstage/plugin-techdocs-react';\nimport { Repository } from './types';\nimport { ReportIssueProps } from './ReportIssue';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    transform: 'translate(-100%, -100%)',\n    position: 'absolute',\n    padding: theme.spacing(1),\n    zIndex: theme.zIndex.tooltip,\n    background: theme.palette.common.white,\n  },\n}));\n\ntype Style = {\n  top: string;\n  left: string;\n};\n\n// Props customizing the <ReportIssue /> Addon.\nexport type ReportIssueAddonContentProps = ReportIssueProps & {\n  repository: Repository;\n};\n\nexport const ReportIssueAddonContent = ({\n  debounceTime,\n  templateBuilder,\n  repository,\n}: ReportIssueAddonContentProps) => {\n  const classes = useStyles();\n  const [style, setStyle] = useState<Style>();\n  const defaultTemplate = useGitTemplate(debounceTime);\n  const selection = useShadowRootSelection(debounceTime);\n\n  const [mainContent, feedbackLink] = useShadowRootElements([\n    PAGE_MAIN_CONTENT_SELECTOR,\n    PAGE_FEEDBACK_LINK_SELECTOR,\n  ]);\n\n  let [feedbackContainer] = useShadowRootElements([\n    ADDON_FEEDBACK_CONTAINER_SELECTOR,\n  ]);\n\n  if (feedbackLink) {\n    feedbackLink.style.display = 'none';\n  }\n\n  useEffect(() => {\n    if (\n      !selection ||\n      !selection.containsNode(mainContent, true) ||\n      selection.containsNode(feedbackContainer, true)\n    ) {\n      return;\n    }\n\n    const mainContentPosition = mainContent.getBoundingClientRect();\n    const selectionPosition = selection.getRangeAt(0).getBoundingClientRect();\n\n    const distanceFromTop = selectionPosition.top - mainContentPosition.top;\n    const minDistanceFromTop = 50;\n\n    let top = distanceFromTop < minDistanceFromTop ? 101 : distanceFromTop - 16;\n\n    if (mainContentPosition.top < 0) {\n      const absMainContentTop = Math.abs(mainContentPosition.top);\n      if (distanceFromTop - absMainContentTop < minDistanceFromTop) {\n        top += 89;\n      }\n    }\n\n    setStyle({\n      top: `${top}px`,\n      left: `${selectionPosition.left + selectionPosition.width / 2}px`,\n    });\n  }, [selection, mainContent, feedbackContainer]);\n\n  if (!feedbackContainer) {\n    feedbackContainer = document.createElement('div');\n    feedbackContainer.setAttribute('id', ADDON_FEEDBACK_CONTAINER_ID);\n    mainContent!.prepend(feedbackContainer);\n  }\n\n  if (!selection || !selection.containsNode(mainContent, true)) {\n    return null;\n  }\n\n  return (\n    <Portal container={feedbackContainer}>\n      <Paper\n        data-testid=\"report-issue-addon\"\n        className={classes.root}\n        style={style}\n      >\n        <IssueLink\n          repository={repository}\n          template={\n            templateBuilder ? templateBuilder({ selection }) : defaultTemplate\n          }\n        />\n      </Paper>\n    </Portal>\n  );\n};\n"],"names":[],"mappings":"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"}