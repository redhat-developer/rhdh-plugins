{"version":3,"file":"overrides.esm.js","sources":["../../src/unified/overrides.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Overrides } from '@material-ui/core/styles/overrides';\nimport type { ComponentsProps } from '@material-ui/core/styles/props';\nimport { ComponentsOverrides, Theme, ThemeOptions } from '@mui/material/styles';\nimport { CSSProperties } from 'react';\n\ntype V5Override = ComponentsOverrides[Exclude<\n  keyof ComponentsOverrides,\n  'MuiCssBaseline'\n>];\ntype V4Override = Overrides[keyof Overrides];\ntype StaticStyleRules = Record<\n  string,\n  CSSProperties | Record<string, CSSProperties>\n>;\n\n// Utility function based on v5 `createSpacing`: https://github.com/mui/material-ui/blob/master/packages/mui-system/src/createTheme/createSpacing.ts#L42C3-L59C5\nconst __v5Spacing =\n  (defaultSpacing: number) =>\n  (...argsInput: ReadonlyArray<number | string>) => {\n    const args = argsInput.length === 0 ? [1] : argsInput;\n    const transform = (argument: string | number, themeSpacing: number) => {\n      if (typeof argument === 'string') {\n        return argument;\n      }\n      return themeSpacing * argument;\n    };\n\n    return args\n      .map(argument => {\n        const output = transform(argument, defaultSpacing);\n        return typeof output === 'number' ? `${output}px` : output;\n      })\n      .join(' ');\n  };\n\n// Converts callback-based overrides to static styles, e.g.\n// { root: theme => ({ color: theme.color }) } -> { root: { color: 'red' } }\nfunction adaptV5CssBaselineOverride(\n  theme: Theme,\n  overrides: ComponentsOverrides['MuiCssBaseline'],\n): StaticStyleRules | undefined {\n  if (!overrides || typeof overrides === 'string') {\n    return undefined;\n  }\n\n  const styles = typeof overrides === 'function' ? overrides(theme) : overrides;\n  if (styles) {\n    return { '@global': styles } as StaticStyleRules;\n  }\n\n  return undefined;\n}\n\n// Converts callback-based overrides to static styles, e.g.\n// { root: theme => ({ color: theme.color }) } -> { root: { color: 'red' } }\nfunction adaptV5Override(\n  theme: Theme,\n  overrides: V5Override,\n): StaticStyleRules | undefined {\n  if (!overrides || typeof overrides === 'string') {\n    return undefined;\n  }\n  if (typeof overrides === 'object') {\n    const _theme = { ...theme };\n    const defaultSpacing = theme.spacing(1);\n    if (typeof defaultSpacing === 'number') {\n      // Override potential v4 spacing method: https://mui.com/material-ui/migration/v5-style-changes/#%E2%9C%85-remove-px-suffix\n      // `adaptV4Theme as reference: https://github.com/mui/material-ui/blob/v5.x/packages/mui-material/src/styles/adaptV4Theme.js#L54C41-L54C41\n      _theme.spacing = __v5Spacing(defaultSpacing);\n    }\n    return Object.fromEntries(\n      Object.entries(overrides).map(([className, style]) => {\n        if (typeof style === 'function') {\n          return [className, style({ theme: _theme })];\n        }\n        return [className, style];\n      }),\n    );\n  }\n  return overrides as StaticStyleRules;\n}\n\nconst stateStyleKeyPattern = /^&.Mui-([\\w-]+)$/;\n\n// Move state style overrides to the top level, e.g.\n// { root: { '&.Mui-active': { color: 'red' } } } -> { active: { color: 'red' } }\nfunction extractV5StateOverrides(\n  overrides: StaticStyleRules | undefined,\n): StaticStyleRules | undefined {\n  let output = overrides;\n  if (!overrides || typeof overrides !== 'object') {\n    return output;\n  }\n  for (const className of Object.keys(overrides)) {\n    const styles = overrides[className];\n    if (!styles || typeof styles !== 'object') {\n      continue;\n    }\n    for (const _styleKey of Object.keys(styles)) {\n      const styleKey = _styleKey as keyof typeof styles;\n      const match = styleKey.match(stateStyleKeyPattern);\n      if (match) {\n        const [, state] = match;\n        const { [styleKey]: stateStyles, ...restStyles } = styles;\n        if (stateStyles) {\n          output = {\n            ...output,\n            [className]: restStyles,\n            [state]: stateStyles,\n          };\n        }\n      }\n    }\n  }\n  return output;\n}\n\n/**\n * Transform Material UI v5 component themes into a v4 theme props and overrides.\n *\n * @public\n */\nexport function transformV5ComponentThemesToV4(\n  theme: Theme,\n  components: ThemeOptions['components'] = {},\n): { overrides: Overrides; props: ComponentsProps } {\n  const overrides: Record<string, V4Override> = {};\n  const props: Record<string, ComponentsProps[keyof ComponentsProps]> = {};\n\n  for (const name of Object.keys(components)) {\n    const component = components[name as keyof typeof components];\n    if (!component) {\n      continue;\n    }\n    if ('styleOverrides' in component) {\n      if (name === 'MuiCssBaseline') {\n        overrides[name] = adaptV5CssBaselineOverride(\n          theme,\n          component.styleOverrides as ComponentsOverrides['MuiCssBaseline'],\n        );\n      } else {\n        overrides[name] = extractV5StateOverrides(\n          adaptV5Override(theme, component.styleOverrides as V5Override),\n        );\n      }\n    }\n    if ('defaultProps' in component) {\n      props[name] = component.defaultProps;\n    }\n  }\n\n  return { overrides, props };\n}\n"],"names":[],"mappings":"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"}