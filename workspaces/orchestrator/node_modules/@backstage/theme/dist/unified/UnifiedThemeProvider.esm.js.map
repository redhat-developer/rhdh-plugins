{"version":3,"file":"UnifiedThemeProvider.esm.js","sources":["../../src/unified/UnifiedThemeProvider.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode, useEffect } from 'react';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport {\n  ThemeProvider,\n  StylesProvider,\n  createGenerateClassName,\n  Theme as Mui4Theme,\n} from '@material-ui/core/styles';\nimport {\n  StyledEngineProvider,\n  ThemeProvider as Mui5Provider,\n  Theme as Mui5Theme,\n} from '@mui/material/styles';\nimport { UnifiedTheme } from './types';\nimport { unstable_ClassNameGenerator as ClassNameGenerator } from '@mui/material/className';\n\n/**\n * Props for {@link UnifiedThemeProvider}.\n *\n * @public\n */\nexport interface UnifiedThemeProviderProps {\n  children: ReactNode;\n  theme: UnifiedTheme;\n  noCssBaseline?: boolean;\n}\n\n/**\n * This API is introduced in @mui/material (v5.0.5) as a replacement of deprecated createGenerateClassName & only affects v5 Material UI components from `@mui/*`.\n *\n * This call needs to be in the same module as the `UnifiedThemeProvider` to ensure that it doesn't get removed by tree shaking\n */\nClassNameGenerator.configure(componentName => {\n  return `v5-${componentName}`;\n});\n\n// Background at https://mui.com/x/migration/migration-data-grid-v4/#using-mui-core-v4-with-v5\n// Rather than disabling globals and custom seed, we instead only set a production prefix that\n// won't collide with Material UI 5 styles. We've already got the separate class name generator\n// for v5 set up in just above, so only the production JSS needs deduplication.\nconst generateV4ClassName = createGenerateClassName({\n  productionPrefix: 'jss4-',\n});\n\n/**\n * Provides themes for all Material UI versions supported by the provided unified theme.\n *\n * @public\n */\nexport function UnifiedThemeProvider(\n  props: UnifiedThemeProviderProps,\n): JSX.Element {\n  const { children, theme, noCssBaseline = false } = props;\n\n  const v4Theme = theme.getTheme('v4') as Mui4Theme;\n  const v5Theme = theme.getTheme('v5') as Mui5Theme;\n  const themeMode = v4Theme ? v4Theme.palette.type : v5Theme?.palette.mode;\n  const themeName = 'backstage';\n\n  useEffect(() => {\n    document.body.setAttribute('data-theme-mode', themeMode);\n    document.body.setAttribute('data-theme-name', themeName);\n\n    return () => {\n      document.body.removeAttribute('data-theme-mode');\n      document.body.removeAttribute('data-theme-name');\n    };\n  }, [themeMode, themeName]);\n\n  let cssBaseline: JSX.Element | undefined = undefined;\n  if (!noCssBaseline) {\n    cssBaseline = <CssBaseline />;\n  }\n\n  let result = (\n    <>\n      {cssBaseline}\n      {children}\n    </>\n  );\n\n  if (v4Theme) {\n    result = (\n      <StylesProvider generateClassName={generateV4ClassName}>\n        <ThemeProvider theme={v4Theme}>{result}</ThemeProvider>\n      </StylesProvider>\n    );\n  }\n\n  if (v5Theme) {\n    result = (\n      <StyledEngineProvider injectFirst>\n        <Mui5Provider theme={v5Theme}>{result}</Mui5Provider>\n      </StyledEngineProvider>\n    );\n  }\n\n  return result;\n}\n"],"names":["ClassNameGenerator","Mui5Provider"],"mappings":";;;;;;;AAgDAA,2BAAA,CAAmB,UAAU,CAAA,aAAA,KAAiB;AAC5C,EAAA,OAAO,MAAM,aAAa,CAAA,CAAA;AAC5B,CAAC,CAAA;AAMD,MAAM,sBAAsB,uBAAA,CAAwB;AAAA,EAClD,gBAAA,EAAkB;AACpB,CAAC,CAAA;AAOM,SAAS,qBACd,KAAA,EACa;AACb,EAAA,MAAM,EAAE,QAAA,EAAU,KAAA,EAAO,aAAA,GAAgB,OAAM,GAAI,KAAA;AAEnD,EAAA,MAAM,OAAA,GAAU,KAAA,CAAM,QAAA,CAAS,IAAI,CAAA;AACnC,EAAA,MAAM,OAAA,GAAU,KAAA,CAAM,QAAA,CAAS,IAAI,CAAA;AACnC,EAAA,MAAM,YAAY,OAAA,GAAU,OAAA,CAAQ,OAAA,CAAQ,IAAA,GAAO,SAAS,OAAA,CAAQ,IAAA;AACpE,EAAA,MAAM,SAAA,GAAY,WAAA;AAElB,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,QAAA,CAAS,IAAA,CAAK,YAAA,CAAa,iBAAA,EAAmB,SAAS,CAAA;AACvD,IAAA,QAAA,CAAS,IAAA,CAAK,YAAA,CAAa,iBAAA,EAAmB,SAAS,CAAA;AAEvD,IAAA,OAAO,MAAM;AACX,MAAA,QAAA,CAAS,IAAA,CAAK,gBAAgB,iBAAiB,CAAA;AAC/C,MAAA,QAAA,CAAS,IAAA,CAAK,gBAAgB,iBAAiB,CAAA;AAAA,IACjD,CAAA;AAAA,EACF,CAAA,EAAG,CAAC,SAAA,EAAW,SAAS,CAAC,CAAA;AAEzB,EAAA,IAAI,WAAA,GAAuC,MAAA;AAC3C,EAAA,IAAI,CAAC,aAAA,EAAe;AAClB,IAAA,WAAA,uBAAe,WAAA,EAAA,EAAY,CAAA;AAAA,EAC7B;AAEA,EAAA,IAAI,yBACF,IAAA,CAAA,QAAA,EAAA,EACG,QAAA,EAAA;AAAA,IAAA,WAAA;AAAA,IACA;AAAA,GAAA,EACH,CAAA;AAGF,EAAA,IAAI,OAAA,EAAS;AACX,IAAA,MAAA,mBACE,GAAA,CAAC,kBAAe,iBAAA,EAAmB,mBAAA,EACjC,8BAAC,aAAA,EAAA,EAAc,KAAA,EAAO,OAAA,EAAU,QAAA,EAAA,MAAA,EAAO,CAAA,EACzC,CAAA;AAAA,EAEJ;AAEA,EAAA,IAAI,OAAA,EAAS;AACX,IAAA,MAAA,mBACE,GAAA,CAAC,wBAAqB,WAAA,EAAW,IAAA,EAC/B,8BAACC,eAAA,EAAA,EAAa,KAAA,EAAO,OAAA,EAAU,QAAA,EAAA,MAAA,EAAO,CAAA,EACxC,CAAA;AAAA,EAEJ;AAEA,EAAA,OAAO,MAAA;AACT;;;;"}