{"version":3,"file":"MobileSidebar.esm.js","sources":["../../../src/layout/Sidebar/MobileSidebar.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useElementFilter } from '@backstage/core-plugin-api';\nimport BottomNavigation from '@material-ui/core/BottomNavigation';\nimport Box from '@material-ui/core/Box';\nimport IconButton from '@material-ui/core/IconButton';\nimport { Theme, makeStyles } from '@material-ui/core/styles';\nimport Drawer from '@material-ui/core/Drawer';\nimport Typography from '@material-ui/core/Typography';\nimport CloseIcon from '@material-ui/icons/Close';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport { orderBy } from 'lodash';\nimport {\n  useEffect,\n  useState,\n  useContext,\n  ReactNode,\n  ReactElement,\n  createElement,\n} from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { SidebarOpenStateProvider } from './SidebarOpenStateContext';\nimport { SidebarGroup } from './SidebarGroup';\nimport { SidebarConfigContext, SidebarConfig } from './config';\nimport { MobileSidebarContext } from './MobileSidebarContext';\n\n/**\n * Props of MobileSidebar\n *\n * @public\n */\nexport type MobileSidebarProps = {\n  children?: ReactNode;\n};\n\n/**\n * @internal\n */\ntype OverlayMenuProps = {\n  label?: string;\n  onClose: () => void;\n  open: boolean;\n  children?: ReactNode;\n};\n\nconst useStyles = makeStyles<Theme, { sidebarConfig: SidebarConfig }>(\n  theme => ({\n    root: {\n      position: 'fixed',\n      backgroundColor: theme.palette.navigation.background,\n      color: theme.palette.navigation.color,\n      bottom: 0,\n      left: 0,\n      right: 0,\n      zIndex: theme.zIndex.snackbar,\n      // SidebarDivider color\n      borderTop: '1px solid #383838',\n      '@media print': {\n        display: 'none',\n      },\n    },\n\n    overlay: props => ({\n      background: theme.palette.navigation.background,\n      width: '100%',\n      bottom: `${props.sidebarConfig.mobileSidebarHeight}px`,\n      height: `calc(100% - ${props.sidebarConfig.mobileSidebarHeight}px)`,\n      flex: '0 1 auto',\n      overflow: 'auto',\n    }),\n\n    overlayHeader: {\n      display: 'flex',\n      color: theme.palette.navigation.color,\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      padding: theme.spacing(2, 3),\n    },\n\n    overlayHeaderClose: {\n      color: theme.palette.navigation.color,\n    },\n\n    marginMobileSidebar: props => ({\n      marginBottom: `${props.sidebarConfig.mobileSidebarHeight}px`,\n    }),\n  }),\n);\n\nconst sortSidebarGroupsForPriority = (children: ReactElement[]) =>\n  orderBy(\n    children,\n    ({ props: { priority } }) => (Number.isInteger(priority) ? priority : -1),\n    'desc',\n  );\n\nconst sidebarGroupType = createElement(SidebarGroup).type;\n\nconst OverlayMenu = ({\n  children,\n  label = 'Menu',\n  open,\n  onClose,\n}: OverlayMenuProps) => {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const classes = useStyles({ sidebarConfig });\n\n  return (\n    <Drawer\n      anchor=\"bottom\"\n      open={open}\n      onClose={onClose}\n      ModalProps={{\n        BackdropProps: { classes: { root: classes.marginMobileSidebar } },\n      }}\n      classes={{\n        root: classes.marginMobileSidebar,\n        paperAnchorBottom: classes.overlay,\n      }}\n    >\n      <Box className={classes.overlayHeader}>\n        <Typography variant=\"h3\">{label}</Typography>\n        <IconButton\n          onClick={onClose}\n          classes={{ root: classes.overlayHeaderClose }}\n        >\n          <CloseIcon />\n        </IconButton>\n      </Box>\n      <Box component=\"nav\">{children}</Box>\n    </Drawer>\n  );\n};\n\n/**\n * A navigation component for mobile screens, which sticks to the bottom.\n *\n * @remarks\n * It alternates the normal sidebar by grouping the `SidebarItems` based on provided `SidebarGroup`s\n * either rendering them as a link or an overlay menu.\n * If no `SidebarGroup`s are provided the sidebar content is wrapped in an default overlay menu.\n *\n * @public\n */\nexport const MobileSidebar = (props: MobileSidebarProps) => {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const { children } = props;\n  const classes = useStyles({ sidebarConfig });\n  const location = useLocation();\n  const [selectedMenuItemIndex, setSelectedMenuItemIndex] =\n    useState<number>(-1);\n\n  useEffect(() => {\n    setSelectedMenuItemIndex(-1);\n  }, [location.pathname]);\n\n  // Filter children for SidebarGroups\n  //\n  // Directly comparing child.type with SidebarSubmenu will not work with in\n  // combination with react-hot-loader\n  //\n  // https://github.com/gaearon/react-hot-loader/issues/304#issuecomment-456569720\n  let sidebarGroups = useElementFilter(children, elements =>\n    elements.getElements().filter(child => child.type === sidebarGroupType),\n  );\n\n  if (!children) {\n    // If Sidebar has no children the MobileSidebar won't be rendered\n    return null;\n  } else if (!sidebarGroups.length) {\n    // If Sidebar has no SidebarGroup as a children a default\n    // SidebarGroup with the complete Sidebar content will be created\n    sidebarGroups.push(\n      <SidebarGroup key=\"default_menu\" icon={<MenuIcon />}>\n        {children}\n      </SidebarGroup>,\n    );\n  } else {\n    // Sort SidebarGroups for the given Priority\n    sidebarGroups = sortSidebarGroupsForPriority(sidebarGroups);\n  }\n\n  const shouldShowGroupChildren =\n    selectedMenuItemIndex >= 0 &&\n    !sidebarGroups[selectedMenuItemIndex].props.to;\n\n  return (\n    <SidebarOpenStateProvider value={{ isOpen: true, setOpen: () => {} }}>\n      <MobileSidebarContext.Provider\n        value={{ selectedMenuItemIndex, setSelectedMenuItemIndex }}\n      >\n        <OverlayMenu\n          label={\n            sidebarGroups[selectedMenuItemIndex] &&\n            (sidebarGroups[selectedMenuItemIndex]!.props.label as string)\n          }\n          open={shouldShowGroupChildren}\n          onClose={() => setSelectedMenuItemIndex(-1)}\n        >\n          {sidebarGroups[selectedMenuItemIndex] &&\n            (sidebarGroups[selectedMenuItemIndex].props.children as ReactNode)}\n        </OverlayMenu>\n        <BottomNavigation\n          className={classes.root}\n          data-testid=\"mobile-sidebar-root\"\n          component=\"nav\"\n        >\n          {sidebarGroups}\n        </BottomNavigation>\n      </MobileSidebarContext.Provider>\n    </SidebarOpenStateProvider>\n  );\n};\n"],"names":[],"mappings":"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"}