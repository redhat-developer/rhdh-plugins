{"version":3,"file":"SearchPagination.esm.js","sources":["../../../src/components/SearchPagination/SearchPagination.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ReactNode,\n  ChangeEvent,\n  MouseEvent,\n  useCallback,\n  useMemo,\n} from 'react';\nimport TablePagination from '@material-ui/core/TablePagination';\nimport { useSearch } from '../../context';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { searchReactTranslationRef } from '../../translation';\n\nconst encodePageCursor = (pageCursor: number): string => {\n  return Buffer.from(pageCursor.toString(), 'utf-8').toString('base64');\n};\n\nconst decodePageCursor = (pageCursor?: string): number => {\n  if (!pageCursor) return 0;\n  return Number(Buffer.from(pageCursor, 'base64').toString('utf-8'));\n};\n\n/**\n * A page limit option, this value must not be greater than 100.\n * @public\n */\nexport type SearchPaginationLimitOption<\n  Current extends number = 101,\n  Accumulator extends number[] = [],\n> = Accumulator['length'] extends Current\n  ? Accumulator[number]\n  : SearchPaginationLimitOption<\n      Current,\n      [...Accumulator, Accumulator['length']]\n    >;\n\n/**\n * A page limit text, this function is called with a \"\\{ from, to, page, count \\}\" object.\n * @public\n */\nexport type SearchPaginationLimitText = (params: {\n  from: number;\n  to: number;\n  page: number;\n  count: number;\n}) => ReactNode;\n\n/**\n * Props for {@link SearchPaginationBase}.\n * @public\n */\nexport type SearchPaginationBaseProps = {\n  /**\n   * The component class name.\n   */\n  className?: string;\n  /**\n   * The total number of results.\n   * For an unknown number of items, provide -1.\n   * Defaults to -1.\n   */\n  total?: number;\n  /**\n   * The cursor for the current page.\n   */\n  cursor?: string;\n  /**\n   * Whether a next page exists\n   */\n  hasNextPage?: boolean;\n  /**\n   * Callback fired when the current page cursor is changed.\n   */\n  onCursorChange?: (pageCursor: string) => void;\n  /**\n   * The limit of results per page.\n   * Set -1 to display all the results.\n   */\n  limit?: number;\n  /**\n   * Customize the results per page label.\n   * Defaults to \"Results per page:\".\n   */\n  limitLabel?: ReactNode;\n  /**\n   * Customize the results per page text.\n   * Defaults to \"(\\{ from, to, count \\}) =\\> count \\> 0 ? `of $\\{count\\}` : `$\\{from\\}-$\\{to\\}`\".\n   */\n  limitText?: SearchPaginationLimitText;\n  /**\n   * Options for setting how many results show per page.\n   * If less than two options are available, no select field will be displayed.\n   * Use -1 for the value with a custom label to show all the results.\n   * Defaults to [10, 25, 50, 100].\n   */\n  limitOptions?: SearchPaginationLimitOption[];\n  /**\n   * Callback fired when the number of results per page is changed.\n   */\n  onLimitChange?: (value: number) => void;\n};\n\n/**\n * A component with controls for search results pagination.\n * @param props - See {@link SearchPaginationBaseProps}.\n * @public\n */\nexport const SearchPaginationBase = (props: SearchPaginationBaseProps) => {\n  const { t } = useTranslationRef(searchReactTranslationRef);\n  const {\n    total: count = -1,\n    cursor: pageCursor,\n    hasNextPage,\n    onCursorChange: onPageCursorChange,\n    limit: rowsPerPage = 25,\n    limitLabel: labelRowsPerPage = t('searchPagination.limitLabel'),\n    limitText: labelDisplayedRows = ({ from, to }) =>\n      count > 0\n        ? t('searchPagination.limitText', { num: `${count}` })\n        : `${from}-${to}`,\n    limitOptions: rowsPerPageOptions,\n    onLimitChange: onPageLimitChange,\n    ...rest\n  } = props;\n\n  const page = useMemo(() => decodePageCursor(pageCursor), [pageCursor]);\n\n  const handlePageChange = useCallback(\n    (_: MouseEvent<HTMLButtonElement> | null, newValue: number) => {\n      onPageCursorChange?.(encodePageCursor(newValue));\n    },\n    [onPageCursorChange],\n  );\n\n  const handleRowsPerPageChange = useCallback(\n    (e: ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) => {\n      const newValue = e.target.value;\n      onPageLimitChange?.(parseInt(newValue, 10));\n    },\n    [onPageLimitChange],\n  );\n\n  return (\n    <TablePagination\n      {...rest}\n      component=\"div\"\n      count={count}\n      page={page}\n      nextIconButtonProps={{\n        ...(hasNextPage !== undefined && { disabled: !hasNextPage }),\n      }}\n      onPageChange={handlePageChange}\n      rowsPerPage={rowsPerPage}\n      labelRowsPerPage={labelRowsPerPage}\n      labelDisplayedRows={labelDisplayedRows}\n      rowsPerPageOptions={rowsPerPageOptions}\n      onRowsPerPageChange={handleRowsPerPageChange}\n    />\n  );\n};\n\n/**\n * Props for {@link SearchPagination}.\n * @public\n */\nexport type SearchPaginationProps = Omit<\n  SearchPaginationBaseProps,\n  | 'pageLimit'\n  | 'onLimitChange'\n  | 'pageCursor'\n  | 'onPageCursorChange'\n  | 'hasNextPage'\n>;\n\n/**\n * A component for setting the search context page limit and cursor.\n * @param props - See {@link SearchPaginationProps}.\n * @public\n */\nexport const SearchPagination = (props: SearchPaginationProps) => {\n  const { pageLimit, setPageLimit, pageCursor, setPageCursor, fetchNextPage } =\n    useSearch();\n\n  const handlePageLimitChange = useCallback(\n    (newPageLimit: number) => {\n      setPageLimit(newPageLimit);\n      setPageCursor(undefined);\n    },\n    [setPageLimit, setPageCursor],\n  );\n\n  return (\n    <SearchPaginationBase\n      {...props}\n      hasNextPage={!!fetchNextPage}\n      limit={pageLimit}\n      onLimitChange={handlePageLimitChange}\n      cursor={pageCursor}\n      onCursorChange={setPageCursor}\n    />\n  );\n};\n"],"names":[],"mappings":"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"}