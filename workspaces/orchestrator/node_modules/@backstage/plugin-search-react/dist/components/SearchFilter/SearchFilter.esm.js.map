{"version":3,"file":"SearchFilter.esm.js","sources":["../../../src/components/SearchFilter/SearchFilter.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactElement, ChangeEvent, useRef } from 'react';\nimport { capitalize } from 'lodash';\nimport { v4 as uuid } from 'uuid';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Select, SelectedItems } from '@backstage/core-components';\n\nimport { useSearch } from '../../context';\nimport {\n  AutocompleteFilter,\n  SearchAutocompleteFilterProps,\n} from './SearchFilter.Autocomplete';\nimport { useAsyncFilterValues, useDefaultFilterValue } from './hooks';\nimport { ensureFilterValueWithLabel, FilterValue } from './types';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { searchReactTranslationRef } from '../../translation';\n\nconst useStyles = makeStyles({\n  label: {\n    textTransform: 'capitalize',\n  },\n  checkboxWrapper: {\n    display: 'flex',\n    alignItems: 'center',\n    width: '100%',\n  },\n  textWrapper: {\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n    whiteSpace: 'nowrap',\n  },\n});\n\n/**\n * @public\n */\nexport type SearchFilterComponentProps = {\n  className?: string;\n  name: string;\n  label?: string;\n  /**\n   * Either an array of values directly, or an async function to return a list\n   * of values to be used in the filter. In the autocomplete filter, the last\n   * input value is provided as an input to allow values to be filtered. This\n   * function is debounced and values cached.\n   */\n  values?: FilterValue[] | ((partial: string) => Promise<FilterValue[]>);\n  defaultValue?: string[] | string | null;\n  /**\n   * Debounce time in milliseconds, used when values is an async callback.\n   * Defaults to 250ms.\n   */\n  valuesDebounceMs?: number;\n};\n\n/**\n * @public\n */\nexport type SearchFilterWrapperProps = SearchFilterComponentProps & {\n  component: (props: SearchFilterComponentProps) => ReactElement;\n  debug?: boolean;\n};\n\n/**\n * @public\n */\nexport const CheckboxFilter = (props: SearchFilterComponentProps) => {\n  const {\n    className,\n    defaultValue,\n    label: formLabel,\n    name,\n    values: givenValues = [],\n    valuesDebounceMs,\n  } = props;\n  const classes = useStyles();\n  const { filters, setFilters } = useSearch();\n  useDefaultFilterValue(name, defaultValue);\n  const asyncValues =\n    typeof givenValues === 'function' ? givenValues : undefined;\n  const defaultValues =\n    typeof givenValues === 'function'\n      ? undefined\n      : givenValues.map(v => ensureFilterValueWithLabel(v));\n  const { value: values = [], loading } = useAsyncFilterValues(\n    asyncValues,\n    '',\n    defaultValues,\n    valuesDebounceMs,\n  );\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const {\n      target: { value, checked },\n    } = e;\n\n    setFilters(prevFilters => {\n      const { [name]: filter, ...others } = prevFilters;\n      const rest = ((filter as string[]) || []).filter(i => i !== value);\n      const items = checked ? [...rest, value] : rest;\n      return items.length ? { ...others, [name]: items } : others;\n    });\n  };\n\n  return (\n    <FormControl\n      className={className}\n      disabled={loading}\n      fullWidth\n      data-testid=\"search-checkboxfilter-next\"\n    >\n      {!!formLabel && (\n        <FormLabel className={classes.label}>{formLabel}</FormLabel>\n      )}\n      {values.map(({ value, label }) => (\n        <FormControlLabel\n          key={value}\n          classes={{\n            root: classes.checkboxWrapper,\n            label: classes.textWrapper,\n          }}\n          label={label}\n          control={\n            <Checkbox\n              color=\"primary\"\n              inputProps={{ 'aria-labelledby': label }}\n              value={value}\n              name={label}\n              onChange={handleChange}\n              checked={((filters[name] as string[]) ?? []).includes(value)}\n            />\n          }\n        />\n      ))}\n    </FormControl>\n  );\n};\n\n/**\n * @public\n */\nexport const SelectFilter = (props: SearchFilterComponentProps) => {\n  const {\n    className,\n    defaultValue,\n    label,\n    name,\n    values: givenValues,\n    valuesDebounceMs,\n  } = props;\n  const { t } = useTranslationRef(searchReactTranslationRef);\n  useDefaultFilterValue(name, defaultValue);\n  const asyncValues =\n    typeof givenValues === 'function' ? givenValues : undefined;\n  const defaultValues =\n    typeof givenValues === 'function'\n      ? undefined\n      : givenValues?.map(v => ensureFilterValueWithLabel(v));\n  const { value: values = [], loading } = useAsyncFilterValues(\n    asyncValues,\n    '',\n    defaultValues,\n    valuesDebounceMs,\n  );\n  const allOptionValue = useRef(uuid());\n  const allOption = {\n    value: allOptionValue.current,\n    label: t('searchFilter.allOptionTitle'),\n  };\n  const { filters, setFilters } = useSearch();\n\n  const handleChange = (value: SelectedItems) => {\n    setFilters(prevFilters => {\n      const { [name]: filter, ...others } = prevFilters;\n      return value !== allOptionValue.current\n        ? { ...others, [name]: value as string }\n        : others;\n    });\n  };\n\n  const items = [allOption, ...values];\n\n  return (\n    <FormControl\n      disabled={loading}\n      className={className}\n      variant=\"filled\"\n      fullWidth\n      data-testid=\"search-selectfilter-next\"\n    >\n      <Select\n        label={label ?? capitalize(name)}\n        selected={(filters[name] || allOptionValue.current) as string}\n        onChange={handleChange}\n        items={items}\n      />\n    </FormControl>\n  );\n};\n\n/**\n * @public\n */\nconst SearchFilter = (props: SearchFilterWrapperProps) => {\n  const { component: Element, ...elementProps } = props;\n  return <Element {...elementProps} />;\n};\n\nSearchFilter.Checkbox = (\n  props: Omit<SearchFilterWrapperProps, 'component'> &\n    SearchFilterComponentProps,\n) => <SearchFilter {...props} component={CheckboxFilter} />;\n\nSearchFilter.Select = (\n  props: Omit<SearchFilterWrapperProps, 'component'> &\n    SearchFilterComponentProps,\n) => <SearchFilter {...props} component={SelectFilter} />;\n\n/**\n * A control surface for a given filter field name, rendered as an autocomplete\n * textfield. A hard-coded list of values may be provided, or an async function\n * which returns values may be provided instead.\n *\n * @public\n */\nSearchFilter.Autocomplete = (props: SearchAutocompleteFilterProps) => (\n  <SearchFilter {...props} component={AutocompleteFilter} />\n);\n\nexport { SearchFilter };\n"],"names":["uuid"],"mappings":"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"}