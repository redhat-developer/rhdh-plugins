{"version":3,"file":"hooks.esm.js","sources":["../../../src/components/SearchFilter/hooks.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport useAsyncFn from 'react-use/esm/useAsyncFn';\nimport useDebounce from 'react-use/esm/useDebounce';\n\nimport { useSearch } from '../../context';\nimport {\n  ensureFilterValueWithLabel,\n  FilterValue,\n  FilterValueWithLabel,\n} from './types';\n\n/**\n * Utility hook for either asynchronously loading filter values from a given\n * function or synchronously providing a given list of default values.\n *\n * @public\n */\nexport const useAsyncFilterValues = (\n  fn: ((partial: string) => Promise<FilterValue[]>) | undefined,\n  inputValue: string,\n  defaultValues: FilterValueWithLabel[] = [],\n  debounce: number = 250,\n) => {\n  const valuesMemo = useRef<\n    Record<string, FilterValueWithLabel[] | Promise<FilterValueWithLabel[]>>\n  >({});\n  const definiteFn = useCallback(\n    async (partial: string) => {\n      return (\n        (await fn?.(partial))?.map(v => ensureFilterValueWithLabel(v)) || []\n      );\n    },\n    [fn],\n  );\n\n  const [state, callback] = useAsyncFn(definiteFn, [inputValue], {\n    loading: true,\n  });\n\n  // Do not invoke the given function more than necessary.\n  useDebounce(\n    () => {\n      // Performance optimization: only invoke the callback once per inputValue\n      // for the lifetime of the hook/component.\n      if (valuesMemo.current[inputValue] === undefined) {\n        valuesMemo.current[inputValue] = callback(inputValue).then(values => {\n          // Override the value for future immediate returns.\n          valuesMemo.current[inputValue] = values;\n          return values;\n        });\n      }\n    },\n    debounce,\n    [callback, inputValue],\n  );\n\n  // Immediately return the default values if they are provided.\n  if (defaultValues.length) {\n    return {\n      loading: false,\n      value: defaultValues,\n    };\n  }\n\n  // Immediately return a memoized value if it is set (and not a promise).\n  const possibleValue = valuesMemo.current[inputValue];\n  if (Array.isArray(possibleValue)) {\n    return {\n      loading: false,\n      value: possibleValue,\n    };\n  }\n\n  return state;\n};\n\n/**\n * Utility hook for applying a given default value to the search context.\n *\n * @public\n */\nexport const useDefaultFilterValue = (\n  name: string,\n  defaultValue?: string | string[] | null,\n) => {\n  const { setFilters } = useSearch();\n\n  useEffect(() => {\n    if (defaultValue && [defaultValue].flat().length > 0) {\n      setFilters(prevFilters => ({\n        ...prevFilters,\n        [name]: defaultValue,\n      }));\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};\n"],"names":[],"mappings":";;;;;;AAiCO,MAAM,oBAAA,GAAuB,CAClC,EAAA,EACA,UAAA,EACA,gBAAwC,EAAC,EACzC,WAAmB,GAAA,KAChB;AACH,EAAA,MAAM,UAAA,GAAa,MAAA,CAEjB,EAAE,CAAA;AACJ,EAAA,MAAM,UAAA,GAAa,WAAA;AAAA,IACjB,OAAO,OAAA,KAAoB;AACzB,MAAA,OAAA,CACG,MAAM,EAAA,GAAK,OAAO,CAAA,GAAI,GAAA,CAAI,OAAK,0BAAA,CAA2B,CAAC,CAAC,CAAA,IAAK,EAAC;AAAA,IAEvE,CAAA;AAAA,IACA,CAAC,EAAE;AAAA,GACL;AAEA,EAAA,MAAM,CAAC,OAAO,QAAQ,CAAA,GAAI,WAAW,UAAA,EAAY,CAAC,UAAU,CAAA,EAAG;AAAA,IAC7D,OAAA,EAAS;AAAA,GACV,CAAA;AAGD,EAAA,WAAA;AAAA,IACE,MAAM;AAGJ,MAAA,IAAI,UAAA,CAAW,OAAA,CAAQ,UAAU,CAAA,KAAM,MAAA,EAAW;AAChD,QAAA,UAAA,CAAW,QAAQ,UAAU,CAAA,GAAI,SAAS,UAAU,CAAA,CAAE,KAAK,CAAA,MAAA,KAAU;AAEnE,UAAA,UAAA,CAAW,OAAA,CAAQ,UAAU,CAAA,GAAI,MAAA;AACjC,UAAA,OAAO,MAAA;AAAA,QACT,CAAC,CAAA;AAAA,MACH;AAAA,IACF,CAAA;AAAA,IACA,QAAA;AAAA,IACA,CAAC,UAAU,UAAU;AAAA,GACvB;AAGA,EAAA,IAAI,cAAc,MAAA,EAAQ;AACxB,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF;AAGA,EAAA,MAAM,aAAA,GAAgB,UAAA,CAAW,OAAA,CAAQ,UAAU,CAAA;AACnD,EAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,aAAa,CAAA,EAAG;AAChC,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF;AAEA,EAAA,OAAO,KAAA;AACT;AAOO,MAAM,qBAAA,GAAwB,CACnC,IAAA,EACA,YAAA,KACG;AACH,EAAA,MAAM,EAAE,UAAA,EAAW,GAAI,SAAA,EAAU;AAEjC,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,IAAI,gBAAgB,CAAC,YAAY,EAAE,IAAA,EAAK,CAAE,SAAS,CAAA,EAAG;AACpD,MAAA,UAAA,CAAW,CAAA,WAAA,MAAgB;AAAA,QACzB,GAAG,WAAA;AAAA,QACH,CAAC,IAAI,GAAG;AAAA,OACV,CAAE,CAAA;AAAA,IACJ;AAAA,EAEF,CAAA,EAAG,EAAE,CAAA;AACP;;;;"}