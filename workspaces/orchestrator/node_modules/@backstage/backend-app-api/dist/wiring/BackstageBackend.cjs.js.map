{"version":3,"file":"BackstageBackend.cjs.js","sources":["../../src/wiring/BackstageBackend.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackendFeature, ServiceFactory } from '@backstage/backend-plugin-api';\nimport { BackendInitializer } from './BackendInitializer';\nimport { unwrapFeature } from './helpers';\nimport { Backend } from './types';\n\nexport class BackstageBackend implements Backend {\n  #initializer: BackendInitializer;\n\n  constructor(defaultServiceFactories: ServiceFactory[]) {\n    this.#initializer = new BackendInitializer(defaultServiceFactories);\n  }\n\n  add(feature: BackendFeature | Promise<{ default: BackendFeature }>): void {\n    if (isPromise(feature)) {\n      this.#initializer.add(feature.then(f => unwrapFeature(f.default)));\n    } else {\n      this.#initializer.add(unwrapFeature(feature));\n    }\n  }\n\n  async start(): Promise<void> {\n    await this.#initializer.start();\n  }\n\n  async stop(): Promise<void> {\n    await this.#initializer.stop();\n  }\n}\n\nfunction isPromise<T>(value: unknown | Promise<T>): value is Promise<T> {\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    'then' in value &&\n    typeof value.then === 'function'\n  );\n}\n"],"names":["BackendInitializer","unwrapFeature"],"mappings":";;;;;AAqBO,MAAM,gBAAA,CAAoC;AAAA,EAC/C,YAAA;AAAA,EAEA,YAAY,uBAAA,EAA2C;AACrD,IAAA,IAAA,CAAK,YAAA,GAAe,IAAIA,qCAAA,CAAmB,uBAAuB,CAAA;AAAA,EACpE;AAAA,EAEA,IAAI,OAAA,EAAsE;AACxE,IAAA,IAAI,SAAA,CAAU,OAAO,CAAA,EAAG;AACtB,MAAA,IAAA,CAAK,YAAA,CAAa,IAAI,OAAA,CAAQ,IAAA,CAAK,OAAKC,qBAAA,CAAc,CAAA,CAAE,OAAO,CAAC,CAAC,CAAA;AAAA,IACnE,CAAA,MAAO;AACL,MAAA,IAAA,CAAK,YAAA,CAAa,GAAA,CAAIA,qBAAA,CAAc,OAAO,CAAC,CAAA;AAAA,IAC9C;AAAA,EACF;AAAA,EAEA,MAAM,KAAA,GAAuB;AAC3B,IAAA,MAAM,IAAA,CAAK,aAAa,KAAA,EAAM;AAAA,EAChC;AAAA,EAEA,MAAM,IAAA,GAAsB;AAC1B,IAAA,MAAM,IAAA,CAAK,aAAa,IAAA,EAAK;AAAA,EAC/B;AACF;AAEA,SAAS,UAAa,KAAA,EAAkD;AACtE,EAAA,OACE,OAAO,UAAU,QAAA,IACjB,KAAA,KAAU,QACV,MAAA,IAAU,KAAA,IACV,OAAO,KAAA,CAAM,IAAA,KAAS,UAAA;AAE1B;;;;"}