{"version":3,"file":"GoogleAuth.esm.js","sources":["../../../../../../../../../../packages/core-app-api/src/apis/implementations/auth/google/GoogleAuth.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { googleAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'google',\n  title: 'Google',\n  icon: () => null,\n};\n\nconst SCOPE_PREFIX = 'https://www.googleapis.com/auth/';\n\n/**\n * Implements the OAuth flow to Google products.\n *\n * @public\n */\nexport default class GoogleAuth {\n  static create(options: OAuthApiCreateOptions): typeof googleAuthApiRef.T {\n    const {\n      configApi,\n      discoveryApi,\n      oauthRequestApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      defaultScopes = [\n        'openid',\n        `${SCOPE_PREFIX}userinfo.email`,\n        `${SCOPE_PREFIX}userinfo.profile`,\n      ],\n    } = options;\n\n    return OAuth2.create({\n      configApi,\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n      scopeTransform(scopes: string[]) {\n        return scopes.map(scope => {\n          if (scope === 'openid') {\n            return scope;\n          }\n\n          if (scope === 'profile' || scope === 'email') {\n            return `${SCOPE_PREFIX}userinfo.${scope}`;\n          }\n\n          if (scope.startsWith(SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n"],"names":[],"mappings":";;AAoBA,MAAM,gBAAA,GAAmB;AAAA,EACvB,EAAA,EAAI,QAAA;AAAA,EACJ,KAAA,EAAO,QAAA;AAAA,EACP,MAAM,MAAM;AACd,CAAA;AAEA,MAAM,YAAA,GAAe,kCAAA;AAOrB,MAAqB,UAAA,CAAW;AAAA,EAC9B,OAAO,OAAO,OAAA,EAA2D;AACvE,IAAA,MAAM;AAAA,MACJ,SAAA;AAAA,MACA,YAAA;AAAA,MACA,eAAA;AAAA,MACA,WAAA,GAAc,aAAA;AAAA,MACd,QAAA,GAAW,gBAAA;AAAA,MACX,aAAA,GAAgB;AAAA,QACd,QAAA;AAAA,QACA,GAAG,YAAY,CAAA,cAAA,CAAA;AAAA,QACf,GAAG,YAAY,CAAA,gBAAA;AAAA;AACjB,KACF,GAAI,OAAA;AAEJ,IAAA,OAAO,OAAO,MAAA,CAAO;AAAA,MACnB,SAAA;AAAA,MACA,YAAA;AAAA,MACA,eAAA;AAAA,MACA,QAAA;AAAA,MACA,WAAA;AAAA,MACA,aAAA;AAAA,MACA,eAAe,MAAA,EAAkB;AAC/B,QAAA,OAAO,MAAA,CAAO,IAAI,CAAA,KAAA,KAAS;AACzB,UAAA,IAAI,UAAU,QAAA,EAAU;AACtB,YAAA,OAAO,KAAA;AAAA,UACT;AAEA,UAAA,IAAI,KAAA,KAAU,SAAA,IAAa,KAAA,KAAU,OAAA,EAAS;AAC5C,YAAA,OAAO,CAAA,EAAG,YAAY,CAAA,SAAA,EAAY,KAAK,CAAA,CAAA;AAAA,UACzC;AAEA,UAAA,IAAI,KAAA,CAAM,UAAA,CAAW,YAAY,CAAA,EAAG;AAClC,YAAA,OAAO,KAAA;AAAA,UACT;AAEA,UAAA,OAAO,CAAA,EAAG,YAAY,CAAA,EAAG,KAAK,CAAA,CAAA;AAAA,QAChC,CAAC,CAAA;AAAA,MACH;AAAA,KACD,CAAA;AAAA,EACH;AACF;;;;"}