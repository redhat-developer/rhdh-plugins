{"version":3,"file":"collectRouteIds.esm.js","sources":["../../src/routing/collectRouteIds.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  SubRouteRef,\n  ExternalRouteRef,\n  FrontendFeature,\n} from '@backstage/frontend-plugin-api';\n// eslint-disable-next-line @backstage/no-relative-monorepo-imports\nimport {\n  isRouteRef,\n  toInternalRouteRef,\n} from '../../../frontend-plugin-api/src/routing/RouteRef';\n// eslint-disable-next-line @backstage/no-relative-monorepo-imports\nimport { toInternalExternalRouteRef } from '../../../frontend-plugin-api/src/routing/ExternalRouteRef';\n// eslint-disable-next-line @backstage/no-relative-monorepo-imports\nimport { toInternalSubRouteRef } from '../../../frontend-plugin-api/src/routing/SubRouteRef';\nimport { OpaqueFrontendPlugin } from '@internal/frontend';\nimport { ErrorCollector } from '../wiring/createErrorCollector';\n\n/** @internal */\nexport interface RouteRefsById {\n  routes: Map<string, RouteRef | SubRouteRef>;\n  externalRoutes: Map<string, ExternalRouteRef>;\n}\n\n/** @internal */\nexport function collectRouteIds(\n  features: FrontendFeature[],\n  collector: ErrorCollector,\n): RouteRefsById {\n  const routesById = new Map<string, RouteRef | SubRouteRef>();\n  const externalRoutesById = new Map<string, ExternalRouteRef>();\n\n  for (const feature of features) {\n    if (!OpaqueFrontendPlugin.isType(feature)) {\n      continue;\n    }\n\n    for (const [name, ref] of Object.entries(feature.routes)) {\n      const refId = `${feature.id}.${name}`;\n      if (routesById.has(refId)) {\n        collector.report({\n          code: 'ROUTE_DUPLICATE',\n          message: `Duplicate route id '${refId}' encountered while collecting routes`,\n          context: { routeId: refId },\n        });\n        continue;\n      }\n\n      if (isRouteRef(ref)) {\n        const internalRef = toInternalRouteRef(ref);\n        internalRef.setId(refId);\n        routesById.set(refId, ref);\n      } else {\n        const internalRef = toInternalSubRouteRef(ref);\n        routesById.set(refId, internalRef);\n      }\n    }\n    for (const [name, ref] of Object.entries(feature.externalRoutes)) {\n      const refId = `${feature.id}.${name}`;\n      if (externalRoutesById.has(refId)) {\n        collector.report({\n          code: 'ROUTE_DUPLICATE',\n          message: `Duplicate external route id '${refId}' encountered while collecting routes`,\n          context: { routeId: refId },\n        });\n        continue;\n      }\n\n      const internalRef = toInternalExternalRouteRef(ref);\n      internalRef.setId(refId);\n      externalRoutesById.set(refId, ref);\n    }\n  }\n\n  return { routes: routesById, externalRoutes: externalRoutesById };\n}\n"],"names":[],"mappings":";;;;;;;AAyCO,SAAS,eAAA,CACd,UACA,SAAA,EACe;AACf,EAAA,MAAM,UAAA,uBAAiB,GAAA,EAAoC;AAC3D,EAAA,MAAM,kBAAA,uBAAyB,GAAA,EAA8B;AAE7D,EAAA,KAAA,MAAW,WAAW,QAAA,EAAU;AAC9B,IAAA,IAAI,CAAC,oBAAA,CAAqB,MAAA,CAAO,OAAO,CAAA,EAAG;AACzC,MAAA;AAAA,IACF;AAEA,IAAA,KAAA,MAAW,CAAC,MAAM,GAAG,CAAA,IAAK,OAAO,OAAA,CAAQ,OAAA,CAAQ,MAAM,CAAA,EAAG;AACxD,MAAA,MAAM,KAAA,GAAQ,CAAA,EAAG,OAAA,CAAQ,EAAE,IAAI,IAAI,CAAA,CAAA;AACnC,MAAA,IAAI,UAAA,CAAW,GAAA,CAAI,KAAK,CAAA,EAAG;AACzB,QAAA,SAAA,CAAU,MAAA,CAAO;AAAA,UACf,IAAA,EAAM,iBAAA;AAAA,UACN,OAAA,EAAS,uBAAuB,KAAK,CAAA,qCAAA,CAAA;AAAA,UACrC,OAAA,EAAS,EAAE,OAAA,EAAS,KAAA;AAAM,SAC3B,CAAA;AACD,QAAA;AAAA,MACF;AAEA,MAAA,IAAI,UAAA,CAAW,GAAG,CAAA,EAAG;AACnB,QAAA,MAAM,WAAA,GAAc,mBAAmB,GAAG,CAAA;AAC1C,QAAA,WAAA,CAAY,MAAM,KAAK,CAAA;AACvB,QAAA,UAAA,CAAW,GAAA,CAAI,OAAO,GAAG,CAAA;AAAA,MAC3B,CAAA,MAAO;AACL,QAAA,MAAM,WAAA,GAAc,sBAAsB,GAAG,CAAA;AAC7C,QAAA,UAAA,CAAW,GAAA,CAAI,OAAO,WAAW,CAAA;AAAA,MACnC;AAAA,IACF;AACA,IAAA,KAAA,MAAW,CAAC,MAAM,GAAG,CAAA,IAAK,OAAO,OAAA,CAAQ,OAAA,CAAQ,cAAc,CAAA,EAAG;AAChE,MAAA,MAAM,KAAA,GAAQ,CAAA,EAAG,OAAA,CAAQ,EAAE,IAAI,IAAI,CAAA,CAAA;AACnC,MAAA,IAAI,kBAAA,CAAmB,GAAA,CAAI,KAAK,CAAA,EAAG;AACjC,QAAA,SAAA,CAAU,MAAA,CAAO;AAAA,UACf,IAAA,EAAM,iBAAA;AAAA,UACN,OAAA,EAAS,gCAAgC,KAAK,CAAA,qCAAA,CAAA;AAAA,UAC9C,OAAA,EAAS,EAAE,OAAA,EAAS,KAAA;AAAM,SAC3B,CAAA;AACD,QAAA;AAAA,MACF;AAEA,MAAA,MAAM,WAAA,GAAc,2BAA2B,GAAG,CAAA;AAClD,MAAA,WAAA,CAAY,MAAM,KAAK,CAAA;AACvB,MAAA,kBAAA,CAAmB,GAAA,CAAI,OAAO,GAAG,CAAA;AAAA,IACnC;AAAA,EACF;AAEA,EAAA,OAAO,EAAE,MAAA,EAAQ,UAAA,EAAY,cAAA,EAAgB,kBAAA,EAAmB;AAClE;;;;"}