{"version":3,"file":"utils.cjs.js","sources":["../../src/sources/utils.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Parser } from './types';\nimport yaml from 'yaml';\n\n/** @internal */\nexport async function waitOrAbort<T>(\n  promise: PromiseLike<T>,\n  signal?: AbortSignal | Array<AbortSignal | undefined>,\n): Promise<[ok: true, value: T] | [ok: false]> {\n  const signals = [signal].flat().filter((x): x is AbortSignal => !!x);\n  return new Promise((resolve, reject) => {\n    if (signals.some(s => s.aborted)) {\n      resolve([false]);\n    }\n    const onAbort = () => {\n      resolve([false]);\n    };\n    promise.then(\n      value => {\n        resolve([true, value]);\n        signals.forEach(s => s.removeEventListener('abort', onAbort));\n      },\n      error => {\n        reject(error);\n        signals.forEach(s => s.removeEventListener('abort', onAbort));\n      },\n    );\n    signals.forEach(s => s.addEventListener('abort', onAbort));\n  });\n}\n\n/** @internal */\nexport const parseYamlContent: Parser = async ({ contents }) => {\n  const parsed = yaml.parse(contents);\n  return { result: parsed === null ? undefined : parsed };\n};\n"],"names":["yaml"],"mappings":";;;;;;;;AAoBA,eAAsB,WAAA,CACpB,SACA,MAAA,EAC6C;AAC7C,EAAA,MAAM,OAAA,GAAU,CAAC,MAAM,CAAA,CAAE,IAAA,EAAK,CAAE,MAAA,CAAO,CAAC,CAAA,KAAwB,CAAC,CAAC,CAAC,CAAA;AACnE,EAAA,OAAO,IAAI,OAAA,CAAQ,CAAC,OAAA,EAAS,MAAA,KAAW;AACtC,IAAA,IAAI,OAAA,CAAQ,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,OAAO,CAAA,EAAG;AAChC,MAAA,OAAA,CAAQ,CAAC,KAAK,CAAC,CAAA;AAAA,IACjB;AACA,IAAA,MAAM,UAAU,MAAM;AACpB,MAAA,OAAA,CAAQ,CAAC,KAAK,CAAC,CAAA;AAAA,IACjB,CAAA;AACA,IAAA,OAAA,CAAQ,IAAA;AAAA,MACN,CAAA,KAAA,KAAS;AACP,QAAA,OAAA,CAAQ,CAAC,IAAA,EAAM,KAAK,CAAC,CAAA;AACrB,QAAA,OAAA,CAAQ,QAAQ,CAAA,CAAA,KAAK,CAAA,CAAE,mBAAA,CAAoB,OAAA,EAAS,OAAO,CAAC,CAAA;AAAA,MAC9D,CAAA;AAAA,MACA,CAAA,KAAA,KAAS;AACP,QAAA,MAAA,CAAO,KAAK,CAAA;AACZ,QAAA,OAAA,CAAQ,QAAQ,CAAA,CAAA,KAAK,CAAA,CAAE,mBAAA,CAAoB,OAAA,EAAS,OAAO,CAAC,CAAA;AAAA,MAC9D;AAAA,KACF;AACA,IAAA,OAAA,CAAQ,QAAQ,CAAA,CAAA,KAAK,CAAA,CAAE,gBAAA,CAAiB,OAAA,EAAS,OAAO,CAAC,CAAA;AAAA,EAC3D,CAAC,CAAA;AACH;AAGO,MAAM,gBAAA,GAA2B,OAAO,EAAE,QAAA,EAAS,KAAM;AAC9D,EAAA,MAAM,MAAA,GAASA,qBAAA,CAAK,KAAA,CAAM,QAAQ,CAAA;AAClC,EAAA,OAAO,EAAE,MAAA,EAAQ,MAAA,KAAW,IAAA,GAAO,SAAY,MAAA,EAAO;AACxD;;;;;"}