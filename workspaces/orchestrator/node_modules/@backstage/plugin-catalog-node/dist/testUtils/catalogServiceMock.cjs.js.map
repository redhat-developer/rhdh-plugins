{"version":3,"file":"catalogServiceMock.cjs.js","sources":["../../src/testUtils/catalogServiceMock.ts"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createServiceFactory,\n  ServiceFactory,\n  ServiceRef,\n} from '@backstage/backend-plugin-api';\nimport { InMemoryCatalogClient } from '@backstage/catalog-client/testUtils';\nimport { Entity } from '@backstage/catalog-model';\nimport { catalogServiceRef } from '@backstage/plugin-catalog-node';\n// eslint-disable-next-line @backstage/no-undeclared-imports\nimport { ServiceMock } from '@backstage/backend-test-utils';\nimport { CatalogServiceMock } from './types';\n\n/** @internal */\nfunction simpleMock<TService>(\n  ref: ServiceRef<TService, any>,\n  mockFactory: () => jest.Mocked<TService>,\n): (partialImpl?: Partial<TService>) => ServiceMock<TService> {\n  return partialImpl => {\n    const mock = mockFactory();\n    if (partialImpl) {\n      for (const [key, impl] of Object.entries(partialImpl)) {\n        if (typeof impl === 'function') {\n          (mock as any)[key].mockImplementation(impl);\n        } else {\n          (mock as any)[key] = impl;\n        }\n      }\n    }\n    return Object.assign(mock, {\n      factory: createServiceFactory({\n        service: ref,\n        deps: {},\n        factory: () => mock,\n      }),\n    }) as ServiceMock<TService>;\n  };\n}\n\n/**\n * Creates a fake catalog client that handles entities in memory storage. Note\n * that this client may be severely limited in functionality, and advanced\n * functions may not be available at all.\n *\n * @public\n */\nexport function catalogServiceMock(options?: {\n  entities?: Entity[];\n}): CatalogServiceMock {\n  return new InMemoryCatalogClient(options);\n}\n\n/**\n * A collection of mock functionality for the catalog service.\n *\n * @public\n */\nexport namespace catalogServiceMock {\n  /**\n   * Creates a fake catalog client that handles entities in memory storage. Note\n   * that this client may be severely limited in functionality, and advanced\n   * functions may not be available at all.\n   */\n  export const factory = (options?: { entities?: Entity[] }) =>\n    createServiceFactory({\n      service: catalogServiceRef,\n      deps: {},\n      factory: () => new InMemoryCatalogClient(options),\n    }) as ServiceFactory<CatalogServiceMock, 'plugin', 'singleton'>;\n  /**\n   * Creates a catalog client whose methods are mock functions, possibly with\n   * some of them overloaded by the caller.\n   */\n  export const mock = simpleMock<CatalogServiceMock>(catalogServiceRef, () => ({\n    getEntities: jest.fn(),\n    getEntitiesByRefs: jest.fn(),\n    queryEntities: jest.fn(),\n    getEntityAncestors: jest.fn(),\n    getEntityByRef: jest.fn(),\n    removeEntityByUid: jest.fn(),\n    refreshEntity: jest.fn(),\n    getEntityFacets: jest.fn(),\n    getLocations: jest.fn(),\n    getLocationById: jest.fn(),\n    getLocationByRef: jest.fn(),\n    addLocation: jest.fn(),\n    removeLocationById: jest.fn(),\n    getLocationByEntity: jest.fn(),\n    validateEntity: jest.fn(),\n    analyzeLocation: jest.fn(),\n    streamEntities: jest.fn(),\n  }));\n}\n"],"names":["createServiceFactory","InMemoryCatalogClient","catalogServiceMock","catalogServiceRef"],"mappings":";;;;;;AA6BA,SAAS,UAAA,CACP,KACA,WAAA,EAC4D;AAC5D,EAAA,OAAO,CAAA,WAAA,KAAe;AACpB,IAAA,MAAM,OAAO,WAAA,EAAY;AACzB,IAAA,IAAI,WAAA,EAAa;AACf,MAAA,KAAA,MAAW,CAAC,GAAA,EAAK,IAAI,KAAK,MAAA,CAAO,OAAA,CAAQ,WAAW,CAAA,EAAG;AACrD,QAAA,IAAI,OAAO,SAAS,UAAA,EAAY;AAC9B,UAAC,IAAA,CAAa,GAAG,CAAA,CAAE,kBAAA,CAAmB,IAAI,CAAA;AAAA,QAC5C,CAAA,MAAO;AACL,UAAC,IAAA,CAAa,GAAG,CAAA,GAAI,IAAA;AAAA,QACvB;AAAA,MACF;AAAA,IACF;AACA,IAAA,OAAO,MAAA,CAAO,OAAO,IAAA,EAAM;AAAA,MACzB,SAASA,qCAAA,CAAqB;AAAA,QAC5B,OAAA,EAAS,GAAA;AAAA,QACT,MAAM,EAAC;AAAA,QACP,SAAS,MAAM;AAAA,OAChB;AAAA,KACF,CAAA;AAAA,EACH,CAAA;AACF;AASO,SAAS,mBAAmB,OAAA,EAEZ;AACrB,EAAA,OAAO,IAAIC,gCAAsB,OAAO,CAAA;AAC1C;AAAA,CAOO,CAAUC,mBAAAA,KAAV;AAME,EAAMA,mBAAAA,CAAA,OAAA,GAAU,CAAC,OAAA,KACtBF,qCAAA,CAAqB;AAAA,IACnB,OAAA,EAASG,mCAAA;AAAA,IACT,MAAM,EAAC;AAAA,IACP,OAAA,EAAS,MAAM,IAAIF,+BAAA,CAAsB,OAAO;AAAA,GACjD,CAAA;AAKI,EAAMC,mBAAAA,CAAA,IAAA,GAAO,UAAA,CAA+BC,mCAAA,EAAmB,OAAO;AAAA,IAC3E,WAAA,EAAa,KAAK,EAAA,EAAG;AAAA,IACrB,iBAAA,EAAmB,KAAK,EAAA,EAAG;AAAA,IAC3B,aAAA,EAAe,KAAK,EAAA,EAAG;AAAA,IACvB,kBAAA,EAAoB,KAAK,EAAA,EAAG;AAAA,IAC5B,cAAA,EAAgB,KAAK,EAAA,EAAG;AAAA,IACxB,iBAAA,EAAmB,KAAK,EAAA,EAAG;AAAA,IAC3B,aAAA,EAAe,KAAK,EAAA,EAAG;AAAA,IACvB,eAAA,EAAiB,KAAK,EAAA,EAAG;AAAA,IACzB,YAAA,EAAc,KAAK,EAAA,EAAG;AAAA,IACtB,eAAA,EAAiB,KAAK,EAAA,EAAG;AAAA,IACzB,gBAAA,EAAkB,KAAK,EAAA,EAAG;AAAA,IAC1B,WAAA,EAAa,KAAK,EAAA,EAAG;AAAA,IACrB,kBAAA,EAAoB,KAAK,EAAA,EAAG;AAAA,IAC5B,mBAAA,EAAqB,KAAK,EAAA,EAAG;AAAA,IAC7B,cAAA,EAAgB,KAAK,EAAA,EAAG;AAAA,IACxB,eAAA,EAAiB,KAAK,EAAA,EAAG;AAAA,IACzB,cAAA,EAAgB,KAAK,EAAA;AAAG,GAC1B,CAAE,CAAA;AAAA,CAAA,EAlCa,kBAAA,KAAA,kBAAA,GAAA,EAAA,CAAA,CAAA;;;;"}