{"version":3,"file":"CookieAuthRedirect.esm.js","sources":["../../../src/components/CookieAuthRedirect/CookieAuthRedirect.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { identityApiRef, useApi } from '@backstage/core-plugin-api';\nimport { useAsync, useMountEffect } from '@react-hookz/web';\n\n/**\n * @public\n * A component that redirects to the page an user was trying to access before sign-in.\n */\nexport function CookieAuthRedirect() {\n  const identityApi = useApi(identityApiRef);\n\n  const [state, actions] = useAsync(async () => {\n    const { token } = await identityApi.getCredentials();\n    if (!token) {\n      throw new Error('Expected Backstage token in sign-in response');\n    }\n    return token;\n  });\n\n  useMountEffect(actions.execute);\n\n  if (state.status === 'error' && state.error) {\n    return <>An error occurred: {state.error.message}</>;\n  }\n\n  if (state.status === 'success' && state.result) {\n    return (\n      <form\n        ref={form => form?.submit()}\n        action={window.location.href}\n        method=\"POST\"\n        style={{ visibility: 'hidden' }}\n      >\n        <input type=\"hidden\" name=\"type\" value=\"sign-in\" />\n        <input type=\"hidden\" name=\"token\" value={state.result} />\n        <input type=\"submit\" value=\"Continue\" />\n      </form>\n    );\n  }\n\n  return null;\n}\n"],"names":[],"mappings":";;;;AAuBO,SAAS,kBAAA,GAAqB;AACnC,EAAA,MAAM,WAAA,GAAc,OAAO,cAAc,CAAA;AAEzC,EAAA,MAAM,CAAC,KAAA,EAAO,OAAO,CAAA,GAAI,SAAS,YAAY;AAC5C,IAAA,MAAM,EAAE,KAAA,EAAM,GAAI,MAAM,YAAY,cAAA,EAAe;AACnD,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,MAAM,8CAA8C,CAAA;AAAA,IAChE;AACA,IAAA,OAAO,KAAA;AAAA,EACT,CAAC,CAAA;AAED,EAAA,cAAA,CAAe,QAAQ,OAAO,CAAA;AAE9B,EAAA,IAAI,KAAA,CAAM,MAAA,KAAW,OAAA,IAAW,KAAA,CAAM,KAAA,EAAO;AAC3C,IAAA,uBAAO,IAAA,CAAA,QAAA,EAAA,EAAE,QAAA,EAAA;AAAA,MAAA,qBAAA;AAAA,MAAoB,MAAM,KAAA,CAAM;AAAA,KAAA,EAAQ,CAAA;AAAA,EACnD;AAEA,EAAA,IAAI,KAAA,CAAM,MAAA,KAAW,SAAA,IAAa,KAAA,CAAM,MAAA,EAAQ;AAC9C,IAAA,uBACE,IAAA;AAAA,MAAC,MAAA;AAAA,MAAA;AAAA,QACC,GAAA,EAAK,CAAA,IAAA,KAAQ,IAAA,EAAM,MAAA,EAAO;AAAA,QAC1B,MAAA,EAAQ,OAAO,QAAA,CAAS,IAAA;AAAA,QACxB,MAAA,EAAO,MAAA;AAAA,QACP,KAAA,EAAO,EAAE,UAAA,EAAY,QAAA,EAAS;AAAA,QAE9B,QAAA,EAAA;AAAA,0BAAA,GAAA,CAAC,WAAM,IAAA,EAAK,QAAA,EAAS,IAAA,EAAK,MAAA,EAAO,OAAM,SAAA,EAAU,CAAA;AAAA,0BACjD,GAAA,CAAC,WAAM,IAAA,EAAK,QAAA,EAAS,MAAK,OAAA,EAAQ,KAAA,EAAO,MAAM,MAAA,EAAQ,CAAA;AAAA,0BACvD,GAAA,CAAC,OAAA,EAAA,EAAM,IAAA,EAAK,QAAA,EAAS,OAAM,UAAA,EAAW;AAAA;AAAA;AAAA,KACxC;AAAA,EAEJ;AAEA,EAAA,OAAO,IAAA;AACT;;;;"}