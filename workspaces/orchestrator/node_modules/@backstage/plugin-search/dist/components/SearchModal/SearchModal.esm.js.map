{"version":3,"file":"SearchModal.esm.js","sources":["../../../src/components/SearchModal/SearchModal.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useContent } from '@backstage/core-components';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport {\n  SearchBar,\n  SearchContextProvider,\n  SearchResult,\n  SearchResultPager,\n} from '@backstage/plugin-search-react';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Divider from '@material-ui/core/Divider';\nimport Grid from '@material-ui/core/Grid';\nimport { useTheme } from '@material-ui/core/styles';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport { makeStyles } from '@material-ui/core/styles';\nimport ArrowForwardIcon from '@material-ui/icons/ArrowForward';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { ReactNode, useCallback, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { rootRouteRef } from '../../plugin';\nimport { SearchResultSet } from '@backstage/plugin-search-common';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { searchTranslationRef } from '../../translation';\n\n/**\n * @public\n */\nexport interface SearchModalChildrenProps {\n  /**\n   * A function that should be invoked when navigating away from the modal.\n   */\n  toggleModal: () => void;\n\n  /**\n   * Ability to provide custom components to render the result items\n   */\n  resultItemComponents?:\n    | ReactNode\n    | ((resultSet: SearchResultSet) => JSX.Element);\n}\n\n/**\n * @public\n */\nexport interface SearchModalProps {\n  /**\n   * If true, it renders the modal.\n   */\n  open?: boolean;\n  /**\n   * This is supposed to be used together with the open prop.\n   * If `hidden` is true, it hides the modal.\n   * If `open` is false, the value of `hidden` has no effect on the modal.\n   * Use `open` for controlling whether the modal should be rendered or not.\n   */\n  hidden?: boolean;\n  /**\n   * a function invoked when a search item is pressed or when the dialog\n   * should be closed.\n   */\n  toggleModal: () => void;\n  /**\n   * A function that returns custom content to render in the search modal in\n   * place of the default.\n   */\n  children?: (props: SearchModalChildrenProps) => JSX.Element;\n\n  /**\n   * Optional ability to pass in result item component renderers.\n   */\n  resultItemComponents?: SearchModalChildrenProps['resultItemComponents'];\n}\n\nconst useStyles = makeStyles(theme => ({\n  dialogTitle: {\n    gap: theme.spacing(1),\n    display: 'grid',\n    alignItems: 'center',\n    gridTemplateColumns: '1fr auto',\n    '&> button': {\n      marginTop: theme.spacing(1),\n    },\n  },\n  input: {\n    flex: 1,\n  },\n  button: {\n    '&:hover': {\n      background: 'none',\n    },\n  },\n  // Reduces default height of the modal, keeping a gap of 128px between the top and bottom of the page.\n  paperFullWidth: { height: 'calc(100% - 128px)' },\n  dialogActionsContainer: { padding: theme.spacing(1, 3) },\n  viewResultsLink: { verticalAlign: '0.5em' },\n}));\n\nexport const Modal = ({\n  toggleModal,\n  resultItemComponents,\n}: SearchModalChildrenProps) => {\n  const classes = useStyles();\n  const navigate = useNavigate();\n  const { transitions } = useTheme();\n  const { focusContent } = useContent();\n  const { t } = useTranslationRef(searchTranslationRef);\n\n  const searchRootRoute = useRouteRef(rootRouteRef)();\n  const searchBarRef = useRef<HTMLInputElement | null>(null);\n\n  useEffect(() => {\n    searchBarRef?.current?.focus();\n  });\n\n  const handleSearchResultClick = useCallback(() => {\n    setTimeout(focusContent, transitions.duration.leavingScreen);\n  }, [focusContent, transitions]);\n\n  // This handler is called when \"enter\" is pressed\n  const handleSearchBarSubmit = useCallback(() => {\n    // Using ref to get the current field value without waiting for a query debounce\n    const query = searchBarRef.current?.value ?? '';\n    navigate(`${searchRootRoute}?query=${query}`);\n    handleSearchResultClick();\n  }, [navigate, handleSearchResultClick, searchRootRoute]);\n\n  return (\n    <>\n      <DialogTitle>\n        <Box className={classes.dialogTitle}>\n          <SearchBar\n            className={classes.input}\n            inputProps={{ ref: searchBarRef }}\n            onSubmit={handleSearchBarSubmit}\n          />\n\n          <IconButton aria-label=\"close\" onClick={toggleModal}>\n            <CloseIcon />\n          </IconButton>\n        </Box>\n      </DialogTitle>\n      <DialogContent>\n        <Grid\n          container\n          direction=\"row-reverse\"\n          justifyContent=\"flex-start\"\n          alignItems=\"center\"\n        >\n          <Grid item>\n            <Button\n              className={classes.button}\n              color=\"primary\"\n              endIcon={<ArrowForwardIcon />}\n              onClick={handleSearchBarSubmit}\n              disableRipple\n            >\n              {t('searchModal.viewFullResults')}\n            </Button>\n          </Grid>\n        </Grid>\n        <Divider />\n        <SearchResult\n          onClick={handleSearchResultClick}\n          onKeyDown={handleSearchResultClick}\n        >\n          {resultItemComponents}\n        </SearchResult>\n      </DialogContent>\n      <DialogActions className={classes.dialogActionsContainer}>\n        <Grid container direction=\"row\">\n          <Grid item xs={12}>\n            <SearchResultPager />\n          </Grid>\n        </Grid>\n      </DialogActions>\n    </>\n  );\n};\n\n/**\n * @public\n */\nexport const SearchModal = (props: SearchModalProps) => {\n  const {\n    open = true,\n    hidden,\n    toggleModal,\n    children,\n    resultItemComponents,\n  } = props;\n\n  const classes = useStyles();\n\n  return (\n    <Dialog\n      classes={{\n        paperFullWidth: classes.paperFullWidth,\n      }}\n      onClose={toggleModal}\n      aria-label=\"Search Modal\"\n      aria-modal=\"true\"\n      fullWidth\n      maxWidth=\"lg\"\n      open={open}\n      hidden={hidden}\n    >\n      {open && (\n        <SearchContextProvider inheritParentContextIfAvailable>\n          {(children &&\n            children({\n              toggleModal,\n              resultItemComponents: resultItemComponents || [],\n            })) ?? (\n            <Modal\n              toggleModal={toggleModal}\n              resultItemComponents={resultItemComponents}\n            />\n          )}\n        </SearchContextProvider>\n      )}\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":"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"}