{"version":3,"file":"alpha.esm.js","sources":["../src/alpha.tsx"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Grid from '@material-ui/core/Grid';\nimport Paper from '@material-ui/core/Paper';\nimport { makeStyles, Theme } from '@material-ui/core/styles';\nimport SearchIcon from '@material-ui/icons/Search';\n\nimport {\n  CatalogIcon,\n  Content,\n  DocsIcon,\n  Header,\n  Page,\n  useSidebarPinState,\n} from '@backstage/core-components';\nimport {\n  useApi,\n  discoveryApiRef,\n  fetchApiRef,\n} from '@backstage/core-plugin-api';\n\nimport {\n  createFrontendPlugin,\n  ApiBlueprint,\n  createExtensionInput,\n  PageBlueprint,\n  NavItemBlueprint,\n} from '@backstage/frontend-plugin-api';\n\nimport {\n  catalogApiRef,\n  CATALOG_FILTER_EXISTS,\n} from '@backstage/plugin-catalog-react';\n\nimport {\n  DefaultResultListItem,\n  SearchBar,\n  SearchFilter,\n  SearchPagination,\n  SearchResult as SearchResults,\n  SearchResultPager,\n  useSearch,\n  SearchContextProvider,\n} from '@backstage/plugin-search-react';\nimport { SearchResult } from '@backstage/plugin-search-common';\nimport { searchApiRef } from '@backstage/plugin-search-react';\nimport {\n  SearchResultListItemBlueprint,\n  SearchFilterResultTypeBlueprint,\n  SearchFilterBlueprint,\n} from '@backstage/plugin-search-react/alpha';\n\nimport { rootRouteRef } from './plugin';\nimport { SearchClient } from './apis';\nimport { SearchType } from './components/SearchType';\nimport { UrlUpdater } from './components/SearchPage/SearchPage';\nimport {\n  compatWrapper,\n  convertLegacyRouteRef,\n  convertLegacyRouteRefs,\n} from '@backstage/core-compat-api';\n\n/** @alpha */\nexport const searchApi = ApiBlueprint.make({\n  params: defineParams =>\n    defineParams({\n      api: searchApiRef,\n      deps: { discoveryApi: discoveryApiRef, fetchApi: fetchApiRef },\n      factory: ({ discoveryApi, fetchApi }) =>\n        new SearchClient({ discoveryApi, fetchApi }),\n    }),\n});\n\nconst useSearchPageStyles = makeStyles((theme: Theme) => ({\n  filter: {\n    '& + &': {\n      marginTop: theme.spacing(2.5),\n    },\n  },\n  filters: {\n    padding: theme.spacing(2),\n    marginTop: theme.spacing(2),\n  },\n}));\n\n/** @alpha */\nexport const searchPage = PageBlueprint.makeWithOverrides({\n  config: {\n    schema: {\n      noTrack: z => z.boolean().default(false),\n    },\n  },\n  inputs: {\n    items: createExtensionInput([SearchResultListItemBlueprint.dataRefs.item]),\n    resultTypes: createExtensionInput([\n      SearchFilterResultTypeBlueprint.dataRefs.resultType,\n    ]),\n    searchFilters: createExtensionInput([\n      SearchFilterBlueprint.dataRefs.searchFilters,\n    ]),\n  },\n  factory(originalFactory, { config, inputs }) {\n    return originalFactory({\n      path: '/search',\n      routeRef: convertLegacyRouteRef(rootRouteRef),\n      loader: async () => {\n        const getResultItemComponent = (result: SearchResult) => {\n          const value = inputs.items.find(item =>\n            item\n              ?.get(SearchResultListItemBlueprint.dataRefs.item)\n              .predicate?.(result),\n          );\n          return (\n            value?.get(SearchResultListItemBlueprint.dataRefs.item).component ??\n            DefaultResultListItem\n          );\n        };\n\n        const resultTypes = inputs.resultTypes.map(item =>\n          item.get(SearchFilterResultTypeBlueprint.dataRefs.resultType),\n        );\n\n        const additionalSearchFilters = inputs.searchFilters.map(\n          item =>\n            item.get(SearchFilterBlueprint.dataRefs.searchFilters).component,\n        );\n\n        const Component = () => {\n          const classes = useSearchPageStyles();\n          const { isMobile } = useSidebarPinState();\n          const { types } = useSearch();\n          const catalogApi = useApi(catalogApiRef);\n\n          return (\n            <Page themeId=\"home\">\n              {!isMobile && <Header title=\"Search\" />}\n              <Content>\n                <Grid container direction=\"row\">\n                  <Grid item xs={12}>\n                    <SearchBar debounceTime={100} />\n                  </Grid>\n                  {!isMobile && (\n                    <Grid item xs={3}>\n                      <SearchType.Accordion\n                        name=\"Result Type\"\n                        defaultValue=\"software-catalog\"\n                        showCounts\n                        types={[\n                          {\n                            value: 'software-catalog',\n                            name: 'Software Catalog',\n                            icon: <CatalogIcon />,\n                          },\n                          {\n                            value: 'techdocs',\n                            name: 'Documentation',\n                            icon: <DocsIcon />,\n                          },\n                        ].concat(resultTypes)}\n                      />\n                      <Paper className={classes.filters}>\n                        {types.includes('techdocs') && (\n                          <SearchFilter.Select\n                            className={classes.filter}\n                            label=\"Entity\"\n                            name=\"name\"\n                            values={async () => {\n                              // Return a list of entities which are documented.\n                              const { items } = await catalogApi.getEntities({\n                                fields: ['metadata.name'],\n                                filter: {\n                                  'metadata.annotations.backstage.io/techdocs-ref':\n                                    CATALOG_FILTER_EXISTS,\n                                },\n                              });\n\n                              const names = items.map(\n                                entity => entity.metadata.name,\n                              );\n                              names.sort();\n                              return names;\n                            }}\n                          />\n                        )}\n                        <SearchFilter.Select\n                          className={classes.filter}\n                          label=\"Kind\"\n                          name=\"kind\"\n                          values={[\n                            'API',\n                            'Component',\n                            'Domain',\n                            'Group',\n                            'Location',\n                            'Resource',\n                            'System',\n                            'Template',\n                            'User',\n                          ]}\n                        />\n                        <SearchFilter.Checkbox\n                          className={classes.filter}\n                          label=\"Lifecycle\"\n                          name=\"lifecycle\"\n                          values={['experimental', 'production']}\n                        />\n                        {additionalSearchFilters.map(SearchFilterComponent => (\n                          <SearchFilterComponent className={classes.filter} />\n                        ))}\n                      </Paper>\n                    </Grid>\n                  )}\n                  <Grid item xs>\n                    <SearchPagination />\n                    <SearchResults>\n                      {({ results }) => (\n                        <>\n                          {results.map((result, index) => {\n                            const { noTrack } = config;\n                            const { document, ...rest } = result;\n                            const SearchResultListItem =\n                              getResultItemComponent(result);\n                            return (\n                              <SearchResultListItem\n                                {...rest}\n                                key={index}\n                                result={document}\n                                noTrack={noTrack}\n                              />\n                            );\n                          })}\n                        </>\n                      )}\n                    </SearchResults>\n                    <SearchResultPager />\n                  </Grid>\n                </Grid>\n              </Content>\n            </Page>\n          );\n        };\n\n        return compatWrapper(\n          <SearchContextProvider>\n            <UrlUpdater />\n            <Component />\n          </SearchContextProvider>,\n        );\n      },\n    });\n  },\n});\n\n/** @alpha */\nexport const searchNavItem = NavItemBlueprint.make({\n  params: {\n    routeRef: convertLegacyRouteRef(rootRouteRef),\n    title: 'Search',\n    icon: SearchIcon,\n  },\n});\n\n/** @alpha */\nexport default createFrontendPlugin({\n  pluginId: 'search',\n  info: { packageJson: () => import('../package.json') },\n  extensions: [searchApi, searchPage, searchNavItem],\n  routes: convertLegacyRouteRefs({\n    root: rootRouteRef,\n  }),\n});\n\n/** @alpha */\nexport { searchTranslationRef } from './translation';\n"],"names":["SearchResults"],"mappings":"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"}