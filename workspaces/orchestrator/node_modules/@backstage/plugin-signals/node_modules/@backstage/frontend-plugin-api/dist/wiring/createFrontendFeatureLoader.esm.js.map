{"version":3,"file":"createFrontendFeatureLoader.esm.js","sources":["../../src/wiring/createFrontendFeatureLoader.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConfigApi } from '../apis/definitions';\nimport { describeParentCallSite } from '../routing/describeParentCallSite';\nimport { FrontendFeature } from './types';\n\n/** @public */\nexport interface CreateFrontendFeatureLoaderOptions {\n  loader(deps: {\n    config: ConfigApi;\n  }):\n    | Iterable<\n        | FrontendFeature\n        | FrontendFeatureLoader\n        | Promise<{ default: FrontendFeature | FrontendFeatureLoader }>\n      >\n    | Promise<\n        Iterable<\n          | FrontendFeature\n          | FrontendFeatureLoader\n          | Promise<{ default: FrontendFeature | FrontendFeatureLoader }>\n        >\n      >\n    | AsyncIterable<\n        | FrontendFeature\n        | FrontendFeatureLoader\n        | { default: FrontendFeature | FrontendFeatureLoader }\n      >;\n}\n\n/** @public */\nexport interface FrontendFeatureLoader {\n  readonly $$type: '@backstage/FrontendFeatureLoader';\n}\n\n/** @internal */\nexport interface InternalFrontendFeatureLoader extends FrontendFeatureLoader {\n  readonly version: 'v1';\n  readonly description: string;\n  readonly loader: (deps: {\n    config: ConfigApi;\n  }) => Promise<(FrontendFeature | FrontendFeatureLoader)[]>;\n}\n\n/** @public */\nexport function createFrontendFeatureLoader(\n  options: CreateFrontendFeatureLoaderOptions,\n): FrontendFeatureLoader {\n  const description = `created at '${describeParentCallSite()}'`;\n  return {\n    $$type: '@backstage/FrontendFeatureLoader',\n    version: 'v1',\n    description,\n    toString() {\n      return `FeatureLoader{description=${description}}`;\n    },\n    async loader(deps: {\n      config: ConfigApi;\n    }): Promise<(FrontendFeature | FrontendFeatureLoader)[]> {\n      const it = await options.loader(deps);\n      const result = new Array<FrontendFeature | FrontendFeatureLoader>();\n      for await (const item of it) {\n        if (isFeatureOrLoader(item)) {\n          result.push(item);\n        } else if ('default' in item) {\n          result.push(item.default);\n        } else {\n          throw new Error(`Invalid item \"${item}\"`);\n        }\n      }\n      return result;\n    },\n  } as InternalFrontendFeatureLoader;\n}\n\n/** @internal */\nexport function isInternalFrontendFeatureLoader(opaque: {\n  $$type: string;\n}): opaque is InternalFrontendFeatureLoader {\n  if (opaque.$$type === '@backstage/FrontendFeatureLoader') {\n    // Make sure we throw if invalid\n    toInternalFrontendFeatureLoader(opaque as FrontendFeatureLoader);\n    return true;\n  }\n  return false;\n}\n\n/** @internal */\nexport function toInternalFrontendFeatureLoader(\n  plugin: FrontendFeatureLoader,\n): InternalFrontendFeatureLoader {\n  const internal = plugin as InternalFrontendFeatureLoader;\n  if (internal.$$type !== '@backstage/FrontendFeatureLoader') {\n    throw new Error(`Invalid plugin instance, bad type '${internal.$$type}'`);\n  }\n  if (internal.version !== 'v1') {\n    throw new Error(\n      `Invalid plugin instance, bad version '${internal.version}'`,\n    );\n  }\n  return internal;\n}\n\nfunction isFeatureOrLoader(\n  obj: unknown,\n): obj is FrontendFeature | FrontendFeatureLoader {\n  if (obj !== null && typeof obj === 'object' && '$$type' in obj) {\n    return (\n      obj.$$type === '@backstage/FrontendPlugin' ||\n      obj.$$type === '@backstage/FrontendModule' ||\n      obj.$$type === '@backstage/FrontendFeatureLoader'\n    );\n  }\n  return false;\n}\n"],"names":[],"mappings":";;AA2DO,SAAS,4BACd,OAAA,EACuB;AACvB,EAAA,MAAM,WAAA,GAAc,CAAA,YAAA,EAAe,sBAAA,EAAwB,CAAA,CAAA,CAAA;AAC3D,EAAA,OAAO;AAAA,IACL,MAAA,EAAQ,kCAAA;AAAA,IACR,OAAA,EAAS,IAAA;AAAA,IACT,WAAA;AAAA,IACA,QAAA,GAAW;AACT,MAAA,OAAO,6BAA6B,WAAW,CAAA,CAAA,CAAA;AAAA,IACjD,CAAA;AAAA,IACA,MAAM,OAAO,IAAA,EAE4C;AACvD,MAAA,MAAM,EAAA,GAAK,MAAM,OAAA,CAAQ,MAAA,CAAO,IAAI,CAAA;AACpC,MAAA,MAAM,MAAA,GAAS,IAAI,KAAA,EAA+C;AAClE,MAAA,WAAA,MAAiB,QAAQ,EAAA,EAAI;AAC3B,QAAA,IAAI,iBAAA,CAAkB,IAAI,CAAA,EAAG;AAC3B,UAAA,MAAA,CAAO,KAAK,IAAI,CAAA;AAAA,QAClB,CAAA,MAAA,IAAW,aAAa,IAAA,EAAM;AAC5B,UAAA,MAAA,CAAO,IAAA,CAAK,KAAK,OAAO,CAAA;AAAA,QAC1B,CAAA,MAAO;AACL,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,cAAA,EAAiB,IAAI,CAAA,CAAA,CAAG,CAAA;AAAA,QAC1C;AAAA,MACF;AACA,MAAA,OAAO,MAAA;AAAA,IACT;AAAA,GACF;AACF;AA8BA,SAAS,kBACP,GAAA,EACgD;AAChD,EAAA,IAAI,QAAQ,IAAA,IAAQ,OAAO,GAAA,KAAQ,QAAA,IAAY,YAAY,GAAA,EAAK;AAC9D,IAAA,OACE,IAAI,MAAA,KAAW,2BAAA,IACf,IAAI,MAAA,KAAW,2BAAA,IACf,IAAI,MAAA,KAAW,kCAAA;AAAA,EAEnB;AACA,EAAA,OAAO,KAAA;AACT;;;;"}