import { jsx, Fragment } from 'react/jsx-runtime';
import { lazy, Suspense, useEffect } from 'react';
import { AnalyticsContext, useAnalytics } from '@backstage/core-plugin-api';
import { ErrorBoundary } from './ErrorBoundary.esm.js';
import { routableExtensionRenderedEvent } from '../core-plugin-api/src/analytics/Tracker.esm.js';
import { coreExtensionData } from '../wiring/coreExtensionData.esm.js';
import 'zod';
import 'zod-to-json-schema';
import '../wiring/createExtensionBlueprint.esm.js';
import { AppNodeProvider } from './AppNodeProvider.esm.js';
import { Progress } from './DefaultSwappableComponents.esm.js';

const RouteTracker = (props) => {
  const { enabled, children } = props;
  const analytics = useAnalytics();
  useEffect(() => {
    if (enabled) {
      analytics.captureEvent(routableExtensionRenderedEvent, "");
    }
  }, [analytics, enabled]);
  return /* @__PURE__ */ jsx(Fragment, { children });
};
function ExtensionBoundary(props) {
  const { node, children } = props;
  const hasRoutePathOutput = Boolean(
    node.instance?.getData(coreExtensionData.routePath)
  );
  const plugin = node.spec.plugin;
  const attributes = {
    extensionId: node.spec.id,
    pluginId: node.spec.plugin?.id ?? "app"
  };
  return /* @__PURE__ */ jsx(AppNodeProvider, { node, children: /* @__PURE__ */ jsx(Suspense, { fallback: /* @__PURE__ */ jsx(Progress, {}), children: /* @__PURE__ */ jsx(ErrorBoundary, { plugin, children: /* @__PURE__ */ jsx(AnalyticsContext, { attributes, children: /* @__PURE__ */ jsx(RouteTracker, { enabled: hasRoutePathOutput, children }) }) }) }) });
}
((ExtensionBoundary2) => {
  function lazy$1(appNode, loader) {
    const ExtensionComponent = lazy(
      () => loader().then((element) => ({ default: () => element }))
    );
    return /* @__PURE__ */ jsx(ExtensionBoundary2, { node: appNode, children: /* @__PURE__ */ jsx(ExtensionComponent, {}) });
  }
  ExtensionBoundary2.lazy = lazy$1;
  function lazyComponent(appNode, loader) {
    const ExtensionComponent = lazy(
      () => loader().then((Component) => ({ default: Component }))
    );
    return (props) => /* @__PURE__ */ jsx(ExtensionBoundary2, { node: appNode, children: /* @__PURE__ */ jsx(ExtensionComponent, { ...props }) });
  }
  ExtensionBoundary2.lazyComponent = lazyComponent;
})(ExtensionBoundary || (ExtensionBoundary = {}));

export { ExtensionBoundary };
//# sourceMappingURL=ExtensionBoundary.esm.js.map
