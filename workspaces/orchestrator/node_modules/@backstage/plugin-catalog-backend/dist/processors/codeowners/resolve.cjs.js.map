{"version":3,"file":"resolve.cjs.js","sources":["../../../src/processors/codeowners/resolve.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as codeowners from 'codeowners-utils';\nimport parseGitUrl from 'git-url-parse';\n\nconst USER_PATTERN = /^@.*/;\nconst GROUP_PATTERN = /^@.*\\/.*/;\nconst EMAIL_PATTERN = /^.*@.*\\..*$/;\n\nexport function resolveCodeOwner(\n  contents: string,\n  catalogInfoFileUrl: string,\n): string | undefined {\n  const codeOwnerEntries = codeowners.parse(contents);\n\n  const { filepath } = parseGitUrl(catalogInfoFileUrl);\n  const match = codeowners.matchFile(filepath, codeOwnerEntries);\n\n  return match?.owners?.length\n    ? normalizeCodeOwner(match.owners[0])\n    : undefined;\n}\n\nexport function normalizeCodeOwner(owner: string) {\n  if (owner.match(GROUP_PATTERN)) {\n    return owner.split('/')[1];\n  } else if (owner.match(USER_PATTERN)) {\n    return `User:${owner.substring(1)}`;\n  } else if (owner.match(EMAIL_PATTERN)) {\n    return owner.split('@')[0];\n  }\n\n  return owner;\n}\n"],"names":["codeowners","parseGitUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmBA,MAAM,YAAA,GAAe,MAAA;AACrB,MAAM,aAAA,GAAgB,UAAA;AACtB,MAAM,aAAA,GAAgB,aAAA;AAEf,SAAS,gBAAA,CACd,UACA,kBAAA,EACoB;AACpB,EAAA,MAAM,gBAAA,GAAmBA,qBAAA,CAAW,KAAA,CAAM,QAAQ,CAAA;AAElD,EAAA,MAAM,EAAE,QAAA,EAAS,GAAIC,4BAAA,CAAY,kBAAkB,CAAA;AACnD,EAAA,MAAM,KAAA,GAAQD,qBAAA,CAAW,SAAA,CAAU,QAAA,EAAU,gBAAgB,CAAA;AAE7D,EAAA,OAAO,KAAA,EAAO,QAAQ,MAAA,GAClB,kBAAA,CAAmB,MAAM,MAAA,CAAO,CAAC,CAAC,CAAA,GAClC,MAAA;AACN;AAEO,SAAS,mBAAmB,KAAA,EAAe;AAChD,EAAA,IAAI,KAAA,CAAM,KAAA,CAAM,aAAa,CAAA,EAAG;AAC9B,IAAA,OAAO,KAAA,CAAM,KAAA,CAAM,GAAG,CAAA,CAAE,CAAC,CAAA;AAAA,EAC3B,CAAA,MAAA,IAAW,KAAA,CAAM,KAAA,CAAM,YAAY,CAAA,EAAG;AACpC,IAAA,OAAO,CAAA,KAAA,EAAQ,KAAA,CAAM,SAAA,CAAU,CAAC,CAAC,CAAA,CAAA;AAAA,EACnC,CAAA,MAAA,IAAW,KAAA,CAAM,KAAA,CAAM,aAAa,CAAA,EAAG;AACrC,IAAA,OAAO,KAAA,CAAM,KAAA,CAAM,GAAG,CAAA,CAAE,CAAC,CAAA;AAAA,EAC3B;AAEA,EAAA,OAAO,KAAA;AACT;;;;;"}