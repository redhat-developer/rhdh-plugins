{"version":3,"file":"conversion.cjs.js","sources":["../../src/database/conversion.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isDatabaseConflictError } from '@backstage/backend-plugin-api';\nimport { ConflictError, InputError } from '@backstage/errors';\nimport { DateTime } from 'luxon';\n\n/**\n * Takes a TIMESTAMP type column and converts it to a DateTime.\n *\n * Some engines return the SQL string form (e.g. 'YYYY-MM-DD hh:mm:ss'), some\n * return ISO string form (e.g. 'YYYY-MM-DDThh:mm:ss.SSSZ'), some return a js\n * Date object.\n */\nexport function timestampToDateTime(input: Date | string): DateTime {\n  try {\n    if (typeof input === 'object') {\n      return DateTime.fromJSDate(input).toUTC();\n    }\n\n    const result = input.includes(' ')\n      ? DateTime.fromSQL(input, { zone: 'utc' })\n      : DateTime.fromISO(input, { zone: 'utc' });\n    if (!result.isValid) {\n      throw new TypeError('Not valid');\n    }\n\n    return result;\n  } catch (e) {\n    throw new InputError(`Failed to parse database timestamp ${input}`, e);\n  }\n}\n\n/**\n * Rethrows an error, possibly translating it to a more precise error type.\n */\nexport function rethrowError(e: any): never {\n  if (isDatabaseConflictError(e)) {\n    throw new ConflictError(`Rejected due to a conflicting entity`, e);\n  }\n\n  throw e;\n}\n"],"names":["DateTime","InputError","isDatabaseConflictError","ConflictError"],"mappings":";;;;;;AA2BO,SAAS,oBAAoB,KAAA,EAAgC;AAClE,EAAA,IAAI;AACF,IAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAC7B,MAAA,OAAOA,cAAA,CAAS,UAAA,CAAW,KAAK,CAAA,CAAE,KAAA,EAAM;AAAA,IAC1C;AAEA,IAAA,MAAM,SAAS,KAAA,CAAM,QAAA,CAAS,GAAG,CAAA,GAC7BA,cAAA,CAAS,QAAQ,KAAA,EAAO,EAAE,MAAM,KAAA,EAAO,IACvCA,cAAA,CAAS,OAAA,CAAQ,OAAO,EAAE,IAAA,EAAM,OAAO,CAAA;AAC3C,IAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,MAAA,MAAM,IAAI,UAAU,WAAW,CAAA;AAAA,IACjC;AAEA,IAAA,OAAO,MAAA;AAAA,EACT,SAAS,CAAA,EAAG;AACV,IAAA,MAAM,IAAIC,iBAAA,CAAW,CAAA,mCAAA,EAAsC,KAAK,IAAI,CAAC,CAAA;AAAA,EACvE;AACF;AAKO,SAAS,aAAa,CAAA,EAAe;AAC1C,EAAA,IAAIC,wCAAA,CAAwB,CAAC,CAAA,EAAG;AAC9B,IAAA,MAAM,IAAIC,oBAAA,CAAc,CAAA,oCAAA,CAAA,EAAwC,CAAC,CAAA;AAAA,EACnE;AAEA,EAAA,MAAM,CAAA;AACR;;;;;"}