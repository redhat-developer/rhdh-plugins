{"version":3,"file":"index.cjs.js","sources":["../src/catalog-entity-constants.ts","../src/permissions.ts","../src/util/response.ts","../src/error-detection/common.ts","../src/error-detection/pods.ts","../src/error-detection/deployments.ts","../src/error-detection/hpas.ts","../src/error-detection/error-detection.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Annotation for specifying the API server of a Kubernetes cluster\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_API_SERVER = 'kubernetes.io/api-server';\n\n/**\n * Annotation for specifying the Certificate Authority of an API server for a Kubernetes cluster\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_API_SERVER_CA =\n  'kubernetes.io/api-server-certificate-authority';\n\n/**\n * Annotation for specifying the auth provider for a Kubernetes cluster\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_AUTH_PROVIDER =\n  'kubernetes.io/auth-provider';\n\n/**\n * Annotation for specifying the oidc provider used to get id tokens for a Kubernetes cluster\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_OIDC_TOKEN_PROVIDER =\n  'kubernetes.io/oidc-token-provider';\n\n/**\n * Annotation for specifying boolean value for skip metric lookup.\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_SKIP_METRICS_LOOKUP =\n  'kubernetes.io/skip-metrics-lookup';\n\n/**\n * Annotation for specifying boolean value for skip tls verify.\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_SKIP_TLS_VERIFY =\n  'kubernetes.io/skip-tls-verify';\n\n/**\n * Annotation for specifying the dashboard url for a Kubernetes cluster.\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_DASHBOARD_URL =\n  'kubernetes.io/dashboard-url';\n\n/**\n * Annotation for specifying the dashboard app for a Kubernetes cluster.\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_DASHBOARD_APP =\n  'kubernetes.io/dashboard-app';\n\n/**\n * Annotation for specifying the dashboard app parameters for a Kubernetes cluster.\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_DASHBOARD_PARAMETERS =\n  'kubernetes.io/dashboard-parameters';\n\n/**\n * Annotation for specifying the assume role use to authenticate with AWS.\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_AWS_ASSUME_ROLE =\n  'kubernetes.io/aws-assume-role';\n\n/**\n * Annotation for specifying the AWS ID of a cluster when signing STS tokens\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_AWS_CLUSTER_ID =\n  'kubernetes.io/x-k8s-aws-id';\n\n/**\n * Annotation for specifying an external id when communicating with AWS\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_AWS_EXTERNAL_ID =\n  'kubernetes.io/aws-external-id';\n","/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createPermission } from '@backstage/plugin-permission-common';\n\n/** This permission is used to check access to the proxy endpoint\n * @public\n */\nexport const kubernetesProxyPermission = createPermission({\n  name: 'kubernetes.proxy',\n  attributes: {},\n});\n\n/**\n * List of all Kubernetes permissions.\n * @public\n */\nexport const kubernetesPermissions = [kubernetesProxyPermission];\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FetchResponse } from '@backstage/plugin-kubernetes-common';\nimport { GroupedResponses } from '../types';\n\n/** @public */\nexport const groupResponses = (\n  fetchResponse: FetchResponse[],\n): GroupedResponses => {\n  // TODO this could probably be a lodash groupBy\n  return fetchResponse.reduce(\n    (prev, next) => {\n      switch (next.type) {\n        case 'deployments':\n          prev.deployments.push(...next.resources);\n          break;\n        case 'pods':\n          prev.pods.push(...next.resources);\n          break;\n        case 'replicasets':\n          prev.replicaSets.push(...next.resources);\n          break;\n        case 'services':\n          prev.services.push(...next.resources);\n          break;\n        case 'configmaps':\n          prev.configMaps.push(...next.resources);\n          break;\n        case 'horizontalpodautoscalers':\n          prev.horizontalPodAutoscalers.push(...next.resources);\n          break;\n        case 'ingresses':\n          prev.ingresses.push(...next.resources);\n          break;\n        case 'jobs':\n          prev.jobs.push(...next.resources);\n          break;\n        case 'cronjobs':\n          prev.cronJobs.push(...next.resources);\n          break;\n        case 'customresources':\n          prev.customResources.push(...next.resources);\n          break;\n        case 'statefulsets':\n          prev.statefulsets.push(...next.resources);\n          break;\n        case 'daemonsets':\n          prev.daemonSets.push(...next.resources);\n          break;\n        default:\n      }\n      return prev;\n    },\n    {\n      pods: [],\n      replicaSets: [],\n      deployments: [],\n      services: [],\n      configMaps: [],\n      horizontalPodAutoscalers: [],\n      ingresses: [],\n      jobs: [],\n      cronJobs: [],\n      customResources: [],\n      statefulsets: [],\n      daemonSets: [],\n    } as GroupedResponses,\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DetectedError, ErrorMapper } from './types';\n\n// Run through the each error mapper for each object\n// returning a deduplicated (mostly) result\nexport const detectErrorsInObjects = <T>(\n  objects: T[],\n  errorMappers: ErrorMapper<T>[],\n): DetectedError[] => {\n  return objects.flatMap(o => {\n    return errorMappers.flatMap(em => em.detectErrors(o));\n  });\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Pod, IContainerStatus, IContainer } from 'kubernetes-models/v1';\nimport { DetectedError, ErrorMapper, ProposedFix } from './types';\nimport { detectErrorsInObjects } from './common';\nimport lodash from 'lodash';\nimport { DateTime } from 'luxon';\n\nfunction isPodReadinessProbeUnready({\n  container,\n  containerStatus,\n}: ContainerSpecAndStatus): boolean {\n  if (\n    containerStatus.ready ||\n    containerStatus.state?.running?.startedAt === undefined ||\n    !container.readinessProbe\n  ) {\n    return false;\n  }\n  const startDateTime = DateTime.fromISO(\n    containerStatus.state?.running?.startedAt,\n  )\n    // Add initial delay\n    .plus({\n      seconds: container.readinessProbe?.initialDelaySeconds ?? 0,\n    })\n    // Add failure threshold\n    .plus({\n      seconds:\n        (container.readinessProbe?.periodSeconds ?? 0) *\n        (container.readinessProbe?.failureThreshold ?? 0),\n    });\n  return startDateTime < DateTime.now();\n}\n\ninterface ContainerSpecAndStatus {\n  container: IContainer;\n  containerStatus: IContainerStatus;\n}\n\nconst podToContainerSpecsAndStatuses = (pod: Pod): ContainerSpecAndStatus[] => {\n  const specs = lodash.groupBy(pod.spec?.containers ?? [], value => value.name);\n\n  const result: ContainerSpecAndStatus[] = [];\n\n  for (const cs of pod.status?.containerStatuses ?? []) {\n    const spec = specs[cs.name];\n    if (spec.length > 0) {\n      result.push({\n        container: spec[0],\n        containerStatus: cs,\n      });\n    }\n  }\n\n  return result;\n};\n\nconst readinessProbeProposedFixes = (pod: Pod): ProposedFix | undefined => {\n  const firstUnreadyContainerStatus = pod.status?.containerStatuses?.find(\n    cs => {\n      return cs.ready === false;\n    },\n  );\n\n  return {\n    errorType: 'ReadinessProbeFailed',\n    rootCauseExplanation: `The container ${firstUnreadyContainerStatus?.name} failed to start properly, but is not crashing`,\n    actions: [\n      'Ensure that the container starts correctly locally',\n      \"Check the container's logs looking for error during startup\",\n    ],\n    type: 'events',\n    podName: pod.metadata?.name ?? '',\n  };\n};\n\nconst restartingPodProposedFixes = (pod: Pod): ProposedFix | undefined => {\n  const lastTerminatedCs = (pod.status?.containerStatuses ?? []).find(\n    cs => cs.lastState?.terminated !== undefined,\n  );\n\n  const lastTerminated = lastTerminatedCs?.lastState?.terminated;\n\n  if (!lastTerminated) {\n    return undefined;\n  }\n\n  switch (lastTerminated?.reason) {\n    case 'Unknown':\n      return {\n        // TODO check this one, it's more likely a cluster issue\n        errorType: 'Unknown',\n        rootCauseExplanation: `This container has exited with a non-zero exit code (${lastTerminated.exitCode})`,\n        actions: ['Check the crash logs for stacktraces'],\n        container: lastTerminatedCs.name,\n        type: 'logs',\n      };\n    case 'Error':\n      return {\n        errorType: 'Error',\n        rootCauseExplanation: `This container has exited with a non-zero exit code (${lastTerminated.exitCode})`,\n        actions: ['Check the crash logs for stacktraces'],\n        container: lastTerminatedCs.name,\n        type: 'logs',\n      };\n    case 'OOMKilled':\n      return {\n        errorType: 'OOMKilled',\n        rootCauseExplanation: `The container \"${lastTerminatedCs.name}\" has crashed because it has tried to use more memory that it has been allocated`,\n        actions: [\n          `Increase the amount of memory assigned to the container`,\n          'Ensure the application is memory bounded and is not trying to consume too much memory',\n        ],\n        docsLink:\n          'https://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/#exceed-a-container-s-memory-limit',\n        type: 'docs',\n      };\n    default:\n      return undefined;\n  }\n};\n\nconst waitingProposedFix = (pod: Pod): ProposedFix | undefined => {\n  const waitingCs = (pod.status?.containerStatuses ?? []).find(\n    cs => cs.state?.waiting !== undefined,\n  );\n\n  const waiting = (pod.status?.containerStatuses ?? [])\n    .map(cs => cs.state?.waiting)\n    .find(w => w?.reason !== undefined);\n\n  switch (waiting?.reason) {\n    case 'InvalidImageName':\n      return {\n        errorType: 'InvalidImageName',\n        rootCauseExplanation: 'The image in the pod is invalid',\n        actions: ['Ensure the image name is correct and valid image name'],\n        type: 'docs',\n        docsLink:\n          'https://docs.docker.com/engine/reference/commandline/tag/#extended-description',\n      };\n    case 'ImagePullBackOff':\n      return {\n        errorType: 'ImagePullBackOff',\n        rootCauseExplanation:\n          'The image either could not be found or Kubernetes does not have permission to pull it',\n        actions: [\n          'Ensure the image name is correct',\n          'Ensure Kubernetes has permission to pull this image',\n        ],\n        type: 'docs',\n        docsLink:\n          'https://kubernetes.io/docs/concepts/containers/images/#imagepullbackoff',\n      };\n    case 'CrashLoopBackOff':\n      return {\n        errorType: 'CrashLoopBackOff',\n        rootCauseExplanation: `The container ${waitingCs?.name} has crashed many times, it will be exponentially restarted until it stops crashing`,\n        actions: ['Check the crash logs for stacktraces'],\n        type: 'logs',\n        container: waitingCs?.name ?? 'unknown',\n      };\n    case 'CreateContainerConfigError':\n      return {\n        errorType: 'CreateContainerConfigError',\n        rootCauseExplanation:\n          'There is missing or mismatching configuration required to start the container',\n        actions: [\n          'Ensure ConfigMaps references in the Deployment manifest are correct and the keys exist',\n          'Ensure Secrets references in the Deployment manifest are correct and the keys exist',\n        ],\n        type: 'docs',\n        docsLink:\n          'https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/',\n      };\n    default:\n      return undefined;\n  }\n};\n\nconst podErrorMappers: ErrorMapper<Pod>[] = [\n  {\n    detectErrors: pod => {\n      return podToContainerSpecsAndStatuses(pod)\n        .filter(isPodReadinessProbeUnready)\n        .map(cs => ({\n          type: 'readiness-probe-taking-too-long',\n          message: `The container ${cs.container.name} failed to start properly, but is not crashing`,\n          severity: 4,\n          proposedFix: readinessProbeProposedFixes(pod),\n          sourceRef: {\n            name: pod.metadata?.name ?? 'unknown pod',\n            namespace: pod.metadata?.namespace ?? 'unknown namespace',\n            kind: 'Pod',\n            apiGroup: 'v1',\n          },\n          occurrenceCount: 1,\n        }));\n    },\n  },\n  {\n    detectErrors: pod => {\n      return (pod.status?.containerStatuses ?? [])\n        .filter(cs => cs.state?.waiting?.message !== undefined)\n        .map(cs => ({\n          type: 'container-waiting',\n          message: cs.state?.waiting?.message ?? 'container waiting',\n          severity: 4,\n          proposedFix: waitingProposedFix(pod),\n          sourceRef: {\n            name: pod.metadata?.name ?? 'unknown pod',\n            namespace: pod.metadata?.namespace ?? 'unknown namespace',\n            kind: 'Pod',\n            apiGroup: 'v1',\n          },\n          occurrenceCount: 1,\n        }));\n    },\n  },\n  {\n    detectErrors: pod => {\n      return (pod.status?.containerStatuses ?? [])\n        .filter(cs => cs.restartCount > 0)\n        .map(cs => ({\n          type: 'containers-restarting',\n          message: `container=${cs.name} restarted ${cs.restartCount} times`,\n          severity: 4,\n          proposedFix: restartingPodProposedFixes(pod),\n          sourceRef: {\n            name: pod.metadata?.name ?? 'unknown pod',\n            namespace: pod.metadata?.namespace ?? 'unknown namespace',\n            kind: 'Pod',\n            apiGroup: 'v1',\n          },\n          occurrenceCount: cs.restartCount,\n        }));\n    },\n  },\n];\n\nexport const detectErrorsInPods = (pods: Pod[]): DetectedError[] =>\n  detectErrorsInObjects(pods, podErrorMappers);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DetectedError, ErrorMapper } from './types';\nimport { Deployment } from 'kubernetes-models/apps/v1';\nimport { detectErrorsInObjects } from './common';\n\nconst deploymentErrorMappers: ErrorMapper<Deployment>[] = [\n  {\n    detectErrors: deployment => {\n      return (deployment.status?.conditions ?? [])\n        .filter(c => c.status === 'False')\n        .filter(c => c.message !== undefined)\n        .map(c => ({\n          type: 'condition-message-present',\n          message: c.message ?? '',\n          severity: 6,\n          sourceRef: {\n            name: deployment.metadata?.name ?? 'unknown hpa',\n            namespace: deployment.metadata?.namespace ?? 'unknown namespace',\n            kind: 'Deployment',\n            apiGroup: 'apps/v1',\n          },\n          occurrenceCount: 1,\n        }));\n    },\n  },\n];\n\nexport const detectErrorsInDeployments = (\n  deployments: Deployment[],\n): DetectedError[] =>\n  detectErrorsInObjects(deployments, deploymentErrorMappers);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { HorizontalPodAutoscaler } from 'kubernetes-models/autoscaling/v2';\nimport { DetectedError, ErrorMapper } from './types';\nimport { detectErrorsInObjects } from './common';\n\nconst hpaErrorMappers: ErrorMapper<HorizontalPodAutoscaler>[] = [\n  {\n    detectErrors: hpa => {\n      if ((hpa.spec?.maxReplicas ?? -1) === hpa.status?.currentReplicas) {\n        return [\n          {\n            type: 'hpa-max-current-replicas',\n            message: `Current number of replicas (${\n              hpa.status?.currentReplicas\n            }) is equal to the configured max number of replicas (${\n              hpa.spec?.maxReplicas ?? -1\n            })`,\n            severity: 8,\n            sourceRef: {\n              name: hpa.metadata?.name ?? 'unknown hpa',\n              namespace: hpa.metadata?.namespace ?? 'unknown namespace',\n              kind: 'HorizontalPodAutoscaler',\n              apiGroup: 'autoscaling/v2',\n            },\n            occurrenceCount: 1,\n          },\n        ];\n      }\n      return [];\n    },\n  },\n];\n\nexport const detectErrorsInHpa = (\n  hpas: HorizontalPodAutoscaler[],\n): DetectedError[] => detectErrorsInObjects(hpas, hpaErrorMappers);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DetectedError, DetectedErrorsByCluster } from './types';\nimport { ObjectsByEntityResponse } from '@backstage/plugin-kubernetes-common';\nimport { groupResponses } from '../util';\nimport { detectErrorsInPods } from './pods';\nimport { detectErrorsInDeployments } from './deployments';\nimport { detectErrorsInHpa } from './hpas';\nimport { Deployment } from 'kubernetes-models/apps/v1';\nimport { HorizontalPodAutoscaler } from 'kubernetes-models/autoscaling/v2';\nimport { Pod } from 'kubernetes-models/v1';\n\n/**\n * For each cluster try to find errors in each of the object types provided\n * returning a map of cluster names to errors in that cluster\n *\n * @public\n */\nexport const detectErrors = (\n  objects: ObjectsByEntityResponse,\n): DetectedErrorsByCluster => {\n  const errors: DetectedErrorsByCluster = new Map<string, DetectedError[]>();\n\n  for (const clusterResponse of objects.items) {\n    let clusterErrors: DetectedError[] = [];\n\n    const groupedResponses = groupResponses(clusterResponse.resources);\n\n    clusterErrors = clusterErrors.concat(\n      detectErrorsInPods(groupedResponses.pods as Pod[]),\n    );\n\n    clusterErrors = clusterErrors.concat(\n      detectErrorsInDeployments(groupedResponses.deployments as Deployment[]),\n    );\n\n    clusterErrors = clusterErrors.concat(\n      detectErrorsInHpa(\n        groupedResponses.horizontalPodAutoscalers as HorizontalPodAutoscaler[],\n      ),\n    );\n\n    errors.set(clusterResponse.cluster.name, clusterErrors);\n  }\n\n  return errors;\n};\n"],"names":["createPermission","DateTime","lodash"],"mappings":"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"}