{"version":3,"file":"createSchemaFromZod.esm.js","sources":["../../src/schema/createSchemaFromZod.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\nimport { z, ZodSchema, ZodTypeDef } from 'zod';\nimport zodToJsonSchema from 'zod-to-json-schema';\nimport { PortableSchema } from './types';\n\n/**\n * @internal\n */\nexport function createSchemaFromZod<TOutput, TInput>(\n  schemaCreator: (zImpl: typeof z) => ZodSchema<TOutput, ZodTypeDef, TInput>,\n): PortableSchema<TOutput, TInput> {\n  const schema = schemaCreator(z);\n  return {\n    // TODO: Types allow z.array etc here but it will break stuff\n    parse: input => {\n      const result = schema.safeParse(input);\n      if (result.success) {\n        return result.data;\n      }\n\n      throw new Error(result.error.issues.map(formatIssue).join('; '));\n    },\n    // TODO: Verify why we are not compatible with the latest zodToJsonSchema.\n    schema: zodToJsonSchema(schema) as JsonObject,\n  };\n}\n\nfunction formatIssue(issue: z.ZodIssue): string {\n  if (issue.code === 'invalid_union') {\n    return formatIssue(issue.unionErrors[0].issues[0]);\n  }\n  let message = issue.message;\n  if (message === 'Required') {\n    message = `Missing required value`;\n  }\n  if (issue.path.length) {\n    message += ` at '${issue.path.join('.')}'`;\n  }\n  return message;\n}\n"],"names":[],"mappings":";;;AAwBO,SAAS,oBACd,aAAA,EACiC;AACjC,EAAA,MAAM,MAAA,GAAS,cAAc,CAAC,CAAA;AAC9B,EAAA,OAAO;AAAA;AAAA,IAEL,OAAO,CAAA,KAAA,KAAS;AACd,MAAA,MAAM,MAAA,GAAS,MAAA,CAAO,SAAA,CAAU,KAAK,CAAA;AACrC,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,OAAO,MAAA,CAAO,IAAA;AAAA,MAChB;AAEA,MAAA,MAAM,IAAI,KAAA,CAAM,MAAA,CAAO,KAAA,CAAM,MAAA,CAAO,IAAI,WAAW,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,IACjE,CAAA;AAAA;AAAA,IAEA,MAAA,EAAQ,gBAAgB,MAAM;AAAA,GAChC;AACF;AAEA,SAAS,YAAY,KAAA,EAA2B;AAC9C,EAAA,IAAI,KAAA,CAAM,SAAS,eAAA,EAAiB;AAClC,IAAA,OAAO,YAAY,KAAA,CAAM,WAAA,CAAY,CAAC,CAAA,CAAE,MAAA,CAAO,CAAC,CAAC,CAAA;AAAA,EACnD;AACA,EAAA,IAAI,UAAU,KAAA,CAAM,OAAA;AACpB,EAAA,IAAI,YAAY,UAAA,EAAY;AAC1B,IAAA,OAAA,GAAU,CAAA,sBAAA,CAAA;AAAA,EACZ;AACA,EAAA,IAAI,KAAA,CAAM,KAAK,MAAA,EAAQ;AACrB,IAAA,OAAA,IAAW,CAAA,KAAA,EAAQ,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,GAAG,CAAC,CAAA,CAAA,CAAA;AAAA,EACzC;AACA,EAAA,OAAO,OAAA;AACT;;;;"}