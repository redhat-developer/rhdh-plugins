{"version":3,"file":"createHasMatcher.esm.js","sources":["../../../../src/alpha/filter/matchers/createHasMatcher.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport { EntityMatcherFn } from './types';\n\nconst allowedMatchers: Record<string, EntityMatcherFn> = {\n  labels: entity => {\n    return Object.keys(entity.metadata.labels ?? {}).length > 0;\n  },\n  links: entity => {\n    return (entity.metadata.links ?? []).length > 0;\n  },\n};\n\n/**\n * Matches on the non-empty presence of different parts of the entity\n */\nexport function createHasMatcher(\n  parameters: string[],\n  onParseError: (error: Error) => void,\n): EntityMatcherFn {\n  const matchers = parameters.flatMap(parameter => {\n    const matcher = allowedMatchers[parameter.toLocaleLowerCase('en-US')];\n    if (!matcher) {\n      const known = Object.keys(allowedMatchers).map(m => `'${m}'`);\n      onParseError(\n        new InputError(\n          `'${parameter}' is not a valid parameter for 'has' filter expressions, expected one of ${known}`,\n        ),\n      );\n      return [];\n    }\n    return [matcher];\n  });\n\n  return entity =>\n    matchers.length ? matchers.some(matcher => matcher(entity)) : true;\n}\n"],"names":[],"mappings":";;AAmBA,MAAM,eAAA,GAAmD;AAAA,EACvD,QAAQ,CAAA,MAAA,KAAU;AAChB,IAAA,OAAO,MAAA,CAAO,KAAK,MAAA,CAAO,QAAA,CAAS,UAAU,EAAE,EAAE,MAAA,GAAS,CAAA;AAAA,EAC5D,CAAA;AAAA,EACA,OAAO,CAAA,MAAA,KAAU;AACf,IAAA,OAAA,CAAQ,MAAA,CAAO,QAAA,CAAS,KAAA,IAAS,IAAI,MAAA,GAAS,CAAA;AAAA,EAChD;AACF,CAAA;AAKO,SAAS,gBAAA,CACd,YACA,YAAA,EACiB;AACjB,EAAA,MAAM,QAAA,GAAW,UAAA,CAAW,OAAA,CAAQ,CAAA,SAAA,KAAa;AAC/C,IAAA,MAAM,OAAA,GAAU,eAAA,CAAgB,SAAA,CAAU,iBAAA,CAAkB,OAAO,CAAC,CAAA;AACpE,IAAA,IAAI,CAAC,OAAA,EAAS;AACZ,MAAA,MAAM,KAAA,GAAQ,OAAO,IAAA,CAAK,eAAe,EAAE,GAAA,CAAI,CAAA,CAAA,KAAK,CAAA,CAAA,EAAI,CAAC,CAAA,CAAA,CAAG,CAAA;AAC5D,MAAA,YAAA;AAAA,QACE,IAAI,UAAA;AAAA,UACF,CAAA,CAAA,EAAI,SAAS,CAAA,yEAAA,EAA4E,KAAK,CAAA;AAAA;AAChG,OACF;AACA,MAAA,OAAO,EAAC;AAAA,IACV;AACA,IAAA,OAAO,CAAC,OAAO,CAAA;AAAA,EACjB,CAAC,CAAA;AAED,EAAA,OAAO,CAAA,MAAA,KACL,SAAS,MAAA,GAAS,QAAA,CAAS,KAAK,CAAA,OAAA,KAAW,OAAA,CAAQ,MAAM,CAAC,CAAA,GAAI,IAAA;AAClE;;;;"}