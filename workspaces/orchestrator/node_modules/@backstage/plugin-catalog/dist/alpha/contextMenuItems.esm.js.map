{"version":3,"file":"contextMenuItems.esm.js","sources":["../../src/alpha/contextMenuItems.tsx"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  EntityContextMenuItemBlueprint,\n  useEntityPermission,\n} from '@backstage/plugin-catalog-react/alpha';\nimport FileCopyTwoToneIcon from '@material-ui/icons/FileCopyTwoTone';\nimport BugReportIcon from '@material-ui/icons/BugReport';\nimport CancelIcon from '@material-ui/icons/Cancel';\nimport useCopyToClipboard from 'react-use/esm/useCopyToClipboard';\nimport { alertApiRef, useApi, useRouteRef } from '@backstage/core-plugin-api';\nimport {\n  dialogApiRef,\n  useTranslationRef,\n  type DialogApiDialog,\n} from '@backstage/frontend-plugin-api';\nimport { catalogTranslationRef } from './translation';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport {\n  UnregisterEntityDialog,\n  useEntity,\n} from '@backstage/plugin-catalog-react';\nimport { rootRouteRef, unregisterRedirectRouteRef } from '../routes';\nimport { catalogEntityDeletePermission } from '@backstage/plugin-catalog-common/alpha';\nimport { useEffect } from 'react';\nimport { compatWrapper } from '@backstage/core-compat-api';\n\nexport const copyEntityUrlContextMenuItem = EntityContextMenuItemBlueprint.make(\n  {\n    name: 'copy-entity-url',\n    params: {\n      icon: <FileCopyTwoToneIcon fontSize=\"small\" />,\n      useProps: () => {\n        const [copyState, copyToClipboard] = useCopyToClipboard();\n        const alertApi = useApi(alertApiRef);\n        const { t } = useTranslationRef(catalogTranslationRef);\n\n        useEffect(() => {\n          if (!copyState.error && copyState.value) {\n            alertApi.post({\n              message: t('entityContextMenu.copiedMessage'),\n              severity: 'info',\n              display: 'transient',\n            });\n          }\n        }, [copyState, alertApi, t]);\n\n        return {\n          title: t('entityContextMenu.copyURLMenuTitle'),\n          onClick: async () => {\n            copyToClipboard(window.location.toString());\n          },\n        };\n      },\n    },\n  },\n);\n\nexport const inspectEntityContextMenuItem = EntityContextMenuItemBlueprint.make(\n  {\n    name: 'inspect-entity',\n    params: {\n      icon: <BugReportIcon fontSize=\"small\" />,\n      useProps: () => {\n        const [_, setSearchParams] = useSearchParams();\n        const { t } = useTranslationRef(catalogTranslationRef);\n\n        return {\n          title: t('entityContextMenu.inspectMenuTitle'),\n          onClick: async () => {\n            setSearchParams('inspect');\n          },\n        };\n      },\n    },\n  },\n);\n\nexport const unregisterEntityContextMenuItem =\n  EntityContextMenuItemBlueprint.make({\n    name: 'unregister-entity',\n    params: {\n      icon: <CancelIcon fontSize=\"small\" />,\n      useProps: () => {\n        const { entity } = useEntity();\n        const dialogApi = useApi(dialogApiRef);\n        const navigate = useNavigate();\n        const catalogRoute = useRouteRef(rootRouteRef);\n\n        const { t } = useTranslationRef(catalogTranslationRef);\n        const unregisterRedirectRoute = useRouteRef(unregisterRedirectRouteRef);\n        const unregisterPermission = useEntityPermission(\n          catalogEntityDeletePermission,\n        );\n\n        return {\n          title: t('entityContextMenu.unregisterMenuTitle'),\n          disabled: !unregisterPermission.allowed,\n          onClick: async () => {\n            dialogApi.showModal(({ dialog }: { dialog: DialogApiDialog }) =>\n              compatWrapper(\n                <UnregisterEntityDialog\n                  open\n                  entity={entity}\n                  onClose={() => dialog.close()}\n                  onConfirm={() => {\n                    dialog.close();\n                    navigate(\n                      unregisterRedirectRoute\n                        ? unregisterRedirectRoute()\n                        : catalogRoute(),\n                    );\n                  }}\n                />,\n              ),\n            );\n          },\n        };\n      },\n    },\n  });\n\nexport default [\n  unregisterEntityContextMenuItem,\n  inspectEntityContextMenuItem,\n  copyEntityUrlContextMenuItem,\n];\n"],"names":[],"mappings":"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"}