{"version":3,"file":"EntityHeader.esm.js","sources":["../../../../src/alpha/components/EntityHeader/EntityHeader.tsx"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  useState,\n  useCallback,\n  useEffect,\n  ComponentProps,\n  ReactNode,\n} from 'react';\nimport { useNavigate, useLocation, useSearchParams } from 'react-router-dom';\nimport useAsync from 'react-use/esm/useAsync';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Box from '@material-ui/core/Box';\n\nimport { Header, Breadcrumbs } from '@backstage/core-components';\nimport {\n  useApi,\n  useRouteRef,\n  useRouteRefParams,\n} from '@backstage/core-plugin-api';\nimport { IconComponent } from '@backstage/frontend-plugin-api';\n\nimport {\n  Entity,\n  EntityRelation,\n  DEFAULT_NAMESPACE,\n} from '@backstage/catalog-model';\n\nimport {\n  useAsyncEntity,\n  entityRouteRef,\n  catalogApiRef,\n  EntityRefLink,\n  InspectEntityDialog,\n  UnregisterEntityDialog,\n  EntityDisplayName,\n  FavoriteEntity,\n} from '@backstage/plugin-catalog-react';\n\nimport { EntityLabels } from '../EntityLabels';\nimport { EntityContextMenu } from '../../../components/EntityContextMenu';\nimport { rootRouteRef, unregisterRedirectRouteRef } from '../../../routes';\n\nfunction headerProps(\n  paramKind: string | undefined,\n  paramNamespace: string | undefined,\n  paramName: string | undefined,\n  entity: Entity | undefined,\n): { headerTitle: string; headerType: string } {\n  const kind = paramKind ?? entity?.kind ?? '';\n  const namespace = paramNamespace ?? entity?.metadata.namespace ?? '';\n  const name =\n    entity?.metadata.title ?? paramName ?? entity?.metadata.name ?? '';\n\n  return {\n    headerTitle: `${name}${\n      namespace && namespace !== DEFAULT_NAMESPACE ? ` in ${namespace}` : ''\n    }`,\n    headerType: (() => {\n      let t = kind.toLocaleLowerCase('en-US');\n      if (entity && entity.spec && 'type' in entity.spec) {\n        t += ' â€” ';\n        t += (entity.spec as { type: string }).type.toLocaleLowerCase('en-US');\n      }\n      return t;\n    })(),\n  };\n}\n\nfunction findParentRelation(\n  entityRelations: EntityRelation[] = [],\n  relationTypes: string[] = [],\n) {\n  for (const type of relationTypes) {\n    const foundRelation = entityRelations.find(\n      relation => relation.type === type,\n    );\n    if (foundRelation) {\n      return foundRelation; // Return the first found relation and stop\n    }\n  }\n  return null;\n}\n\nconst useStyles = makeStyles(theme => ({\n  breadcrumbs: {\n    color: theme.page.fontColor,\n    fontSize: theme.typography.caption.fontSize,\n    textTransform: 'uppercase',\n    marginTop: theme.spacing(1),\n    opacity: 0.8,\n    '& span ': {\n      color: theme.page.fontColor,\n      textDecoration: 'underline',\n      textUnderlineOffset: '3px',\n    },\n  },\n}));\n\nfunction EntityHeaderTitle() {\n  const { entity } = useAsyncEntity();\n  const { kind, namespace, name } = useRouteRefParams(entityRouteRef);\n  const { headerTitle: title } = headerProps(kind, namespace, name, entity);\n  return (\n    <Box display=\"inline-flex\" alignItems=\"center\" height=\"1em\" maxWidth=\"100%\">\n      <Box\n        component=\"span\"\n        textOverflow=\"ellipsis\"\n        whiteSpace=\"nowrap\"\n        overflow=\"hidden\"\n      >\n        {entity ? <EntityDisplayName entityRef={entity} hideIcon /> : title}\n      </Box>\n      {entity && <FavoriteEntity entity={entity} />}\n    </Box>\n  );\n}\n\nfunction EntityHeaderSubtitle(props: { parentEntityRelations?: string[] }) {\n  const { parentEntityRelations } = props;\n  const classes = useStyles();\n  const { entity } = useAsyncEntity();\n  const { name } = useRouteRefParams(entityRouteRef);\n  const parentEntity = findParentRelation(\n    entity?.relations ?? [],\n    parentEntityRelations ?? [],\n  );\n\n  const catalogApi = useApi(catalogApiRef);\n\n  const { value: ancestorEntity } = useAsync(async () => {\n    if (parentEntity) {\n      return findParentRelation(\n        (await catalogApi.getEntityByRef(parentEntity?.targetRef))?.relations,\n        parentEntityRelations,\n      );\n    }\n    return null;\n  }, [parentEntity, catalogApi]);\n\n  return parentEntity ? (\n    <Breadcrumbs separator=\">\" className={classes.breadcrumbs}>\n      {ancestorEntity && (\n        <EntityRefLink entityRef={ancestorEntity.targetRef} disableTooltip />\n      )}\n      <EntityRefLink entityRef={parentEntity.targetRef} disableTooltip />\n      {name}\n    </Breadcrumbs>\n  ) : null;\n}\n\n/** @alpha */\nexport function EntityHeader(props: {\n  // NOTE(freben): Intentionally not exported at this point, since it's part of\n  // the unstable extra context menu items concept below\n  UNSTABLE_extraContextMenuItems?: {\n    title: string;\n    Icon: IconComponent;\n    onClick: () => void;\n  }[];\n  // NOTE(blam): Intentionally not exported at this point, since it's part of\n  // unstable context menu option, eg: disable the unregister entity menu\n  UNSTABLE_contextMenuOptions?: {\n    disableUnregister: boolean | 'visible' | 'hidden' | 'disable';\n  };\n  contextMenuItems?: React.JSX.Element[];\n  /**\n   * An array of relation types used to determine the parent entities in the hierarchy.\n   * These relations are prioritized in the order provided, allowing for flexible\n   * navigation through entity relationships.\n   *\n   * For example, use relation types like `[\"partOf\", \"memberOf\", \"ownedBy\"]` to define how the entity is related to\n   * its parents in the Entity Catalog.\n   *\n   * It adds breadcrumbs in the Entity page to enhance user navigation and context awareness.\n   */\n  parentEntityRelations?: string[];\n  title?: ReactNode;\n  subtitle?: ReactNode;\n}) {\n  const {\n    UNSTABLE_extraContextMenuItems,\n    UNSTABLE_contextMenuOptions,\n    contextMenuItems,\n    parentEntityRelations,\n    title,\n    subtitle,\n  } = props;\n  const { entity } = useAsyncEntity();\n  const { kind, namespace, name } = useRouteRefParams(entityRouteRef);\n  const { headerTitle: entityFallbackText, headerType: type } = headerProps(\n    kind,\n    namespace,\n    name,\n    entity,\n  );\n\n  const location = useLocation();\n  const navigate = useNavigate();\n  const catalogRoute = useRouteRef(rootRouteRef);\n  const unregisterRedirectRoute = useRouteRef(unregisterRedirectRouteRef);\n\n  const [confirmationDialogOpen, setConfirmationDialogOpen] = useState(false);\n\n  const openUnregisterEntityDialog = useCallback(\n    () => setConfirmationDialogOpen(true),\n    [setConfirmationDialogOpen],\n  );\n\n  const closeUnregisterEntityDialog = useCallback(\n    () => setConfirmationDialogOpen(false),\n    [setConfirmationDialogOpen],\n  );\n\n  const cleanUpAfterUnregisterConfirmation = useCallback(async () => {\n    setConfirmationDialogOpen(false);\n    navigate(\n      unregisterRedirectRoute ? unregisterRedirectRoute() : catalogRoute(),\n    );\n  }, [\n    navigate,\n    catalogRoute,\n    unregisterRedirectRoute,\n    setConfirmationDialogOpen,\n  ]);\n\n  // Make sure to close the dialog if the user clicks links in it that navigate\n  // to another entity.\n  useEffect(() => {\n    setConfirmationDialogOpen(false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [location.pathname]);\n\n  const [searchParams, setSearchParams] = useSearchParams();\n  const selectedInspectEntityDialogTab = searchParams.get('inspect');\n\n  const setInspectEntityDialogTab = useCallback(\n    (newTab: string) => setSearchParams(`inspect=${newTab}`),\n    [setSearchParams],\n  );\n\n  const openInspectEntityDialog = useCallback(\n    () => setSearchParams('inspect'),\n    [setSearchParams],\n  );\n\n  const closeInspectEntityDialog = useCallback(\n    () => setSearchParams(),\n    [setSearchParams],\n  );\n\n  const inspectDialogOpen = typeof selectedInspectEntityDialogTab === 'string';\n\n  return (\n    <Header\n      pageTitleOverride={entityFallbackText}\n      type={type}\n      title={title ?? <EntityHeaderTitle />}\n      subtitle={\n        subtitle ?? (\n          <EntityHeaderSubtitle parentEntityRelations={parentEntityRelations} />\n        )\n      }\n    >\n      {entity && (\n        <>\n          <EntityLabels entity={entity} />\n          <EntityContextMenu\n            UNSTABLE_extraContextMenuItems={UNSTABLE_extraContextMenuItems}\n            UNSTABLE_contextMenuOptions={UNSTABLE_contextMenuOptions}\n            contextMenuItems={contextMenuItems}\n            onInspectEntity={openInspectEntityDialog}\n            onUnregisterEntity={openUnregisterEntityDialog}\n          />\n          <InspectEntityDialog\n            entity={entity!}\n            initialTab={\n              (selectedInspectEntityDialogTab as ComponentProps<\n                typeof InspectEntityDialog\n              >['initialTab']) || undefined\n            }\n            open={inspectDialogOpen}\n            onClose={closeInspectEntityDialog}\n            onSelect={setInspectEntityDialogTab}\n          />\n          <UnregisterEntityDialog\n            entity={entity!}\n            open={confirmationDialogOpen}\n            onClose={closeUnregisterEntityDialog}\n            onConfirm={cleanUpAfterUnregisterConfirmation}\n          />\n        </>\n      )}\n    </Header>\n  );\n}\n"],"names":[],"mappings":"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"}