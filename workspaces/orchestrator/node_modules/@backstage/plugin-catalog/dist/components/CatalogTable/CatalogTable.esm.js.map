{"version":3,"file":"CatalogTable.esm.js","sources":["../../../src/components/CatalogTable/CatalogTable.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ANNOTATION_EDIT_URL,\n  ANNOTATION_VIEW_URL,\n  Entity,\n  RELATION_OWNED_BY,\n  RELATION_PART_OF,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  CodeSnippet,\n  Table,\n  TableColumn,\n  TableProps,\n  WarningPanel,\n} from '@backstage/core-components';\nimport {\n  getEntityRelations,\n  humanizeEntityRef,\n  useEntityList,\n  useStarredEntities,\n} from '@backstage/plugin-catalog-react';\nimport Typography from '@material-ui/core/Typography';\nimport { visuallyHidden } from '@mui/utils';\nimport Edit from '@material-ui/icons/Edit';\nimport OpenInNew from '@material-ui/icons/OpenInNew';\nimport { capitalize } from 'lodash';\nimport pluralize from 'pluralize';\nimport { ReactNode, useMemo } from 'react';\nimport { columnFactories } from './columns';\nimport { CatalogTableColumnsFunc, CatalogTableRow } from './types';\nimport { OffsetPaginatedCatalogTable } from './OffsetPaginatedCatalogTable';\nimport { CursorPaginatedCatalogTable } from './CursorPaginatedCatalogTable';\nimport { defaultCatalogTableColumnsFunc } from './defaultCatalogTableColumnsFunc';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\nimport { catalogTranslationRef } from '../../alpha';\nimport { FavoriteToggleIcon } from '@backstage/core-components';\n\n/**\n * Props for {@link CatalogTable}.\n *\n * @public\n */\nexport interface CatalogTableProps {\n  columns?: TableColumn<CatalogTableRow>[] | CatalogTableColumnsFunc;\n  actions?: TableProps<CatalogTableRow>['actions'];\n  tableOptions?: TableProps<CatalogTableRow>['options'];\n  emptyContent?: ReactNode;\n  /**\n   * A static title to use for the table. If not provided, a title will be\n   * generated based on the current Kind and Type filters and total number of items.\n   */\n  title?: string;\n  subtitle?: string;\n}\n\nconst refCompare = (a: Entity, b: Entity) => {\n  const toRef = (entity: Entity) =>\n    entity.metadata.title ||\n    humanizeEntityRef(entity, {\n      defaultKind: 'Component',\n    });\n\n  return toRef(a).localeCompare(toRef(b));\n};\n\n/**\n * CatalogTable is a wrapper around the Table component that is pre-configured\n * to display catalog entities.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/features/software-catalog/catalog-customization}\n *\n * @public\n */\nexport const CatalogTable = (props: CatalogTableProps) => {\n  const {\n    columns = defaultCatalogTableColumnsFunc,\n    tableOptions,\n    subtitle,\n    emptyContent,\n  } = props;\n  const { isStarredEntity, toggleStarredEntity } = useStarredEntities();\n  const entityListContext = useEntityList();\n\n  const {\n    loading,\n    error,\n    entities,\n    filters,\n    pageInfo,\n    totalItems,\n    paginationMode,\n  } = entityListContext;\n\n  const tableColumns = useMemo(\n    () =>\n      typeof columns === 'function' ? columns(entityListContext) : columns,\n    [columns, entityListContext],\n  );\n  const { t } = useTranslationRef(catalogTranslationRef);\n\n  if (error) {\n    return (\n      <div>\n        <WarningPanel\n          severity=\"error\"\n          title={t('catalogTable.warningPanelTitle')}\n        >\n          <CodeSnippet language=\"text\" text={error.toString()} />\n        </WarningPanel>\n      </div>\n    );\n  }\n\n  const defaultActions: TableProps<CatalogTableRow>['actions'] = [\n    ({ entity }) => {\n      const url = entity.metadata.annotations?.[ANNOTATION_VIEW_URL];\n      const title = t('catalogTable.viewActionTitle');\n\n      return {\n        icon: () => (\n          <>\n            <Typography style={visuallyHidden}>{title}</Typography>\n            <OpenInNew fontSize=\"small\" />\n          </>\n        ),\n        tooltip: title,\n        disabled: !url,\n        onClick: () => {\n          if (!url) return;\n          window.open(url, '_blank');\n        },\n      };\n    },\n    ({ entity }) => {\n      const url = entity.metadata.annotations?.[ANNOTATION_EDIT_URL];\n      const title = t('catalogTable.editActionTitle');\n\n      return {\n        icon: () => (\n          <>\n            <Typography style={visuallyHidden}>{title}</Typography>\n            <Edit fontSize=\"small\" />\n          </>\n        ),\n        tooltip: title,\n        disabled: !url,\n        onClick: () => {\n          if (!url) return;\n          window.open(url, '_blank');\n        },\n      };\n    },\n    ({ entity }) => {\n      const isStarred = isStarredEntity(entity);\n      const title = isStarred\n        ? t('catalogTable.unStarActionTitle')\n        : t('catalogTable.starActionTitle');\n\n      return {\n        cellStyle: { paddingLeft: '1em' },\n        icon: () => <FavoriteToggleIcon isFavorite={isStarred} />,\n        tooltip: title,\n        onClick: () => toggleStarredEntity(entity),\n      };\n    },\n  ];\n\n  const currentKind = filters.kind?.label || '';\n  const currentType = filters.type?.value || '';\n  const currentCount = typeof totalItems === 'number' ? `(${totalItems})` : '';\n  // TODO(timbonicus): remove the title from the CatalogTable once using EntitySearchBar\n  const titlePreamble = capitalize(filters.user?.value ?? 'all');\n  const title =\n    props.title ||\n    [titlePreamble, currentType, pluralize(currentKind), currentCount]\n      .filter(s => s)\n      .join(' ');\n\n  const actions = props.actions || defaultActions;\n  const options: TableProps['options'] = {\n    actionsColumnIndex: -1,\n    loadingType: 'linear' as const,\n    showEmptyDataSourceMessage: !loading,\n    padding: 'dense' as const,\n    ...tableOptions,\n  };\n\n  if (paginationMode === 'cursor') {\n    return (\n      <CursorPaginatedCatalogTable\n        columns={tableColumns}\n        emptyContent={emptyContent}\n        isLoading={loading}\n        title={title}\n        actions={actions}\n        subtitle={subtitle}\n        options={options}\n        data={entities.map(toEntityRow)}\n        next={pageInfo?.next}\n        prev={pageInfo?.prev}\n      />\n    );\n  } else if (paginationMode === 'offset') {\n    return (\n      <OffsetPaginatedCatalogTable\n        columns={tableColumns}\n        emptyContent={emptyContent}\n        isLoading={loading}\n        title={title}\n        actions={actions}\n        subtitle={subtitle}\n        options={options}\n        data={entities.map(toEntityRow)}\n      />\n    );\n  }\n\n  const rows = entities.sort(refCompare).map(toEntityRow);\n  const pageSize = 20;\n  const showPagination = rows.length > pageSize;\n\n  return (\n    <Table<CatalogTableRow>\n      isLoading={loading}\n      columns={tableColumns}\n      options={{\n        paging: showPagination,\n        pageSize: pageSize,\n        pageSizeOptions: [20, 50, 100],\n        ...options,\n      }}\n      title={title}\n      data={rows}\n      actions={actions}\n      subtitle={subtitle}\n      emptyContent={emptyContent}\n    />\n  );\n};\n\nCatalogTable.columns = columnFactories;\nCatalogTable.defaultColumnsFunc = defaultCatalogTableColumnsFunc;\n\nfunction toEntityRow(entity: Entity) {\n  const partOfSystemRelations = getEntityRelations(entity, RELATION_PART_OF, {\n    kind: 'system',\n  });\n  const ownedByRelations = getEntityRelations(entity, RELATION_OWNED_BY);\n\n  return {\n    entity,\n    resolved: {\n      // This name is here for backwards compatibility mostly; the\n      // presentation of refs in the table should in general be handled with\n      // EntityRefLink / EntityName components\n      name: humanizeEntityRef(entity, {\n        defaultKind: 'Component',\n      }),\n      entityRef: stringifyEntityRef(entity),\n      ownedByRelationsTitle: ownedByRelations\n        .map(r => humanizeEntityRef(r, { defaultKind: 'group' }))\n        .join(', '),\n      ownedByRelations,\n      partOfSystemRelationTitle: partOfSystemRelations\n        .map(r =>\n          humanizeEntityRef(r, {\n            defaultKind: 'system',\n          }),\n        )\n        .join(', '),\n      partOfSystemRelations,\n    },\n  };\n}\n"],"names":["title","Edit"],"mappings":"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"}