{"version":3,"file":"AboutContent.esm.js","sources":["../../../src/components/AboutCard/AboutContent.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  getEntitySourceLocation,\n  RELATION_OWNED_BY,\n  RELATION_PART_OF,\n} from '@backstage/catalog-model';\nimport {\n  EntityRefLinks,\n  getEntityRelations,\n} from '@backstage/plugin-catalog-react';\nimport { JsonArray } from '@backstage/types';\nimport Chip from '@material-ui/core/Chip';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { MarkdownContent } from '@backstage/core-components';\nimport { AboutField } from './AboutField';\nimport { LinksGridList } from '../EntityLinksCard/LinksGridList';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\nimport { catalogTranslationRef } from '../../alpha/translation';\n\nconst useStyles = makeStyles({\n  description: {\n    wordBreak: 'break-word',\n  },\n});\n\n/**\n * Props for {@link AboutContent}.\n *\n * @public\n */\nexport interface AboutContentProps {\n  entity: Entity;\n}\n\nfunction getLocationTargetHref(\n  target: string,\n  type: string,\n  entitySourceLocation: {\n    type: string;\n    target: string;\n  },\n): string {\n  if (type === 'url' || target.includes('://')) {\n    return target;\n  }\n\n  const srcLocationUrl =\n    entitySourceLocation.type === 'file'\n      ? `file://${entitySourceLocation.target}`\n      : entitySourceLocation.target;\n\n  if (type === 'file' || entitySourceLocation.type === 'file') {\n    return new URL(target, srcLocationUrl).href;\n  }\n\n  return srcLocationUrl;\n}\n\n/** @public */\nexport function AboutContent(props: AboutContentProps) {\n  const { entity } = props;\n  const classes = useStyles();\n  const { t } = useTranslationRef(catalogTranslationRef);\n\n  const isSystem = entity.kind.toLocaleLowerCase('en-US') === 'system';\n  const isResource = entity.kind.toLocaleLowerCase('en-US') === 'resource';\n  const isComponent = entity.kind.toLocaleLowerCase('en-US') === 'component';\n  const isAPI = entity.kind.toLocaleLowerCase('en-US') === 'api';\n  const isTemplate = entity.kind.toLocaleLowerCase('en-US') === 'template';\n  const isLocation = entity.kind.toLocaleLowerCase('en-US') === 'location';\n  const isGroup = entity.kind.toLocaleLowerCase('en-US') === 'group';\n\n  const partOfSystemRelations = getEntityRelations(entity, RELATION_PART_OF, {\n    kind: 'system',\n  });\n  const partOfComponentRelations = getEntityRelations(\n    entity,\n    RELATION_PART_OF,\n    {\n      kind: 'component',\n    },\n  );\n  const partOfDomainRelations = getEntityRelations(entity, RELATION_PART_OF, {\n    kind: 'domain',\n  });\n  const ownedByRelations = getEntityRelations(entity, RELATION_OWNED_BY);\n\n  let entitySourceLocation:\n    | {\n        type: string;\n        target: string;\n      }\n    | undefined;\n  try {\n    entitySourceLocation = getEntitySourceLocation(entity);\n  } catch (e) {\n    entitySourceLocation = undefined;\n  }\n\n  return (\n    <Grid container>\n      <AboutField\n        label={t('aboutCard.descriptionField.label')}\n        gridSizes={{ xs: 12 }}\n      >\n        <MarkdownContent\n          className={classes.description}\n          content={\n            entity?.metadata?.description ||\n            t('aboutCard.descriptionField.value')\n          }\n        />\n      </AboutField>\n      <AboutField\n        label={t('aboutCard.ownerField.label')}\n        value={t('aboutCard.ownerField.value')}\n        className={classes.description}\n        gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n      >\n        {ownedByRelations.length > 0 && (\n          <EntityRefLinks entityRefs={ownedByRelations} defaultKind=\"group\" />\n        )}\n      </AboutField>\n      {(isSystem || partOfDomainRelations.length > 0) && (\n        <AboutField\n          label={t('aboutCard.domainField.label')}\n          value={t('aboutCard.domainField.value')}\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        >\n          {partOfDomainRelations.length > 0 && (\n            <EntityRefLinks\n              entityRefs={partOfDomainRelations}\n              defaultKind=\"domain\"\n            />\n          )}\n        </AboutField>\n      )}\n      {(isAPI ||\n        isComponent ||\n        isResource ||\n        partOfSystemRelations.length > 0) && (\n        <AboutField\n          label={t('aboutCard.systemField.label')}\n          value={t('aboutCard.systemField.value')}\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        >\n          {partOfSystemRelations.length > 0 && (\n            <EntityRefLinks\n              entityRefs={partOfSystemRelations}\n              defaultKind=\"system\"\n            />\n          )}\n        </AboutField>\n      )}\n      {isComponent && partOfComponentRelations.length > 0 && (\n        <AboutField\n          label={t('aboutCard.parentComponentField.label')}\n          value={t('aboutCard.parentComponentField.value')}\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        >\n          <EntityRefLinks\n            entityRefs={partOfComponentRelations}\n            defaultKind=\"component\"\n          />\n        </AboutField>\n      )}\n      {(isAPI ||\n        isComponent ||\n        isResource ||\n        isTemplate ||\n        isGroup ||\n        isLocation ||\n        typeof entity?.spec?.type === 'string') && (\n        <AboutField\n          label={t('aboutCard.typeField.label')}\n          value={entity?.spec?.type as string}\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        />\n      )}\n      {(isAPI ||\n        isComponent ||\n        typeof entity?.spec?.lifecycle === 'string') && (\n        <AboutField\n          label={t('aboutCard.lifecycleField.label')}\n          value={entity?.spec?.lifecycle as string}\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        />\n      )}\n      <AboutField\n        label={t('aboutCard.tagsField.label')}\n        value={t('aboutCard.tagsField.value')}\n        gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n      >\n        {(entity?.metadata?.tags || []).map(tag => (\n          <Chip key={tag} size=\"small\" label={tag} />\n        ))}\n      </AboutField>\n      {isLocation && (entity?.spec?.targets || entity?.spec?.target) && (\n        <AboutField\n          label={t('aboutCard.targetsField.label')}\n          gridSizes={{ xs: 12 }}\n        >\n          <LinksGridList\n            cols={1}\n            items={((entity.spec.targets as JsonArray) || [entity.spec.target])\n              .map(target => target as string)\n              .map(target => ({\n                text: target,\n                href: getLocationTargetHref(\n                  target,\n                  (entity?.spec?.type || 'unknown') as string,\n                  entitySourceLocation!,\n                ),\n              }))}\n          />\n        </AboutField>\n      )}\n    </Grid>\n  );\n}\n"],"names":[],"mappings":"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"}