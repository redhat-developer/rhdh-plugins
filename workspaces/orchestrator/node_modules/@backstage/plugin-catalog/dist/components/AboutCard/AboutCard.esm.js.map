{"version":3,"file":"AboutCard.esm.js","sources":["../../../src/components/AboutCard/AboutCard.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport Divider from '@material-ui/core/Divider';\nimport IconButton from '@material-ui/core/IconButton';\nimport CachedIcon from '@material-ui/icons/Cached';\nimport EditIcon from '@material-ui/icons/Edit';\nimport DocsIcon from '@material-ui/icons/Description';\nimport CreateComponentIcon from '@material-ui/icons/AddCircleOutline';\n\nimport {\n  AppIcon,\n  HeaderIconLinkRow,\n  IconLinkVerticalProps,\n  InfoCardVariants,\n  Link,\n} from '@backstage/core-components';\nimport {\n  alertApiRef,\n  errorApiRef,\n  useApp,\n  useApi,\n  useRouteRef,\n} from '@backstage/core-plugin-api';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\nimport {\n  ScmIntegrationIcon,\n  scmIntegrationsApiRef,\n} from '@backstage/integration-react';\n\nimport {\n  DEFAULT_NAMESPACE,\n  ANNOTATION_EDIT_URL,\n  ANNOTATION_LOCATION,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  catalogApiRef,\n  getEntitySourceLocation,\n  useEntity,\n} from '@backstage/plugin-catalog-react';\nimport { useEntityPermission } from '@backstage/plugin-catalog-react/alpha';\nimport { catalogEntityRefreshPermission } from '@backstage/plugin-catalog-common/alpha';\n\nimport {\n  TECHDOCS_ANNOTATION,\n  TECHDOCS_EXTERNAL_ANNOTATION,\n} from '@backstage/plugin-techdocs-common';\nimport { buildTechDocsURL } from '@backstage/plugin-techdocs-react';\n\nimport { isTemplateEntityV1beta3 } from '@backstage/plugin-scaffolder-common';\nimport { taskCreatePermission } from '@backstage/plugin-scaffolder-common/alpha';\n\nimport { usePermission } from '@backstage/plugin-permission-react';\n\nimport { createFromTemplateRouteRef, viewTechDocRouteRef } from '../../routes';\nimport { catalogTranslationRef } from '../../alpha/translation';\nimport { useSourceTemplateCompoundEntityRef } from './hooks';\nimport { AboutContent } from './AboutContent';\n\nexport function useCatalogSourceIconLinkProps() {\n  const { entity } = useEntity();\n  const scmIntegrationsApi = useApi(scmIntegrationsApiRef);\n  const { t } = useTranslationRef(catalogTranslationRef);\n  const entitySourceLocation = getEntitySourceLocation(\n    entity,\n    scmIntegrationsApi,\n  );\n  return {\n    label: t('aboutCard.viewSource'),\n    disabled: !entitySourceLocation,\n    icon: <ScmIntegrationIcon type={entitySourceLocation?.integrationType} />,\n    href: entitySourceLocation?.locationTargetUrl,\n  };\n}\n\n// TODO: This hook is duplicated from the TechDocs plugin for backwards compatibility\n// Remove it when the the legacy frontend system support is dropped.\nfunction useTechdocsReaderIconLinkProps(): IconLinkVerticalProps {\n  const { entity } = useEntity();\n  const viewTechdocLink = useRouteRef(viewTechDocRouteRef);\n  const { t } = useTranslationRef(catalogTranslationRef);\n\n  return {\n    label: t('aboutCard.viewTechdocs'),\n    disabled:\n      !(\n        entity.metadata.annotations?.[TECHDOCS_ANNOTATION] ||\n        entity.metadata.annotations?.[TECHDOCS_EXTERNAL_ANNOTATION]\n      ) || !viewTechdocLink,\n    icon: <DocsIcon />,\n    href: buildTechDocsURL(entity, viewTechdocLink),\n  };\n}\n\n// TODO: This hook is duplicated from the Scaffolder plugin for backwards compatibility\n// Remove it when the the legacy frontend system support is dropped.\nfunction useScaffolderTemplateIconLinkProps(): IconLinkVerticalProps {\n  const app = useApp();\n  const { entity } = useEntity();\n  const templateRoute = useRouteRef(createFromTemplateRouteRef);\n  const { t } = useTranslationRef(catalogTranslationRef);\n  const Icon = app.getSystemIcon('scaffolder') ?? CreateComponentIcon;\n  const { allowed: canCreateTemplateTask } = usePermission({\n    permission: taskCreatePermission,\n  });\n\n  return {\n    label: t('aboutCard.launchTemplate'),\n    icon: <Icon />,\n    disabled: !templateRoute || !canCreateTemplateTask,\n    href:\n      templateRoute &&\n      templateRoute({\n        templateName: entity.metadata.name,\n        namespace: entity.metadata.namespace || DEFAULT_NAMESPACE,\n      }),\n  };\n}\n\nfunction DefaultAboutCardSubheader() {\n  const { entity } = useEntity();\n  const catalogSourceIconLink = useCatalogSourceIconLinkProps();\n  const techdocsreaderIconLink = useTechdocsReaderIconLinkProps();\n  const scaffolderTemplateIconLink = useScaffolderTemplateIconLinkProps();\n\n  const links = [catalogSourceIconLink, techdocsreaderIconLink];\n  if (isTemplateEntityV1beta3(entity)) {\n    links.push(scaffolderTemplateIconLink);\n  }\n\n  return <HeaderIconLinkRow links={links} />;\n}\n\nconst useStyles = makeStyles({\n  gridItemCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: 'calc(100% - 10px)', // for pages without content header\n    marginBottom: '10px',\n  },\n  fullHeightCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n  },\n  gridItemCardContent: {\n    flex: 1,\n  },\n  fullHeightCardContent: {\n    flex: 1,\n  },\n});\n\n/**\n * Props for {@link EntityAboutCard}.\n *\n * @public\n */\nexport type AboutCardProps = {\n  variant?: InfoCardVariants;\n};\n\nexport interface InternalAboutCardProps extends AboutCardProps {\n  subheader?: JSX.Element;\n}\n\nexport function InternalAboutCard(props: InternalAboutCardProps) {\n  const { variant, subheader } = props;\n  const classes = useStyles();\n  const { entity } = useEntity();\n  const catalogApi = useApi(catalogApiRef);\n  const alertApi = useApi(alertApiRef);\n  const errorApi = useApi(errorApiRef);\n  const templateRoute = useRouteRef(createFromTemplateRouteRef);\n  const sourceTemplateRef = useSourceTemplateCompoundEntityRef(entity);\n  const { allowed: canRefresh } = useEntityPermission(\n    catalogEntityRefreshPermission,\n  );\n  const { t } = useTranslationRef(catalogTranslationRef);\n\n  const entityMetadataEditUrl =\n    entity.metadata.annotations?.[ANNOTATION_EDIT_URL];\n\n  let cardClass = '';\n  if (variant === 'gridItem') {\n    cardClass = classes.gridItemCard;\n  } else if (variant === 'fullHeight') {\n    cardClass = classes.fullHeightCard;\n  }\n\n  let cardContentClass = '';\n  if (variant === 'gridItem') {\n    cardContentClass = classes.gridItemCardContent;\n  } else if (variant === 'fullHeight') {\n    cardContentClass = classes.fullHeightCardContent;\n  }\n\n  const entityLocation = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  // Limiting the ability to manually refresh to the less expensive locations\n  const allowRefresh =\n    entityLocation?.startsWith('url:') || entityLocation?.startsWith('file:');\n  const refreshEntity = useCallback(async () => {\n    try {\n      await catalogApi.refreshEntity(stringifyEntityRef(entity));\n      alertApi.post({\n        message: t('aboutCard.refreshScheduledMessage'),\n        severity: 'info',\n        display: 'transient',\n      });\n    } catch (e) {\n      errorApi.post(e);\n    }\n  }, [catalogApi, entity, alertApi, t, errorApi]);\n\n  return (\n    <Card className={cardClass}>\n      <CardHeader\n        title={t('aboutCard.title')}\n        action={\n          <>\n            {allowRefresh && canRefresh && (\n              <IconButton\n                aria-label=\"Refresh\"\n                title={t('aboutCard.refreshButtonTitle')}\n                onClick={refreshEntity}\n              >\n                <CachedIcon />\n              </IconButton>\n            )}\n            <IconButton\n              component={Link}\n              aria-label=\"Edit\"\n              disabled={!entityMetadataEditUrl}\n              title={t('aboutCard.editButtonTitle')}\n              to={entityMetadataEditUrl ?? '#'}\n            >\n              <EditIcon />\n            </IconButton>\n            {sourceTemplateRef && templateRoute && (\n              <IconButton\n                component={Link}\n                title={t('aboutCard.createSimilarButtonTitle')}\n                to={templateRoute({\n                  namespace: sourceTemplateRef.namespace,\n                  templateName: sourceTemplateRef.name,\n                })}\n              >\n                <AppIcon id=\"scaffolder\" />\n              </IconButton>\n            )}\n          </>\n        }\n        subheader={subheader ?? <DefaultAboutCardSubheader />}\n      />\n      <Divider />\n      <CardContent className={cardContentClass}>\n        <AboutContent entity={entity} />\n      </CardContent>\n    </Card>\n  );\n}\n\n/**\n * Exported publicly via the EntityAboutCard\n *\n * NOTE: We generally do not accept pull requests to extend this class with more\n * props and customizability. If you need to tweak it, consider making a bespoke\n * card in your own repository instead, that is perfect for your own needs.\n */\nexport function AboutCard(props: AboutCardProps) {\n  return <InternalAboutCard {...props} />;\n}\n"],"names":[],"mappings":"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"}