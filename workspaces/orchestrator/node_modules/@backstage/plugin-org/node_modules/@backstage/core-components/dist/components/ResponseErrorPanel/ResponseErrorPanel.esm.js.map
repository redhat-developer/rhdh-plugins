{"version":3,"file":"ResponseErrorPanel.esm.js","sources":["../../../src/components/ResponseErrorPanel/ResponseErrorPanel.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ResponseError } from '@backstage/errors';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Divider from '@material-ui/core/Divider';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport { CodeSnippet } from '../CodeSnippet';\nimport { CopyTextButton } from '../CopyTextButton';\nimport { ErrorPanel, ErrorPanelProps } from '../ErrorPanel';\n\nexport type ResponseErrorPanelClassKey = 'text' | 'divider';\n\nconst useStyles = makeStyles(\n  theme => ({\n    text: {\n      fontFamily: 'monospace',\n      whiteSpace: 'pre',\n      overflowX: 'auto',\n      marginRight: theme.spacing(2),\n    },\n    divider: {\n      margin: theme.spacing(2),\n    },\n  }),\n  { name: 'BackstageResponseErrorPanel' },\n);\n\n/**\n * Renders a warning panel as the effect of a failed server request.\n *\n * @remarks\n * Has special treatment for ResponseError errors, to display rich\n * server-provided information about what happened.\n */\nexport function ResponseErrorPanel(props: ErrorPanelProps) {\n  const { title, error, defaultExpanded } = props;\n  const classes = useStyles();\n\n  if (error.name !== 'ResponseError') {\n    return (\n      <ErrorPanel\n        title={title ?? error.message}\n        defaultExpanded={defaultExpanded}\n        error={error}\n      />\n    );\n  }\n\n  const { body, cause } = error as ResponseError;\n  const { request, response } = body;\n\n  const errorString = `${response.statusCode}: ${cause.name}`;\n  const requestString = request && `${request.method} ${request.url}`;\n  const messageString = cause.message.replace(/\\\\n/g, '\\n');\n  const stackString = cause.stack?.replace(/\\\\n/g, '\\n');\n  const jsonString = JSON.stringify(body, undefined, 2);\n\n  return (\n    <ErrorPanel\n      title={title ?? error.message}\n      defaultExpanded={defaultExpanded}\n      error={{ name: errorString, message: messageString, stack: stackString }}\n    >\n      {requestString && (\n        <ListItem alignItems=\"flex-start\">\n          <ListItemText\n            classes={{ secondary: classes.text }}\n            primary=\"Request\"\n            secondary={request ? `${requestString}` : undefined}\n          />\n          <CopyTextButton text={requestString} />\n        </ListItem>\n      )}\n      <>\n        <Divider component=\"li\" className={classes.divider} />\n        <ListItem alignItems=\"flex-start\">\n          <ListItemText\n            classes={{ secondary: classes.text }}\n            primary=\"Full Error as JSON\"\n          />\n        </ListItem>\n        <CodeSnippet language=\"json\" text={jsonString} showCopyCodeButton />\n      </>\n    </ErrorPanel>\n  );\n}\n"],"names":[],"mappings":"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"}