{"version":3,"file":"Page.esm.js","sources":["../../../src/layout/Sidebar/Page.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Box from '@material-ui/core/Box';\nimport { makeStyles, Theme } from '@material-ui/core/styles';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport {\n  ReactNode,\n  MutableRefObject,\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { SidebarConfig, SidebarConfigContext } from './config';\nimport { LocalStorage } from './localStorage';\nimport { SidebarPinStateProvider } from './SidebarPinStateContext';\n\nexport type SidebarPageClassKey = 'root';\n\ntype StyleProps = { sidebarConfig: SidebarConfig; isPinned: boolean };\n\nconst useStyles = makeStyles<Theme, StyleProps>(\n  theme => ({\n    root: {\n      width: '100%',\n      transition: 'padding-left 0.1s ease-out',\n      isolation: 'isolate',\n      [theme.breakpoints.up('sm')]: {\n        paddingLeft: (props: StyleProps) =>\n          props.isPinned\n            ? props.sidebarConfig.drawerWidthOpen\n            : props.sidebarConfig.drawerWidthClosed,\n      },\n      [theme.breakpoints.down('xs')]: {\n        paddingBottom: (props: StyleProps) =>\n          props.sidebarConfig.mobileSidebarHeight,\n      },\n      '@media print': {\n        padding: '0px !important',\n      },\n    },\n    content: {\n      zIndex: 0,\n      isolation: 'isolate',\n      '&:focus': {\n        outline: 0,\n      },\n    },\n  }),\n  { name: 'BackstageSidebarPage' },\n);\n\n/**\n * Props for SidebarPage\n *\n * @public\n */\nexport type SidebarPageProps = {\n  children?: ReactNode;\n};\n\ntype PageContextType = {\n  content: {\n    contentRef?: MutableRefObject<HTMLElement | null>;\n  };\n};\n\nconst PageContext = createContext<PageContextType>({\n  content: {\n    contentRef: undefined,\n  },\n});\nexport function SidebarPage(props: SidebarPageProps) {\n  const [isPinned, setIsPinned] = useState(() =>\n    LocalStorage.getSidebarPinState(),\n  );\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n\n  const contentRef = useRef(null);\n\n  const pageContext = useMemo(\n    () => ({\n      content: {\n        contentRef,\n      },\n    }),\n    [contentRef],\n  );\n\n  useEffect(() => {\n    LocalStorage.setSidebarPinState(isPinned);\n  }, [isPinned]);\n\n  const isMobile = useMediaQuery<Theme>(theme => theme.breakpoints.down('xs'), {\n    noSsr: true,\n  });\n\n  const toggleSidebarPinState = () => setIsPinned(!isPinned);\n\n  const classes = useStyles({ isPinned, sidebarConfig });\n\n  return (\n    <SidebarPinStateProvider\n      value={{\n        isPinned,\n        toggleSidebarPinState,\n        isMobile,\n      }}\n    >\n      <PageContext.Provider value={pageContext}>\n        <Box className={classes.root}>{props.children}</Box>\n      </PageContext.Provider>\n    </SidebarPinStateProvider>\n  );\n}\n\n/**\n * This hook provides a react ref to the main content.\n * Allows to set an element as the main content and focus on that component.\n *\n * *Note: If `contentRef` is not set `focusContent` is noop. `Content` component sets this ref automatically*\n *\n * @public\n * @example\n * Focus current content\n * ```tsx\n *  const { focusContent} = useContent();\n * ...\n *  <Button onClick={focusContent}>\n *     focus main content\n *  </Button>\n * ```\n * @example\n * Set the reference to an Html element\n * ```\n *  const { contentRef } = useContent();\n * ...\n *  <article ref={contentRef} tabIndex={-1}>Main Content</article>\n * ```\n */\nexport function useContent() {\n  const { content } = useContext(PageContext);\n\n  const focusContent = useCallback(() => {\n    content?.contentRef?.current?.focus();\n  }, [content]);\n\n  return { focusContent, contentRef: content?.contentRef };\n}\n"],"names":[],"mappings":"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"}