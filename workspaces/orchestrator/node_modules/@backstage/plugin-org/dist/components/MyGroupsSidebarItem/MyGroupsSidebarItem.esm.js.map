{"version":3,"file":"MyGroupsSidebarItem.esm.js","sources":["../../../src/components/MyGroupsSidebarItem/MyGroupsSidebarItem.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  DEFAULT_NAMESPACE,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  SidebarItem,\n  SidebarSubmenu,\n  SidebarSubmenuItem,\n} from '@backstage/core-components';\nimport {\n  IconComponent,\n  identityApiRef,\n  useApi,\n  useRouteRef,\n} from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/esm/useAsync';\nimport {\n  catalogApiRef,\n  entityRouteRef,\n  entityPresentationApiRef,\n} from '@backstage/plugin-catalog-react';\nimport { getCompoundEntityRef } from '@backstage/catalog-model';\n\n/**\n * MyGroupsSidebarItem can be added to your sidebar providing quick access to groups the logged in user is a member of\n *\n * @public\n */\nexport const MyGroupsSidebarItem = (props: {\n  singularTitle: string;\n  pluralTitle: string;\n  icon: IconComponent;\n  filter?: Record<string, string | symbol | (string | symbol)[]>;\n}) => {\n  const { singularTitle, pluralTitle, icon, filter } = props;\n\n  const identityApi = useApi(identityApiRef);\n  const catalogApi = useApi(catalogApiRef);\n  const catalogEntityRoute = useRouteRef(entityRouteRef);\n  const entityPresentationApi = useApi(entityPresentationApiRef);\n\n  const { value: groups } = useAsync(async () => {\n    const profile = await identityApi.getBackstageIdentity();\n\n    const response = await catalogApi.getEntities({\n      filter: [\n        {\n          kind: 'group',\n          'relations.hasMember': profile.userEntityRef,\n          ...(filter ?? {}),\n        },\n      ],\n      fields: ['metadata', 'kind', 'spec.profile'],\n    });\n    return response.items;\n  }, []);\n\n  if (!groups?.length) {\n    return null;\n  }\n\n  // Only member of one group\n  if (groups.length === 1) {\n    const group = groups[0];\n    return (\n      <SidebarItem\n        text={singularTitle}\n        to={catalogEntityRoute(getCompoundEntityRef(group))}\n        icon={icon}\n      />\n    );\n  }\n\n  // Member of more than one group\n  return (\n    <SidebarItem icon={icon} text={pluralTitle}>\n      <SidebarSubmenu title={pluralTitle}>\n        {groups?.map(group => {\n          const entityDisplayName = entityPresentationApi.forEntity(group);\n          return (\n            <SidebarSubmenuItem\n              title={entityDisplayName.snapshot.primaryTitle}\n              subtitle={\n                group.metadata.namespace !== DEFAULT_NAMESPACE\n                  ? group.metadata.namespace\n                  : undefined\n              }\n              to={catalogEntityRoute(getCompoundEntityRef(group))}\n              icon={icon}\n              key={stringifyEntityRef(group)}\n            />\n          );\n        })}\n      </SidebarSubmenu>\n    </SidebarItem>\n  );\n};\n"],"names":[],"mappings":";;;;;;;AA4CO,MAAM,mBAAA,GAAsB,CAAC,KAAA,KAK9B;AACJ,EAAA,MAAM,EAAE,aAAA,EAAe,WAAA,EAAa,IAAA,EAAM,QAAO,GAAI,KAAA;AAErD,EAAA,MAAM,WAAA,GAAc,OAAO,cAAc,CAAA;AACzC,EAAA,MAAM,UAAA,GAAa,OAAO,aAAa,CAAA;AACvC,EAAA,MAAM,kBAAA,GAAqB,YAAY,cAAc,CAAA;AACrD,EAAA,MAAM,qBAAA,GAAwB,OAAO,wBAAwB,CAAA;AAE7D,EAAA,MAAM,EAAE,KAAA,EAAO,MAAA,EAAO,GAAI,SAAS,YAAY;AAC7C,IAAA,MAAM,OAAA,GAAU,MAAM,WAAA,CAAY,oBAAA,EAAqB;AAEvD,IAAA,MAAM,QAAA,GAAW,MAAM,UAAA,CAAW,WAAA,CAAY;AAAA,MAC5C,MAAA,EAAQ;AAAA,QACN;AAAA,UACE,IAAA,EAAM,OAAA;AAAA,UACN,uBAAuB,OAAA,CAAQ,aAAA;AAAA,UAC/B,GAAI,UAAU;AAAC;AACjB,OACF;AAAA,MACA,MAAA,EAAQ,CAAC,UAAA,EAAY,MAAA,EAAQ,cAAc;AAAA,KAC5C,CAAA;AACD,IAAA,OAAO,QAAA,CAAS,KAAA;AAAA,EAClB,CAAA,EAAG,EAAE,CAAA;AAEL,EAAA,IAAI,CAAC,QAAQ,MAAA,EAAQ;AACnB,IAAA,OAAO,IAAA;AAAA,EACT;AAGA,EAAA,IAAI,MAAA,CAAO,WAAW,CAAA,EAAG;AACvB,IAAA,MAAM,KAAA,GAAQ,OAAO,CAAC,CAAA;AACtB,IAAA,uBACE,GAAA;AAAA,MAAC,WAAA;AAAA,MAAA;AAAA,QACC,IAAA,EAAM,aAAA;AAAA,QACN,EAAA,EAAI,kBAAA,CAAmB,oBAAA,CAAqB,KAAK,CAAC,CAAA;AAAA,QAClD;AAAA;AAAA,KACF;AAAA,EAEJ;AAGA,EAAA,uBACE,GAAA,CAAC,WAAA,EAAA,EAAY,IAAA,EAAY,IAAA,EAAM,WAAA,EAC7B,QAAA,kBAAA,GAAA,CAAC,cAAA,EAAA,EAAe,KAAA,EAAO,WAAA,EACpB,QAAA,EAAA,MAAA,EAAQ,GAAA,CAAI,CAAA,KAAA,KAAS;AACpB,IAAA,MAAM,iBAAA,GAAoB,qBAAA,CAAsB,SAAA,CAAU,KAAK,CAAA;AAC/D,IAAA,uBACE,GAAA;AAAA,MAAC,kBAAA;AAAA,MAAA;AAAA,QACC,KAAA,EAAO,kBAAkB,QAAA,CAAS,YAAA;AAAA,QAClC,UACE,KAAA,CAAM,QAAA,CAAS,cAAc,iBAAA,GACzB,KAAA,CAAM,SAAS,SAAA,GACf,MAAA;AAAA,QAEN,EAAA,EAAI,kBAAA,CAAmB,oBAAA,CAAqB,KAAK,CAAC,CAAA;AAAA,QAClD;AAAA,OAAA;AAAA,MACK,mBAAmB,KAAK;AAAA,KAC/B;AAAA,EAEJ,CAAC,GACH,CAAA,EACF,CAAA;AAEJ;;;;"}