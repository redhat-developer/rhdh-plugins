{"version":3,"file":"Bar.esm.js","sources":["../../../src/layout/Sidebar/Bar.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles, Theme } from '@material-ui/core/styles';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport classnames from 'classnames';\nimport { ReactNode, useContext, useRef, useState } from 'react';\n\nimport {\n  makeSidebarConfig,\n  makeSidebarSubmenuConfig,\n  SidebarConfig,\n  SidebarConfigContext,\n  SidebarOptions,\n  SubmenuConfig,\n  SubmenuOptions,\n} from './config';\nimport { MobileSidebar } from './MobileSidebar';\nimport { useContent } from './Page';\nimport { SidebarOpenStateProvider } from './SidebarOpenStateContext';\nimport { useSidebarPinState } from './SidebarPinStateContext';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\nimport { coreComponentsTranslationRef } from '../../translation';\n\n/** @public */\nexport type SidebarClassKey = 'drawer' | 'drawerOpen';\nconst useStyles = makeStyles<Theme, { sidebarConfig: SidebarConfig }>(\n  theme => ({\n    root: {\n      left: 0,\n      top: 0,\n      bottom: 0,\n      zIndex: theme.zIndex.appBar,\n      position: 'fixed',\n    },\n    drawer: {\n      display: 'flex',\n      flexFlow: 'column nowrap',\n      alignItems: 'flex-start',\n      left: 0,\n      top: 0,\n      bottom: 0,\n      position: 'absolute',\n      background: theme.palette.navigation.background,\n      overflowX: 'hidden',\n      msOverflowStyle: 'none',\n      scrollbarWidth: 'none',\n      transition: theme.transitions.create('width', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.shortest,\n      }),\n      '& > *': {\n        flexShrink: 0,\n      },\n      '&::-webkit-scrollbar': {\n        display: 'none',\n      },\n      '@media print': {\n        display: 'none',\n      },\n    },\n    drawerWidth: props => ({\n      width: props.sidebarConfig.drawerWidthClosed,\n    }),\n    drawerOpen: props => ({\n      width: props.sidebarConfig.drawerWidthOpen,\n      transition: theme.transitions.create('width', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.shorter,\n      }),\n    }),\n    visuallyHidden: {\n      top: 0,\n      position: 'absolute',\n      zIndex: 1000,\n      transform: 'translateY(-200%)',\n      '&:focus': {\n        transform: 'translateY(5px)',\n      },\n    },\n  }),\n  { name: 'BackstageSidebar' },\n);\n\nenum State {\n  Closed,\n  Idle,\n  Open,\n}\n\n/** @public */\nexport type SidebarProps = {\n  openDelayMs?: number;\n  closeDelayMs?: number;\n  sidebarOptions?: SidebarOptions;\n  submenuOptions?: SubmenuOptions;\n  disableExpandOnHover?: boolean;\n  children?: ReactNode;\n};\n\nexport type DesktopSidebarProps = {\n  openDelayMs?: number;\n  closeDelayMs?: number;\n  disableExpandOnHover?: boolean;\n  children?: ReactNode;\n};\n\n/**\n * Places the Sidebar & wraps the children providing context weather the `Sidebar` is open or not.\n *\n * Handles & delays hover events for expanding the `Sidebar`\n *\n * @param props `disableExpandOnHover` disables the default hover behaviour;\n * `openDelayMs` & `closeDelayMs` set delay until sidebar will open/close on hover\n * @returns\n * @internal\n */\nconst DesktopSidebar = (props: DesktopSidebarProps) => {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const {\n    openDelayMs = sidebarConfig.defaultOpenDelayMs,\n    closeDelayMs = sidebarConfig.defaultCloseDelayMs,\n    disableExpandOnHover,\n    children,\n  } = props;\n\n  const classes = useStyles({ sidebarConfig });\n  const isSmallScreen = useMediaQuery<Theme>(\n    theme => theme.breakpoints.down('md'),\n    { noSsr: true },\n  );\n  const [state, setState] = useState(State.Closed);\n  const hoverTimerRef = useRef<number>();\n  const { isPinned, toggleSidebarPinState } = useSidebarPinState();\n\n  const handleOpen = () => {\n    if (isPinned || disableExpandOnHover) {\n      return;\n    }\n    if (hoverTimerRef.current) {\n      clearTimeout(hoverTimerRef.current);\n      hoverTimerRef.current = undefined;\n    }\n    if (state !== State.Open && !isSmallScreen) {\n      hoverTimerRef.current = window.setTimeout(() => {\n        hoverTimerRef.current = undefined;\n        setState(State.Open);\n      }, openDelayMs);\n\n      setState(State.Idle);\n    }\n  };\n\n  const handleClose = () => {\n    if (isPinned || disableExpandOnHover) {\n      return;\n    }\n    if (hoverTimerRef.current) {\n      clearTimeout(hoverTimerRef.current);\n      hoverTimerRef.current = undefined;\n    }\n    if (state === State.Idle) {\n      setState(State.Closed);\n    } else if (state === State.Open) {\n      hoverTimerRef.current = window.setTimeout(() => {\n        hoverTimerRef.current = undefined;\n        setState(State.Closed);\n      }, closeDelayMs);\n    }\n  };\n\n  const isOpen = (state === State.Open && !isSmallScreen) || isPinned;\n\n  /**\n   * Close/Open Sidebar directly without delays. Also toggles `SidebarPinState` to avoid hidden content behind Sidebar.\n   */\n  const setOpen = (open: boolean) => {\n    if (open) {\n      setState(State.Open);\n      toggleSidebarPinState();\n    } else {\n      setState(State.Closed);\n      toggleSidebarPinState();\n    }\n  };\n\n  return (\n    <nav style={{}} aria-label=\"sidebar nav\">\n      <A11ySkipSidebar />\n      <SidebarOpenStateProvider value={{ isOpen, setOpen }}>\n        <Box\n          className={classes.root}\n          data-testid=\"sidebar-root\"\n          onMouseEnter={disableExpandOnHover ? () => {} : handleOpen}\n          onFocus={disableExpandOnHover ? () => {} : handleOpen}\n          onMouseLeave={disableExpandOnHover ? () => {} : handleClose}\n          onBlur={disableExpandOnHover ? () => {} : handleClose}\n        >\n          <Box\n            className={classnames(classes.drawer, classes.drawerWidth, {\n              [classes.drawerOpen]: isOpen,\n            })}\n          >\n            {children}\n          </Box>\n        </Box>\n      </SidebarOpenStateProvider>\n    </nav>\n  );\n};\n\n/**\n * Passing children into the desktop or mobile sidebar depending on the context\n *\n * @public\n */\nexport const Sidebar = (props: SidebarProps) => {\n  const sidebarConfig: SidebarConfig = makeSidebarConfig(\n    props.sidebarOptions ?? {},\n  );\n  const submenuConfig: SubmenuConfig = makeSidebarSubmenuConfig(\n    props.submenuOptions ?? {},\n  );\n  const { children, disableExpandOnHover, openDelayMs, closeDelayMs } = props;\n  const { isMobile } = useSidebarPinState();\n\n  return isMobile ? (\n    <MobileSidebar>{children}</MobileSidebar>\n  ) : (\n    <SidebarConfigContext.Provider value={{ sidebarConfig, submenuConfig }}>\n      <DesktopSidebar\n        openDelayMs={openDelayMs}\n        closeDelayMs={closeDelayMs}\n        disableExpandOnHover={disableExpandOnHover}\n      >\n        {children}\n      </DesktopSidebar>\n    </SidebarConfigContext.Provider>\n  );\n};\n\nfunction A11ySkipSidebar() {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const { focusContent, contentRef } = useContent();\n  const classes = useStyles({ sidebarConfig });\n  const { t } = useTranslationRef(coreComponentsTranslationRef);\n\n  if (!contentRef?.current) {\n    return null;\n  }\n  return (\n    <Button\n      onClick={focusContent}\n      variant=\"contained\"\n      className={classnames(classes.visuallyHidden)}\n    >\n      {t('skipToContent')}\n    </Button>\n  );\n}\n"],"names":["classnames"],"mappings":"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"}