{"version":3,"file":"dbUtil.cjs.js","sources":["../../../src/scaffolder/tasks/dbUtil.ts"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Knex } from 'knex';\n\nexport const intervalFromNowTill = (timeoutS: number, knex: Knex) => {\n  let heartbeatInterval = knex.raw(`? - interval '${timeoutS} seconds'`, [\n    knex.fn.now(),\n  ]);\n  if (knex.client.config.client.includes('mysql')) {\n    heartbeatInterval = knex.raw(\n      `date_sub(now(), interval ${timeoutS} second)`,\n    );\n  } else if (knex.client.config.client.includes('sqlite3')) {\n    heartbeatInterval = knex.raw(`datetime('now', ?)`, [\n      `-${timeoutS} seconds`,\n    ]);\n  }\n  return heartbeatInterval;\n};\n"],"names":[],"mappings":";;AAiBO,MAAM,mBAAA,GAAsB,CAAC,QAAA,EAAkB,IAAA,KAAe;AACnE,EAAA,IAAI,iBAAA,GAAoB,IAAA,CAAK,GAAA,CAAI,CAAA,cAAA,EAAiB,QAAQ,CAAA,SAAA,CAAA,EAAa;AAAA,IACrE,IAAA,CAAK,GAAG,GAAA;AAAI,GACb,CAAA;AACD,EAAA,IAAI,KAAK,MAAA,CAAO,MAAA,CAAO,MAAA,CAAO,QAAA,CAAS,OAAO,CAAA,EAAG;AAC/C,IAAA,iBAAA,GAAoB,IAAA,CAAK,GAAA;AAAA,MACvB,4BAA4B,QAAQ,CAAA,QAAA;AAAA,KACtC;AAAA,EACF,WAAW,IAAA,CAAK,MAAA,CAAO,OAAO,MAAA,CAAO,QAAA,CAAS,SAAS,CAAA,EAAG;AACxD,IAAA,iBAAA,GAAoB,IAAA,CAAK,IAAI,CAAA,kBAAA,CAAA,EAAsB;AAAA,MACjD,IAAI,QAAQ,CAAA,QAAA;AAAA,KACb,CAAA;AAAA,EACH;AACA,EAAA,OAAO,iBAAA;AACT;;;;"}