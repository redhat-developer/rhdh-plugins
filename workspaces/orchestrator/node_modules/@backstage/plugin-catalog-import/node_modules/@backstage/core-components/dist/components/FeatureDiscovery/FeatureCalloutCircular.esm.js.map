{"version":3,"file":"FeatureCalloutCircular.esm.js","sources":["../../../src/components/FeatureDiscovery/FeatureCalloutCircular.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport Box from '@material-ui/core/Box';\nimport ClickAwayListener from '@material-ui/core/ClickAwayListener';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport {\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { usePortal } from './lib/usePortal';\nimport { useShowCallout } from './lib/useShowCallout';\n\n/** @public */\nexport type FeatureCalloutCircleClassKey =\n  | '@keyframes pulsateSlightly'\n  | '@keyframes pulsateAndFade'\n  | 'featureWrapper'\n  | 'backdrop'\n  | 'dot'\n  | 'pulseCircle'\n  | 'text';\n\nconst useStyles = makeStyles(\n  theme => ({\n    '@keyframes pulsateSlightly': {\n      '0%': { transform: 'scale(1.0)' },\n      '100%': { transform: 'scale(1.1)' },\n    },\n    '@keyframes pulsateAndFade': {\n      '0%': { transform: 'scale(1.0)', opacity: 0.9 },\n      '100%': { transform: 'scale(1.5)', opacity: 0 },\n    },\n    featureWrapper: {\n      position: 'relative',\n    },\n    backdrop: {\n      zIndex: 2000,\n      position: 'fixed',\n      overflow: 'hidden',\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n    },\n    dot: {\n      position: 'absolute',\n      backgroundColor: 'transparent',\n      borderRadius: '100%',\n      border: '1px solid rgba(103, 146, 180, 0.98)',\n      boxShadow: '0px 0px 0px 20000px rgba(0, 0, 0, 0.5)',\n      zIndex: 2001,\n      transformOrigin: 'center center',\n      animation:\n        '$pulsateSlightly 1744ms 1.2s cubic-bezier(0.4, 0, 0.2, 1) alternate infinite',\n    },\n    pulseCircle: {\n      width: '100%',\n      height: '100%',\n      backgroundColor: 'transparent',\n      borderRadius: '100%',\n      border: `2px solid ${theme.palette.common.white}`,\n      zIndex: 2001,\n      transformOrigin: 'center center',\n      animation:\n        '$pulsateAndFade 872ms 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite',\n    },\n    text: {\n      position: 'absolute',\n      color: theme.palette.common.white,\n      zIndex: 2003,\n    },\n  }),\n  { name: 'BackstageFeatureCalloutCircular' },\n);\n\nexport type Props = {\n  featureId: string;\n  title: string;\n  description: string;\n};\n\ntype Placement = {\n  dotLeft: number;\n  dotTop: number;\n  dotSize: number;\n  borderWidth: number;\n  textLeft: number;\n  textTop: number;\n  textWidth: number;\n};\n\n/**\n * One-time, round 'telescope' animation showing new feature.\n *\n * @public\n *\n */\nexport function FeatureCalloutCircular(props: PropsWithChildren<Props>) {\n  const { featureId, title, description, children } = props;\n  const { show, hide } = useShowCallout(featureId);\n  const portalElement = usePortal('core.callout');\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const [placement, setPlacement] = useState<Placement | undefined>();\n  const classes = useStyles();\n\n  const update = useCallback(() => {\n    if (wrapperRef.current) {\n      const wrapperBounds = wrapperRef.current.getBoundingClientRect();\n      const longest = Math.max(wrapperBounds.width, wrapperBounds.height);\n\n      const borderWidth = 800;\n      const dotLeft =\n        wrapperBounds.x - (longest - wrapperBounds.width) / 2 - borderWidth;\n      const dotTop =\n        wrapperBounds.y - (longest - wrapperBounds.height) / 2 - borderWidth;\n      const dotSize = longest + 2 * borderWidth;\n\n      const textWidth = 450;\n      const textLeft = wrapperBounds.x + wrapperBounds.width / 2 - textWidth;\n      const textTop =\n        wrapperBounds.y - (longest - wrapperBounds.height) / 2 + longest + 20;\n\n      setPlacement({\n        dotLeft,\n        dotTop,\n        dotSize,\n        borderWidth,\n        textTop,\n        textLeft,\n        textWidth,\n      });\n    }\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener('resize', update);\n    window.addEventListener('scroll', update);\n    return () => {\n      window.removeEventListener('resize', update);\n      window.removeEventListener('scroll', update);\n    };\n  }, [update]);\n\n  useLayoutEffect(update, [wrapperRef.current, update]);\n\n  if (!show) {\n    return <>{children}</>;\n  }\n\n  return (\n    <>\n      <Box className={classes.featureWrapper} {...{ ref: wrapperRef }}>\n        {children}\n      </Box>\n      {createPortal(\n        <Box className={classes.backdrop}>\n          <ClickAwayListener onClickAway={hide}>\n            <>\n              <Box\n                className={classes.dot}\n                data-testid=\"dot\"\n                style={{\n                  left: placement?.dotLeft,\n                  top: placement?.dotTop,\n                  width: placement?.dotSize,\n                  height: placement?.dotSize,\n                  borderWidth: placement?.borderWidth,\n                }}\n                onClick={hide}\n                onKeyDown={hide}\n                role=\"button\"\n                tabIndex={0}\n              >\n                <Box className={classes.pulseCircle} />\n              </Box>\n              <Box\n                className={classes.text}\n                data-testid=\"text\"\n                style={{\n                  left: placement?.textLeft,\n                  top: placement?.textTop,\n                  width: placement?.textWidth,\n                }}\n              >\n                <Typography variant=\"h2\" paragraph>\n                  {title}\n                </Typography>\n                <Typography>{description}</Typography>\n              </Box>\n            </>\n          </ClickAwayListener>\n        </Box>,\n        portalElement,\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}