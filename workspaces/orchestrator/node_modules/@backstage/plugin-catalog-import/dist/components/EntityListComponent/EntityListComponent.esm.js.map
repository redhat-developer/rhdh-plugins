{"version":3,"file":"EntityListComponent.esm.js","sources":["../../../src/components/EntityListComponent/EntityListComponent.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport {\n  EntityDisplayName,\n  EntityRefLink,\n  entityPresentationApiRef,\n} from '@backstage/plugin-catalog-react';\nimport Collapse from '@material-ui/core/Collapse';\nimport IconButton from '@material-ui/core/IconButton';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport { makeStyles } from '@material-ui/core/styles';\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { ReactElement, Fragment, useState } from 'react';\n\nconst useStyles = makeStyles(theme => ({\n  nested: {\n    paddingLeft: theme.spacing(4),\n  },\n}));\n\n/**\n * Props for {@link EntityListComponent}.\n *\n * @public\n */\nexport interface EntityListComponentProps {\n  locations: Array<{\n    target: string;\n    entities: (Entity | CompoundEntityRef)[];\n  }>;\n  locationListItemIcon: (target: string) => ReactElement;\n  collapsed?: boolean;\n  firstListItem?: ReactElement;\n  onItemClick?: (target: string) => void;\n  withLinks?: boolean;\n}\n\n/**\n * Shows a result list of entities.\n *\n * @public\n */\nexport const EntityListComponent = (props: EntityListComponentProps) => {\n  const {\n    locations,\n    collapsed = false,\n    locationListItemIcon,\n    onItemClick,\n    firstListItem,\n    withLinks = false,\n  } = props;\n\n  const classes = useStyles();\n  const entityPresentationApi = useApi(entityPresentationApiRef);\n  const [expandedUrls, setExpandedUrls] = useState<string[]>([]);\n\n  const handleClick = (url: string) => {\n    setExpandedUrls(urls =>\n      urls.includes(url) ? urls.filter(u => u !== url) : urls.concat(url),\n    );\n  };\n\n  function sortEntities(entities: Array<CompoundEntityRef | Entity>) {\n    return entities.sort((a, b) =>\n      entityPresentationApi\n        .forEntity(stringifyEntityRef(a))\n        .snapshot.entityRef.localeCompare(\n          entityPresentationApi.forEntity(stringifyEntityRef(b)).snapshot\n            .entityRef,\n        ),\n    );\n  }\n\n  return (\n    <List>\n      {firstListItem}\n      {locations.map(r => (\n        <Fragment key={r.target}>\n          <ListItem\n            dense\n            button={Boolean(onItemClick) as any}\n            onClick={() => onItemClick?.(r.target)}\n          >\n            <ListItemIcon>{locationListItemIcon(r.target)}</ListItemIcon>\n\n            <ListItemText\n              primary={r.target}\n              secondary={`Entities: ${r.entities.length}`}\n            />\n\n            {collapsed && (\n              <ListItemSecondaryAction>\n                <IconButton edge=\"end\" onClick={() => handleClick(r.target)}>\n                  {expandedUrls.includes(r.target) ? (\n                    <ExpandLessIcon />\n                  ) : (\n                    <ExpandMoreIcon />\n                  )}\n                </IconButton>\n              </ListItemSecondaryAction>\n            )}\n          </ListItem>\n\n          <Collapse\n            in={!collapsed || expandedUrls.includes(r.target)}\n            timeout=\"auto\"\n            unmountOnExit\n          >\n            <List component=\"div\" disablePadding dense>\n              {sortEntities(r.entities).map(entity => {\n                return (\n                  <ListItem\n                    key={stringifyEntityRef(entity)}\n                    className={classes.nested}\n                    {...(withLinks\n                      ? {\n                          component: EntityRefLink,\n                          entityRef: entity,\n                          button: withLinks as any,\n                        }\n                      : {})}\n                  >\n                    <ListItemText\n                      primary={<EntityDisplayName entityRef={entity} />}\n                    />\n                  </ListItem>\n                );\n              })}\n            </List>\n          </Collapse>\n        </Fragment>\n      ))}\n    </List>\n  );\n};\n"],"names":[],"mappings":"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"}