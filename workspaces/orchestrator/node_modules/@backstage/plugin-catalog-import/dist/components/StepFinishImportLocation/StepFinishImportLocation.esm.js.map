{"version":3,"file":"StepFinishImportLocation.esm.js","sources":["../../../src/components/StepFinishImportLocation/StepFinishImportLocation.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CompoundEntityRef, DEFAULT_NAMESPACE } from '@backstage/catalog-model';\nimport { Link } from '@backstage/core-components';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { entityRouteRef } from '@backstage/plugin-catalog-react';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport LocationOnIcon from '@material-ui/icons/LocationOn';\nimport partition from 'lodash/partition';\n\nimport { catalogImportTranslationRef } from '../../translation';\nimport { BackButton, ViewComponentButton } from '../Buttons';\nimport { EntityListComponent } from '../EntityListComponent';\nimport { PrepareResult } from '../useImportState';\n\ntype Props = {\n  prepareResult: PrepareResult;\n  onReset: () => void;\n};\n\n// Among the newly registered entities, return a software entity (e.g. Component, API, Resource)\nconst filterComponentEntity = (\n  newLocations: Array<{\n    exists?: boolean;\n    target: string;\n    entities: CompoundEntityRef[];\n  }>,\n): CompoundEntityRef | null => {\n  for (const location of newLocations) {\n    for (const entity of location.entities) {\n      if (\n        ['component', 'api', 'resource'].includes(\n          entity.kind.toLocaleLowerCase('en-US'),\n        )\n      ) {\n        return {\n          kind: entity.kind.toLocaleLowerCase('en-US'),\n          namespace:\n            entity.namespace?.toLocaleLowerCase('en-US') ?? DEFAULT_NAMESPACE,\n          name: entity.name,\n        };\n      }\n    }\n  }\n\n  return null;\n};\n\nexport const StepFinishImportLocation = ({ prepareResult, onReset }: Props) => {\n  const { t } = useTranslationRef(catalogImportTranslationRef);\n  const entityRoute = useRouteRef(entityRouteRef);\n\n  if (prepareResult.type === 'repository') {\n    return (\n      <>\n        <Typography paragraph>\n          {t('stepFinishImportLocation.repository.title')}\n          <Link\n            to={prepareResult.pullRequest.url}\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            {prepareResult.pullRequest.url}\n          </Link>\n        </Typography>\n        <Typography paragraph>\n          {t('stepFinishImportLocation.repository.description')}\n        </Typography>\n        <Grid container spacing={0}>\n          <BackButton onClick={onReset}>\n            {t('stepFinishImportLocation.backButtonText')}\n          </BackButton>\n        </Grid>\n      </>\n    );\n  }\n\n  const [existingLocations, newLocations] = partition(\n    prepareResult.locations,\n    l => l.exists,\n  );\n  const newComponentEntity = filterComponentEntity(newLocations);\n  return (\n    <>\n      {newLocations.length > 0 && (\n        <>\n          <Typography>{t('stepFinishImportLocation.locations.new')}</Typography>\n\n          <EntityListComponent\n            locations={newLocations}\n            locationListItemIcon={() => <LocationOnIcon />}\n            withLinks\n          />\n        </>\n      )}\n      {existingLocations.length > 0 && (\n        <>\n          <Typography>\n            {t('stepFinishImportLocation.locations.existing')}\n          </Typography>\n\n          <EntityListComponent\n            locations={existingLocations}\n            locationListItemIcon={() => <LocationOnIcon />}\n            withLinks\n          />\n        </>\n      )}\n      <Grid container spacing={0}>\n        {newComponentEntity && (\n          <ViewComponentButton to={entityRoute(newComponentEntity)}>\n            {t('stepFinishImportLocation.locations.viewButtonText')}\n          </ViewComponentButton>\n        )}\n        <BackButton onClick={onReset}>\n          {t('stepFinishImportLocation.backButtonText')}\n        </BackButton>\n      </Grid>\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}