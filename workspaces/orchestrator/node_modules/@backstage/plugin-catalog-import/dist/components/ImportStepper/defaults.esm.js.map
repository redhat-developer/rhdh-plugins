{"version":3,"file":"defaults.esm.js","sources":["../../../src/components/ImportStepper/defaults.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TranslationFunction } from '@backstage/core-plugin-api/alpha';\nimport { catalogImportTranslationRef } from '@backstage/plugin-catalog-import/alpha';\nimport Box from '@material-ui/core/Box';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\nimport { ReactElement } from 'react';\nimport { BackButton } from '../Buttons';\nimport { asInputRef } from '../helpers';\nimport { StepFinishImportLocation } from '../StepFinishImportLocation';\nimport { StepInitAnalyzeUrl } from '../StepInitAnalyzeUrl';\nimport {\n  AutocompleteTextField,\n  StepPrepareCreatePullRequest,\n} from '../StepPrepareCreatePullRequest';\nimport { StepPrepareSelectLocations } from '../StepPrepareSelectLocations';\nimport { StepReviewLocation } from '../StepReviewLocation';\nimport { StepperApis } from '../types';\nimport { ImportFlows, ImportState } from '../useImportState';\n\nexport type StepConfiguration = {\n  stepLabel: ReactElement;\n  content: ReactElement;\n};\n\n/**\n * Defines the details of the stepper.\n *\n * @public\n */\nexport interface StepperProvider {\n  analyze: (\n    s: Extract<ImportState, { activeState: 'analyze' }>,\n    opts: {\n      apis: StepperApis;\n      t: TranslationFunction<typeof catalogImportTranslationRef.T>;\n    },\n  ) => StepConfiguration;\n  prepare: (\n    s: Extract<ImportState, { activeState: 'prepare' }>,\n    opts: {\n      apis: StepperApis;\n      t: TranslationFunction<typeof catalogImportTranslationRef.T>;\n    },\n  ) => StepConfiguration;\n  review: (\n    s: Extract<ImportState, { activeState: 'review' }>,\n    opts: {\n      apis: StepperApis;\n      t: TranslationFunction<typeof catalogImportTranslationRef.T>;\n    },\n  ) => StepConfiguration;\n  finish: (\n    s: Extract<ImportState, { activeState: 'finish' }>,\n    opts: {\n      apis: StepperApis;\n      t: TranslationFunction<typeof catalogImportTranslationRef.T>;\n    },\n  ) => StepConfiguration;\n}\n\n/**\n * The default stepper generation function.\n *\n * Override this function to customize the import flow. Each flow should at\n * least override the prepare operation.\n *\n * @param flow - the name of the active flow\n * @param defaults - the default steps\n * @param t - the translation function\n * @public\n */\nexport function defaultGenerateStepper(\n  flow: ImportFlows,\n  defaults: StepperProvider,\n  t: TranslationFunction<typeof catalogImportTranslationRef.T>,\n): StepperProvider {\n  switch (flow) {\n    // the prepare step is skipped but the label of the step is updated\n    case 'single-location':\n      return {\n        ...defaults,\n        prepare: () => ({\n          stepLabel: (\n            <StepLabel\n              optional={\n                <Typography variant=\"caption\">\n                  {t('importStepper.singleLocation.description')}\n                </Typography>\n              }\n            >\n              {t('importStepper.singleLocation.title')}\n            </StepLabel>\n          ),\n          content: <></>,\n        }),\n      };\n\n    // let the user select one or more of the discovered locations in the prepare step\n    case 'multiple-locations':\n      return {\n        ...defaults,\n        prepare: (state, opts) => {\n          if (state.analyzeResult.type !== 'locations') {\n            return defaults.prepare(state, opts);\n          }\n\n          return {\n            stepLabel: (\n              <StepLabel\n                optional={\n                  <Typography variant=\"caption\">\n                    {t('importStepper.multipleLocations.description', {\n                      length: state.analyzeResult.locations.length,\n                    })}\n                  </Typography>\n                }\n              >\n                {t('importStepper.multipleLocations.title')}\n              </StepLabel>\n            ),\n            content: (\n              <StepPrepareSelectLocations\n                analyzeResult={state.analyzeResult}\n                prepareResult={state.prepareResult}\n                onPrepare={state.onPrepare}\n                onGoBack={state.onGoBack}\n              />\n            ),\n          };\n        },\n      };\n\n    case 'no-location':\n      return {\n        ...defaults,\n        prepare: (state, opts) => {\n          if (state.analyzeResult.type !== 'repository') {\n            return defaults.prepare(state, opts);\n          }\n\n          return {\n            stepLabel: (\n              <StepLabel>{t('importStepper.noLocation.title')}</StepLabel>\n            ),\n            content: (\n              <StepPrepareCreatePullRequest\n                analyzeResult={state.analyzeResult}\n                onPrepare={state.onPrepare}\n                onGoBack={state.onGoBack}\n                renderFormFields={({\n                  values,\n                  setValue,\n                  formState,\n                  groupsLoading,\n                  groups,\n                  register,\n                }) => (\n                  <>\n                    <Box marginTop={2}>\n                      <Typography variant=\"h6\">\n                        {t('importStepper.noLocation.createPr.detailsTitle')}\n                      </Typography>\n                    </Box>\n\n                    <TextField\n                      {...asInputRef(\n                        register('title', {\n                          required: true,\n                        }),\n                      )}\n                      label={t('importStepper.noLocation.createPr.titleLabel')}\n                      placeholder={t(\n                        'importStepper.noLocation.createPr.titlePlaceholder',\n                      )}\n                      margin=\"normal\"\n                      variant=\"outlined\"\n                      fullWidth\n                      error={Boolean(formState.errors.title)}\n                      required\n                    />\n\n                    <TextField\n                      {...asInputRef(\n                        register('body', {\n                          required: true,\n                        }),\n                      )}\n                      label={t('importStepper.noLocation.createPr.bodyLabel')}\n                      placeholder={t(\n                        'importStepper.noLocation.createPr.bodyPlaceholder',\n                      )}\n                      margin=\"normal\"\n                      variant=\"outlined\"\n                      fullWidth\n                      error={Boolean(formState.errors.body)}\n                      multiline\n                      required\n                    />\n\n                    <Box marginTop={2}>\n                      <Typography variant=\"h6\">\n                        {t(\n                          'importStepper.noLocation.createPr.configurationTitle',\n                        )}\n                      </Typography>\n                    </Box>\n\n                    <TextField\n                      {...asInputRef(\n                        register('componentName', { required: true }),\n                      )}\n                      label={t(\n                        'importStepper.noLocation.createPr.componentNameLabel',\n                      )}\n                      placeholder={t(\n                        'importStepper.noLocation.createPr.componentNamePlaceholder',\n                      )}\n                      margin=\"normal\"\n                      variant=\"outlined\"\n                      fullWidth\n                      error={Boolean(formState.errors.componentName)}\n                      required\n                    />\n\n                    {!values.useCodeowners && (\n                      <AutocompleteTextField\n                        name=\"owner\"\n                        errors={formState.errors}\n                        options={groups || []}\n                        loading={groupsLoading}\n                        loadingText={t(\n                          'importStepper.noLocation.createPr.ownerLoadingText',\n                        )}\n                        helperText={t(\n                          'importStepper.noLocation.createPr.ownerHelperText',\n                        )}\n                        errorHelperText={t(\n                          'importStepper.noLocation.createPr.ownerErrorHelperText',\n                        )}\n                        textFieldProps={{\n                          label: t(\n                            'importStepper.noLocation.createPr.ownerLabel',\n                          ),\n                          placeholder: t(\n                            'importStepper.noLocation.createPr.ownerPlaceholder',\n                          ),\n                        }}\n                        rules={{ required: true }}\n                        required\n                      />\n                    )}\n\n                    <FormControlLabel\n                      control={\n                        <Checkbox\n                          {...asInputRef(register('useCodeowners'))}\n                          onChange={(_, value) => {\n                            if (value) {\n                              setValue('owner', '');\n                            }\n                          }}\n                        />\n                      }\n                      label={\n                        <>\n                          Use <em>CODEOWNERS</em> file as Entity Owner\n                        </>\n                      }\n                    />\n                    <FormHelperText>\n                      {t(\n                        'importStepper.noLocation.createPr.codeownersHelperText',\n                      )}\n                    </FormHelperText>\n                  </>\n                )}\n              />\n            ),\n          };\n        },\n      };\n\n    default:\n      return defaults;\n  }\n}\n\nexport const defaultStepper: StepperProvider = {\n  analyze: (state, { apis, t }) => ({\n    stepLabel: <StepLabel>{t('importStepper.analyze.title')}</StepLabel>,\n    content: (\n      <StepInitAnalyzeUrl\n        key=\"analyze\"\n        analysisUrl={state.analysisUrl}\n        onAnalysis={state.onAnalysis}\n        disablePullRequest={!apis.catalogImportApi.preparePullRequest}\n      />\n    ),\n  }),\n\n  prepare: (state, { t }) => ({\n    stepLabel: (\n      <StepLabel\n        optional={\n          <Typography variant=\"caption\">\n            {t('importStepper.prepare.description')}\n          </Typography>\n        }\n      >\n        {t('importStepper.prepare.title')}\n      </StepLabel>\n    ),\n    content: <BackButton onClick={state.onGoBack} />,\n  }),\n\n  review: (state, { t }) => ({\n    stepLabel: <StepLabel>{t('importStepper.review.title')}</StepLabel>,\n    content: (\n      <StepReviewLocation\n        prepareResult={state.prepareResult}\n        onReview={state.onReview}\n        onGoBack={state.onGoBack}\n      />\n    ),\n  }),\n\n  finish: (state, { t }) => ({\n    stepLabel: <StepLabel>{t('importStepper.finish.title')}</StepLabel>,\n    content: (\n      <StepFinishImportLocation\n        prepareResult={state.prepareResult}\n        onReset={state.onReset}\n      />\n    ),\n  }),\n};\n"],"names":[],"mappings":"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"}