{"version":3,"file":"alpha.esm.js","sources":["../src/alpha.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Grid from '@material-ui/core/Grid';\n\nimport {\n  ApiBlueprint,\n  NavItemBlueprint,\n  PageBlueprint,\n  createFrontendPlugin,\n} from '@backstage/frontend-plugin-api';\n\nimport {\n  compatWrapper,\n  convertLegacyRouteRef,\n} from '@backstage/core-compat-api';\n\nimport {\n  ApiEntity,\n  parseEntityRef,\n  RELATION_HAS_PART,\n} from '@backstage/catalog-model';\n\nimport { defaultDefinitionWidgets } from './components/ApiDefinitionCard';\nimport { rootRoute, registerComponentRouteRef } from './routes';\nimport { apiDocsConfigRef } from './config';\nimport { AppIcon } from '@backstage/core-components';\n\nimport {\n  EntityCardBlueprint,\n  EntityContentBlueprint,\n} from '@backstage/plugin-catalog-react/alpha';\n\nconst apiDocsNavItem = NavItemBlueprint.make({\n  params: {\n    title: 'APIs',\n    routeRef: convertLegacyRouteRef(rootRoute),\n    icon: () => compatWrapper(<AppIcon id=\"kind:api\" />),\n  },\n});\n\nconst apiDocsConfigApi = ApiBlueprint.make({\n  name: 'config',\n  params: defineParams =>\n    defineParams({\n      api: apiDocsConfigRef,\n      deps: {},\n      factory: () => {\n        const definitionWidgets = defaultDefinitionWidgets();\n        return {\n          getApiDefinitionWidget: (apiEntity: ApiEntity) => {\n            return definitionWidgets.find(d => d.type === apiEntity.spec.type);\n          },\n        };\n      },\n    }),\n});\n\nconst apiDocsExplorerPage = PageBlueprint.makeWithOverrides({\n  config: {\n    schema: {\n      // Omitting columns and actions for now as their types are too complex to map to zod\n      initiallySelectedFilter: z =>\n        z.enum(['owned', 'starred', 'all']).optional(),\n    },\n  },\n  factory(originalFactory, { config }) {\n    return originalFactory({\n      path: '/api-docs',\n      routeRef: convertLegacyRouteRef(rootRoute),\n      loader: () =>\n        import('./components/ApiExplorerPage').then(m =>\n          compatWrapper(\n            <m.ApiExplorerIndexPage\n              initiallySelectedFilter={config.initiallySelectedFilter}\n            />,\n          ),\n        ),\n    });\n  },\n});\n\nconst apiDocsHasApisEntityCard = EntityCardBlueprint.make({\n  name: 'has-apis',\n  params: {\n    // Omitting configSchema for now\n    // We are skipping variants and columns are too complex to map to zod\n    // See: https://github.com/backstage/backstage/pull/22619#discussion_r1477333252\n    filter: entity => {\n      return (\n        entity.kind === 'Component' &&\n        entity.relations?.some(\n          ({ type, targetRef }) =>\n            type.toLocaleLowerCase('en-US') === RELATION_HAS_PART &&\n            parseEntityRef(targetRef).kind === 'API',\n        )!!\n      );\n    },\n    loader: () =>\n      import('./components/ApisCards').then(m =>\n        compatWrapper(<m.HasApisCard />),\n      ),\n  },\n});\n\nconst apiDocsDefinitionEntityCard = EntityCardBlueprint.make({\n  name: 'definition',\n  params: {\n    filter: 'kind:api',\n    loader: () =>\n      import('./components/ApiDefinitionCard').then(m =>\n        compatWrapper(<m.ApiDefinitionCard />),\n      ),\n  },\n});\n\nconst apiDocsConsumedApisEntityCard = EntityCardBlueprint.make({\n  name: 'consumed-apis',\n  params: {\n    // Omitting configSchema for now\n    // We are skipping variants and columns are too complex to map to zod\n    // See: https://github.com/backstage/backstage/pull/22619#discussion_r1477333252\n    filter: 'kind:component',\n    loader: () =>\n      import('./components/ApisCards').then(m =>\n        compatWrapper(<m.ConsumedApisCard />),\n      ),\n  },\n});\n\nconst apiDocsProvidedApisEntityCard = EntityCardBlueprint.make({\n  name: 'provided-apis',\n  params: {\n    // Omitting configSchema for now\n    // We are skipping variants and columns are too complex to map to zod\n    // See: https://github.com/backstage/backstage/pull/22619#discussion_r1477333252\n    filter: 'kind:component',\n    loader: () =>\n      import('./components/ApisCards').then(m =>\n        compatWrapper(<m.ProvidedApisCard />),\n      ),\n  },\n});\n\nconst apiDocsConsumingComponentsEntityCard = EntityCardBlueprint.make({\n  name: 'consuming-components',\n  params: {\n    // Omitting configSchema for now\n    // We are skipping variants\n    // See: https://github.com/backstage/backstage/pull/22619#discussion_r1477333252\n    filter: 'kind:api',\n    loader: () =>\n      import('./components/ComponentsCards').then(m =>\n        compatWrapper(<m.ConsumingComponentsCard />),\n      ),\n  },\n});\n\nconst apiDocsProvidingComponentsEntityCard = EntityCardBlueprint.make({\n  name: 'providing-components',\n  params: {\n    // Omitting configSchema for now\n    // We are skipping variants\n    // See: https://github.com/backstage/backstage/pull/22619#discussion_r1477333252\n    filter: 'kind:api',\n    loader: () =>\n      import('./components/ComponentsCards').then(m =>\n        compatWrapper(<m.ProvidingComponentsCard />),\n      ),\n  },\n});\n\nconst apiDocsDefinitionEntityContent = EntityContentBlueprint.make({\n  name: 'definition',\n  params: {\n    path: '/definition',\n    title: 'Definition',\n    filter: 'kind:api',\n    loader: async () =>\n      import('./components/ApiDefinitionCard').then(m =>\n        compatWrapper(\n          <Grid container spacing={3}>\n            <Grid item xs={12}>\n              <m.ApiDefinitionCard />\n            </Grid>\n          </Grid>,\n        ),\n      ),\n  },\n});\n\nconst apiDocsApisEntityContent = EntityContentBlueprint.make({\n  name: 'apis',\n  params: {\n    path: '/apis',\n    title: 'APIs',\n    filter: 'kind:component',\n    loader: async () =>\n      import('./components/ApisCards').then(m =>\n        compatWrapper(\n          <Grid container spacing={3} alignItems=\"stretch\">\n            <Grid item xs={12}>\n              <m.ProvidedApisCard />\n            </Grid>\n            <Grid item xs={12}>\n              <m.ConsumedApisCard />\n            </Grid>\n          </Grid>,\n        ),\n      ),\n  },\n});\n\nexport default createFrontendPlugin({\n  pluginId: 'api-docs',\n  info: { packageJson: () => import('../package.json') },\n  routes: {\n    root: convertLegacyRouteRef(rootRoute),\n  },\n  externalRoutes: {\n    registerApi: convertLegacyRouteRef(registerComponentRouteRef),\n  },\n  extensions: [\n    apiDocsNavItem,\n    apiDocsConfigApi,\n    apiDocsExplorerPage,\n    apiDocsHasApisEntityCard,\n    apiDocsDefinitionEntityCard,\n    apiDocsProvidedApisEntityCard,\n    apiDocsConsumedApisEntityCard,\n    apiDocsConsumingComponentsEntityCard,\n    apiDocsProvidingComponentsEntityCard,\n    apiDocsDefinitionEntityContent,\n    apiDocsApisEntityContent,\n  ],\n});\n\nexport { apiDocsTranslationRef } from './translation';\n"],"names":[],"mappings":"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"}