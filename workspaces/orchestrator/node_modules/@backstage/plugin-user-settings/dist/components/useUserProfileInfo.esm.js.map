{"version":3,"file":"useUserProfileInfo.esm.js","sources":["../../src/components/useUserProfileInfo.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  alertApiRef,\n  identityApiRef,\n  ProfileInfo,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport { useEffect } from 'react';\nimport useAsync from 'react-use/esm/useAsync';\nimport { catalogApiRef } from '@backstage/plugin-catalog-react';\nimport { UserEntity } from '@backstage/catalog-model';\n\n/** @public */\nexport const useUserProfile = () => {\n  const identityApi = useApi(identityApiRef);\n  const alertApi = useApi(alertApiRef);\n  const catalogApi = useApi(catalogApiRef);\n\n  const { value, loading, error } = useAsync(async () => {\n    let identityProfile = await identityApi.getProfileInfo();\n    const backStageIdentity = await identityApi.getBackstageIdentity();\n    const catalogProfile = (await catalogApi.getEntityByRef(\n      backStageIdentity.userEntityRef,\n    )) as unknown as UserEntity;\n    if (\n      identityProfile.picture === undefined &&\n      catalogProfile?.spec?.profile?.picture\n    ) {\n      identityProfile = {\n        ...identityProfile,\n        picture: catalogProfile.spec.profile.picture,\n      };\n    }\n    return {\n      profile: identityProfile,\n      identity: backStageIdentity,\n    };\n  }, []);\n\n  useEffect(() => {\n    if (error) {\n      alertApi.post({\n        message: `Failed to load user identity: ${error}`,\n        severity: 'error',\n      });\n    }\n  }, [error, alertApi]);\n\n  if (loading || error) {\n    return {\n      profile: {} as ProfileInfo,\n      displayName: '',\n      loading,\n    };\n  }\n\n  return {\n    profile: value!.profile,\n    backstageIdentity: value!.identity,\n    displayName: value!.profile.displayName ?? value!.identity.userEntityRef,\n    loading,\n  };\n};\n"],"names":[],"mappings":";;;;;AA4BO,MAAM,iBAAiB,MAAM;AAClC,EAAA,MAAM,WAAA,GAAc,OAAO,cAAc,CAAA;AACzC,EAAA,MAAM,QAAA,GAAW,OAAO,WAAW,CAAA;AACnC,EAAA,MAAM,UAAA,GAAa,OAAO,aAAa,CAAA;AAEvC,EAAA,MAAM,EAAE,KAAA,EAAO,OAAA,EAAS,KAAA,EAAM,GAAI,SAAS,YAAY;AACrD,IAAA,IAAI,eAAA,GAAkB,MAAM,WAAA,CAAY,cAAA,EAAe;AACvD,IAAA,MAAM,iBAAA,GAAoB,MAAM,WAAA,CAAY,oBAAA,EAAqB;AACjE,IAAA,MAAM,cAAA,GAAkB,MAAM,UAAA,CAAW,cAAA;AAAA,MACvC,iBAAA,CAAkB;AAAA,KACpB;AACA,IAAA,IACE,gBAAgB,OAAA,KAAY,MAAA,IAC5B,cAAA,EAAgB,IAAA,EAAM,SAAS,OAAA,EAC/B;AACA,MAAA,eAAA,GAAkB;AAAA,QAChB,GAAG,eAAA;AAAA,QACH,OAAA,EAAS,cAAA,CAAe,IAAA,CAAK,OAAA,CAAQ;AAAA,OACvC;AAAA,IACF;AACA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,eAAA;AAAA,MACT,QAAA,EAAU;AAAA,KACZ;AAAA,EACF,CAAA,EAAG,EAAE,CAAA;AAEL,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,IAAI,KAAA,EAAO;AACT,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACZ,OAAA,EAAS,iCAAiC,KAAK,CAAA,CAAA;AAAA,QAC/C,QAAA,EAAU;AAAA,OACX,CAAA;AAAA,IACH;AAAA,EACF,CAAA,EAAG,CAAC,KAAA,EAAO,QAAQ,CAAC,CAAA;AAEpB,EAAA,IAAI,WAAW,KAAA,EAAO;AACpB,IAAA,OAAO;AAAA,MACL,SAAS,EAAC;AAAA,MACV,WAAA,EAAa,EAAA;AAAA,MACb;AAAA,KACF;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,SAAS,KAAA,CAAO,OAAA;AAAA,IAChB,mBAAmB,KAAA,CAAO,QAAA;AAAA,IAC1B,WAAA,EAAa,KAAA,CAAO,OAAA,CAAQ,WAAA,IAAe,MAAO,QAAA,CAAS,aAAA;AAAA,IAC3D;AAAA,GACF;AACF;;;;"}