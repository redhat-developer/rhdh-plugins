{"version":3,"file":"ProviderSettingsItem.esm.js","sources":["../../../src/components/AuthProviders/ProviderSettingsItem.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\nimport {\n  ApiRef,\n  SessionApi,\n  SessionState,\n  ProfileInfoApi,\n  ProfileInfo,\n  useApi,\n  errorApiRef,\n  IconComponent,\n} from '@backstage/core-plugin-api';\nimport { ProviderSettingsAvatar } from './ProviderSettingsAvatar';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { userSettingsTranslationRef } from '../../translation';\n\nconst emptyProfile: ProfileInfo = {};\n\n/** @public */\nexport const ProviderSettingsItem = (props: {\n  title: string;\n  description: string;\n  icon: IconComponent;\n  apiRef: ApiRef<ProfileInfoApi & SessionApi>;\n}) => {\n  const { title, description, icon: Icon, apiRef } = props;\n\n  const api = useApi(apiRef);\n  const errorApi = useApi(errorApiRef);\n  const [signedIn, setSignedIn] = useState(false);\n  const [profile, setProfile] = useState<ProfileInfo>(emptyProfile);\n  const { t } = useTranslationRef(userSettingsTranslationRef);\n\n  useEffect(() => {\n    let didCancel = false;\n\n    const subscription = api\n      .sessionState$()\n      .subscribe((sessionState: SessionState) => {\n        if (sessionState !== SessionState.SignedIn) {\n          setProfile(emptyProfile);\n          setSignedIn(false);\n        }\n        if (!didCancel) {\n          api\n            .getProfile({ optional: true })\n            .then((profileResponse: ProfileInfo | undefined) => {\n              if (!didCancel) {\n                if (sessionState === SessionState.SignedIn) {\n                  setSignedIn(true);\n                }\n                if (profileResponse) {\n                  setProfile(profileResponse);\n                }\n              }\n            });\n        }\n      });\n\n    return () => {\n      didCancel = true;\n      subscription.unsubscribe();\n    };\n  }, [api]);\n\n  return (\n    <ListItem>\n      <ListItemIcon>\n        <Icon />\n      </ListItemIcon>\n      <ListItemText\n        primary={title}\n        secondary={\n          <Tooltip placement=\"top\" arrow title={description}>\n            <Grid container spacing={6}>\n              <Grid item>\n                <ProviderSettingsAvatar size={48} picture={profile.picture} />\n              </Grid>\n              <Grid item xs={12} sm container>\n                <Grid item xs container direction=\"column\" spacing={2}>\n                  <Grid item xs>\n                    {profile.displayName && (\n                      <Typography\n                        variant=\"subtitle1\"\n                        color=\"textPrimary\"\n                        gutterBottom\n                      >\n                        {profile.displayName}\n                      </Typography>\n                    )}\n                    {profile.email && (\n                      <Typography variant=\"body2\" color=\"textSecondary\">\n                        {profile.email}\n                      </Typography>\n                    )}\n                    <Typography variant=\"body2\" color=\"textSecondary\">\n                      {description}\n                    </Typography>\n                  </Grid>\n                </Grid>\n              </Grid>\n            </Grid>\n          </Tooltip>\n        }\n        secondaryTypographyProps={{ noWrap: true, style: { width: '80%' } }}\n      />\n      <ListItemSecondaryAction>\n        <Tooltip\n          placement=\"top\"\n          arrow\n          title={\n            signedIn\n              ? t('providerSettingsItem.title.signOut', { title })\n              : t('providerSettingsItem.title.signIn', { title })\n          }\n        >\n          <Button\n            variant=\"outlined\"\n            color=\"primary\"\n            onClick={() => {\n              const action = signedIn ? api.signOut() : api.signIn();\n              action.catch(error => errorApi.post(error));\n            }}\n          >\n            {signedIn\n              ? t('providerSettingsItem.buttonTitle.signOut')\n              : t('providerSettingsItem.buttonTitle.signIn')}\n          </Button>\n        </Tooltip>\n      </ListItemSecondaryAction>\n    </ListItem>\n  );\n};\n"],"names":[],"mappings":"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"}