{"version":3,"file":"MockEntityListContextProvider.esm.js","sources":["../../src/testUtils/MockEntityListContextProvider.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PropsWithChildren, useCallback, useMemo, useState } from 'react';\nimport {\n  DefaultEntityFilters,\n  EntityListContext,\n  EntityListContextProps,\n} from '@backstage/plugin-catalog-react';\n\n/**\n * Simplifies testing of code that uses the entity list hooks.\n *\n * @public\n */\nexport function MockEntityListContextProvider<\n  T extends DefaultEntityFilters = DefaultEntityFilters,\n>(\n  props: PropsWithChildren<{\n    value?: Partial<EntityListContextProps<T>>;\n  }>,\n) {\n  const { children, value } = props;\n\n  // Provides a default implementation that stores filter state, for testing components that\n  // reflect filter state.\n  const [filters, setFilters] = useState<T>(value?.filters ?? ({} as T));\n\n  const updateFilters = useCallback(\n    (update: Partial<T> | ((prevFilters: T) => Partial<T>)) => {\n      setFilters(prevFilters => {\n        const newFilters =\n          typeof update === 'function' ? update(prevFilters) : update;\n        return { ...prevFilters, ...newFilters };\n      });\n    },\n    [],\n  );\n\n  // Memoize the default values since pickers have useEffect triggers on these; naively defaulting\n  // below with `?? <X>` breaks referential equality on subsequent updates.\n  const defaultValues = useMemo(\n    () => ({\n      entities: [],\n      backendEntities: [],\n      queryParameters: {},\n    }),\n    [],\n  );\n\n  const resolvedValue: EntityListContextProps<T> = useMemo(\n    () => ({\n      entities: value?.entities ?? defaultValues.entities,\n      backendEntities: value?.backendEntities ?? defaultValues.backendEntities,\n      updateFilters: value?.updateFilters ?? updateFilters,\n      filters,\n      loading: value?.loading ?? false,\n      queryParameters: value?.queryParameters ?? defaultValues.queryParameters,\n      error: value?.error,\n      totalItems:\n        value?.totalItems ?? (value?.entities ?? defaultValues.entities).length,\n      limit: value?.limit ?? 20,\n      offset: value?.offset,\n      setLimit: value?.setLimit ?? (() => {}),\n      setOffset: value?.setOffset,\n      paginationMode: value?.paginationMode ?? 'none',\n    }),\n    [value, defaultValues, filters, updateFilters],\n  );\n\n  return (\n    <EntityListContext.Provider value={resolvedValue}>\n      {children}\n    </EntityListContext.Provider>\n  );\n}\n"],"names":[],"mappings":";;;;AA4BO,SAAS,8BAGd,KAAA,EAGA;AACA,EAAA,MAAM,EAAE,QAAA,EAAU,KAAA,EAAM,GAAI,KAAA;AAI5B,EAAA,MAAM,CAAC,SAAS,UAAU,CAAA,GAAI,SAAY,KAAA,EAAO,OAAA,IAAY,EAAQ,CAAA;AAErE,EAAA,MAAM,aAAA,GAAgB,WAAA;AAAA,IACpB,CAAC,MAAA,KAA0D;AACzD,MAAA,UAAA,CAAW,CAAA,WAAA,KAAe;AACxB,QAAA,MAAM,aACJ,OAAO,MAAA,KAAW,UAAA,GAAa,MAAA,CAAO,WAAW,CAAA,GAAI,MAAA;AACvD,QAAA,OAAO,EAAE,GAAG,WAAA,EAAa,GAAG,UAAA,EAAW;AAAA,MACzC,CAAC,CAAA;AAAA,IACH,CAAA;AAAA,IACA;AAAC,GACH;AAIA,EAAA,MAAM,aAAA,GAAgB,OAAA;AAAA,IACpB,OAAO;AAAA,MACL,UAAU,EAAC;AAAA,MACX,iBAAiB,EAAC;AAAA,MAClB,iBAAiB;AAAC,KACpB,CAAA;AAAA,IACA;AAAC,GACH;AAEA,EAAA,MAAM,aAAA,GAA2C,OAAA;AAAA,IAC/C,OAAO;AAAA,MACL,QAAA,EAAU,KAAA,EAAO,QAAA,IAAY,aAAA,CAAc,QAAA;AAAA,MAC3C,eAAA,EAAiB,KAAA,EAAO,eAAA,IAAmB,aAAA,CAAc,eAAA;AAAA,MACzD,aAAA,EAAe,OAAO,aAAA,IAAiB,aAAA;AAAA,MACvC,OAAA;AAAA,MACA,OAAA,EAAS,OAAO,OAAA,IAAW,KAAA;AAAA,MAC3B,eAAA,EAAiB,KAAA,EAAO,eAAA,IAAmB,aAAA,CAAc,eAAA;AAAA,MACzD,OAAO,KAAA,EAAO,KAAA;AAAA,MACd,YACE,KAAA,EAAO,UAAA,IAAA,CAAe,KAAA,EAAO,QAAA,IAAY,cAAc,QAAA,EAAU,MAAA;AAAA,MACnE,KAAA,EAAO,OAAO,KAAA,IAAS,EAAA;AAAA,MACvB,QAAQ,KAAA,EAAO,MAAA;AAAA,MACf,QAAA,EAAU,KAAA,EAAO,QAAA,KAAa,MAAM;AAAA,MAAC,CAAA,CAAA;AAAA,MACrC,WAAW,KAAA,EAAO,SAAA;AAAA,MAClB,cAAA,EAAgB,OAAO,cAAA,IAAkB;AAAA,KAC3C,CAAA;AAAA,IACA,CAAC,KAAA,EAAO,aAAA,EAAe,OAAA,EAAS,aAAa;AAAA,GAC/C;AAEA,EAAA,2BACG,iBAAA,CAAkB,QAAA,EAAlB,EAA2B,KAAA,EAAO,eAChC,QAAA,EACH,CAAA;AAEJ;;;;"}