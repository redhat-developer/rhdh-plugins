{"version":3,"file":"useAllEntitiesCount.esm.js","sources":["../../../src/components/UserListPicker/useAllEntitiesCount.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { QueryEntitiesInitialRequest } from '@backstage/catalog-client';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { compact, isEqual } from 'lodash';\nimport { useMemo, useRef } from 'react';\nimport useAsync from 'react-use/esm/useAsync';\nimport { catalogApiRef } from '../../api';\nimport { useEntityList } from '../../hooks';\nimport { reduceCatalogFilters } from '../../utils/filters';\n\nexport function useAllEntitiesCount() {\n  const catalogApi = useApi(catalogApiRef);\n  const { filters } = useEntityList();\n\n  const prevRequest = useRef<QueryEntitiesInitialRequest>();\n  const request = useMemo(() => {\n    const { user, ...allFilters } = filters;\n    const compacted = compact(Object.values(allFilters));\n    const { orderFields, ...catalogFilters } = reduceCatalogFilters(compacted);\n    const newRequest: QueryEntitiesInitialRequest = {\n      ...catalogFilters,\n      limit: 0,\n    };\n\n    if (Object.keys(catalogFilters.filter).length === 0) {\n      prevRequest.current = undefined;\n      return prevRequest.current;\n    }\n\n    if (isEqual(newRequest, prevRequest.current)) {\n      return prevRequest.current;\n    }\n    prevRequest.current = newRequest;\n    return newRequest;\n  }, [filters]);\n\n  const { value: count, loading } = useAsync(async () => {\n    if (request === undefined) {\n      return 0;\n    }\n    const { totalItems } = await catalogApi.queryEntities(request);\n\n    return totalItems;\n  }, [request]);\n\n  return { count, loading };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAwBO,SAAS,mBAAA,GAAsB;AACpC,EAAA,MAAM,UAAA,GAAa,OAAO,aAAa,CAAA;AACvC,EAAA,MAAM,EAAE,OAAA,EAAQ,GAAI,aAAA,EAAc;AAElC,EAAA,MAAM,cAAc,MAAA,EAAoC;AACxD,EAAA,MAAM,OAAA,GAAU,QAAQ,MAAM;AAC5B,IAAA,MAAM,EAAE,IAAA,EAAM,GAAG,UAAA,EAAW,GAAI,OAAA;AAChC,IAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,MAAA,CAAO,MAAA,CAAO,UAAU,CAAC,CAAA;AACnD,IAAA,MAAM,EAAE,WAAA,EAAa,GAAG,cAAA,EAAe,GAAI,qBAAqB,SAAS,CAAA;AACzE,IAAA,MAAM,UAAA,GAA0C;AAAA,MAC9C,GAAG,cAAA;AAAA,MACH,KAAA,EAAO;AAAA,KACT;AAEA,IAAA,IAAI,OAAO,IAAA,CAAK,cAAA,CAAe,MAAM,CAAA,CAAE,WAAW,CAAA,EAAG;AACnD,MAAA,WAAA,CAAY,OAAA,GAAU,MAAA;AACtB,MAAA,OAAO,WAAA,CAAY,OAAA;AAAA,IACrB;AAEA,IAAA,IAAI,OAAA,CAAQ,UAAA,EAAY,WAAA,CAAY,OAAO,CAAA,EAAG;AAC5C,MAAA,OAAO,WAAA,CAAY,OAAA;AAAA,IACrB;AACA,IAAA,WAAA,CAAY,OAAA,GAAU,UAAA;AACtB,IAAA,OAAO,UAAA;AAAA,EACT,CAAA,EAAG,CAAC,OAAO,CAAC,CAAA;AAEZ,EAAA,MAAM,EAAE,KAAA,EAAO,KAAA,EAAO,OAAA,EAAQ,GAAI,SAAS,YAAY;AACrD,IAAA,IAAI,YAAY,MAAA,EAAW;AACzB,MAAA,OAAO,CAAA;AAAA,IACT;AACA,IAAA,MAAM,EAAE,UAAA,EAAW,GAAI,MAAM,UAAA,CAAW,cAAc,OAAO,CAAA;AAE7D,IAAA,OAAO,UAAA;AAAA,EACT,CAAA,EAAG,CAAC,OAAO,CAAC,CAAA;AAEZ,EAAA,OAAO,EAAE,OAAO,OAAA,EAAQ;AAC1B;;;;"}