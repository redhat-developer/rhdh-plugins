{"version":3,"file":"ColocatedPage.esm.js","sources":["../../../../src/components/InspectEntityDialog/components/ColocatedPage.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  ANNOTATION_LOCATION,\n  ANNOTATION_ORIGIN_LOCATION,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Alert from '@material-ui/lab/Alert';\nimport useAsync from 'react-use/esm/useAsync';\nimport { catalogApiRef } from '../../../api';\nimport { EntityRefLink } from '../../EntityRefLink';\nimport { KeyValueListItem, ListItemText } from './common';\nimport { catalogReactTranslationRef } from '../../../translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n});\n\nfunction useColocated(entity: Entity): {\n  loading: boolean;\n  error?: Error;\n  location?: string;\n  originLocation?: string;\n  colocatedEntities?: Entity[];\n} {\n  const catalogApi = useApi(catalogApiRef);\n  const currentEntityRef = stringifyEntityRef(entity);\n  const location = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  const origin = entity.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION];\n\n  const { loading, error, value } = useAsync(async () => {\n    if (!location && !origin) {\n      return [];\n    }\n    const response = await catalogApi.getEntities({\n      filter: [\n        ...(location\n          ? [{ [`metadata.annotations.${ANNOTATION_LOCATION}`]: location }]\n          : []),\n        ...(origin\n          ? [{ [`metadata.annotations.${ANNOTATION_ORIGIN_LOCATION}`]: origin }]\n          : []),\n      ],\n    });\n    return response.items;\n  }, [location, origin]);\n\n  return {\n    loading,\n    error,\n    location,\n    originLocation: origin,\n    colocatedEntities: value?.filter(\n      colocated => stringifyEntityRef(colocated) !== currentEntityRef,\n    ),\n  };\n}\n\nfunction EntityList(props: { entities: Entity[]; header?: [string, string] }) {\n  return (\n    <List dense>\n      {props.header && <KeyValueListItem key=\"header\" entry={props.header} />}\n      {props.entities.map(entity => (\n        <ListItem key={stringifyEntityRef(entity)}>\n          <ListItemText primary={<EntityRefLink entityRef={entity} />} />\n        </ListItem>\n      ))}\n    </List>\n  );\n}\n\nfunction Contents(props: { entity: Entity }) {\n  const { entity } = props;\n  const { t } = useTranslationRef(catalogReactTranslationRef);\n\n  const { loading, error, location, originLocation, colocatedEntities } =\n    useColocated(entity);\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  if (!location && !originLocation) {\n    return (\n      <Alert severity=\"warning\">\n        {t('inspectEntityDialog.colocatedPage.alertNoLocation')}\n      </Alert>\n    );\n  } else if (!colocatedEntities?.length) {\n    return (\n      <Alert severity=\"info\">\n        {t('inspectEntityDialog.colocatedPage.alertNoEntity')}\n      </Alert>\n    );\n  }\n\n  if (location === originLocation) {\n    return <EntityList entities={colocatedEntities} />;\n  }\n\n  const atLocation = colocatedEntities.filter(\n    e => e.metadata.annotations?.[ANNOTATION_LOCATION] === location,\n  );\n  const atOrigin = colocatedEntities.filter(\n    e =>\n      e.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION] === originLocation,\n  );\n\n  return (\n    <>\n      {atLocation.length > 0 && (\n        <EntityList\n          entities={atLocation}\n          header={['At the same location', location!]}\n        />\n      )}\n      {atOrigin.length > 0 && (\n        <EntityList\n          entities={atOrigin}\n          header={['At the same origin', originLocation!]}\n        />\n      )}\n    </>\n  );\n}\n\nexport function ColocatedPage(props: { entity: Entity }) {\n  const classes = useStyles();\n  const { t } = useTranslationRef(catalogReactTranslationRef);\n  return (\n    <>\n      <DialogContentText variant=\"h2\">\n        {t('inspectEntityDialog.colocatedPage.title')}\n      </DialogContentText>\n      <DialogContentText>\n        {t('inspectEntityDialog.colocatedPage.description')}\n      </DialogContentText>\n      <div className={classes.root}>\n        <Contents entity={props.entity} />\n      </div>\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}