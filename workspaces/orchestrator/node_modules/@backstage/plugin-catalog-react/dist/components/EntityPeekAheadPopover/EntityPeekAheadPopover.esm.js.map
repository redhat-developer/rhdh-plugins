{"version":3,"file":"EntityPeekAheadPopover.esm.js","sources":["../../../src/components/EntityPeekAheadPopover/EntityPeekAheadPopover.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport useAsyncFn from 'react-use/esm/useAsyncFn';\nimport { catalogApiRef } from '../../api';\nimport { PropsWithChildren, useEffect, useMemo, useState } from 'react';\nimport HoverPopover from 'material-ui-popup-state/HoverPopover';\nimport {\n  bindHover,\n  bindPopover,\n  usePopupState,\n} from 'material-ui-popup-state/hooks';\nimport Box from '@material-ui/core/Box';\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport CardContent from '@material-ui/core/CardContent';\nimport Chip from '@material-ui/core/Chip';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useApiHolder } from '@backstage/core-plugin-api';\nimport { isGroupEntity, isUserEntity } from '@backstage/catalog-model';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport {\n  EntityCardActions,\n  UserCardActions,\n  GroupCardActions,\n} from './CardActionComponents';\nimport { debounce } from 'lodash';\nimport { catalogReactTranslationRef } from '../../translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\n/**\n * Properties for an entity popover on hover of a component.\n *\n * @public\n */\nexport type EntityPeekAheadPopoverProps = PropsWithChildren<{\n  entityRef: string;\n  delayTime?: number;\n}>;\n\nconst useStyles = makeStyles(() => {\n  return {\n    popoverPaper: {\n      width: '30em',\n    },\n    descriptionTypography: {\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      display: '-webkit-box',\n      WebkitLineClamp: 2,\n      WebkitBoxOrient: 'vertical',\n    },\n  };\n});\n\nconst maxTagChips = 4;\n\n/**\n * Shows an entity popover on hover of a component.\n *\n * @public\n */\nexport const EntityPeekAheadPopover = (props: EntityPeekAheadPopoverProps) => {\n  const { entityRef, children, delayTime = 500 } = props;\n  const { t } = useTranslationRef(catalogReactTranslationRef);\n  const classes = useStyles();\n  const apiHolder = useApiHolder();\n  const popupState = usePopupState({\n    variant: 'popover',\n    popupId: 'entity-peek-ahead',\n  });\n  const [isHovered, setIsHovered] = useState(false);\n\n  const debouncedHandleMouseEnter = useMemo(\n    () => debounce(() => setIsHovered(true), delayTime),\n    [delayTime],\n  );\n\n  const [{ loading, error, value: entity }, load] = useAsyncFn(async () => {\n    const catalogApi = apiHolder.get(catalogApiRef);\n    if (catalogApi) {\n      const retrievedEntity = await catalogApi.getEntityByRef(entityRef);\n      if (!retrievedEntity) {\n        throw new Error(`${entityRef} not found`);\n      }\n      return retrievedEntity;\n    }\n    return undefined;\n  }, [apiHolder, entityRef]);\n\n  const handleOnMouseLeave = () => {\n    setIsHovered(false);\n    debouncedHandleMouseEnter.cancel();\n  };\n\n  useEffect(() => {\n    if (popupState.isOpen && !entity && !error && !loading) {\n      load();\n    }\n  }, [popupState.isOpen, load, entity, error, loading]);\n\n  return (\n    <>\n      <Typography component=\"span\" onMouseEnter={debouncedHandleMouseEnter}>\n        <Typography\n          component=\"span\"\n          data-testid=\"trigger\"\n          {...bindHover(popupState)}\n        >\n          {children}\n        </Typography>\n      </Typography>\n      {isHovered && (\n        <HoverPopover\n          PaperProps={{\n            className: classes.popoverPaper,\n          }}\n          {...bindPopover(popupState)}\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'center',\n          }}\n          transformOrigin={{\n            vertical: 'top',\n            horizontal: 'center',\n          }}\n          onMouseLeave={handleOnMouseLeave}\n        >\n          <Card>\n            <CardContent>\n              {error && <ResponseErrorPanel error={error} />}\n              {loading && <Progress />}\n              {entity && (\n                <>\n                  <Typography color=\"textSecondary\">\n                    {entity.metadata.namespace}\n                  </Typography>\n                  <Typography variant=\"h5\" component=\"div\">\n                    {entity.metadata.name}\n                  </Typography>\n                  <Typography color=\"textSecondary\" gutterBottom>\n                    {entity.kind}\n                  </Typography>\n                  {entity.metadata.description && (\n                    <Typography\n                      className={classes.descriptionTypography}\n                      paragraph\n                    >\n                      {entity.metadata.description}\n                    </Typography>\n                  )}\n                  <Typography>{entity.spec?.type?.toString()}</Typography>\n                  <Box marginTop=\"0.5em\">\n                    {(entity.metadata.tags || [])\n                      .slice(0, maxTagChips)\n                      .map(tag => {\n                        return <Chip key={tag} size=\"small\" label={tag} />;\n                      })}\n                    {entity.metadata.tags?.length &&\n                      entity.metadata.tags?.length > maxTagChips && (\n                        <Tooltip title={t('entityPeekAheadPopover.title')}>\n                          <Chip key=\"other-tags\" size=\"small\" label=\"...\" />\n                        </Tooltip>\n                      )}\n                  </Box>\n                </>\n              )}\n            </CardContent>\n            {!error && entity && (\n              <CardActions>\n                <>\n                  {isUserEntity(entity) && <UserCardActions entity={entity} />}\n                  {isGroupEntity(entity) && (\n                    <GroupCardActions entity={entity} />\n                  )}\n                  <EntityCardActions entity={entity} />\n                </>\n              </CardActions>\n            )}\n          </Card>\n        </HoverPopover>\n      )}\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}