{"version":3,"file":"MissingAnnotationEmptyState.esm.js","sources":["../../../src/components/MissingAnnotationEmptyState/MissingAnnotationEmptyState.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport { CodeSnippet, Link, EmptyState } from '@backstage/core-components';\nimport { Entity } from '@backstage/catalog-model';\nimport { useEntity } from '../../hooks';\n\n/** @public */\nexport type MissingAnnotationEmptyStateClassKey = 'code';\n\nconst useStyles = makeStyles(\n  theme => ({\n    code: {\n      borderRadius: 6,\n      margin: theme.spacing(2, 0),\n      background:\n        theme.palette.type === 'dark' ? '#444' : theme.palette.common.white,\n    },\n  }),\n  { name: 'BackstageMissingAnnotationEmptyState' },\n);\n\nfunction generateYamlExample(\n  annotations: string[],\n  entity?: Entity,\n): { yamlText: string; lineNumbers: number[] } {\n  const kind = entity?.kind || 'Component';\n  const name = entity?.metadata.name || 'example';\n  const type = entity?.spec?.type || 'website';\n  const owner = entity?.spec?.owner || 'user:default/guest';\n\n  const yamlText = `apiVersion: backstage.io/v1alpha1\nkind: ${kind}\nmetadata:\n  name: ${name}\n  annotations:${annotations.map(ann => `\\n    ${ann}: value`).join('')}\nspec:\n  type: ${type}\n  owner: ${owner}`;\n\n  let line = 6; // Line 6 is the line number that annotations are added to.\n  const lineNumbers: number[] = [];\n  annotations.forEach(() => {\n    lineNumbers.push(line);\n    line++;\n  });\n\n  return {\n    yamlText,\n    lineNumbers,\n  };\n}\n\nfunction generateDescription(annotations: string[], entityKind = 'Component') {\n  const isSingular = annotations.length <= 1;\n  return (\n    <>\n      The {isSingular ? 'annotation' : 'annotations'}{' '}\n      {annotations\n        .map(ann => <code>{ann}</code>)\n        .reduce((prev, curr) => (\n          <>\n            {prev}, {curr}\n          </>\n        ))}{' '}\n      {isSingular ? 'is' : 'are'} missing. You need to add the{' '}\n      {isSingular ? 'annotation' : 'annotations'} to your {entityKind} if you\n      want to enable this tool.\n    </>\n  );\n}\n\n/**\n * @public\n * Renders an empty state when an annotation is missing from an entity.\n */\nexport function MissingAnnotationEmptyState(props: {\n  annotation: string | string[];\n  readMoreUrl?: string;\n}) {\n  let entity: Entity | undefined;\n  try {\n    const entityContext = useEntity();\n    entity = entityContext.entity;\n  } catch (err) {\n    // ignore when entity context doesnt exist\n  }\n\n  const { annotation, readMoreUrl } = props;\n  const annotations = Array.isArray(annotation) ? annotation : [annotation];\n  const url =\n    readMoreUrl ||\n    'https://backstage.io/docs/features/software-catalog/well-known-annotations';\n  const classes = useStyles();\n\n  const entityKind = entity?.kind || 'Component';\n  const { yamlText, lineNumbers } = generateYamlExample(annotations, entity);\n  return (\n    <EmptyState\n      missing=\"field\"\n      title=\"Missing Annotation\"\n      description={generateDescription(annotations, entityKind)}\n      action={\n        <>\n          <Typography variant=\"body1\">\n            Add the annotation to your {entityKind} YAML as shown in the\n            highlighted example below:\n          </Typography>\n          <Box className={classes.code}>\n            <CodeSnippet\n              text={yamlText}\n              language=\"yaml\"\n              showLineNumbers\n              highlightedNumbers={lineNumbers}\n              customStyle={{ background: 'inherit', fontSize: '115%' }}\n            />\n          </Box>\n          <Button color=\"primary\" component={Link} to={url}>\n            Read more\n          </Button>\n        </>\n      }\n    />\n  );\n}\n"],"names":[],"mappings":"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"}