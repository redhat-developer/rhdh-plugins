{"version":3,"file":"useEntityPresentation.esm.js","sources":["../../../src/apis/EntityPresentationApi/useEntityPresentation.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  CompoundEntityRef,\n  Entity,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { useApiHolder } from '@backstage/core-plugin-api';\nimport { useMemo } from 'react';\nimport {\n  EntityRefPresentation,\n  EntityRefPresentationSnapshot,\n  entityPresentationApiRef,\n} from './EntityPresentationApi';\nimport { defaultEntityPresentation } from './defaultEntityPresentation';\nimport { useUpdatingObservable } from './useUpdatingObservable';\n\n/**\n * Returns information about how to represent an entity in the interface.\n *\n * @public\n * @param entityOrRef - The entity to represent, or an entity ref to it. If you\n *   pass in an entity, it is assumed that it is NOT a partial one - i.e. only\n *   pass in an entity if you know that it was fetched in such a way that it\n *   contains all of the fields that the representation renderer needs.\n * @param context - Optional context that control details of the presentation.\n * @returns A snapshot of the entity presentation, which may change over time\n */\nexport function useEntityPresentation(\n  entityOrRef: Entity | CompoundEntityRef | string,\n  context?: {\n    defaultKind?: string;\n    defaultNamespace?: string;\n  },\n): EntityRefPresentationSnapshot {\n  // Defensively allow for a missing presentation API, which makes this hook\n  // safe to use in tests.\n  const apis = useApiHolder();\n  const entityPresentationApi = apis.get(entityPresentationApiRef);\n\n  const deps = [\n    entityPresentationApi,\n    JSON.stringify(entityOrRef),\n    JSON.stringify(context || null),\n  ];\n\n  const presentation = useMemo<EntityRefPresentation>(\n    () => {\n      if (!entityPresentationApi) {\n        const fallback = defaultEntityPresentation(entityOrRef, context);\n        return { snapshot: fallback, promise: Promise.resolve(fallback) };\n      }\n\n      return entityPresentationApi.forEntity(\n        typeof entityOrRef === 'string' || 'metadata' in entityOrRef\n          ? entityOrRef\n          : stringifyEntityRef(entityOrRef),\n        context,\n      );\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    deps,\n  );\n\n  // NOTE(freben): We intentionally do not use the plain useObservable from the\n  // react-use library here. That hook does not support a dependencies array,\n  // and also it only subscribes once to the initially passed in observable and\n  // won't properly react when either initial value or the actual observable\n  // changes.\n  return useUpdatingObservable(presentation.snapshot, presentation.update$, [\n    presentation,\n  ]);\n}\n"],"names":[],"mappings":";;;;;;;AA0CO,SAAS,qBAAA,CACd,aACA,OAAA,EAI+B;AAG/B,EAAA,MAAM,OAAO,YAAA,EAAa;AAC1B,EAAA,MAAM,qBAAA,GAAwB,IAAA,CAAK,GAAA,CAAI,wBAAwB,CAAA;AAE/D,EAAA,MAAM,IAAA,GAAO;AAAA,IACX,qBAAA;AAAA,IACA,IAAA,CAAK,UAAU,WAAW,CAAA;AAAA,IAC1B,IAAA,CAAK,SAAA,CAAU,OAAA,IAAW,IAAI;AAAA,GAChC;AAEA,EAAA,MAAM,YAAA,GAAe,OAAA;AAAA,IACnB,MAAM;AACJ,MAAA,IAAI,CAAC,qBAAA,EAAuB;AAC1B,QAAA,MAAM,QAAA,GAAW,yBAAA,CAA0B,WAAA,EAAa,OAAO,CAAA;AAC/D,QAAA,OAAO,EAAE,QAAA,EAAU,QAAA,EAAU,SAAS,OAAA,CAAQ,OAAA,CAAQ,QAAQ,CAAA,EAAE;AAAA,MAClE;AAEA,MAAA,OAAO,qBAAA,CAAsB,SAAA;AAAA,QAC3B,OAAO,WAAA,KAAgB,QAAA,IAAY,cAAc,WAAA,GAC7C,WAAA,GACA,mBAAmB,WAAW,CAAA;AAAA,QAClC;AAAA,OACF;AAAA,IACF,CAAA;AAAA;AAAA,IAEA;AAAA,GACF;AAOA,EAAA,OAAO,qBAAA,CAAsB,YAAA,CAAa,QAAA,EAAU,YAAA,CAAa,OAAA,EAAS;AAAA,IACxE;AAAA,GACD,CAAA;AACH;;;;"}