{"version":3,"file":"defaultEntityPresentation.esm.js","sources":["../../../src/apis/EntityPresentationApi/defaultEntityPresentation.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  CompoundEntityRef,\n  DEFAULT_NAMESPACE,\n  Entity,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport get from 'lodash/get';\nimport { EntityRefPresentationSnapshot } from './EntityPresentationApi';\n\n/**\n * This returns the default representation of an entity.\n *\n * @public\n * @param entityOrRef - Either an entity, or a ref to it.\n * @param context - Contextual information that may affect the presentation.\n */\nexport function defaultEntityPresentation(\n  entityOrRef: Entity | CompoundEntityRef | string,\n  context?: {\n    defaultKind?: string;\n    defaultNamespace?: string;\n  },\n): EntityRefPresentationSnapshot {\n  // NOTE(freben): This code may look convoluted, but it tries its very best to\n  // be defensive and handling any type of malformed input and still producing\n  // some form of result without crashing.\n  const { kind, namespace, name, title, description, displayName, type } =\n    getParts(entityOrRef);\n\n  const entityRef: string = stringifyEntityRef({\n    kind: kind || 'unknown',\n    namespace: namespace || DEFAULT_NAMESPACE,\n    name: name || 'unknown',\n  });\n\n  const shortRef = getShortRef({ kind, namespace, name, context });\n\n  const primary = [displayName, title, shortRef].find(\n    candidate => candidate && typeof candidate === 'string',\n  )!;\n\n  const secondary = [\n    primary !== entityRef ? entityRef : undefined,\n    type,\n    description,\n  ]\n    .filter(candidate => candidate && typeof candidate === 'string')\n    .join(' | ');\n\n  return {\n    entityRef,\n    primaryTitle: primary,\n    secondaryTitle: secondary || undefined,\n    Icon: undefined, // leave it up to the presentation API to handle\n  };\n}\n\nconst isString = (value: unknown): value is string =>\n  Boolean(value) && typeof value === 'string';\n\n// Try to extract display-worthy parts of an entity or ref as best we can, without throwing\nfunction getParts(entityOrRef: Entity | CompoundEntityRef | string): {\n  kind?: string;\n  namespace?: string;\n  name?: string;\n  title?: string;\n  description?: string;\n  displayName?: string;\n  type?: string;\n} {\n  if (typeof entityOrRef === 'string') {\n    let colonI = entityOrRef.indexOf(':');\n    const slashI = entityOrRef.indexOf('/');\n\n    // If the / is ahead of the :, treat the rest as the name\n    if (slashI !== -1 && slashI < colonI) {\n      colonI = -1;\n    }\n\n    const kind = colonI === -1 ? undefined : entityOrRef.slice(0, colonI);\n    const namespace =\n      slashI === -1 ? undefined : entityOrRef.slice(colonI + 1, slashI);\n    const name = entityOrRef.slice(Math.max(colonI + 1, slashI + 1));\n\n    return { kind, namespace, name };\n  }\n\n  if (typeof entityOrRef === 'object' && entityOrRef !== null) {\n    const kind = [get(entityOrRef, 'kind')].find(isString);\n\n    const namespace = [\n      get(entityOrRef, 'metadata.namespace'),\n      get(entityOrRef, 'namespace'),\n    ].find(isString);\n\n    const name = [\n      get(entityOrRef, 'metadata.name'),\n      get(entityOrRef, 'name'),\n    ].find(isString);\n\n    const title = [get(entityOrRef, 'metadata.title')].find(isString);\n\n    const description = [get(entityOrRef, 'metadata.description')].find(\n      isString,\n    );\n\n    const displayName = [get(entityOrRef, 'spec.profile.displayName')].find(\n      isString,\n    );\n\n    const type = [get(entityOrRef, 'spec.type')].find(isString);\n\n    return { kind, namespace, name, title, description, displayName, type };\n  }\n\n  return {};\n}\n\nfunction getShortRef(options: {\n  kind?: string;\n  namespace?: string;\n  name?: string;\n  context?: { defaultKind?: string; defaultNamespace?: string };\n}): string {\n  const kind = options.kind?.toLocaleLowerCase('en-US') || 'unknown';\n  const namespace = options.namespace || DEFAULT_NAMESPACE;\n  const name = options.name || 'unknown';\n  const defaultKindLower =\n    options.context?.defaultKind?.toLocaleLowerCase('en-US');\n  const defaultNamespaceLower =\n    options.context?.defaultNamespace?.toLocaleLowerCase('en-US');\n\n  let result = name;\n\n  if (\n    (defaultNamespaceLower &&\n      namespace.toLocaleLowerCase('en-US') !== defaultNamespaceLower) ||\n    namespace !== DEFAULT_NAMESPACE\n  ) {\n    result = `${namespace}/${result}`;\n  }\n\n  if (\n    defaultKindLower &&\n    kind.toLocaleLowerCase('en-US') !== defaultKindLower\n  ) {\n    result = `${kind}:${result}`;\n  }\n\n  return result;\n}\n"],"names":[],"mappings":";;;AAgCO,SAAS,yBAAA,CACd,aACA,OAAA,EAI+B;AAI/B,EAAA,MAAM,EAAE,IAAA,EAAM,SAAA,EAAW,IAAA,EAAM,KAAA,EAAO,aAAa,WAAA,EAAa,IAAA,EAAK,GACnE,QAAA,CAAS,WAAW,CAAA;AAEtB,EAAA,MAAM,YAAoB,kBAAA,CAAmB;AAAA,IAC3C,MAAM,IAAA,IAAQ,SAAA;AAAA,IACd,WAAW,SAAA,IAAa,iBAAA;AAAA,IACxB,MAAM,IAAA,IAAQ;AAAA,GACf,CAAA;AAED,EAAA,MAAM,WAAW,WAAA,CAAY,EAAE,MAAM,SAAA,EAAW,IAAA,EAAM,SAAS,CAAA;AAE/D,EAAA,MAAM,OAAA,GAAU,CAAC,WAAA,EAAa,KAAA,EAAO,QAAQ,CAAA,CAAE,IAAA;AAAA,IAC7C,CAAA,SAAA,KAAa,SAAA,IAAa,OAAO,SAAA,KAAc;AAAA,GACjD;AAEA,EAAA,MAAM,SAAA,GAAY;AAAA,IAChB,OAAA,KAAY,YAAY,SAAA,GAAY,MAAA;AAAA,IACpC,IAAA;AAAA,IACA;AAAA,GACF,CACG,OAAO,CAAA,SAAA,KAAa,SAAA,IAAa,OAAO,SAAA,KAAc,QAAQ,CAAA,CAC9D,IAAA,CAAK,KAAK,CAAA;AAEb,EAAA,OAAO;AAAA,IACL,SAAA;AAAA,IACA,YAAA,EAAc,OAAA;AAAA,IACd,gBAAgB,SAAA,IAAa,MAAA;AAAA,IAC7B,IAAA,EAAM;AAAA;AAAA,GACR;AACF;AAEA,MAAM,WAAW,CAAC,KAAA,KAChB,QAAQ,KAAK,CAAA,IAAK,OAAO,KAAA,KAAU,QAAA;AAGrC,SAAS,SAAS,WAAA,EAQhB;AACA,EAAA,IAAI,OAAO,gBAAgB,QAAA,EAAU;AACnC,IAAA,IAAI,MAAA,GAAS,WAAA,CAAY,OAAA,CAAQ,GAAG,CAAA;AACpC,IAAA,MAAM,MAAA,GAAS,WAAA,CAAY,OAAA,CAAQ,GAAG,CAAA;AAGtC,IAAA,IAAI,MAAA,KAAW,EAAA,IAAM,MAAA,GAAS,MAAA,EAAQ;AACpC,MAAA,MAAA,GAAS,EAAA;AAAA,IACX;AAEA,IAAA,MAAM,OAAO,MAAA,KAAW,EAAA,GAAK,SAAY,WAAA,CAAY,KAAA,CAAM,GAAG,MAAM,CAAA;AACpE,IAAA,MAAM,SAAA,GACJ,WAAW,EAAA,GAAK,MAAA,GAAY,YAAY,KAAA,CAAM,MAAA,GAAS,GAAG,MAAM,CAAA;AAClE,IAAA,MAAM,IAAA,GAAO,YAAY,KAAA,CAAM,IAAA,CAAK,IAAI,MAAA,GAAS,CAAA,EAAG,MAAA,GAAS,CAAC,CAAC,CAAA;AAE/D,IAAA,OAAO,EAAE,IAAA,EAAM,SAAA,EAAW,IAAA,EAAK;AAAA,EACjC;AAEA,EAAA,IAAI,OAAO,WAAA,KAAgB,QAAA,IAAY,WAAA,KAAgB,IAAA,EAAM;AAC3D,IAAA,MAAM,IAAA,GAAO,CAAC,GAAA,CAAI,WAAA,EAAa,MAAM,CAAC,CAAA,CAAE,KAAK,QAAQ,CAAA;AAErD,IAAA,MAAM,SAAA,GAAY;AAAA,MAChB,GAAA,CAAI,aAAa,oBAAoB,CAAA;AAAA,MACrC,GAAA,CAAI,aAAa,WAAW;AAAA,KAC9B,CAAE,KAAK,QAAQ,CAAA;AAEf,IAAA,MAAM,IAAA,GAAO;AAAA,MACX,GAAA,CAAI,aAAa,eAAe,CAAA;AAAA,MAChC,GAAA,CAAI,aAAa,MAAM;AAAA,KACzB,CAAE,KAAK,QAAQ,CAAA;AAEf,IAAA,MAAM,KAAA,GAAQ,CAAC,GAAA,CAAI,WAAA,EAAa,gBAAgB,CAAC,CAAA,CAAE,KAAK,QAAQ,CAAA;AAEhE,IAAA,MAAM,cAAc,CAAC,GAAA,CAAI,WAAA,EAAa,sBAAsB,CAAC,CAAA,CAAE,IAAA;AAAA,MAC7D;AAAA,KACF;AAEA,IAAA,MAAM,cAAc,CAAC,GAAA,CAAI,WAAA,EAAa,0BAA0B,CAAC,CAAA,CAAE,IAAA;AAAA,MACjE;AAAA,KACF;AAEA,IAAA,MAAM,IAAA,GAAO,CAAC,GAAA,CAAI,WAAA,EAAa,WAAW,CAAC,CAAA,CAAE,KAAK,QAAQ,CAAA;AAE1D,IAAA,OAAO,EAAE,IAAA,EAAM,SAAA,EAAW,MAAM,KAAA,EAAO,WAAA,EAAa,aAAa,IAAA,EAAK;AAAA,EACxE;AAEA,EAAA,OAAO,EAAC;AACV;AAEA,SAAS,YAAY,OAAA,EAKV;AACT,EAAA,MAAM,IAAA,GAAO,OAAA,CAAQ,IAAA,EAAM,iBAAA,CAAkB,OAAO,CAAA,IAAK,SAAA;AACzD,EAAA,MAAM,SAAA,GAAY,QAAQ,SAAA,IAAa,iBAAA;AACvC,EAAA,MAAM,IAAA,GAAO,QAAQ,IAAA,IAAQ,SAAA;AAC7B,EAAA,MAAM,gBAAA,GACJ,OAAA,CAAQ,OAAA,EAAS,WAAA,EAAa,kBAAkB,OAAO,CAAA;AACzD,EAAA,MAAM,qBAAA,GACJ,OAAA,CAAQ,OAAA,EAAS,gBAAA,EAAkB,kBAAkB,OAAO,CAAA;AAE9D,EAAA,IAAI,MAAA,GAAS,IAAA;AAEb,EAAA,IACG,yBACC,SAAA,CAAU,iBAAA,CAAkB,OAAO,CAAA,KAAM,qBAAA,IAC3C,cAAc,iBAAA,EACd;AACA,IAAA,MAAA,GAAS,CAAA,EAAG,SAAS,CAAA,CAAA,EAAI,MAAM,CAAA,CAAA;AAAA,EACjC;AAEA,EAAA,IACE,gBAAA,IACA,IAAA,CAAK,iBAAA,CAAkB,OAAO,MAAM,gBAAA,EACpC;AACA,IAAA,MAAA,GAAS,CAAA,EAAG,IAAI,CAAA,CAAA,EAAI,MAAM,CAAA,CAAA;AAAA,EAC5B;AAEA,EAAA,OAAO,MAAA;AACT;;;;"}