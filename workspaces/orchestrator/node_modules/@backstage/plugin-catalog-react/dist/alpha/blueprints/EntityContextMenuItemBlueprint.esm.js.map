{"version":3,"file":"EntityContextMenuItemBlueprint.esm.js","sources":["../../../src/alpha/blueprints/EntityContextMenuItemBlueprint.tsx"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode, JSX } from 'react';\nimport {\n  coreExtensionData,\n  createExtensionBlueprint,\n  ExtensionBoundary,\n} from '@backstage/frontend-plugin-api';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport { useEntityContextMenu } from '../../hooks/useEntityContextMenu';\nimport { EntityPredicate } from '../predicates/types';\nimport { entityPredicateToFilterFunction } from '../predicates/entityPredicateToFilterFunction';\nimport type { Entity } from '@backstage/catalog-model';\nimport { entityFilterFunctionDataRef } from './extensionData';\nimport { createEntityPredicateSchema } from '../predicates/createEntityPredicateSchema';\n/** @alpha */\nexport type UseProps = () =>\n  | {\n      title: ReactNode;\n      href: string;\n      disabled?: boolean;\n    }\n  | {\n      title: ReactNode;\n      onClick: () => void | Promise<void>;\n      disabled?: boolean;\n    };\n\n/** @alpha */\nexport type EntityContextMenuItemParams = {\n  useProps: UseProps;\n  icon: JSX.Element;\n  filter?: EntityPredicate | ((entity: Entity) => boolean);\n};\n\n/** @alpha */\nexport const EntityContextMenuItemBlueprint = createExtensionBlueprint({\n  kind: 'entity-context-menu-item',\n  attachTo: { id: 'page:catalog/entity', input: 'contextMenuItems' },\n  output: [\n    coreExtensionData.reactElement,\n    entityFilterFunctionDataRef.optional(),\n  ],\n  dataRefs: {\n    filterFunction: entityFilterFunctionDataRef,\n  },\n  config: {\n    schema: {\n      filter: z => createEntityPredicateSchema(z).optional(),\n    },\n  },\n  *factory(params: EntityContextMenuItemParams, { node, config }) {\n    const loader = async () => {\n      const Component = () => {\n        const { onMenuClose } = useEntityContextMenu();\n        const { title, ...menuItemProps } = params.useProps();\n        let handleClick = undefined;\n\n        if ('onClick' in menuItemProps) {\n          handleClick = () => {\n            const result = menuItemProps.onClick();\n            if (result && 'then' in result) {\n              result.then(onMenuClose, onMenuClose);\n            } else {\n              onMenuClose();\n            }\n          };\n        }\n\n        return (\n          <MenuItem {...menuItemProps} onClick={handleClick}>\n            <ListItemIcon>{params.icon}</ListItemIcon>\n            <ListItemText primary={title} />\n          </MenuItem>\n        );\n      };\n\n      return <Component />;\n    };\n\n    yield coreExtensionData.reactElement(ExtensionBoundary.lazy(node, loader));\n\n    if (config.filter) {\n      yield entityFilterFunctionDataRef(\n        entityPredicateToFilterFunction(config.filter),\n      );\n    } else if (typeof params.filter === 'function') {\n      yield entityFilterFunctionDataRef(params.filter);\n    } else if (params.filter) {\n      yield entityFilterFunctionDataRef(\n        entityPredicateToFilterFunction(params.filter),\n      );\n    }\n  },\n});\n"],"names":[],"mappings":";;;;;;;;;;AAoDO,MAAM,iCAAiC,wBAAA,CAAyB;AAAA,EACrE,IAAA,EAAM,0BAAA;AAAA,EACN,QAAA,EAAU,EAAE,EAAA,EAAI,qBAAA,EAAuB,OAAO,kBAAA,EAAmB;AAAA,EACjE,MAAA,EAAQ;AAAA,IACN,iBAAA,CAAkB,YAAA;AAAA,IAClB,4BAA4B,QAAA;AAAS,GACvC;AAAA,EACA,QAAA,EAAU;AAAA,IACR,cAAA,EAAgB;AAAA,GAClB;AAAA,EACA,MAAA,EAAQ;AAAA,IACN,MAAA,EAAQ;AAAA,MACN,MAAA,EAAQ,CAAA,CAAA,KAAK,2BAAA,CAA4B,CAAC,EAAE,QAAA;AAAS;AACvD,GACF;AAAA,EACA,CAAC,OAAA,CAAQ,MAAA,EAAqC,EAAE,IAAA,EAAM,QAAO,EAAG;AAC9D,IAAA,MAAM,SAAS,YAAY;AACzB,MAAA,MAAM,YAAY,MAAM;AACtB,QAAA,MAAM,EAAE,WAAA,EAAY,GAAI,oBAAA,EAAqB;AAC7C,QAAA,MAAM,EAAE,KAAA,EAAO,GAAG,aAAA,EAAc,GAAI,OAAO,QAAA,EAAS;AACpD,QAAA,IAAI,WAAA,GAAc,MAAA;AAElB,QAAA,IAAI,aAAa,aAAA,EAAe;AAC9B,UAAA,WAAA,GAAc,MAAM;AAClB,YAAA,MAAM,MAAA,GAAS,cAAc,OAAA,EAAQ;AACrC,YAAA,IAAI,MAAA,IAAU,UAAU,MAAA,EAAQ;AAC9B,cAAA,MAAA,CAAO,IAAA,CAAK,aAAa,WAAW,CAAA;AAAA,YACtC,CAAA,MAAO;AACL,cAAA,WAAA,EAAY;AAAA,YACd;AAAA,UACF,CAAA;AAAA,QACF;AAEA,QAAA,uBACE,IAAA,CAAC,QAAA,EAAA,EAAU,GAAG,aAAA,EAAe,SAAS,WAAA,EACpC,QAAA,EAAA;AAAA,0BAAA,GAAA,CAAC,YAAA,EAAA,EAAc,iBAAO,IAAA,EAAK,CAAA;AAAA,0BAC3B,GAAA,CAAC,YAAA,EAAA,EAAa,OAAA,EAAS,KAAA,EAAO;AAAA,SAAA,EAChC,CAAA;AAAA,MAEJ,CAAA;AAEA,MAAA,2BAAQ,SAAA,EAAA,EAAU,CAAA;AAAA,IACpB,CAAA;AAEA,IAAA,MAAM,kBAAkB,YAAA,CAAa,iBAAA,CAAkB,IAAA,CAAK,IAAA,EAAM,MAAM,CAAC,CAAA;AAEzE,IAAA,IAAI,OAAO,MAAA,EAAQ;AACjB,MAAA,MAAM,2BAAA;AAAA,QACJ,+BAAA,CAAgC,OAAO,MAAM;AAAA,OAC/C;AAAA,IACF,CAAA,MAAA,IAAW,OAAO,MAAA,CAAO,MAAA,KAAW,UAAA,EAAY;AAC9C,MAAA,MAAM,2BAAA,CAA4B,OAAO,MAAM,CAAA;AAAA,IACjD,CAAA,MAAA,IAAW,OAAO,MAAA,EAAQ;AACxB,MAAA,MAAM,2BAAA;AAAA,QACJ,+BAAA,CAAgC,OAAO,MAAM;AAAA,OAC/C;AAAA,IACF;AAAA,EACF;AACF,CAAC;;;;"}