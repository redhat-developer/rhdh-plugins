{"version":3,"file":"convertLegacyEntityCardExtension.esm.js","sources":["../../../src/alpha/converters/convertLegacyEntityCardExtension.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { compatWrapper } from '@backstage/core-compat-api';\nimport { BackstagePlugin, getComponentData } from '@backstage/core-plugin-api';\nimport { ExtensionDefinition } from '@backstage/frontend-plugin-api';\nimport { ComponentType } from 'react';\nimport { EntityCardBlueprint } from '../blueprints/EntityCardBlueprint';\nimport kebabCase from 'lodash/kebabCase';\nimport { EntityPredicate } from '../predicates/types';\nimport { Entity } from '@backstage/catalog-model';\nimport { EntityCardType } from '../blueprints/extensionData';\n\n/** @alpha */\nexport function convertLegacyEntityCardExtension(\n  LegacyExtension: ComponentType<{}>,\n  overrides?: {\n    name?: string;\n    filter?: string | EntityPredicate | ((entity: Entity) => boolean);\n    type?: EntityCardType;\n  },\n): ExtensionDefinition {\n  const element = <LegacyExtension />;\n\n  const extName = getComponentData<string>(element, 'core.extensionName');\n  if (!extName) {\n    throw new Error('Extension has no name');\n  }\n\n  const plugin = getComponentData<BackstagePlugin>(element, 'core.plugin');\n  const pluginId = plugin?.getId();\n\n  const match = extName.match(/^Entity(.*)Card$/);\n  const infix = match?.[1] ?? extName;\n\n  let name: string | undefined = infix;\n  if (\n    pluginId &&\n    name\n      .toLocaleLowerCase('en-US')\n      .startsWith(pluginId.toLocaleLowerCase('en-US'))\n  ) {\n    name = name.slice(pluginId.length);\n    if (!name) {\n      name = undefined;\n    }\n  }\n  name = name && kebabCase(name);\n\n  return EntityCardBlueprint.make({\n    name: overrides?.name ?? name,\n    params: {\n      filter: overrides?.filter,\n      loader: async () => compatWrapper(element),\n      type: overrides?.type,\n    },\n  });\n}\n"],"names":[],"mappings":";;;;;;AA2BO,SAAS,gCAAA,CACd,iBACA,SAAA,EAKqB;AACrB,EAAA,MAAM,OAAA,uBAAW,eAAA,EAAA,EAAgB,CAAA;AAEjC,EAAA,MAAM,OAAA,GAAU,gBAAA,CAAyB,OAAA,EAAS,oBAAoB,CAAA;AACtE,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,MAAM,IAAI,MAAM,uBAAuB,CAAA;AAAA,EACzC;AAEA,EAAA,MAAM,MAAA,GAAS,gBAAA,CAAkC,OAAA,EAAS,aAAa,CAAA;AACvE,EAAA,MAAM,QAAA,GAAW,QAAQ,KAAA,EAAM;AAE/B,EAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,KAAA,CAAM,kBAAkB,CAAA;AAC9C,EAAA,MAAM,KAAA,GAAQ,KAAA,GAAQ,CAAC,CAAA,IAAK,OAAA;AAE5B,EAAA,IAAI,IAAA,GAA2B,KAAA;AAC/B,EAAA,IACE,QAAA,IACA,IAAA,CACG,iBAAA,CAAkB,OAAO,CAAA,CACzB,WAAW,QAAA,CAAS,iBAAA,CAAkB,OAAO,CAAC,CAAA,EACjD;AACA,IAAA,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,QAAA,CAAS,MAAM,CAAA;AACjC,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,IAAA,GAAO,MAAA;AAAA,IACT;AAAA,EACF;AACA,EAAA,IAAA,GAAO,IAAA,IAAQ,UAAU,IAAI,CAAA;AAE7B,EAAA,OAAO,oBAAoB,IAAA,CAAK;AAAA,IAC9B,IAAA,EAAM,WAAW,IAAA,IAAQ,IAAA;AAAA,IACzB,MAAA,EAAQ;AAAA,MACN,QAAQ,SAAA,EAAW,MAAA;AAAA,MACnB,MAAA,EAAQ,YAAY,aAAA,CAAc,OAAO,CAAA;AAAA,MACzC,MAAM,SAAA,EAAW;AAAA;AACnB,GACD,CAAA;AACH;;;;"}