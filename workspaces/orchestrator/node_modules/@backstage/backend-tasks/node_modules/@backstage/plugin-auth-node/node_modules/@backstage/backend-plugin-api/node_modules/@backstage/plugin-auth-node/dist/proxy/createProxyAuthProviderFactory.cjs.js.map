{"version":3,"file":"createProxyAuthProviderFactory.cjs.js","sources":["../../src/proxy/createProxyAuthProviderFactory.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  readDeclarativeSignInResolver,\n  SignInResolverFactory,\n} from '../sign-in';\nimport {\n  AuthProviderFactory,\n  ProfileTransform,\n  SignInResolver,\n} from '../types';\nimport { createProxyAuthRouteHandlers } from './createProxyRouteHandlers';\nimport { ProxyAuthenticator } from './types';\n\n/** @public */\nexport function createProxyAuthProviderFactory<TResult>(options: {\n  authenticator: ProxyAuthenticator<unknown, TResult, unknown>;\n  profileTransform?: ProfileTransform<TResult>;\n  signInResolver?: SignInResolver<TResult>;\n  signInResolverFactories?: Record<string, SignInResolverFactory>;\n}): AuthProviderFactory {\n  return ctx => {\n    const signInResolver =\n      options.signInResolver ??\n      readDeclarativeSignInResolver({\n        config: ctx.config,\n        signInResolverFactories: options.signInResolverFactories ?? {},\n      });\n\n    if (!signInResolver) {\n      throw new Error(\n        `No sign-in resolver configured for proxy auth provider '${ctx.providerId}'`,\n      );\n    }\n\n    return createProxyAuthRouteHandlers<TResult>({\n      signInResolver,\n      config: ctx.config,\n      authenticator: options.authenticator,\n      resolverContext: ctx.resolverContext,\n      profileTransform: options.profileTransform,\n    });\n  };\n}\n"],"names":["readDeclarativeSignInResolver","createProxyAuthRouteHandlers"],"mappings":";;;;;;;;;AA6BO,SAAS,+BAAwC,OAAA,EAKhC;AACtB,EAAA,OAAO,CAAA,GAAA,KAAO;AACZ,IAAA,MAAM,cAAA,GACJ,OAAA,CAAQ,cAAA,IACRA,2DAAA,CAA8B;AAAA,MAC5B,QAAQ,GAAA,CAAI,MAAA;AAAA,MACZ,uBAAA,EAAyB,OAAA,CAAQ,uBAAA,IAA2B;AAAC,KAC9D,CAAA;AAEH,IAAA,IAAI,CAAC,cAAA,EAAgB;AACnB,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,CAAA,wDAAA,EAA2D,IAAI,UAAU,CAAA,CAAA;AAAA,OAC3E;AAAA,IACF;AAEA,IAAA,OAAOC,qDAAA,CAAsC;AAAA,MAC3C,cAAA;AAAA,MACA,QAAQ,GAAA,CAAI,MAAA;AAAA,MACZ,eAAe,OAAA,CAAQ,aAAA;AAAA,MACvB,iBAAiB,GAAA,CAAI,eAAA;AAAA,MACrB,kBAAkB,OAAA,CAAQ;AAAA,KAC3B,CAAA;AAAA,EACH,CAAA;AACF;;;;"}