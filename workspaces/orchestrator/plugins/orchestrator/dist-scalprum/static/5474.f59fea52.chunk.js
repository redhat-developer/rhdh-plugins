(self.webpackChunkred_hat_developer_hub_backstage_plugin_orchestrator=self.webpackChunkred_hat_developer_hub_backstage_plugin_orchestrator||[]).push([[5474],{86112:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Router:()=>br});var s=r(31085),o=r(42469),n=r(34753),a=r(45274),i=r(16454),l=r(9490),d=r(42899),c=r(56288),u=r(95478),m=r(75202),h=r(64095),p=r(27297),f=r(19996),x=r(59679),j=r(29082),v=r(59642),w=r(98728),g=r(42848);const b=({message:e,params:t})=>{const{t:r}=(0,g.B)();return r(e,t)};var k=r(62414),A=r(81252),y=r(13674),S=r(1321);const C=(0,S.n9)()((e=>({root:{display:"flex",flexDirection:"column",alignItems:"baseline","& label + div":{marginTop:"0px"}},select:{width:"10rem"},label:{color:e.palette.text.primary,fontSize:e.typography.fontSize,paddingRight:"0.5rem",fontWeight:"bold"}}))),I="___all___",R=({includeAll:e=!0,...t})=>{const{classes:r}=C(),o=(0,u.useMemo)((()=>e?[{label:"All",value:I},...t.items]:t.items),[e,t.items]),n=(0,u.useCallback)((e=>t.onChange(e)),[t]);return(0,s.jsxs)("div",{className:r.root,children:[(0,s.jsx)(y.A,{className:r.label,children:t.label}),(0,s.jsx)("div",{className:r.select,children:(0,s.jsx)(A.w,{onChange:n,items:o,selected:t.selected,margin:"dense",label:t.label})})]})};R.displayName="Selector",R.AllItems=I;var N=r(72834),O=r(83474),D=r(99420),E=r.n(D),W=r(86188),$=r(46702),T=r(91353),B=r(16552),P=r(10302),F=r(6977),L=r(12653);const _=({open:e,onClose:t,instanceVariables:r})=>{const{t:o}=(0,g.B)(),n=(0,P.h)(),a=Object.keys(r).length>0;return(0,s.jsx)(F.T,{title:o("run.variables"),onClose:t,open:e,dialogActions:(0,s.jsx)(T.A,{color:"primary",variant:"contained",onClick:t,children:o("common.close")}),wideDialog:!0,children:a?Object.entries(r).map((([e,t])=>(0,s.jsxs)($.A,{mt:2,mb:2,children:[(0,s.jsx)(y.A,{variant:"h6",mb:1,children:(0,B.Z)(e)}),(0,s.jsx)(L.l,{isDarkMode:n,value:t})]},e))):(0,s.jsx)(y.A,{children:o("messages.noVariablesFound")})})};var M=r(96872),z=r(99424),Q=r(22329);const U=({className:e,value:t,loading:r,responseError:o,cardClassName:n})=>{const{t:a}=(0,g.B)(),i=null==t?void 0:t.data;return(0,s.jsxs)(p.n,{title:a("run.inputs"),subheader:!r&&!o&&!i&&(0,s.jsx)("i",{children:a("messages.workflowInstanceNoInputs")}),divider:!1,className:e,cardClassName:n,children:[r?(0,s.jsx)(M.k,{}):null,!r&&o&&(0,s.jsx)(z._,{error:o}),!r&&!o&&i&&(0,s.jsx)(Q.t,{dense:!0,metadata:i})]})};U.displayName="WorkflowInputs";const H=e=>null!=e,V=(e,t)=>{const r=E()(e.enter),s=E()(t.enter);if(r.isBefore(s))return-1;if(r.isAfter(s))return 1;if(H(e.exit)&&H(t.exit)){const r=E()(e.exit),s=E()(t.exit);if(r.isBefore(s))return-1;if(r.isAfter(s))return 1}else{if(H(e.exit))return-1;if(H(t.exit))return 1}return e.id<t.id?-1:e.id>t.id?1:0},Y=e=>{var t;return(0,s.jsx)(y.A,{style:{marginTop:"14px",marginBottom:"14px"},variant:null!==(t=e.variant)&&void 0!==t?t:"body2",component:"p",children:e.children})};var X=r(53273),J=r.n(X),q=r(73360),G=r(82308),Z=r(74618),K=r(81411),ee=r(30778),te=r(36210),re=r(29103);const se=({status:e,error:t})=>{const{t:r}=(0,g.B)(),o=(0,re.R)(e);switch(e){case j.oR.Error:var n;return(0,s.jsx)(te.A,{title:null!==(n=null==t?void 0:t.message)&&void 0!==n?n:r("messages.additionalDetailsAboutThisErrorAreNotAvailable"),children:(0,s.jsx)(Z.A,{className:o})});case j.oR.Completed:return(0,s.jsx)(te.A,{title:r("tooltips.completed"),children:(0,s.jsx)(G.A,{className:o})});case j.oR.Active:return(0,s.jsx)(te.A,{title:r("tooltips.active"),children:(0,s.jsx)(K.A,{className:o})});case j.oR.Aborted:return(0,s.jsx)(te.A,{title:r("tooltips.aborted"),children:(0,s.jsx)(q.A,{className:o})});case j.oR.Suspended:return(0,s.jsx)(te.A,{title:r("tooltips.suspended"),children:(0,s.jsx)(ee.A,{className:o})});case j.oR.Pending:return(0,s.jsx)(te.A,{title:r("tooltips.pending"),children:(0,s.jsx)(K.A,{className:o})});default:return null}};se.displayName="WorkflowProgressNodeIcon";const oe=({model:e})=>(0,s.jsxs)(Y,{children:[(0,s.jsxs)(y.A,{style:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(se,{status:e.status,error:e.error}),(0,s.jsx)(y.A,{style:{paddingLeft:"8px"},children:e.name})]}),(0,s.jsx)("small",{style:{paddingLeft:"32px",color:"grey"},children:e.exit?(0,s.jsx)(J(),{fromNow:!0,children:new Date(`${e.exit}`)}):v.vY})]});oe.displayName="WorkflowProgressNode";const ne=(e,t)=>(r,s,o)=>{const n=s===o.length-1,a={...r,status:e,enter:r.enter};return H(r.exit)&&(a.exit=r.exit),r.definitionId===(null==t?void 0:t.nodeDefinitionId)?(a.status=j.oR.Error,a.error=t):r.enter&&r.exit?a.status=j.oR.Completed:r.exit||(a.status=j.oR.Active),e&&n&&(e===j.oR.Aborted||e===j.oR.Suspended)&&(a.status=e),a},ae=({workflowStatus:e,workflowError:t,workflowNodes:r,emptyState:o})=>{const{t:n}=(0,g.B)(),a=o||(0,s.jsx)(Y,{children:n("messages.noDataAvailable")});return(0,s.jsx)(s.Fragment,{children:0===r.length?a:structuredClone(r).sort(V).map(ne(e,t)).map((e=>(0,s.jsx)(oe,{model:e},e.id)))})};ae.displayName="WorkflowProgress";var ie=r(24611),le=r(81491),de=r(6298),ce=r(65706),ue=r(47566),me=r(96452),he=r(89789);const pe="instanceId";function fe(e,t){if(!t||0===Object.keys(t).length)return e;const r=Object.entries(t).filter((([,e])=>void 0!==e)).map((([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&");return r?`${e}?${r}`:e}var xe=r(54148),je=r(98400),ve=r(83920),we=r(11610),ge=r(2190),be=r(30330);const ke=(0,S.n9)()((()=>({closeBtn:{position:"absolute",right:8,top:8}}))),Ae=(e,t)=>{const{t:r}=(0,g.B)(),{workflow:n,open:a=!1,onClose:i,runWorkflowLink:l,workflowError:d}=e,{classes:c}=ke(),u=(0,o.useNavigate)();let m;return m=d?(0,s.jsxs)($.A,{children:[(0,s.jsx)(y.A,{paragraph:!0,children:r("workflow.errors.failedToLoadDetails",{id:d.itemId})}),d.error.message&&(0,s.jsx)(y.A,{paragraph:!0,children:d.error.message})]}):n.description?(0,s.jsx)($.A,{children:n.description}):(0,s.jsx)($.A,{children:(0,s.jsx)(y.A,{paragraph:!0,children:r("workflow.messages.areYouSureYouWantToRunThisWorkflow")})}),(0,s.jsxs)(je.A,{onClose:e=>i,open:a,ref:t,maxWidth:"sm",fullWidth:!0,children:[(0,s.jsx)(ge.A,{children:(0,s.jsxs)($.A,{children:[(0,s.jsx)(y.A,{variant:"h5",children:n.name}),(0,s.jsx)(be.A,{className:c.closeBtn,"aria-label":"close",onClick:i,children:(0,s.jsx)(xe.A,{})})]})}),(0,s.jsx)(we.A,{children:m}),(0,s.jsxs)(ve.A,{children:[(0,s.jsx)(T.A,{onClick:()=>{l&&u(l)},color:"primary",variant:"contained",disabled:!!d,children:r("workflow.buttons.runWorkflow")}),(0,s.jsx)(T.A,{onClick:i,color:"primary",variant:"outlined",children:r("common.close")})]})]})},ye=(0,u.forwardRef)(Ae),Se=(0,S.n9)()((e=>({outputGrid:{"& h2":{textTransform:"none",fontSize:"small"}},links:{padding:"0px"},values:{"& tr > td":{paddingLeft:"0px"}},errorIcon:{color:e.palette.error.main}}))),Ce=[j.oR.Error,j.oR.Completed,j.oR.Suspended],Ie=({status:e,error:t,resultMessage:r,executionSummary:o})=>{const{t:n}=(0,g.B)(),a=(null==t?void 0:t.message)||(null==t?void 0:t.toString()),i=null!=o?o:[],l=e=>{const t=i.find((t=>t.includes(e)));if(!t)return[""];const r=t.match(/(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z)/);if(!r)return[""];const s=new Date(r[1]).toLocaleString();return"waiting"===e?[s,t]:[`at ${s}`]};let d;if(t)d=e===j.oR.Completed?{title:(0,s.jsx)(b,{message:"run.status.completedWithMessage",params:{time:l("completed")}}),message:a,severity:"warning"}:{title:(0,s.jsx)(b,{message:"run.status.failed",params:{time:l("failed")}}),message:a,severity:"error"};else if(e===j.oR.Aborted)d={title:"Run has aborted",message:"",severity:"info"};else if(e&&Ce.includes(e)){let e=n("run.status.noAdditionalInfo");r&&(e=(0,s.jsx)(ie.h,{content:r})),d={title:(0,s.jsx)(b,{message:"run.status.completedAt",params:{time:l("completed")}}),message:e,severity:"success"}}else{const e=(()=>{const[e,t]=l("waiting");if(t){const o=t.match(/node (\S+) since/);var r;const n=null!==(r=null==o?void 0:o[1])&&void 0!==r?r:"unknown";return(0,s.jsx)(b,{message:"run.status.runningWaitingAtNode",params:{node:n,formattedTime:e}})}const[o]=l("started");return""!==o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ue.A,{size:"0.75rem"})," ",(0,s.jsx)(b,{message:"run.status.workflowIsRunning",params:{startedTime:o}})]}):""})();d={title:(0,s.jsx)(s.Fragment,{children:e}),message:n("run.status.resultsWillBeDisplayedHereOnceTheRunIsComplete"),severity:"info"}}return(0,s.jsx)($.A,{sx:{width:"100%"},children:(0,s.jsxs)(de.A,{severity:d.severity,children:[(0,s.jsx)(ce.A,{children:d.title}),d.message]})})},Re=({instanceId:e,nextWorkflows:t})=>{const{t:r}=(0,g.B)(),{classes:o}=Se(),a=(0,l.useApi)(c.k),i=(0,l.useRouteRef)(n.TO),[d,h]=(0,u.useState)(""),[p,x]=(0,u.useState)({}),[j,v]=(0,u.useState)(),w=(0,u.useMemo)((()=>fe(i({workflowId:d}),{[pe]:e})),[d,i,e]),b=(0,u.useCallback)((e=>{e&&(a.getWorkflowOverview(e).then((e=>{x(e.data)})).catch((t=>{v({itemId:e,error:t})})),h(e))}),[a]),k=(0,u.useCallback)((()=>{h(""),x({})}),[]);if(!(null==t?void 0:t.length))return null;const A=1===t.length?r("run.suggestedNextWorkflow"):r("run.suggestedNextWorkflows");return(0,s.jsxs)(f.Ay,{item:!0,xs:12,className:o.outputGrid,children:[(0,s.jsx)(le.Q,{label:A,children:(0,s.jsx)(me.A,{dense:!0,disablePadding:!0,children:t.map((e=>(0,s.jsx)(he.Ay,{disableGutters:!0,children:(0,s.jsx)(m.N_,{color:"primary",to:"#",onClick:()=>{b(e.id)},children:e.name})},e.id)))})}),(0,s.jsx)(ye,{workflow:p,workflowError:j,runWorkflowLink:w,open:!!d,onClose:k})]})},Ne=({outputs:e})=>{const{t}=(0,g.B)(),{classes:r}=Se();if(!(null==e?void 0:e.length))return null;const o=null==e?void 0:e.filter((e=>"link"===e.format)),n=null==e?void 0:e.filter((e=>"markdown"===e.format)),a=(null==e?void 0:e.filter((e=>"link"!==e.format&&"markdown"!==e.format))).reduce(((e,t)=>{let r=t.value||"";return["string","number","boolean"].includes(typeof r)||(r=Array.isArray(r)?JSON.stringify(r):"object"==typeof r?`Object: ${JSON.stringify(r)}`:"Unexpected type"),{...e,[t.key]:r}}),{});return(0,s.jsxs)(s.Fragment,{children:[(null==o?void 0:o.length)>0&&(0,s.jsx)(f.Ay,{item:!0,md:12,className:r.links,children:(0,s.jsx)(le.Q,{label:t("common.links"),children:(0,s.jsx)(me.A,{dense:!0,disablePadding:!0,children:o.filter((e=>e.value&&e.key&&"string"==typeof e.value)).map((e=>(0,s.jsx)(he.Ay,{disableGutters:!0,children:(0,s.jsx)(m.N_,{to:e.value,children:e.key})},e.key)))})})},"__links"),(Object.keys(a).length>0||(null==n?void 0:n.length)>0)&&(0,s.jsx)(f.Ay,{item:!0,md:12,className:r.values,children:(0,s.jsxs)(le.Q,{label:t("common.values"),children:[(null==n?void 0:n.length)>0&&n.map((e=>(0,s.jsx)(ie.h,{content:e.value},e.key))),Object.keys(a).length>0&&(0,s.jsx)(Q.t,{dense:!0,metadata:a})]})},"non__links")]})},Oe=({instance:e,className:t,cardClassName:r})=>{var o;const{t:n}=(0,g.B)(),a=null===(o=e.workflowdata)||void 0===o?void 0:o.result;return(0,s.jsx)(p.n,{title:n("run.results"),subheader:(0,s.jsx)(Ie,{status:e.state,error:e.error,resultMessage:null==a?void 0:a.message,executionSummary:e.executionSummary}),divider:!1,className:t,cardClassName:r,children:(0,s.jsxs)(f.Ay,{container:!0,alignContent:"flex-start",spacing:"1rem",children:[(0,s.jsx)(Re,{instanceId:e.id,nextWorkflows:null==a?void 0:a.nextWorkflows}),(0,s.jsx)(Ne,{outputs:null==a?void 0:a.outputs})]})})};Oe.displayName="WorkflowResult";var De=r(86180),Ee=r(10394),We=r(93676);const $e=(0,S.n9)()((e=>({workflowId:{"& > div":{width:"80%"},"& > button":{maxHeight:"20px"}}}))),Te=({details:e})=>{const{t}=(0,g.B)(),{classes:r}=$e(),o=(0,l.useApi)(c.k),{value:i,loading:d,error:u}=(0,a.A)((async()=>(await o.getWorkflowOverview(e.workflowId)).data),[o]),h=(0,l.useRouteRef)(n.WX);var p;return(0,s.jsxs)(f.Ay,{container:!0,alignContent:"flex-start",spacing:"1rem",children:[(0,s.jsx)(f.Ay,{item:!0,md:7,children:(0,s.jsx)(le.Q,{label:t("workflow.fields.workflow"),children:(0,s.jsx)(m.N_,{to:h({workflowId:e.workflowId}),children:(0,s.jsx)(y.A,{variant:"subtitle2",component:"div",children:(0,s.jsx)("b",{children:(0,B.Z)(e.processName)})})})})},"Workflow"),(0,s.jsx)(f.Ay,{item:!0,md:5,children:(0,s.jsx)(le.Q,{label:t("workflow.fields.runStatus"),children:(0,s.jsx)(y.A,{variant:"subtitle2",component:"div",children:(0,s.jsx)("b",{children:(0,s.jsx)(N.k,{status:e.state})})})})},"Run status"),(0,s.jsx)(f.Ay,{item:!0,md:7,children:(0,s.jsx)(le.Q,{label:t("workflow.fields.workflowStatus"),children:(0,s.jsx)(y.A,{variant:"subtitle2",component:"div",children:(0,s.jsx)("b",{children:u||d?v.vY:(0,s.jsx)(We.s,{availability:null==i?void 0:i.isAvailable})})})})},"Workflow Status"),(0,s.jsx)(f.Ay,{item:!0,md:5,children:(0,s.jsx)(le.Q,{label:t("workflow.fields.workflowId"),children:(0,s.jsxs)(Ee.A,{display:"flex",alignItems:"center",className:r.workflowId,children:[(0,s.jsx)(y.A,{variant:"subtitle2",component:"div",overflow:"hidden",noWrap:!0,children:e.id}),(0,s.jsx)(De.l,{text:e.id,tooltipText:t("workflow.fields.workflowIdCopied"),tooltipDelay:2e3})]})})},"Run ID"),(0,s.jsx)(f.Ay,{item:!0,md:7,children:(0,s.jsx)(le.Q,{label:t("workflow.fields.duration"),children:(0,s.jsx)(y.A,{variant:"subtitle2",component:"div",children:(0,s.jsx)("b",{children:e.duration})})})},"Duration"),(0,s.jsx)(f.Ay,{item:!0,md:5,children:(0,s.jsx)(le.Q,{label:t("workflow.fields.started"),children:(0,s.jsx)(y.A,{variant:"subtitle2",component:"div",children:(0,s.jsx)("b",{children:e.start})})})},"Started"),(0,s.jsx)(f.Ay,{item:!0,md:12,children:(0,s.jsx)(le.Q,{label:t("workflow.fields.description"),children:(0,s.jsx)(y.A,{variant:"subtitle2",component:"div",children:(0,s.jsx)("b",{children:null!==(p=e.description)&&void 0!==p?p:v.vY})})})},"Description")]})};Te.displayName="WorkflowDetails";const Be=e=>{const t=e.start?E()(e.start):void 0;let r=v.vY;if(t&&e.end){const s=E()(e.end);r=E().duration(t.diff(s)).humanize()}var s;const o=null!==(s=null==t?void 0:t.toDate().toLocaleString())&&void 0!==s?s:v.vY;return{id:e.id,processName:e.processName||v.vY,workflowId:e.processId,start:o,duration:r,state:e.state,description:e.description}},Pe=(0,S.n9)()((()=>({topRowCard:{height:"24rem"},bottomRowCard:{height:"42rem"},recommendedLabelContainer:{display:"flex",alignItems:"center",whiteSpace:"nowrap"},recommendedLabel:{margin:"0 0.25rem"},cardClassName:{overflow:"auto"},titleContainer:{display:"flex",justifyContent:"space-between",alignItems:"center"}}))),Fe=({instance:e})=>{const{t}=(0,g.B)(),{classes:r}=Pe(),o=(0,l.useApi)(c.k),n=(0,u.useMemo)((()=>Be(e)),[e]),d=null==e?void 0:e.workflowdata;let h={};d&&(h={...d},h.hasOwnProperty("result")&&delete h.result);const x=e.processId,j=e.id,{value:v,loading:w,error:b}=(0,a.A)((async()=>(await o.getWorkflowDataInputSchema(x,j)).data),[o,x]),[k,A]=(0,u.useState)(!1),S=(0,u.useCallback)((()=>{A((e=>!e))}),[]),C=(0,O.J)({permission:W.Uo}).allowed&&(0,s.jsx)(m.N_,{to:"#",onClick:e=>{e.preventDefault(),S()},children:(0,s.jsx)(y.A,{variant:"subtitle2",component:"div",style:{textAlign:"right"},children:(0,s.jsx)("b",{children:t("run.viewVariables")})})});return(0,s.jsxs)(i.U,{noPadding:!0,children:[(0,s.jsx)(_,{open:k,onClose:S,instanceVariables:h}),(0,s.jsxs)(f.Ay,{container:!0,spacing:2,children:[(0,s.jsx)(f.Ay,{item:!0,xs:6,children:(0,s.jsx)(p.n,{title:(0,s.jsxs)("div",{className:r.titleContainer,children:[(0,s.jsx)(y.A,{component:"span",children:t("common.details")}),C]}),divider:!1,className:r.topRowCard,cardClassName:r.cardClassName,children:(0,s.jsx)(Te,{details:n})})}),(0,s.jsx)(f.Ay,{item:!0,xs:6,children:(0,s.jsx)(Oe,{className:r.topRowCard,cardClassName:r.cardClassName,instance:e})}),(0,s.jsx)(f.Ay,{item:!0,xs:6,children:(0,s.jsx)(U,{className:r.bottomRowCard,cardClassName:r.cardClassName,value:v,loading:w,responseError:b})}),(0,s.jsx)(f.Ay,{item:!0,xs:6,children:(0,s.jsx)(p.n,{title:t("workflow.progress"),divider:!1,className:r.bottomRowCard,cardClassName:r.cardClassName,children:(0,s.jsx)(ae,{workflowError:e.error,workflowNodes:e.nodes,workflowStatus:e.state})})})]})]})};Fe.displayName="WorkflowInstancePageContent";const Le=()=>{const{t:e}=(0,g.B)(),t=(e=>[{label:e("table.status.running"),value:j.oR.Active},{label:e("table.status.failed"),value:j.oR.Error},{label:e("table.status.completed"),value:j.oR.Completed},{label:e("table.status.aborted"),value:j.oR.Aborted},{label:e("table.status.pending"),value:j.oR.Suspended}])(e),r=[e("table.filters.startedOptions.today"),e("table.filters.startedOptions.yesterday"),e("table.filters.startedOptions.last7days"),e("table.filters.startedOptions.thisMonth")].map((e=>({label:e,value:e}))),o=(0,l.useRouteRef)(n.XQ),{workflowId:a,kind:i,name:d,namespace:A}=(0,l.useRouteRefParams)(n.tc);let y;i&&A&&d&&(y=`${i}:${A}/${d}`);const S=(0,l.useApi)(c.k),C=(0,l.useRouteRef)(n.Fu),I=(0,l.useRouteRef)(n.WX),[O,D]=(0,u.useState)(R.AllItems),[E,W]=(0,u.useState)(R.AllItems),[$,T]=(0,u.useState)(0),[B,P]=(0,u.useState)(v.bc),[F,L]=(0,u.useState)("start"),[_,M]=(0,u.useState)("desc"),z=(0,u.useCallback)((()=>{const e=a?{operator:"EQ",value:a,field:"processId"}:void 0,t=O!==R.AllItems?{operator:"EQ",value:O,field:"state"}:void 0;let r;if(E!==R.AllItems){let e;const t=new Date,s=new Date(t);switch(s.setHours(23,59,59,999),E){case"Today":{const t=new Date;t.setHours(0,0,0,0),e=[t.toISOString(),s.toISOString()];break}case"Yesterday":{const t=new Date;t.setDate(t.getDate()-1),t.setHours(0,0,0,0);const r=new Date(t);r.setHours(23,59,59,999),e=[t.toISOString(),r.toISOString()];break}case"Last 7 days":{const t=new Date;t.setDate(t.getDate()-7),t.setHours(0,0,0,0),e=[t.toISOString(),s.toISOString()];break}case"This month":{const t=new Date;t.setDate(1),t.setHours(0,0,0,0),e=[t.toISOString(),s.toISOString()];break}default:e=void 0}r=E!==R.AllItems?{operator:"BETWEEN",value:e,field:"start"}:void 0}const s=[t,e,r,y?{field:"variables",nested:{operator:"EQ",value:y,field:"targetEntity"}}:void 0].filter(Boolean);return s.length>1?{operator:"AND",filters:s}:s[0]||void 0}),[a,O,E,y]),Q=(0,u.useCallback)((async()=>{var e;const t={pageSize:B+1,offset:$*B,orderBy:F,orderDirection:"asc"===_?j.QW.Asc:j.QW.Desc},r=z();return(null===(e=(await S.listInstances(t,r)).data.items)||void 0===e?void 0:e.map(Be))||[]}),[S,$,B,F,_,z]),{loading:U,error:H,value:V}=(0,w.A)(Q),Y=(0,u.useCallback)(((e,t)=>{if(!V)return 0;const r=null==V?void 0:V.findIndex((t=>t.id===e.id)),s=null==V?void 0:V.findIndex((e=>e.id===t.id));return"asc"===_?r-s:s-r}),[V,_]),X=(0,u.useMemo)((()=>[{title:"ID",field:"id",render:e=>y?(0,s.jsx)(m.N_,{to:o({namespace:A,kind:i,name:d,workflowId:a,instanceId:e.id}),children:e.id}):(0,s.jsx)(m.N_,{to:C({instanceId:e.id}),children:e.id}),sorting:!1},...a?[]:[{title:e("table.headers.workflowName"),field:"processName",customSort:Y,render:e=>(0,s.jsx)(m.N_,{to:I({workflowId:e.workflowId}),children:e.processName})}],{title:e("table.headers.runStatus"),field:"state",render:e=>(0,s.jsx)(N.k,{status:e.state})},{title:e("table.headers.started"),field:"start",customSort:Y},{title:e("table.headers.duration"),field:"duration",sorting:!1}]),[e,C,a,I,Y,o,d,i,A,y]);let J=V||[],q=!1;J.length===B+1&&(q=!0,J=J.slice(0,-1));const G=$>0||q;return H?(0,s.jsx)(h.b,{error:H}):(0,s.jsxs)(f.Ay,{container:!0,item:!0,xs:12,spacing:2,children:[(0,s.jsxs)(f.Ay,{item:!0,children:[(0,s.jsx)(R,{label:e("table.filters.status"),items:t,onChange:e=>{D(e),T(0)},selected:O}),(0,s.jsx)(R,{label:e("table.filters.started"),items:r,onChange:e=>{W(e),T(0)},selected:E})]}),(0,s.jsx)(f.Ay,{item:!0,xs:!0,style:{flexGrow:1},children:(0,s.jsxs)(p.n,{noPadding:!0,title:a?(0,s.jsx)(b,{message:"table.title.allWorkflowRuns",params:{count:J.length}}):(0,s.jsx)(b,{message:"table.title.allRuns",params:{count:J.length}}),children:[(0,s.jsx)(k.A,{removeOutline:!0,isLoading:U,columns:X,data:J,options:{paging:!1},onOrderChange:(e,t)=>{const r=X[e].field;if(!r)throw new Error(`Failed to find column number ${e}`);L(r),M(t)},components:{Toolbar:()=>(0,s.jsx)(s.Fragment,{})}}),G&&(0,s.jsx)(x.A,{component:"div",count:-1,page:$,onPageChange:(e,t)=>T(t),onRowsPerPageChange:e=>{P(parseInt(e.target.value,10)),T(0)},rowsPerPage:B,labelDisplayedRows:({from:e})=>`${e}-${e+J.length-1}`,rowsPerPageOptions:[5,10,20],nextIconButtonProps:{disabled:!q}})]})})]})};var _e=r(82326),Me=r(99301);const ze=({title:e,subtitle:t,type:r,typeLink:o,noPadding:n,children:a})=>(0,s.jsxs)(_e.Y,{themeId:"tool",children:[(0,s.jsx)(Me.Y,{title:e,subtitle:t,type:r,typeLink:o}),(0,s.jsx)(i.U,{noPadding:n,children:a})]});var Qe=r(22854),Ue=r(45275);const He=({isAvailable:e,entityRef:t})=>{const{t:r}=(0,g.B)(),{workflowId:a}=(0,l.useRouteRefParams)(n.WX),i=(0,o.useNavigate)(),d=(0,l.useRouteRef)(n.TO),{loading:c,allowed:u}=(0,Ue.U)([W.ox,(0,W.qg)(a)]);let m="";return u?e||(m=r("workflow.messages.workflowDown")):m=r("workflow.messages.userNotAuthorizedExecute"),(0,s.jsx)(f.Ay,{item:!0,container:!0,justifyContent:"flex-end",xs:12,spacing:2,children:(0,s.jsx)(f.Ay,{item:!0,children:c?(0,s.jsx)(Qe.A,{variant:"text",width:"5rem"}):(0,s.jsx)(te.A,{title:m,disableHoverListener:""===m,children:(0,s.jsx)(T.A,{variant:"contained",color:"primary",onClick:()=>{i(t?`${d({workflowId:a})}?targetEntity=${t}`:d({workflowId:a}))},disabled:!u,children:r("workflow.buttons.run")})})})})};var Ve=r(73638);const Ye=(0,S.n9)()((e=>({codeSnippetCOntainer:{"& pre":{backgroundColor:"transparent !important"}}}))),Xe=({format:e,loadingWorkflowSource:t,workflowSource:r,errorWorkflowSource:o})=>{const{classes:n}=Ye();return(0,s.jsxs)(s.Fragment,{children:[o&&(0,s.jsx)(h.b,{error:o}),!t&&!o&&(0,s.jsx)("div",{className:n.codeSnippetCOntainer,children:(0,s.jsx)(Ve.z,{text:r,language:e,showLineNumbers:!0,showCopyCodeButton:!0})})]})};var Je=r(95079);const qe=(0,S.n9)()((()=>({details:{overflowY:"auto",minHeight:"10rem",maxHeight:"15rem"}}))),Ge=({loading:e,workflowOverview:t})=>{const{t:r}=(0,g.B)(),{classes:o}=qe(),n=(0,u.useMemo)((()=>t?Je.A.format(t):void 0),[t]);return(0,s.jsx)(p.n,{title:r("workflow.details"),className:o.details,children:(0,s.jsxs)(f.Ay,{container:!0,spacing:7,alignContent:"flex-start",wrap:"nowrap",children:[(0,s.jsx)(f.Ay,{item:!0,children:(0,s.jsx)(le.Q,{label:r("workflow.fields.workflowStatus"),value:null==n?void 0:n.availability,children:e?(0,s.jsx)(Qe.A,{variant:"text"}):(0,s.jsx)("b",{children:(0,s.jsx)(We.s,{availability:null==n?void 0:n.availability})})})},"workflow status"),(0,s.jsx)(f.Ay,{item:!0,md:7,children:(0,s.jsx)(le.Q,{label:r("workflow.fields.description"),value:null==n?void 0:n.description,children:e?(0,s.jsx)(Qe.A,{variant:"text"}):null==n?void 0:n.description})})]})})},Ze=({loadingWorkflowOverview:e,workflowOverviewDTO:t,errorWorkflowOverview:r})=>{const{t:o}=(0,g.B)(),i=(0,O.J)({permission:W.Uo}),{workflowId:d}=(0,l.useRouteRefParams)(n.WX),u=(0,l.useApi)(c.k),{loading:m,value:h,error:x}=(0,a.A)((()=>u.getWorkflowSource(d)),[]),{kind:j,name:v,namespace:w}=(0,l.useRouteRefParams)(n.tc);let b;return j&&w&&v&&(b=`${j}:${w}/${v}`),(0,s.jsxs)(f.Ay,{container:!0,item:!0,direction:"column",xs:12,spacing:2,wrap:"nowrap",children:[r&&(0,s.jsx)(f.Ay,{item:!0,children:(0,s.jsx)(z._,{error:r})}),(0,s.jsx)(f.Ay,{item:!0,children:(0,s.jsx)(Ge,{workflowOverview:t,loading:e})}),t&&i.allowed&&h&&!b&&(0,s.jsx)(f.Ay,{item:!0,children:(0,s.jsx)(p.n,{title:o("workflow.definition"),children:(0,s.jsx)(Xe,{format:t.format,loadingWorkflowSource:m,workflowSource:h.data,errorWorkflowSource:x})})})]})},Ke=()=>{const{workflowId:e,kind:t,name:r,namespace:o}=(0,l.useRouteRefParams)(n.tc),u=(0,l.useApi)(c.k),{value:m,loading:h,error:p}=(0,a.A)((()=>u.getWorkflowOverview(e)),[]);return(0,s.jsx)(ze,{title:(null==m?void 0:m.data.name)||e,type:r,typeLink:`/catalog/${o}/${t}/${r}/workflows`,noPadding:!0,children:(0,s.jsx)(i.U,{children:(0,s.jsxs)(d.A,{container:!0,spacing:2,children:[(0,s.jsx)(d.A,{item:!0,xs:12,children:(0,s.jsx)(He,{isAvailable:null==m?void 0:m.data.isAvailable,entityRef:`${t}:${o}/${r}`})}),(0,s.jsx)(d.A,{item:!0,xs:12,children:(0,s.jsx)(Ze,{loadingWorkflowOverview:h,workflowOverviewDTO:null==m?void 0:m.data,errorWorkflowOverview:p})}),(0,s.jsx)(d.A,{item:!0,xs:12,children:(0,s.jsx)(Le,{})})]})})})};var et=r(86946),tt=r(46108),rt=r.n(tt),st=r(46123),ot=r.n(st),nt=r(82451),at=r.n(nt),it=r(41263),lt=r.n(it);const dt=(e,t)=>{const r=e.replace(/^#\//,"").replace(/\//g,".");return ot()(t,r)},ct=e=>e.startsWith(".")?e.slice(1):e;function ut(e){return Array.isArray(e)?[...e].map((e=>e?ut(e):{})):e&&"object"==typeof e?Object.keys(e).reduce(((t,r)=>(t[r]=ut(e[r]),t)),{}):e}function mt(e){const t=e,r={},s=(e,r)=>{"boolean"!=typeof e&&(e.$ref?s(dt(e.$ref,t),r):e.properties?((e,t)=>{for(const[r,o]of Object.entries(e))s(o,`${t}.${r}`)})(e.properties,r):e.items?i(e,r):n(e,r),o(e,r),l(e,r))},o=(e,t)=>{const s=ot()(e,"ui:order");if(s){const e={};lt()(e,ct(`${t}.ui:order`),s),at()(r,e)}},n=(e,t)=>{for(const[s,o]of Object.entries(e))s.startsWith("ui:")&&lt()(r,ct(`${t}.${s}`),o)},a=(e,t)=>{for(let r=0;r<e.length;++r)s(e[r],`${t}[${r}]`)},i=(e,t)=>{Array.isArray(e.items)?a(e.items,`${t}.items`):"object"==typeof e.items&&s(e.items,`${t}.items`),e.additionalItems&&"object"==typeof e.additionalItems&&s(e.additionalItems,`${t}.additinalItems`),n(e,t)},l=(e,t)=>{e.anyOf?a(e.anyOf,`${t}.anyOf`):e.oneOf?a(e.oneOf,`${t}.oneOf`):e.allOf?a(e.allOf,`${t}.allOf`):e.then&&(s(e.then,`${t}`),e.else&&s(e.else,`${t}`))};return s(e,""),ut(r)}const ht=(0,u.createContext)(null),pt=()=>{const e=(0,u.useContext)(ht);if(!e)throw new Error("Context StepperContext is not defined");return e},ft=({children:e,reviewStep:t,t:r})=>{const[o,n]=(0,u.useState)(0),[a,i]=(0,u.useState)(!1),l=(0,u.useMemo)((()=>({activeStep:o,handleNext:()=>{n((e=>e+1))},handleBack:()=>n((e=>e-1)),reviewStep:t,isValidating:a,handleValidateStarted:()=>i(!0),handleValidateEnded:()=>i(!1),t:r})),[r,n,o,t,a,i]);return(0,s.jsx)(ht.Provider,{value:l,children:e})};var xt=r(13441),jt=r(94384),vt=r(3326),wt=r.n(vt);const gt=new class{getFormDecorator(){return console.log("Using the Orchestrator DefaultFormApi (without additional extensions)."),e=>t=>(0,s.jsx)(e,{formContext:t})}},bt=(0,l.createApiRef)({id:"plugin.orchestrator.form"}),kt=()=>({t:pt().t}),At=e=>{if(!e.properties)return;let t=Object.entries(e.properties);const r=ot()(e,"ui:order");return r&&r.length>0&&(t=r.map((t=>{var r;return(null===(r=e.properties)||void 0===r?void 0:r[t])?[t,e.properties[t]]:void 0})).filter(Boolean),Object.entries(e.properties).forEach((([e,s])=>{r.includes(e)||t.push([e,s])}))),t},yt=(e,t)=>{var r,s;const o=null===(r=(null!==(s=At(e))&&void 0!==s?s:[])[t])||void 0===r?void 0:r[0];if(!o)throw new Error(`Active step key not found for activeStep: ${t} in schema: ${JSON.stringify(e)}`);return o};var St=r(51632),Ct=r(94403);const It=e=>{var t,r;const o=null===(t=e.formContext)||void 0===t?void 0:t.setAuthTokenDescriptors;var n;const a=null!==(n=null===(r=e.options)||void 0===r?void 0:r.props)&&void 0!==n?n:{};return(0,u.useEffect)((()=>{o&&o(a.authTokenDescriptors||[])}),[o,a.authTokenDescriptors]),(0,s.jsx)(s.Fragment,{})};var Rt=r(94133),Nt=r(82074),Ot=r(90624),Dt=r(76801);const Et=({submitting:e,handleClick:t,children:r,focusOnMount:o})=>{const n=(0,u.useRef)(null);return(0,u.useEffect)((()=>{var e;o&&(null===(e=n.current)||void 0===e||e.focus())}),[o]),(0,s.jsx)(T.A,{ref:n,variant:"contained",color:"primary",onClick:t,disabled:e,type:"submit",startIcon:e?(0,s.jsx)(ue.A,{size:"1rem"}):null,disableRipple:!0,children:r})},Wt=(0,S.n9)()((e=>({step:{".Mui-disabled":{backgroundColor:"inherit !important"}},regularButton:{backgroundColor:"inherit !important"},footer:{display:"flex",flexDirection:"row",justifyContent:"right",marginTop:e.spacing(2)},formWrapper:{padding:e.spacing(2)}}))),$t=()=>{const{t:e}=kt(),{activeStep:t,handleBack:r,isValidating:o}=pt(),{classes:n}=Wt();return(0,s.jsxs)("div",{className:n.footer,children:[(0,s.jsx)(T.A,{disabled:0===t,onClick:r,className:n.regularButton,children:e("common.back")}),(0,s.jsx)(Et,{submitting:o,children:e("common.next")})]})},Tt=({steps:e})=>{const{t}=kt(),{classes:r}=Wt(),{activeStep:o,reviewStep:n}=pt(),a=[...e,{content:n,title:t("common.review"),key:"review"}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Dt.A,{activeStep:o,variant:"elevation",style:{overflowX:"auto"},alternativeLabel:!0,children:null==a?void 0:a.map(((e,t)=>(0,s.jsx)(Nt.A,{className:r.step,children:(0,s.jsx)(Ot.A,{"aria-label":`Step ${t+1} ${e.title}`,"aria-disabled":"false",tabIndex:0,children:(0,s.jsx)(y.A,{variant:"h6",component:"h2",children:e.title})})},e.key)))}),(0,s.jsx)("div",{className:r.formWrapper,children:a[o].content})]})},Bt=({formData:e,schema:t,uiSchema:r,onChange:o,registry:n,idSchema:a,errorSchema:i,...l})=>{const{t:d}=kt(),c=(0,u.useMemo)((()=>At(t)),[t]);if(void 0===c)throw new Error(d("stepperObjectField.error"));const m=c.reduce(((t,[d,c])=>"boolean"==typeof c?t:[...t,{content:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Rt.A,{...l,schema:{...c,title:""},uiSchema:(null==r?void 0:r[d])||{},formData:(null==e?void 0:e[d])||{},onChange:t=>{o({...e,[d]:t})},idSchema:a[d],registry:{...n,fields:{...n.fields,ObjectField:Rt.A}},errorSchema:null==i?void 0:i[d]}),(0,s.jsx)($t,{})]}),title:c.title||d,key:d}]),[]);return(0,s.jsx)(Tt,{steps:m})},Pt=(0,xt.SL)(jt.Sx),Ft=e=>{const t=e.formContext,[r,o]=(0,u.useState)(),n=null==t?void 0:t.numStepsInMultiStepSchema,a=void 0!==n,{handleNext:i,activeStep:l,handleValidateStarted:d,handleValidateEnded:c}=pt(),[m,p]=(0,u.useState)(),x=(e=>{const{activeStep:t}=pt();return{activeStep:t,validateFormData:(r,s,o)=>{let n=Ct.Ay.validateFormData(r,s);if(o){const e=o(r,(0,St.JF)(r)),t=(0,St.fV)(e);n=(0,St.k6)(n,t)}if(!e)return n;const a=yt(s,t);return{errors:n.errors.filter((e=>{var t;return null===(t=e.property)||void 0===t?void 0:t.startsWith(`.${a}.`)})),errorSchema:n.errorSchema[a]||{}}},toErrorList:(e,t)=>Ct.Ay.toErrorList(e,t),isValid:(e,t,r)=>Ct.Ay.isValid(e,t,r),rawValidation:(e,t)=>Ct.Ay.rawValidation(e,t)}})(a),{t:j}=kt();if(!t)return(0,s.jsx)("div",{children:j("formDecorator.error")});const{uiSchema:v,schema:w,onSubmit:g,children:b,formData:k,setFormData:A}=t;return(0,s.jsxs)(f.Ay,{container:!0,spacing:2,direction:"column",wrap:"nowrap",children:[m&&(0,s.jsx)(f.Ay,{item:!0,children:(0,s.jsx)(h.b,{error:m})}),(0,s.jsx)(f.Ay,{item:!0,children:(0,s.jsx)(Pt,{...wt()(e,"getExtraErrors"),widgets:{AuthRequester:It,...e.widgets},fields:a?{ObjectField:Bt}:{},uiSchema:v,validator:x,schema:w,formData:k,formContext:t,noHtml5Validate:!0,extraErrors:r,onSubmit:t=>(async t=>{let r,s;if(o(void 0),e.getExtraErrors)try{d(),r=await e.getExtraErrors(k,v);const t=(()=>{if(a)return yt(w,l)})();o(t&&(null==r?void 0:r[t])?r[t]:r)}catch(e){s=e}finally{c()}p(s),r&&0!==Object.keys(r).length||s||!(l<(null!=n?n:1))||(g(t),i())})(t.formData||{}),onChange:t=>{A(t.formData||{}),e.onChange&&e.onChange(t)},children:b})})]})},Lt=e=>{const t=null!==(r=(0,l.useApiHolder)().get(bt))&&void 0!==r?r:gt;var r;const o=(0,u.useMemo)((()=>t.getFormDecorator()(Ft)),[t]);return(0,s.jsx)(o,{...e})};var _t=r(84301),Mt=r(13070);function zt(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Qt(e,t,r,s){const o=new Mt.t0(r),n=""===e?r:o.getSchema({pointer:`#/${e}`,data:s});var a;const i=null!==(a=null==n?void 0:n.title)&&void 0!==a?a:e;if(n){if("password"===n["ui:widget"])return{[i]:"******"};if(zt(t)){const o=Object.entries(t).reduce(((t,[o,n])=>({...t,...Qt(e?`${e}/${o}`:o,n,r,s)})),{});return{[i]:o}}}return{[i]:t}}const Ut=function(e,t){return e.title="",Qt("",t,e,t)[""]},Ht=(0,S.n9)()((e=>({backButton:{marginRight:e.spacing(1)},footer:{display:"flex",flexDirection:"row",justifyContent:"right",marginTop:e.spacing(2)},paper:{"& > table > tbody > tr":{"& > td:nth-child(1)":{minWidth:"10rem",width:"25%"},"& > td:nth-child(2)":{display:"flex",flexDirection:"row",justifyContent:"left"}}}}))),Vt=({busy:e,schema:t,data:r,handleExecute:o})=>{const{t:n}=kt(),{classes:a}=Ht(),{handleBack:l}=pt(),d=(0,u.useMemo)((()=>Ut(t,r)),[t,r]);return(0,s.jsx)(i.U,{noPadding:!0,children:(0,s.jsxs)(_t.A,{square:!0,elevation:0,className:a.paper,children:[(0,s.jsx)(Q.t,{dense:!0,metadata:d}),(0,s.jsx)($.A,{mb:4}),(0,s.jsxs)("div",{className:a.footer,children:[(0,s.jsx)(T.A,{onClick:l,className:a.backButton,disabled:e,children:n("common.back")}),(0,s.jsx)(Et,{handleClick:o,submitting:e,focusOnMount:!0,children:n("common.run")})]})]})})},Yt=e=>{const t=(0,u.useMemo)((()=>{var t;return[{title:null!==(t=e.schema.title)&&void 0!==t?t:"Inputs",key:"schema",content:(0,s.jsx)(Lt,{...e,schema:{...e.schema,title:""},children:(0,s.jsx)($t,{})})}]}),[e]);return(0,s.jsx)(Tt,{steps:t})},Xt=({schema:e,updateSchema:t,handleExecute:r,isExecuting:o,initialFormData:n,setAuthTokenDescriptors:a,t:i})=>{const[l,d]=(0,u.useState)(n?()=>structuredClone(n):{}),[c,m]=(0,u.useState)({}),h=(0,u.useCallback)((e=>!!c[e]),[c]),p=(0,u.useCallback)(((e,t)=>{m((r=>({...r,[e]:t})))}),[]),f=(0,u.useMemo)((()=>(e=>{if("object"==typeof e.properties){const t=Object.entries(e.properties).map((([e,t])=>{const r=ot()(t,"ui:widget");if("boolean"!=typeof t&&"object"===t.type&&"hidden"===r&&t.properties&&0===Object.keys(t.properties).length)return e})).filter(Boolean);if(t.length>0){const r=rt()(e);return t.forEach((e=>{var t;null===(t=r.properties)||void 0===t||delete t[e]})),r}}return e})(e)),[e]),x=(0,u.useMemo)((()=>(e=>{if("object"===e.type&&e.properties)return Object.values(e.properties).every((e=>"object"===e.type))?Object.keys(e.properties).length:void 0})(f)),[f]),j=void 0!==x,v=(0,u.useCallback)((()=>{r(l)}),[l,r]),w=(0,u.useCallback)((e=>{d(e)}),[d]),g=(0,u.useMemo)((()=>((e,t)=>{const r=mt(e);return((e,t,r)=>{if(e.properties){if(!r){const r=Object.keys(e.properties)[0];t[r]={...t[r],"ui:autofocus":!0}}for(const[r,o]of Object.entries(e.properties)){var s;if("object"!=typeof o)return;const n=o.$ref?dt(o.$ref,e):o;if(!n.properties)return;const a=Object.keys(n.properties)[0];t[r]={...t[r],[a]:{...null===(s=t[r])||void 0===s?void 0:s[a],"ui:autofocus":!0}}}}})(e,r,t),r})(f,j)),[f,j]),b=(0,u.useMemo)((()=>(0,s.jsx)(Vt,{data:l,schema:f,busy:o,handleExecute:v})),[l,f,o,v]);return(0,s.jsx)(ft,{reviewStep:b,t:i,children:j?(0,s.jsx)(Lt,{schema:f,updateSchema:t,numStepsInMultiStepSchema:x,onSubmit:w,uiSchema:g,formData:l,setFormData:d,setAuthTokenDescriptors:a,getIsChangedByUser:h,setIsChangedByUser:p,children:(0,s.jsx)(u.Fragment,{})}):(0,s.jsx)(Yt,{schema:f,updateSchema:t,onSubmit:w,uiSchema:g,formData:l,setFormData:d,setAuthTokenDescriptors:a,getIsChangedByUser:h,setIsChangedByUser:p})})},Jt=()=>{const e=(0,l.useApp)(),t=(0,l.useApiHolder)(),r=(0,l.useApi)(l.githubAuthApiRef),s=(0,l.useApi)(l.gitlabAuthApiRef),o=(0,l.useApi)(l.microsoftAuthApiRef),n=(0,u.useCallback)((async(e,t)=>{if("openId"===t.tokenType){if((e=>e&&"getIdToken"in e&&"function"==typeof e.getIdToken)(e))return await e.getIdToken();throw new Error(`${t.provider} auth API does not support OpenID Connect tokens, since it does not implement the getIdToken method`)}if(t.tokenType&&"oauth"!==t.tokenType)throw new Error(`Unsupported token type: ${t.tokenType}. The supported token types are: openId and oauth`);if((e=>e&&"function"==typeof e.getAccessToken)(e))return await e.getAccessToken(t.scope);throw new Error(`${t.provider} auth API does not support OAuth tokens, since it does not implement the getAccessToken method`)}),[]),a=(0,u.useCallback)((async r=>{var s;const o=null===(s=e.getPlugins().flatMap((e=>Array.from(e.getApis()))).find((e=>e.api.id===r)))||void 0===s?void 0:s.api;if(o){const e=t.get(o);if(!e)throw new Error(`API with id "${r}" was not found in the API holder. The API is provided by a plugin.`);return e}const n=t.apis.get(r);if(!n)throw new Error(`API with id "${r}" was not found in the API holder.`);return n}),[e,t]),i=(0,u.useCallback)((async e=>{let t;switch(e.provider.toLocaleLowerCase("en-US")){case"github":t=r;break;case"gitlab":t=s;break;case"microsoft":t=o;break;default:if(!e.customProviderApiId)throw new Error(`Custom authentication provider API id is required for provider: ${e.provider}`);t=await a(e.customProviderApiId)}return{token:await n(t,e),provider:e.provider}}),[r,s,o,a,n]);return{authenticate:(0,u.useCallback)((async t=>{if(!e)throw new Error("App context is required for authentication");const r=[];for(const e of t)r.push(await i(e));return r}),[e,i])}};var qt=r(67457);const Gt=({isExecuting:e,handleExecute:t})=>{const{t:r}=(0,g.B)();return(0,s.jsxs)(f.Ay,{container:!0,spacing:2,children:[(0,s.jsx)(f.Ay,{item:!0,xs:12,children:(0,s.jsxs)(de.A,{severity:"info",style:{width:"100%"},children:[(0,s.jsx)(ce.A,{children:r("messages.missingJsonSchema.title")}),r("messages.missingJsonSchema.message"),(0,s.jsx)("br",{}),"To enable a form-based input, please provide a valid JSON schema in the ",(0,s.jsx)("code",{children:"dataInputSchema"})," property of your workflow definition file."]})}),(0,s.jsx)(f.Ay,{item:!0,xs:12,children:(0,s.jsx)(Et,{submitting:e,handleClick:()=>t({}),children:"Run"})})]})};var Zt=r(46343),Kt=r.n(Zt);const er=(e,t,r)=>{if(!e)return!1;if(e[t])return Kt()(e[t],r)||(e[t]=r),!0;for(const s of Object.keys(e))if("object"==typeof e[s]){const o=e[s].properties;if(er(o,t,r))return!0}return!1},tr=()=>{const{t:e}=(0,g.B)(),[t]=(0,o.useSearchParams)(),r=t.get("targetEntity"),i=(0,l.useApi)(c.k),{authenticate:d}=Jt(),{workflowId:m}=(0,l.useRouteRefParams)(n.TO),[h,x]=(0,u.useState)(!1),[j,v]=(0,u.useState)(),[w]=(0,et.k)(pe),b=(0,o.useNavigate)(),k=(0,l.useRouteRef)(n.Fu),A=(0,l.useRouteRef)(n.XQ),{value:y,loading:S,error:C}=(0,a.A)((async()=>(await i.getWorkflowDataInputSchema(m,w)).data),[i,m]),[I,R]=(0,u.useState)(),[N,O]=(0,u.useState)([]);(0,u.useEffect)((()=>{R(null==y?void 0:y.inputSchema)}),[y]);const D=(0,u.useMemo)((()=>((e,t)=>r=>{if(!(null==e?void 0:e.properties))return;const s=structuredClone(e);for(const[e,t]of Object.entries(r))er(s.properties,e,t);Kt()(e,s)||t(s)})(I,R)),[I]);var E;const W=null!==(E=null==y?void 0:y.data)&&void 0!==E?E:{},{value:$,loading:T,error:B}=(0,a.A)((async()=>(await i.getWorkflowOverview(m)).data.name||""),[i,m]),[P,F,L]=(null==r?void 0:r.split(/[:\/]/))||[],_=(0,u.useCallback)((async e=>{v(void 0);try{x(!0);const t=await d(N),s=await i.executeWorkflow({workflowId:m,parameters:e,authTokens:t,targetEntity:null!=r?r:void 0}),o=r?A({namespace:F,kind:P,name:L,workflowId:m,instanceId:s.data.id}):k({instanceId:s.data.id});b(o)}catch(e){v((e=>(0,qt.b)(e)?e:"string"==typeof e?new Error(e):new Error("Unexpected error"))(e))}finally{x(!1)}}),[i,m,b,k,N,d,r,A,P,F,L]),Q=C||B;let U;return U=S||T||!S&&(null==y?void 0:y.inputSchema)&&!I?(0,s.jsx)(M.k,{}):Q?(0,s.jsx)(z._,{error:Q}):(0,s.jsxs)(f.Ay,{container:!0,spacing:2,direction:"column",wrap:"nowrap",children:[j&&(0,s.jsx)(f.Ay,{item:!0,children:(0,s.jsx)(z._,{error:j})}),(0,s.jsx)(f.Ay,{item:!0,children:(0,s.jsx)(p.n,{title:e("run.title"),children:I?(0,s.jsx)(Xt,{schema:I,updateSchema:D,handleExecute:_,isExecuting:h,initialFormData:W,setAuthTokenDescriptors:O,t:e}):(0,s.jsx)(Gt,{handleExecute:_,isExecuting:h})})})]}),(0,s.jsx)(ze,{noPadding:T,title:$,type:"Workflows",typeLink:r?`/catalog/${F}/${P}/${L}/workflows`:"/orchestrator",children:U})};var rr=r(41389),sr=r(87132);const or=(0,S.n9)()(((e,{isDarkMode:t})=>({tabbedLayout:{"& .Mui-selected":{color:t?"#ffffff !important":"#151515 !important"}}}))),nr=()=>{const{t:e}=(0,g.B)(),t=(0,P.h)(),{classes:r}=or({isDarkMode:t});return(0,s.jsx)(ze,{title:e("page.title"),noPadding:!0,children:(0,s.jsx)(Ee.A,{className:r.tabbedLayout,children:(0,s.jsxs)(rr.L,{children:[(0,s.jsx)(rr.L.Route,{path:"/",title:e("page.tabs.workflows"),children:(0,s.jsx)(sr.B,{})}),(0,s.jsx)(rr.L.Route,{path:n.GT.path,title:e("page.tabs.allRuns"),children:(0,s.jsx)(Le,{})})]})})})};var ar=r(17138),ir=r(27431),lr=r(68688),dr=r(41356),cr=r(71001),ur=r(51078),mr=r(92824),hr=r(95516);const pr=(e,t)=>{if(t(e))return e;for(const[r,s]of Object.entries(e))if(zt(s)){const e=pr(s,t);if(void 0!==e)return e}},fr=(0,S.n9)()((e=>({abortButton:{backgroundColor:e.palette.error.dark,color:e.palette.getContrastText(e.palette.error.dark),"&:hover":{backgroundColor:e.palette.error.dark,filter:"brightness(90%)"}},modalText:{marginBottom:e.spacing(2)},errorColor:{color:e.palette.error.dark},menu:{"& ul":{display:"flex",flexDirection:"column","& li":{padding:"6px 16px",justifyContent:"left"}}}}))),xr=({canAbort:e})=>{const{t}=(0,g.B)(),{classes:r}=fr();return(0,s.jsxs)("div",{children:[(0,s.jsx)($.A,{className:r.modalText,children:(0,s.jsx)(y.A,{variant:"h6",children:t("run.abort.warning")})}),!e&&(0,s.jsx)($.A,{sx:{width:"100%"},children:(0,s.jsxs)(de.A,{severity:"info",children:[(0,s.jsx)(ce.A,{children:t("run.abort.completed.title")}),t("run.abort.completed.message")]})})]})},jr=e=>{const{t}=(0,g.B)(),{classes:r}=fr();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.A,{onClick:e.handleSubmit,variant:"contained",className:r.abortButton,startIcon:e.isAborting?(0,s.jsx)(ue.A,{size:"1rem"}):null,disabled:e.isAborting||!e.canAbort,children:t("run.abort.button")}),(0,s.jsx)(T.A,{onClick:e.handleCancel,variant:"outlined",color:"primary",disabled:e.isAborting,children:t("common.cancel")})]})},vr=()=>{const{t:e}=(0,g.B)(),{classes:t}=fr(),r=(0,o.useNavigate)(),i=(0,l.useApi)(c.k),{authenticate:d}=Jt(),m=(0,l.useRouteRef)(n.TO),{instanceId:h}=(0,l.useRouteRefParams)(n.Fu),{kind:p,name:x,namespace:k}=(0,l.useRouteRefParams)(n.XQ);let A;p&&k&&x&&(A=`${p}:${k}/${x}`);const[y,S]=(0,u.useState)(!1),[C,I]=(0,u.useState)(!1),[R,N]=(0,u.useState)(!1),[O,D]=(0,u.useState)(""),[E,$]=(0,u.useState)(!1),[B,P]=(0,u.useState)(!1),[L,_]=(0,u.useState)(""),Q=()=>{N(!1)},U=()=>{P(!1)},V=(0,u.useCallback)((async()=>{if(h)return(await i.getInstance(h)).data}),[h,i]),{loading:Y,error:X,value:J,restart:q}=(0,w.A)(V,v.lb,(e=>!(!e||e.state!==j.oR.Active&&e.state!==j.oR.Pending&&e.state))),G=null==J?void 0:J.processId,K=(0,Ue.U)(G?[W.ox,(0,W.qg)(G)]:[W.ox]),{value:ee,error:re}=(0,a.A)((async()=>{var e;if(G)return null===(e=(await i.getWorkflowDataInputSchema(G,h)).data)||void 0===e?void 0:e.inputSchema}),[i,G]),se=(null==J?void 0:J.state)===j.oR.Active||(null==J?void 0:J.state)===j.oR.Error,oe=(null==J?void 0:J.state)===j.oR.Completed||(null==J?void 0:J.state)===j.oR.Aborted||(null==J?void 0:J.state)===j.oR.Error,ne=(0,u.useCallback)((()=>{S((e=>!e))}),[]),ae=(0,u.useCallback)((async()=>{if(J){I(!0);try{await i.abortWorkflowInstance(J.id),q()}catch(t){const r=await V();(null==r?void 0:r.state)===j.oR.Completed?(D(e("workflow.errors.abortFailed")),q()):D(e("workflow.errors.abortFailed",{reason:t.message})),N(!0)}finally{I(!1),ne()}}}),[e,i,q,J,ne,V]),ie=(0,u.useCallback)((()=>{if(!J)return;const e=fe(A?`${m({workflowId:J.processId})}?targetEntity=${A}`:m({workflowId:J.processId}),{[pe]:J.id});r(e)}),[J,r,m,A]),le=(0,u.useRef)(null),[ce,me]=(0,u.useState)(!1),he=()=>{me(!1)},xe=t=>{he(),"rerun"===t?ie():"retrigger"===t&&(async()=>{if(J){$(!0);try{const e=await(async e=>{if(!e)return;const t=pr(e,(e=>{const t=e["ui:widget"],r=e["ui:props"],s=zt(r)?r.authTokenDescriptors:void 0;return"AuthRequester"===t&&Array.isArray(s)}));return t?t["ui:props"].authTokenDescriptors:void 0})(ee);let t;e&&e.length>0&&(t=await d(e)),await i.retriggerInstance(J.processId,J.id,t),q()}catch(t){t.toString().includes("Failed Node ID")?_(e("workflow.buttons.runFailedAgain")):_(e("workflow.errors.retriggerFailed",{reason:t.message})),P(!0)}finally{$(!1)}}})()},je=X||re,ve=(0,s.jsx)(b,{message:"run.pageTitle",params:{processName:null==J?void 0:J.processName}});return(0,s.jsxs)(ze,{title:ve,children:[Y?(0,s.jsx)(M.k,{}):null,je?(0,s.jsx)(z._,{error:je}):null,!Y&&H(J)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(ar.d,{title:"",children:[(0,s.jsx)(F.T,{title:e("run.abort.title"),titleIcon:(0,s.jsx)(Z.A,{className:t.errorColor}),onClose:ne,open:y,dialogActions:(0,s.jsx)(jr,{handleCancel:ne,handleSubmit:ae,isAborting:C,canAbort:se}),children:(0,s.jsx)(xr,{canAbort:se})}),(0,s.jsxs)(f.Ay,{container:!0,item:!0,justifyContent:"flex-end",spacing:1,children:[(0,s.jsx)(f.Ay,{item:!0,children:se&&(0,s.jsx)(te.A,{title:e("tooltips.userNotAuthorizedAbort"),disableHoverListener:K.allowed,children:(0,s.jsx)(T.A,{variant:"outlined",color:"primary",disabled:!K.allowed,onClick:ne,children:e("run.abort.button")})})}),(0,s.jsxs)(f.Ay,{item:!0,children:[(0,s.jsx)(te.A,{title:e("tooltips.userNotAuthorizedExecute"),disableHoverListener:K.allowed,children:(0,s.jsx)(T.A,{ref:le,variant:"contained",color:"primary",startIcon:E?(0,s.jsx)(ue.A,{size:"1rem"}):null,disabled:!K.allowed||!oe,onClick:(null==J?void 0:J.state)===j.oR.Error?()=>{me((e=>!e))}:ie,endIcon:(null==J?void 0:J.state)===j.oR.Error?(0,s.jsx)(ir.A,{}):null,children:J.state===j.oR.Active?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ue.A,{color:"inherit",size:"0.75rem"})," ",e("workflow.buttons.running")]}):e("workflow.buttons.runAgain")})}),(0,s.jsxs)(ur.A,{anchorEl:le.current,open:ce,onClose:he,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},className:t.menu,children:[(0,s.jsxs)(mr.A,{onClick:()=>xe("rerun"),children:[(0,s.jsx)(dr.A,{}),"Entire workflow"]}),(0,s.jsxs)(mr.A,{onClick:()=>xe("retrigger"),disabled:!ee,children:[(0,s.jsx)(cr.A,{}),e("workflow.buttons.fromFailurePoint")]})]})]})]})]}),(0,s.jsx)(hr.A,{open:R,onClose:Q,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,s.jsx)(de.A,{severity:"error",action:(0,s.jsx)(be.A,{size:"small","aria-label":"close",color:"inherit",onClick:Q,children:(0,s.jsx)(lr.A,{fontSize:"small"})}),children:O})}),(0,s.jsx)(hr.A,{open:B,onClose:U,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,s.jsx)(de.A,{severity:"error",action:(0,s.jsx)(be.A,{size:"small","aria-label":"close",color:"inherit",onClick:U,children:(0,s.jsx)(lr.A,{fontSize:"small"})}),children:L})}),(0,s.jsx)(Fe,{instance:J})]}):null]})};vr.displayName="WorkflowInstancePage";const wr=(0,S.n9)()(((e,{isDarkMode:t})=>({tabbedLayout:{"& .Mui-selected":{color:t?"#ffffff !important":"#151515 !important"}}}))),gr=()=>{const{t:e}=(0,g.B)(),{workflowId:t}=(0,l.useRouteRefParams)(n.WX),r=(0,l.useApi)(c.k),o=(0,P.h)(),{classes:i}=wr({isDarkMode:o}),{value:d,loading:u,error:m}=(0,a.A)((()=>r.getWorkflowOverview(t)),[]);return(0,s.jsx)(ze,{title:(null==d?void 0:d.data.name)||t,type:"Orchestrator",typeLink:"/orchestrator",noPadding:!0,children:(0,s.jsx)(Ee.A,{className:i.tabbedLayout,children:(0,s.jsxs)(rr.L,{children:[(0,s.jsx)(rr.L.Route,{path:"/",title:e("page.tabs.workflowDetails"),children:(0,s.jsxs)(f.Ay,{container:!0,spacing:2,children:[(0,s.jsx)(He,{isAvailable:null==d?void 0:d.data.isAvailable}),(0,s.jsx)(Ze,{loadingWorkflowOverview:u,workflowOverviewDTO:null==d?void 0:d.data,errorWorkflowOverview:m})]})}),(0,s.jsx)(rr.L.Route,{path:n.WE,title:e("page.tabs.workflowRuns"),children:(0,s.jsxs)(f.Ay,{container:!0,spacing:2,children:[(0,s.jsx)(He,{isAvailable:null==d?void 0:d.data.isAvailable}),(0,s.jsx)(Le,{})]})})]})})})},br=()=>(0,s.jsxs)(o.Routes,{children:[(0,s.jsx)(o.Route,{path:"/*",element:(0,s.jsx)(nr,{})}),(0,s.jsx)(o.Route,{path:`${n.WX.path}/*`,element:(0,s.jsx)(gr,{})}),(0,s.jsx)(o.Route,{path:n.TO.path,element:(0,s.jsx)(tr,{})}),(0,s.jsx)(o.Route,{path:n.Fu.path,element:(0,s.jsx)(vr,{})}),(0,s.jsx)(o.Route,{path:n.tc.path,element:(0,s.jsx)(Ke,{})}),(0,s.jsx)(o.Route,{path:n.XQ.path,element:(0,s.jsx)(vr,{})})]})},86973:()=>{}}]);
//# sourceMappingURL=5474.f59fea52.chunk.js.map