{"version":3,"file":"static/5474.f59fea52.chunk.js","mappings":"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","sources":["webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/Trans.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/ui/Selector.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/VariablesDialog.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowInputs.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/utils/TypeGuards.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/utils/NodeInstanceUtils.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/Paragraph.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowProgressNode.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowProgressNodeModel.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowProgress.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-common/src/QueryParams.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/utils/UrlUtils.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowDescriptionModal.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowResult.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowRunDetails.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowInstancePageContent.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/OrchestratorPage/WorkflowRunsTabContent.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/ui/BaseOrchestratorPage.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowPage/RunButton.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowPage/ServerlessWorkflowEditor.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowPage/WorkflowDetailsCard.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowPage/WorkflowDetailsTabContent.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/catalogComponents/CatalogWorkflowPage.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/utils/generateUiSchema.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/utils/StepperContext.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-api/src/DefaultFormApi.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-api/src/api.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/hooks/useTranslation.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/utils/getSortedStepEntries.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/utils/useValidator.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/components/AuthRequester.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/components/SubmitButton.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/components/OrchestratorFormStepper.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/components/StepperObjectField.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/components/OrchestratorFormWrapper.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-common/src/utils/isJsonObject.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/utils/generateReviewTableData.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/components/ReviewStep.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/components/SingleStepForm.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/../orchestrator-form-react/src/components/OrchestratorForm.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/hooks/useOrchestratorAuth.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/utils/ErrorUtils.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/ExecuteWorkflowPage/MissingSchemaNotice.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/ExecuteWorkflowPage/schemaUpdater.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/ExecuteWorkflowPage/ExecuteWorkflowPage.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/OrchestratorPage/OrchestratorPage.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/utils/deepSearchObject.ts","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowInstancePage/WorkflowInstancePage.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/WorkflowPage/WorkflowPage.tsx","webpack://red-hat-developer-hub.backstage-plugin-orchestrator/./src/components/Router.tsx"],"sourcesContent":["/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useTranslation } from '../hooks/useTranslation';\nimport { orchestratorTranslationRef } from '../translations';\n\ntype Messages = typeof orchestratorTranslationRef.T;\n\ninterface TransProps<TMessages extends { [key in string]: string }> {\n  message: keyof TMessages;\n  params?: any;\n}\n\nexport const Trans = ({ message, params }: TransProps<Messages>) => {\n  const { t } = useTranslation();\n  return t(message, params);\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useMemo } from 'react';\n\nimport { Select, SelectedItems } from '@backstage/core-components';\n\nimport Typography from '@mui/material/Typography';\nimport { makeStyles } from 'tss-react/mui';\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'baseline',\n    '& label + div': {\n      marginTop: '0px',\n    },\n  },\n  select: {\n    width: '10rem',\n  },\n  label: {\n    color: theme.palette.text.primary,\n    fontSize: theme.typography.fontSize,\n    paddingRight: '0.5rem',\n    fontWeight: 'bold',\n  },\n}));\n\nconst ALL_ITEMS = '___all___';\n\ntype BackstageSelectProps = Parameters<typeof Select>[0];\nexport type SelectorProps = Omit<BackstageSelectProps, 'onChange'> & {\n  includeAll?: boolean;\n  onChange: (item: string) => void;\n};\n\nexport const Selector = ({\n  includeAll = true,\n  ...otherProps\n}: SelectorProps) => {\n  const { classes } = useStyles();\n\n  const selectItems = useMemo(\n    () =>\n      includeAll\n        ? [{ label: 'All', value: ALL_ITEMS }, ...otherProps.items]\n        : otherProps.items,\n    [includeAll, otherProps.items],\n  );\n\n  const handleChange = useCallback(\n    (item: SelectedItems) => otherProps.onChange(item as string),\n    [otherProps],\n  );\n\n  return (\n    <div className={classes.root}>\n      <Typography className={classes.label}>{otherProps.label}</Typography>\n      <div className={classes.select}>\n        <Select\n          onChange={handleChange}\n          items={selectItems}\n          selected={otherProps.selected}\n          margin=\"dense\"\n          label={otherProps.label}\n        />\n      </div>\n    </div>\n  );\n};\nSelector.displayName = 'Selector';\nSelector.AllItems = ALL_ITEMS;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Box from '@mui/material/Box';\nimport Button from '@mui/material/Button';\nimport Typography from '@mui/material/Typography';\n\nimport {\n  capitalize,\n  WorkflowDataDTO,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { useIsDarkMode } from '../../utils/isDarkMode';\nimport { InfoDialog } from '../ui/InfoDialog';\nimport { JsonCodeBlock } from '../ui/JsonCodeBlock';\n\nexport const VariablesDialog = ({\n  open,\n  onClose,\n  instanceVariables,\n}: {\n  open: boolean;\n  onClose: () => void;\n  instanceVariables: WorkflowDataDTO;\n}) => {\n  const { t } = useTranslation();\n  const isDarkMode = useIsDarkMode();\n  const hasVariables = Object.keys(instanceVariables).length > 0;\n\n  return (\n    <InfoDialog\n      title={t('run.variables')}\n      onClose={onClose}\n      open={open}\n      dialogActions={\n        <Button color=\"primary\" variant=\"contained\" onClick={onClose}>\n          {t('common.close')}\n        </Button>\n      }\n      wideDialog\n    >\n      {hasVariables ? (\n        Object.entries(instanceVariables).map(([key, value]) => (\n          <Box key={key} mt={2} mb={2}>\n            <Typography variant=\"h6\" mb={1}>\n              {capitalize(key)}\n            </Typography>\n            <JsonCodeBlock isDarkMode={isDarkMode} value={value} />\n          </Box>\n        ))\n      ) : (\n        <Typography>{t('messages.noVariablesFound')}</Typography>\n      )}\n    </InfoDialog>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FC } from 'react';\n\nimport {\n  InfoCard,\n  Progress,\n  ResponseErrorPanel,\n  StructuredMetadataTable,\n} from '@backstage/core-components';\n\nimport { useTranslation } from '../../hooks/useTranslation';\n\nexport const WorkflowInputs: FC<{\n  className: string;\n  value: any;\n  loading: any;\n  responseError: any;\n  cardClassName: string;\n}> = ({ className, value, loading, responseError, cardClassName }) => {\n  const { t } = useTranslation();\n  const inputs = value?.data;\n  return (\n    <InfoCard\n      title={t('run.inputs')}\n      subheader={\n        !loading &&\n        !responseError &&\n        !inputs && <i>{t('messages.workflowInstanceNoInputs')}</i>\n      }\n      divider={false}\n      className={className}\n      cardClassName={cardClassName}\n    >\n      {loading ? <Progress /> : null}\n\n      {!loading && responseError && (\n        <ResponseErrorPanel error={responseError} />\n      )}\n\n      {!loading && !responseError && inputs && (\n        <StructuredMetadataTable dense metadata={inputs} />\n      )}\n    </InfoCard>\n  );\n};\nWorkflowInputs.displayName = 'WorkflowInputs';\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const isNonNullable = <T = unknown>(value: T): value is NonNullable<T> =>\n  value !== null && typeof value !== 'undefined';\n\nexport const hasOwnProp = <X extends {}, Y extends PropertyKey>(\n  obj: X,\n  prop: Y,\n): obj is X & Record<Y, unknown> => {\n  return obj.hasOwnProperty(prop);\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport moment from 'moment';\n\nimport { NodeInstanceDTO } from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { isNonNullable } from './TypeGuards';\n\nexport const compareNodes = (\n  nodeA: NodeInstanceDTO,\n  nodeB: NodeInstanceDTO,\n) => {\n  const aEnter = moment(nodeA.enter);\n  const bEnter = moment(nodeB.enter);\n  if (aEnter.isBefore(bEnter)) {\n    return -1;\n  } else if (aEnter.isAfter(bEnter)) {\n    return 1;\n  }\n\n  if (isNonNullable(nodeA.exit) && isNonNullable(nodeB.exit)) {\n    const aExit = moment(nodeA.exit);\n    const bExit = moment(nodeB.exit);\n    if (aExit.isBefore(bExit)) {\n      return -1;\n    } else if (aExit.isAfter(bExit)) {\n      return 1;\n    }\n  } else {\n    // nodeA exited, but nodeB didn't\n    if (isNonNullable(nodeA.exit)) return -1;\n    // nodeB exited, but nodeA didn't\n    if (isNonNullable(nodeB.exit)) return 1;\n  }\n\n  if (nodeA.id < nodeB.id) {\n    return -1;\n  } else if (nodeA.id > nodeB.id) {\n    return 1;\n  }\n\n  return 0;\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PropsWithChildren } from 'react';\n\nimport { TypographyVariant } from '@mui/material/styles';\nimport Typography from '@mui/material/Typography';\n\nexport const Paragraph = (\n  props: PropsWithChildren<{ variant?: TypographyVariant | 'inherit' }>,\n) => {\n  return (\n    <Typography\n      style={{ marginTop: '14px', marginBottom: '14px' }}\n      variant={props.variant ?? 'body2'}\n      component=\"p\"\n    >\n      {props.children}\n    </Typography>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FC } from 'react';\nimport Moment from 'react-moment';\n\nimport Cancel from '@mui/icons-material/Cancel';\nimport CheckCircle from '@mui/icons-material/CheckCircle';\nimport Error from '@mui/icons-material/Error';\nimport HourglassTop from '@mui/icons-material/HourglassTop';\nimport PauseCircle from '@mui/icons-material/PauseCircle';\nimport Tooltip from '@mui/material/Tooltip';\nimport Typography from '@mui/material/Typography';\n\nimport { ProcessInstanceStatusDTO } from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { VALUE_UNAVAILABLE } from '../../constants';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { useWorkflowInstanceStateColors } from '../../hooks/useWorkflowInstanceStatusColors';\nimport { Paragraph } from './Paragraph';\nimport { WorkflowProgressNodeModel } from './WorkflowProgressNodeModel';\n\nconst WorkflowProgressNodeIcon: FC<{\n  status?: WorkflowProgressNodeModel['status'];\n  error?: WorkflowProgressNodeModel['error'];\n}> = ({ status, error }) => {\n  const { t } = useTranslation();\n  const color = useWorkflowInstanceStateColors(status);\n  switch (status) {\n    case ProcessInstanceStatusDTO.Error: {\n      return (\n        <Tooltip\n          title={\n            error?.message ??\n            t('messages.additionalDetailsAboutThisErrorAreNotAvailable')\n          }\n        >\n          <Error className={color} />\n        </Tooltip>\n      );\n    }\n    case ProcessInstanceStatusDTO.Completed: {\n      return (\n        <Tooltip title={t('tooltips.completed')}>\n          <CheckCircle className={color} />\n        </Tooltip>\n      );\n    }\n    case ProcessInstanceStatusDTO.Active: {\n      return (\n        <Tooltip title={t('tooltips.active')}>\n          <HourglassTop className={color} />\n        </Tooltip>\n      );\n    }\n    case ProcessInstanceStatusDTO.Aborted: {\n      return (\n        <Tooltip title={t('tooltips.aborted')}>\n          <Cancel className={color} />\n        </Tooltip>\n      );\n    }\n    case ProcessInstanceStatusDTO.Suspended: {\n      return (\n        <Tooltip title={t('tooltips.suspended')}>\n          <PauseCircle className={color} />\n        </Tooltip>\n      );\n    }\n    case ProcessInstanceStatusDTO.Pending: {\n      return (\n        <Tooltip title={t('tooltips.pending')}>\n          <HourglassTop className={color} />\n        </Tooltip>\n      );\n    }\n    default:\n      return null;\n  }\n};\nWorkflowProgressNodeIcon.displayName = 'WorkflowProgressNodeIcon';\n\nexport const WorkflowProgressNode: React.FC<{\n  model: WorkflowProgressNodeModel;\n}> = ({ model }) => (\n  <Paragraph>\n    <Typography\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n      }}\n    >\n      <WorkflowProgressNodeIcon status={model.status} error={model.error} />\n      <Typography style={{ paddingLeft: '8px' }}>{model.name}</Typography>\n    </Typography>\n    <small style={{ paddingLeft: '32px', color: 'grey' }}>\n      {!model.exit ? (\n        VALUE_UNAVAILABLE\n      ) : (\n        <Moment fromNow>{new Date(`${model.exit}`)}</Moment>\n      )}\n    </small>\n  </Paragraph>\n);\nWorkflowProgressNode.displayName = 'WorkflowProgressNode';\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  NodeInstanceDTO,\n  ProcessInstanceErrorDTO,\n  ProcessInstanceStatusDTO,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { isNonNullable } from '../../utils/TypeGuards';\n\nexport type WorkflowProgressNodeModel = NodeInstanceDTO & {\n  status?: ProcessInstanceStatusDTO;\n  error?: ProcessInstanceErrorDTO;\n};\n\nexport const fromNodeInstanceToWorkflowProgressNodeModel =\n  (\n    workflowStatus?: ProcessInstanceStatusDTO,\n    workflowError?: ProcessInstanceErrorDTO,\n  ) =>\n  (\n    node: NodeInstanceDTO,\n    nodeIndex: number,\n    nodes: NodeInstanceDTO[],\n  ): WorkflowProgressNodeModel => {\n    const isLastNode = nodeIndex === nodes.length - 1;\n    const model: WorkflowProgressNodeModel = {\n      ...node,\n      status: workflowStatus,\n      enter: node.enter,\n    };\n\n    if (isNonNullable(node.exit)) {\n      model.exit = node.exit;\n    }\n\n    if (node.definitionId === workflowError?.nodeDefinitionId) {\n      model.status = ProcessInstanceStatusDTO.Error;\n      model.error = workflowError;\n    } else if (node.enter && node.exit) {\n      model.status = ProcessInstanceStatusDTO.Completed;\n    } else if (!node.exit) {\n      model.status = ProcessInstanceStatusDTO.Active;\n    }\n\n    if (\n      workflowStatus &&\n      isLastNode &&\n      (workflowStatus === ProcessInstanceStatusDTO.Aborted ||\n        workflowStatus === ProcessInstanceStatusDTO.Suspended)\n    ) {\n      model.status = workflowStatus;\n    }\n\n    return model;\n  };\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FC } from 'react';\n\nimport { ProcessInstanceDTO } from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { compareNodes } from '../../utils/NodeInstanceUtils';\nimport { Paragraph } from './Paragraph';\nimport { WorkflowProgressNode } from './WorkflowProgressNode';\nimport { fromNodeInstanceToWorkflowProgressNodeModel } from './WorkflowProgressNodeModel';\n\nexport interface WorkflowProgressProps {\n  workflowStatus: ProcessInstanceDTO['state'];\n  workflowNodes: ProcessInstanceDTO['nodes'];\n  workflowError?: ProcessInstanceDTO['error'];\n  emptyState?: React.ReactNode;\n}\n\nexport const WorkflowProgress: FC<WorkflowProgressProps> = ({\n  workflowStatus,\n  workflowError,\n  workflowNodes,\n  emptyState,\n}) => {\n  const { t } = useTranslation();\n  const defaultEmptyState = emptyState || (\n    <Paragraph>{t('messages.noDataAvailable')}</Paragraph>\n  );\n\n  return (\n    <>\n      {workflowNodes.length === 0\n        ? defaultEmptyState\n        : structuredClone(workflowNodes)\n            .sort(compareNodes)\n            .map(\n              fromNodeInstanceToWorkflowProgressNodeModel(\n                workflowStatus,\n                workflowError,\n              ),\n            )\n            .map(model => (\n              <WorkflowProgressNode model={model} key={model.id} />\n            ))}\n    </>\n  );\n};\nWorkflowProgress.displayName = 'WorkflowProgress';\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const QUERY_PARAM_INSTANCE_ID = 'instanceId' as const;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function buildUrl(\n  baseUrl: string,\n  queryParams?: Record<string, any>,\n): string {\n  if (!queryParams || Object.keys(queryParams).length === 0) {\n    return baseUrl;\n  }\n\n  const queryString = Object.entries(queryParams)\n    .filter(([, value]) => value !== undefined)\n    .map(\n      ([key, value]) =>\n        `${encodeURIComponent(key)}=${encodeURIComponent(value)}`,\n    )\n    .join('&');\n\n  return queryString ? `${baseUrl}?${queryString}` : baseUrl;\n}\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { forwardRef, ForwardRefRenderFunction } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { TranslationFunction } from '@backstage/core-plugin-api/alpha';\n\nimport { Close } from '@mui/icons-material';\nimport Box from '@mui/material/Box';\nimport Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport IconButton from '@mui/material/IconButton';\nimport Typography from '@mui/material/Typography';\nimport { makeStyles } from 'tss-react/mui';\n\nimport { WorkflowOverviewDTO } from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { orchestratorTranslationRef } from '../../translations';\n\nexport type WorkflowDescriptionModalProps = {\n  workflow: WorkflowOverviewDTO;\n  workflowError?: {\n    itemId: string;\n    error: any;\n  };\n  runWorkflowLink: string;\n  open: boolean;\n  onClose?: () => void;\n};\n\nexport type ParentComponentRef = HTMLDivElement;\n\nconst useStyles = makeStyles()(() => ({\n  closeBtn: {\n    position: 'absolute',\n    right: 8,\n    top: 8,\n  },\n}));\n\n// hack\ntype LocalTranslationFunction =\n  | TranslationFunction<typeof orchestratorTranslationRef.T>\n  | ((key: string, params?: Record<string, string>) => string);\n\nexport const RefForwardingWorkflowDescriptionModal: ForwardRefRenderFunction<\n  ParentComponentRef,\n  WorkflowDescriptionModalProps\n> = (props, forwardedRef): JSX.Element | null => {\n  const { t } = useTranslation() as { t: LocalTranslationFunction };\n\n  const {\n    workflow,\n    open = false,\n    onClose,\n    runWorkflowLink,\n    workflowError,\n  } = props;\n  const { classes } = useStyles();\n  const navigate = useNavigate();\n\n  const handleRunWorkflow = () => {\n    if (runWorkflowLink) {\n      navigate(runWorkflowLink);\n    }\n  };\n\n  let content;\n  if (workflowError) {\n    content = (\n      <Box>\n        <Typography paragraph>\n          {t('workflow.errors.failedToLoadDetails', {\n            id: workflowError.itemId,\n          })}\n        </Typography>\n        {workflowError.error.message && (\n          <Typography paragraph>{workflowError.error.message}</Typography>\n        )}\n      </Box>\n    );\n  } else if (workflow.description) {\n    content = <Box>{workflow.description}</Box>;\n  } else {\n    content = (\n      <Box>\n        <Typography paragraph>\n          {t('workflow.messages.areYouSureYouWantToRunThisWorkflow')}\n        </Typography>\n      </Box>\n    );\n  }\n\n  return (\n    <Dialog\n      onClose={_ => onClose}\n      open={open}\n      ref={forwardedRef}\n      maxWidth=\"sm\"\n      fullWidth\n    >\n      <DialogTitle>\n        <Box>\n          <Typography variant=\"h5\">{workflow.name}</Typography>\n          <IconButton\n            className={classes.closeBtn}\n            aria-label=\"close\"\n            onClick={onClose}\n          >\n            <Close />\n          </IconButton>\n        </Box>\n      </DialogTitle>\n\n      <DialogContent>{content}</DialogContent>\n      <DialogActions>\n        <Button\n          onClick={handleRunWorkflow}\n          color=\"primary\"\n          variant=\"contained\"\n          disabled={!!workflowError}\n        >\n          {t('workflow.buttons.runWorkflow')}\n        </Button>\n        <Button onClick={onClose} color=\"primary\" variant=\"outlined\">\n          {t('common.close')}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport const WorkflowDescriptionModal = forwardRef(\n  RefForwardingWorkflowDescriptionModal,\n);\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode, useCallback, useMemo, useState } from 'react';\n\nimport {\n  InfoCard,\n  Link,\n  MarkdownContent,\n  StructuredMetadataTable,\n} from '@backstage/core-components';\nimport { RouteFunc, useApi, useRouteRef } from '@backstage/core-plugin-api';\nimport { AboutField } from '@backstage/plugin-catalog';\n\nimport Alert from '@mui/material/Alert';\nimport AlertTitle from '@mui/material/AlertTitle';\nimport Box from '@mui/material/Box';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Grid from '@mui/material/Grid';\nimport List from '@mui/material/List';\nimport ListItem from '@mui/material/ListItem';\nimport { makeStyles } from 'tss-react/mui';\n\nimport {\n  ProcessInstanceDTO,\n  ProcessInstanceErrorDTO,\n  ProcessInstanceStatusDTO,\n  QUERY_PARAM_INSTANCE_ID,\n  WorkflowOverviewDTO,\n  WorkflowResultDTO,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { orchestratorApiRef } from '../../api';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { executeWorkflowRouteRef } from '../../routes';\nimport { buildUrl } from '../../utils/UrlUtils';\nimport { Trans } from '../Trans';\nimport {\n  WorkflowDescriptionModal,\n  WorkflowDescriptionModalProps,\n} from './WorkflowDescriptionModal';\n\nconst useStyles = makeStyles()(theme => ({\n  outputGrid: {\n    '& h2': {\n      textTransform: 'none',\n      fontSize: 'small',\n    },\n  },\n  links: {\n    padding: '0px',\n  },\n  values: {\n    '& tr > td': {\n      paddingLeft: '0px',\n    },\n  },\n  errorIcon: {\n    color: theme.palette.error.main,\n  },\n}));\n\nconst finalStates: ProcessInstanceStatusDTO[] = [\n  ProcessInstanceStatusDTO.Error,\n  ProcessInstanceStatusDTO.Completed,\n  ProcessInstanceStatusDTO.Suspended,\n];\n\nconst ResultMessage = ({\n  status,\n  error,\n  resultMessage,\n  executionSummary: executionSummary,\n}: {\n  status?: ProcessInstanceStatusDTO;\n  error?: ProcessInstanceErrorDTO;\n  resultMessage?: WorkflowResultDTO['message'];\n  executionSummary?: string[];\n}) => {\n  const { t } = useTranslation();\n  const errorMessage = error?.message || error?.toString();\n  const executionSummaryArray: string[] = executionSummary ?? [];\n\n  const getTimeFromExecutionSummary = (\n    keyword: 'started' | 'failed' | 'retriggered' | 'waiting' | 'completed',\n  ): string[] => {\n    const matchingMessage = executionSummaryArray.find(str =>\n      str.includes(keyword),\n    );\n    if (!matchingMessage) return [''];\n\n    const timeMatch = matchingMessage.match(\n      /(\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z)/,\n    );\n    if (!timeMatch) return ['']; // for example 2025-06-25T16:05:18.512Z\n\n    const formattedDate = new Date(timeMatch[1]).toLocaleString();\n\n    return keyword === 'waiting'\n      ? [formattedDate, matchingMessage]\n      : [`at ${formattedDate}`];\n  };\n\n  const checkIfWaiting = (): ReactNode => {\n    const [formattedTime, waitingMessage] =\n      getTimeFromExecutionSummary('waiting');\n\n    if (waitingMessage) {\n      const nodeMatch = waitingMessage.match(/node (\\S+) since/);\n      const node = nodeMatch?.[1] ?? 'unknown';\n      return (\n        <Trans\n          message=\"run.status.runningWaitingAtNode\"\n          params={{ node, formattedTime }}\n        />\n      );\n    }\n    const [startedTime] = getTimeFromExecutionSummary('started');\n\n    if (startedTime !== '') {\n      return (\n        <>\n          <CircularProgress size=\"0.75rem\" />\n          &nbsp;\n          <Trans\n            message=\"run.status.workflowIsRunning\"\n            params={{ startedTime }}\n          />\n        </>\n      );\n    }\n    return '';\n  };\n\n  let alertProps: {\n    title: ReactNode;\n    message: string | undefined;\n    severity: 'warning' | 'error' | 'success' | 'info';\n  };\n\n  if (error) {\n    if (status === ProcessInstanceStatusDTO.Completed) {\n      // Backend reports \"Completed\" but there's also an error\n      alertProps = {\n        title: (\n          <Trans\n            message=\"run.status.completedWithMessage\"\n            params={{ time: getTimeFromExecutionSummary('completed') }}\n          />\n        ),\n        message: errorMessage,\n        severity: 'warning',\n      };\n    } else {\n      alertProps = {\n        title: (\n          <Trans\n            message=\"run.status.failed\"\n            params={{ time: getTimeFromExecutionSummary('failed') }}\n          />\n        ),\n        message: errorMessage,\n        severity: 'error',\n      };\n    }\n  } else if (status === ProcessInstanceStatusDTO.Aborted) {\n    // run aborted\n    alertProps = {\n      title: 'Run has aborted',\n      message: '',\n      severity: 'info',\n    };\n  } else if (status && finalStates.includes(status)) {\n    let message = t('run.status.noAdditionalInfo');\n    if (resultMessage) {\n      // Workaround, an Element is still accepted by the Alert component\n      message = (\n        <MarkdownContent content={resultMessage} />\n      ) as unknown as string;\n    }\n\n    // run completed\n    alertProps = {\n      title: (\n        <Trans\n          message=\"run.status.completedAt\"\n          params={{ time: getTimeFromExecutionSummary('completed') }}\n        />\n      ),\n      message,\n      severity: 'success',\n    };\n  } else {\n    // Running - might be waiting\n    const activeMessage = checkIfWaiting();\n\n    alertProps = {\n      title: <>{activeMessage}</>,\n      message: t('run.status.resultsWillBeDisplayedHereOnceTheRunIsComplete'),\n      severity: 'info',\n    };\n  }\n\n  return (\n    <Box sx={{ width: '100%' }}>\n      <Alert severity={alertProps.severity}>\n        <AlertTitle>{alertProps.title}</AlertTitle>\n        {alertProps.message}\n      </Alert>\n    </Box>\n  );\n};\n\nconst NextWorkflows = ({\n  instanceId,\n  nextWorkflows,\n}: {\n  instanceId: string;\n  nextWorkflows: WorkflowResultDTO['nextWorkflows'];\n}) => {\n  const { t } = useTranslation();\n  const { classes } = useStyles();\n\n  const orchestratorApi = useApi(orchestratorApiRef);\n  const executeWorkflowLink: RouteFunc<{ workflowId: string }> = useRouteRef(\n    executeWorkflowRouteRef,\n  );\n\n  const [\n    currentOpenedWorkflowDescriptionModalID,\n    setCurrentOpenedWorkflowDescriptionModalID,\n  ] = useState('');\n\n  const [currentWorkflow, setCurrentWorkflow] = useState(\n    {} as WorkflowOverviewDTO,\n  );\n  const [workflowError, setWorkflowError] =\n    useState<WorkflowDescriptionModalProps['workflowError']>();\n\n  const runWorkflowLink = useMemo(\n    () =>\n      buildUrl(\n        executeWorkflowLink({\n          workflowId: currentOpenedWorkflowDescriptionModalID,\n        }),\n        {\n          [QUERY_PARAM_INSTANCE_ID]: instanceId,\n        },\n      ),\n    [currentOpenedWorkflowDescriptionModalID, executeWorkflowLink, instanceId],\n  );\n\n  const openWorkflowDescriptionModal = useCallback(\n    (itemId: string) => {\n      if (itemId) {\n        orchestratorApi\n          .getWorkflowOverview(itemId)\n          .then(workflow => {\n            setCurrentWorkflow(workflow.data);\n          })\n          .catch(error => {\n            setWorkflowError({ itemId, error });\n          });\n        setCurrentOpenedWorkflowDescriptionModalID(itemId);\n      }\n    },\n    [orchestratorApi],\n  );\n\n  const closeWorkflowDescriptionModal = useCallback(() => {\n    setCurrentOpenedWorkflowDescriptionModalID('');\n    setCurrentWorkflow({} as WorkflowOverviewDTO);\n  }, []);\n\n  if (!nextWorkflows?.length) {\n    return null;\n  }\n\n  const sectionLabel =\n    nextWorkflows.length === 1\n      ? t('run.suggestedNextWorkflow')\n      : t('run.suggestedNextWorkflows');\n\n  return (\n    <Grid item xs={12} className={classes.outputGrid}>\n      <AboutField label={sectionLabel}>\n        <List dense disablePadding>\n          {nextWorkflows.map(item => (\n            <ListItem key={item.id} disableGutters>\n              <Link\n                color=\"primary\"\n                to=\"#\"\n                onClick={() => {\n                  openWorkflowDescriptionModal(item.id);\n                }}\n              >\n                {item.name}\n              </Link>\n            </ListItem>\n          ))}\n        </List>\n      </AboutField>\n      <WorkflowDescriptionModal\n        workflow={currentWorkflow}\n        workflowError={workflowError}\n        runWorkflowLink={runWorkflowLink}\n        open={!!currentOpenedWorkflowDescriptionModalID}\n        onClose={closeWorkflowDescriptionModal}\n      />\n    </Grid>\n  );\n};\n\nconst WorkflowOutputs = ({\n  outputs,\n}: {\n  outputs: WorkflowResultDTO['outputs'];\n}) => {\n  const { t } = useTranslation();\n  const { classes } = useStyles();\n\n  if (!outputs?.length) {\n    return null;\n  }\n\n  const links = outputs?.filter(item => item.format === 'link');\n  const markdowns = outputs?.filter(item => item.format === 'markdown');\n  const values = outputs?.filter(\n    item => item.format !== 'link' && item.format !== 'markdown',\n  );\n  const valuesAsObject = values.reduce<{\n    [key: string]: any;\n  }>((data, item) => {\n    let value = item.value || '';\n    if (!['string', 'number', 'boolean'].includes(typeof value)) {\n      if (Array.isArray(value)) {\n        value = JSON.stringify(value);\n      } else if (typeof value === 'object') {\n        value = `Object: ${JSON.stringify(value)}`;\n      } else {\n        value = 'Unexpected type';\n      }\n    }\n    return { ...data, [item.key]: value };\n  }, {});\n\n  return (\n    <>\n      {links?.length > 0 && (\n        <Grid item md={12} key=\"__links\" className={classes.links}>\n          <AboutField label={t('common.links')}>\n            <List dense disablePadding>\n              {links\n                .filter(\n                  item =>\n                    item.value && item.key && typeof item.value === 'string',\n                )\n                .map(item => {\n                  return (\n                    <ListItem disableGutters key={item.key}>\n                      <Link to={item.value as string}>{item.key}</Link>\n                    </ListItem>\n                  );\n                })}\n            </List>\n          </AboutField>\n        </Grid>\n      )}\n\n      {(Object.keys(valuesAsObject).length > 0 || markdowns?.length > 0) && (\n        <Grid item md={12} key=\"non__links\" className={classes.values}>\n          <AboutField label={t('common.values')}>\n            {markdowns?.length > 0 &&\n              markdowns.map(item => (\n                <MarkdownContent\n                  key={item.key}\n                  content={item.value as string}\n                />\n              ))}\n            {Object.keys(valuesAsObject).length > 0 && (\n              <StructuredMetadataTable dense metadata={valuesAsObject} />\n            )}\n          </AboutField>\n        </Grid>\n      )}\n    </>\n  );\n};\n\nexport const WorkflowResult: React.FC<{\n  instance: ProcessInstanceDTO;\n  className: string;\n  cardClassName?: string;\n}> = ({ instance, className, cardClassName }) => {\n  const { t } = useTranslation();\n  const result = instance.workflowdata?.result;\n\n  return (\n    <InfoCard\n      title={t('run.results')}\n      subheader={\n        <ResultMessage\n          status={instance.state}\n          error={instance.error}\n          resultMessage={result?.message}\n          executionSummary={instance.executionSummary}\n        />\n      }\n      divider={false}\n      className={className}\n      cardClassName={cardClassName}\n    >\n      <Grid container alignContent=\"flex-start\" spacing=\"1rem\">\n        <NextWorkflows\n          instanceId={instance.id}\n          nextWorkflows={result?.nextWorkflows}\n        />\n        <WorkflowOutputs outputs={result?.outputs} />\n      </Grid>\n    </InfoCard>\n  );\n};\n\nWorkflowResult.displayName = 'WorkflowResult';\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FC } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { CopyTextButton, Link } from '@backstage/core-components';\nimport { useApi, useRouteRef } from '@backstage/core-plugin-api';\nimport { AboutField } from '@backstage/plugin-catalog';\n\nimport { Box } from '@material-ui/core';\nimport Grid from '@mui/material/Grid';\nimport Typography from '@mui/material/Typography';\nimport { makeStyles } from 'tss-react/mui';\n\nimport {\n  capitalize,\n  ProcessInstanceStatusDTO,\n  WorkflowOverviewDTO,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { orchestratorApiRef } from '../../api';\nimport { VALUE_UNAVAILABLE } from '../../constants';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { workflowRouteRef } from '../../routes';\nimport { WorkflowRunDetail } from '../types/WorkflowRunDetail';\nimport { WorkflowInstanceStatusIndicator } from '../ui/WorkflowInstanceStatusIndicator';\nimport { WorkflowStatus } from '../ui/WorkflowStatus';\n\ntype WorkflowDetailsCardProps = {\n  details: WorkflowRunDetail;\n};\n\nconst useStyles = makeStyles()(_ => ({\n  workflowId: {\n    '& > div': {\n      width: '80%',\n    },\n    '& > button': {\n      maxHeight: '20px',\n    },\n  },\n}));\n\nexport const WorkflowRunDetails: FC<WorkflowDetailsCardProps> = ({\n  details,\n}) => {\n  const { t } = useTranslation();\n  const { classes } = useStyles();\n  const orchestratorApi = useApi(orchestratorApiRef);\n  const { value, loading, error } =\n    useAsync(async (): Promise<WorkflowOverviewDTO> => {\n      const res = await orchestratorApi.getWorkflowOverview(details.workflowId);\n\n      return res.data;\n    }, [orchestratorApi]);\n\n  const workflowPageLink = useRouteRef(workflowRouteRef);\n\n  return (\n    <Grid container alignContent=\"flex-start\" spacing=\"1rem\">\n      <Grid item md={7} key=\"Workflow\">\n        <AboutField label={t('workflow.fields.workflow')}>\n          <Link to={workflowPageLink({ workflowId: details.workflowId })}>\n            <Typography variant=\"subtitle2\" component=\"div\">\n              <b>{capitalize(details.processName)}</b>\n            </Typography>\n          </Link>\n        </AboutField>\n      </Grid>\n      <Grid item md={5} key=\"Run status\">\n        <AboutField label={t('workflow.fields.runStatus')}>\n          <Typography variant=\"subtitle2\" component=\"div\">\n            <b>\n              <WorkflowInstanceStatusIndicator\n                status={details.state as ProcessInstanceStatusDTO}\n              />\n            </b>\n          </Typography>\n        </AboutField>\n      </Grid>\n      <Grid item md={7} key=\"Workflow Status\">\n        <AboutField label={t('workflow.fields.workflowStatus')}>\n          <Typography variant=\"subtitle2\" component=\"div\">\n            <b>\n              {!error && !loading ? (\n                <WorkflowStatus availability={value?.isAvailable} />\n              ) : (\n                VALUE_UNAVAILABLE\n              )}\n            </b>\n          </Typography>\n        </AboutField>\n      </Grid>\n      <Grid item md={5} key=\"Run ID\">\n        <AboutField label={t('workflow.fields.workflowId')}>\n          <Box\n            display=\"flex\"\n            alignItems=\"center\"\n            className={classes.workflowId}\n          >\n            <Typography\n              variant=\"subtitle2\"\n              component=\"div\"\n              overflow=\"hidden\"\n              noWrap\n            >\n              {details.id}\n            </Typography>\n            <CopyTextButton\n              text={details.id}\n              tooltipText={t('workflow.fields.workflowIdCopied')}\n              tooltipDelay={2000}\n            />\n          </Box>\n        </AboutField>\n      </Grid>\n      <Grid item md={7} key=\"Duration\">\n        <AboutField label={t('workflow.fields.duration')}>\n          <Typography variant=\"subtitle2\" component=\"div\">\n            <b>{details.duration}</b>\n          </Typography>\n        </AboutField>\n      </Grid>\n      <Grid item md={5} key=\"Started\">\n        <AboutField label={t('workflow.fields.started')}>\n          <Typography variant=\"subtitle2\" component=\"div\">\n            <b>{details.start}</b>\n          </Typography>\n        </AboutField>\n      </Grid>\n      <Grid item md={12} key=\"Description\">\n        <AboutField label={t('workflow.fields.description')}>\n          <Typography variant=\"subtitle2\" component=\"div\">\n            <b>{details.description ?? VALUE_UNAVAILABLE}</b>\n          </Typography>\n        </AboutField>\n      </Grid>\n    </Grid>\n  );\n};\nWorkflowRunDetails.displayName = 'WorkflowDetails';\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useMemo, useState } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { Content, InfoCard, Link } from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { usePermission } from '@backstage/plugin-permission-react';\n\nimport Grid from '@mui/material/Grid';\nimport Typography from '@mui/material/Typography';\nimport moment from 'moment';\nimport { makeStyles } from 'tss-react/mui';\n\nimport {\n  InputSchemaResponseDTO,\n  orchestratorAdminViewPermission,\n  ProcessInstanceDTO,\n  WorkflowDataDTO,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { orchestratorApiRef } from '../../api/api';\nimport { VALUE_UNAVAILABLE } from '../../constants';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { WorkflowRunDetail } from '../types/WorkflowRunDetail';\nimport { VariablesDialog } from './VariablesDialog';\nimport { WorkflowInputs } from './WorkflowInputs';\nimport { WorkflowProgress } from './WorkflowProgress';\nimport { WorkflowResult } from './WorkflowResult';\nimport { WorkflowRunDetails } from './WorkflowRunDetails';\n\nexport const mapProcessInstanceToDetails = (\n  instance: ProcessInstanceDTO,\n): WorkflowRunDetail => {\n  const start = instance.start ? moment(instance.start) : undefined;\n  let duration: string = VALUE_UNAVAILABLE;\n  if (start && instance.end) {\n    const end = moment(instance.end);\n    duration = moment.duration(start.diff(end)).humanize();\n  }\n  const started = start?.toDate().toLocaleString() ?? VALUE_UNAVAILABLE;\n\n  return {\n    id: instance.id,\n    processName: instance.processName || VALUE_UNAVAILABLE,\n    workflowId: instance.processId,\n    start: started,\n    duration,\n    state: instance.state,\n    description: instance.description,\n  };\n};\n\nconst useStyles = makeStyles()(() => ({\n  topRowCard: {\n    height: '24rem',\n  },\n  bottomRowCard: {\n    height: '42rem',\n  },\n  recommendedLabelContainer: {\n    display: 'flex',\n    alignItems: 'center',\n    whiteSpace: 'nowrap',\n  },\n  recommendedLabel: { margin: '0 0.25rem' },\n  cardClassName: {\n    overflow: 'auto',\n  },\n  titleContainer: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n}));\n\nexport const WorkflowInstancePageContent: React.FC<{\n  instance: ProcessInstanceDTO;\n}> = ({ instance }) => {\n  const { t } = useTranslation();\n  const { classes } = useStyles();\n  const orchestratorApi = useApi(orchestratorApiRef);\n\n  const details = useMemo(\n    () => mapProcessInstanceToDetails(instance),\n    [instance],\n  );\n\n  const workflowdata = instance?.workflowdata;\n  let instanceVariables: WorkflowDataDTO = {};\n  if (workflowdata) {\n    instanceVariables = {\n      /* Since we are about to remove just the top-level property, shallow copy of the object is sufficient */\n      ...workflowdata,\n    };\n    if (instanceVariables.hasOwnProperty('result')) {\n      delete instanceVariables.result;\n    }\n  }\n  const workflowId = instance.processId;\n  const instanceId = instance.id;\n  const {\n    value,\n    loading,\n    error: responseError,\n  } = useAsync(async (): Promise<InputSchemaResponseDTO> => {\n    const res = await orchestratorApi.getWorkflowDataInputSchema(\n      workflowId,\n      instanceId,\n    );\n    return res.data;\n  }, [orchestratorApi, workflowId]);\n\n  const [isVariablesDialogOpen, setIsVariablesDialogOpen] = useState(false);\n\n  const toggleVariablesDialog = useCallback(() => {\n    setIsVariablesDialogOpen(prev => !prev);\n  }, []);\n\n  const adminView = usePermission({\n    permission: orchestratorAdminViewPermission,\n  });\n\n  const viewVariables = adminView.allowed && (\n    <Link\n      to=\"#\"\n      onClick={e => {\n        e.preventDefault();\n        toggleVariablesDialog();\n      }}\n    >\n      <Typography\n        variant=\"subtitle2\"\n        component=\"div\"\n        style={{ textAlign: 'right' }}\n      >\n        <b>{t('run.viewVariables')}</b>\n      </Typography>\n    </Link>\n  );\n\n  return (\n    <Content noPadding>\n      <VariablesDialog\n        open={isVariablesDialogOpen}\n        onClose={toggleVariablesDialog}\n        instanceVariables={instanceVariables}\n      />\n      <Grid container spacing={2}>\n        <Grid item xs={6}>\n          <InfoCard\n            title={\n              <div className={classes.titleContainer}>\n                <Typography component=\"span\">{t('common.details')}</Typography>\n                {viewVariables}\n              </div>\n            }\n            divider={false}\n            className={classes.topRowCard}\n            cardClassName={classes.cardClassName}\n          >\n            <WorkflowRunDetails details={details} />\n          </InfoCard>\n        </Grid>\n\n        <Grid item xs={6}>\n          <WorkflowResult\n            className={classes.topRowCard}\n            cardClassName={classes.cardClassName}\n            instance={instance}\n          />\n        </Grid>\n\n        <Grid item xs={6}>\n          <WorkflowInputs\n            className={classes.bottomRowCard}\n            cardClassName={classes.cardClassName}\n            value={value}\n            loading={loading}\n            responseError={responseError}\n          />\n        </Grid>\n\n        <Grid item xs={6}>\n          <InfoCard\n            title={t('workflow.progress')}\n            divider={false}\n            className={classes.bottomRowCard}\n            cardClassName={classes.cardClassName}\n          >\n            <WorkflowProgress\n              workflowError={instance.error}\n              workflowNodes={instance.nodes}\n              workflowStatus={instance.state}\n            />\n          </InfoCard>\n        </Grid>\n      </Grid>\n    </Content>\n  );\n};\nWorkflowInstancePageContent.displayName = 'WorkflowInstancePageContent';\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useMemo, useState } from 'react';\n\nimport {\n  ErrorPanel,\n  InfoCard,\n  Link,\n  SelectItem,\n  TableColumn,\n} from '@backstage/core-components';\nimport {\n  useApi,\n  useRouteRef,\n  useRouteRefParams,\n} from '@backstage/core-plugin-api';\n\nimport Grid from '@mui/material/Grid';\nimport TablePagination from '@mui/material/TablePagination';\n\nimport {\n  FieldFilter,\n  Filter,\n  NestedFilter,\n  PaginationInfoDTO,\n  PaginationInfoDTOOrderDirectionEnum,\n  ProcessInstanceStatusDTO,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { orchestratorApiRef } from '../../api';\nimport { DEFAULT_TABLE_PAGE_SIZE } from '../../constants';\nimport usePolling from '../../hooks/usePolling';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport {\n  entityInstanceRouteRef,\n  entityWorkflowRouteRef,\n  workflowInstanceRouteRef,\n  workflowRouteRef,\n} from '../../routes';\nimport { Trans } from '../Trans';\nimport { WorkflowRunDetail } from '../types/WorkflowRunDetail';\nimport OverrideBackstageTable from '../ui/OverrideBackstageTable';\nimport { Selector } from '../ui/Selector';\nimport { WorkflowInstanceStatusIndicator } from '../ui/WorkflowInstanceStatusIndicator';\nimport { mapProcessInstanceToDetails } from '../WorkflowInstancePage/WorkflowInstancePageContent';\n\nconst makeSelectItemsFromProcessInstanceValues = (t: any): SelectItem[] => [\n  { label: t('table.status.running'), value: ProcessInstanceStatusDTO.Active },\n  { label: t('table.status.failed'), value: ProcessInstanceStatusDTO.Error },\n  {\n    label: t('table.status.completed'),\n    value: ProcessInstanceStatusDTO.Completed,\n  },\n  { label: t('table.status.aborted'), value: ProcessInstanceStatusDTO.Aborted },\n  {\n    label: t('table.status.pending'),\n    value: ProcessInstanceStatusDTO.Suspended,\n  },\n];\n\nexport const WorkflowRunsTabContent = () => {\n  const { t } = useTranslation();\n\n  const statuses = makeSelectItemsFromProcessInstanceValues(t);\n  const started = [\n    t('table.filters.startedOptions.today'),\n    t('table.filters.startedOptions.yesterday'),\n    t('table.filters.startedOptions.last7days'),\n    t('table.filters.startedOptions.thisMonth'),\n  ].map(\n    (time): SelectItem => ({\n      label: time,\n      value: time,\n    }),\n  );\n  const entityInstanceLink = useRouteRef(entityInstanceRouteRef);\n  const { workflowId, kind, name, namespace } = useRouteRefParams(\n    entityWorkflowRouteRef,\n  );\n  let entityRef: string | undefined = undefined;\n  if (kind && namespace && name) {\n    entityRef = `${kind}:${namespace}/${name}`;\n  }\n  const orchestratorApi = useApi(orchestratorApiRef);\n  const workflowInstanceLink = useRouteRef(workflowInstanceRouteRef);\n  const workflowPageLink = useRouteRef(workflowRouteRef);\n\n  // selectors\n  const [statusSelectorValue, setStatusSelectorValue] = useState<string>(\n    Selector.AllItems,\n  );\n  const [startedSelectorValue, setStartedSelectorValue] = useState<string>(\n    Selector.AllItems,\n  );\n\n  const [page, setPage] = useState(0);\n  const [pageSize, setPageSize] = useState(DEFAULT_TABLE_PAGE_SIZE);\n  const [orderByField, setOrderByField] = useState<string>('start');\n  const [orderDirection, setOrderDirection] = useState('desc');\n\n  const getFilter = useCallback((): Filter | undefined => {\n    // runs for specific WF\n    const workflowIdFilter: FieldFilter | undefined = workflowId\n      ? {\n          operator: 'EQ',\n          value: workflowId,\n          field: 'processId',\n        }\n      : undefined;\n\n    const statusFilter: FieldFilter | undefined =\n      statusSelectorValue !== Selector.AllItems\n        ? {\n            operator: 'EQ',\n            value: statusSelectorValue,\n            field: 'state',\n          }\n        : undefined;\n\n    let startedFilter: FieldFilter | undefined = undefined;\n\n    if (startedSelectorValue !== Selector.AllItems) {\n      let dateRange: [string, string] | undefined = undefined;\n\n      const currentDate = new Date();\n      const endOfToday = new Date(currentDate);\n      endOfToday.setHours(23, 59, 59, 999);\n\n      switch (startedSelectorValue) {\n        case 'Today': {\n          const startOfToday = new Date();\n          startOfToday.setHours(0, 0, 0, 0);\n          dateRange = [startOfToday.toISOString(), endOfToday.toISOString()];\n          break;\n        }\n        case 'Yesterday': {\n          const startOfYesterday = new Date();\n          startOfYesterday.setDate(startOfYesterday.getDate() - 1);\n          startOfYesterday.setHours(0, 0, 0, 0);\n\n          const endOfYesterday = new Date(startOfYesterday);\n          endOfYesterday.setHours(23, 59, 59, 999);\n\n          dateRange = [\n            startOfYesterday.toISOString(),\n            endOfYesterday.toISOString(),\n          ];\n          break;\n        }\n        case 'Last 7 days': {\n          const startOfLast7Days = new Date();\n          startOfLast7Days.setDate(startOfLast7Days.getDate() - 7);\n          startOfLast7Days.setHours(0, 0, 0, 0);\n\n          dateRange = [\n            startOfLast7Days.toISOString(),\n            endOfToday.toISOString(),\n          ];\n          break;\n        }\n        case 'This month': {\n          const startOfCurrentMonth = new Date();\n          startOfCurrentMonth.setDate(1);\n          startOfCurrentMonth.setHours(0, 0, 0, 0);\n\n          dateRange = [\n            startOfCurrentMonth.toISOString(),\n            endOfToday.toISOString(),\n          ];\n          break;\n        }\n        default:\n          dateRange = undefined;\n      }\n\n      startedFilter =\n        startedSelectorValue !== Selector.AllItems\n          ? {\n              operator: 'BETWEEN',\n              value: dateRange,\n              field: 'start',\n            }\n          : undefined;\n    }\n\n    const nestedVariablesFilter: NestedFilter | undefined = entityRef\n      ? {\n          field: 'variables',\n          nested: {\n            operator: 'EQ',\n            value: entityRef,\n            field: 'targetEntity',\n          },\n        }\n      : undefined;\n\n    const filters = [\n      statusFilter,\n      workflowIdFilter,\n      startedFilter,\n      nestedVariablesFilter,\n    ].filter(Boolean) as FieldFilter[]; // removes undefined filters\n\n    if (filters.length > 1) {\n      return {\n        operator: 'AND',\n        filters,\n      };\n    }\n    return filters[0] || undefined;\n  }, [workflowId, statusSelectorValue, startedSelectorValue, entityRef]);\n\n  const fetchInstances = useCallback(async () => {\n    const paginationInfo: PaginationInfoDTO = {\n      pageSize: pageSize + 1, // add one more to know if this is the last page or there are more instances. If there are no more instances, next button is disabled.\n      offset: page * pageSize,\n      orderBy: orderByField,\n      orderDirection:\n        orderDirection === 'asc'\n          ? PaginationInfoDTOOrderDirectionEnum.Asc\n          : PaginationInfoDTOOrderDirectionEnum.Desc,\n    };\n    const filter = getFilter();\n    const instances = await orchestratorApi.listInstances(\n      paginationInfo,\n      filter,\n    );\n\n    const clonedData: WorkflowRunDetail[] =\n      instances.data.items?.map(mapProcessInstanceToDetails) || [];\n    return clonedData;\n  }, [\n    orchestratorApi,\n    page,\n    pageSize,\n    orderByField,\n    orderDirection,\n    getFilter,\n  ]);\n\n  const { loading, error, value } = usePolling(fetchInstances);\n\n  const applyBackendSort = useCallback(\n    (item1: WorkflowRunDetail, item2: WorkflowRunDetail): number => {\n      // Workaround for material-table applying sorting on top of backend sorting. The version we are using is too old to request a fix.\n      // Should be resolved when upgrading backstage and all plugins to material6\n      // The workaround is to configure the FE sorting material-table applies to be according to order received from backend\n      // TODO: resolve when upgrading to material 6\n      if (!value) {\n        return 0;\n      }\n      const item1Index = value?.findIndex(curItem => curItem.id === item1.id);\n      const item2Index = value?.findIndex(curItem => curItem.id === item2.id);\n      return orderDirection === 'asc'\n        ? item1Index - item2Index\n        : item2Index - item1Index;\n    },\n    [value, orderDirection],\n  );\n\n  const columns = useMemo(\n    (): TableColumn<WorkflowRunDetail>[] => [\n      {\n        title: 'ID',\n        field: 'id',\n        render: data =>\n          entityRef ? (\n            <Link\n              to={entityInstanceLink({\n                namespace,\n                kind,\n                name,\n                workflowId,\n                instanceId: data.id,\n              })}\n            >\n              {data.id}\n            </Link>\n          ) : (\n            <Link to={workflowInstanceLink({ instanceId: data.id })}>\n              {data.id}\n            </Link>\n          ),\n        sorting: false,\n      },\n      ...(workflowId\n        ? []\n        : [\n            {\n              title: t('table.headers.workflowName'),\n              field: 'processName',\n              customSort: applyBackendSort,\n              render: (data: WorkflowRunDetail) => (\n                <Link to={workflowPageLink({ workflowId: data.workflowId })}>\n                  {data.processName}\n                </Link>\n              ),\n            },\n          ]),\n      {\n        title: t('table.headers.runStatus'),\n        field: 'state',\n        render: (data: WorkflowRunDetail) => (\n          <WorkflowInstanceStatusIndicator\n            status={data.state as ProcessInstanceStatusDTO}\n          />\n        ),\n      },\n      {\n        title: t('table.headers.started'),\n        field: 'start',\n        customSort: applyBackendSort,\n      },\n      { title: t('table.headers.duration'), field: 'duration', sorting: false },\n    ],\n    [\n      t,\n      workflowInstanceLink,\n      workflowId,\n      workflowPageLink,\n      applyBackendSort,\n      entityInstanceLink,\n      name,\n      kind,\n      namespace,\n      entityRef,\n    ],\n  );\n\n  let data = value || [];\n  let hasNextPage = false;\n  if (data.length === pageSize + 1) {\n    hasNextPage = true;\n    data = data.slice(0, -1);\n  }\n  const enablePaging = page > 0 || hasNextPage;\n\n  return error ? (\n    <ErrorPanel error={error} />\n  ) : (\n    <Grid container item xs={12} spacing={2}>\n      <Grid item>\n        <Selector\n          label={t('table.filters.status')}\n          items={statuses}\n          onChange={value_ => {\n            setStatusSelectorValue(value_);\n            setPage(0);\n          }}\n          selected={statusSelectorValue}\n        />\n        <Selector\n          label={t('table.filters.started')}\n          items={started}\n          onChange={value_ => {\n            setStartedSelectorValue(value_);\n            setPage(0);\n          }}\n          selected={startedSelectorValue}\n        />\n      </Grid>\n      <Grid item xs style={{ flexGrow: 1 }}>\n        <InfoCard\n          noPadding\n          title={\n            workflowId ? (\n              <Trans\n                message=\"table.title.allWorkflowRuns\"\n                params={{ count: data.length }}\n              />\n            ) : (\n              <Trans\n                message=\"table.title.allRuns\"\n                params={{ count: data.length }}\n              />\n            )\n          }\n        >\n          <OverrideBackstageTable\n            removeOutline\n            isLoading={loading}\n            columns={columns}\n            data={data}\n            options={{\n              paging: false,\n            }}\n            onOrderChange={(\n              orderBy_: number,\n              orderDirection_: 'asc' | 'desc',\n            ) => {\n              const field = columns[orderBy_].field;\n              if (!field) {\n                throw new Error(`Failed to find column number ${orderBy_}`);\n              }\n              setOrderByField(field);\n              setOrderDirection(orderDirection_);\n            }}\n            components={{\n              Toolbar: () => <></>, // this removes the search filter, which isn't applicable for most fields\n            }}\n          />\n          {enablePaging && (\n            <TablePagination\n              component=\"div\"\n              count={-1}\n              page={page}\n              onPageChange={(_, page_) => setPage(page_)}\n              onRowsPerPageChange={e => {\n                setPageSize(parseInt(e.target.value, 10));\n                setPage(0);\n              }}\n              rowsPerPage={pageSize}\n              labelDisplayedRows={({ from }) => {\n                return `${from}-${from + data.length - 1}`;\n              }}\n              rowsPerPageOptions={[5, 10, 20]}\n              nextIconButtonProps={{ disabled: !hasNextPage }}\n            />\n          )}\n        </InfoCard>\n      </Grid>\n    </Grid>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PropsWithChildren } from 'react';\n\nimport { Content, Header, Page } from '@backstage/core-components';\n\nexport interface BaseOrchestratorProps {\n  title?: string;\n  subtitle?: string;\n  type?: string;\n  typeLink?: string;\n  noPadding?: boolean;\n}\n\nexport const BaseOrchestratorPage = ({\n  title,\n  subtitle,\n  type,\n  typeLink,\n  noPadding,\n  children,\n}: PropsWithChildren<BaseOrchestratorProps>) => {\n  return (\n    <Page themeId=\"tool\">\n      <Header\n        title={title}\n        subtitle={subtitle}\n        type={type}\n        typeLink={typeLink}\n      />\n      <Content noPadding={noPadding}>{children}</Content>\n    </Page>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useNavigate } from 'react-router-dom';\n\nimport { useRouteRef, useRouteRefParams } from '@backstage/core-plugin-api';\n\nimport Button from '@mui/material/Button';\nimport Grid from '@mui/material/Grid';\nimport Skeleton from '@mui/material/Skeleton';\nimport Tooltip from '@mui/material/Tooltip';\n\nimport {\n  orchestratorWorkflowUsePermission,\n  orchestratorWorkflowUseSpecificPermission,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { usePermissionArrayDecision } from '../../hooks/usePermissionArray';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { executeWorkflowRouteRef, workflowRouteRef } from '../../routes';\n\nexport const RunButton = ({\n  isAvailable,\n  entityRef,\n}: {\n  isAvailable?: boolean;\n  entityRef?: string;\n}) => {\n  const { t } = useTranslation();\n  const { workflowId } = useRouteRefParams(workflowRouteRef);\n  const navigate = useNavigate();\n  const executeWorkflowLink = useRouteRef(executeWorkflowRouteRef);\n  const handleExecute = () => {\n    navigate(\n      entityRef\n        ? `${executeWorkflowLink({ workflowId })}?targetEntity=${entityRef}`\n        : executeWorkflowLink({ workflowId }),\n    );\n  };\n\n  const { loading: loadingPermission, allowed: canRun } =\n    usePermissionArrayDecision([\n      orchestratorWorkflowUsePermission,\n      orchestratorWorkflowUseSpecificPermission(workflowId),\n    ]);\n\n  let tooltipText = '';\n  if (!canRun) {\n    tooltipText = t('workflow.messages.userNotAuthorizedExecute');\n  } else if (!isAvailable) {\n    tooltipText = t('workflow.messages.workflowDown');\n  }\n\n  return (\n    <Grid item container justifyContent=\"flex-end\" xs={12} spacing={2}>\n      <Grid item>\n        {loadingPermission ? (\n          <Skeleton variant=\"text\" width=\"5rem\" />\n        ) : (\n          <Tooltip\n            title={tooltipText}\n            disableHoverListener={tooltipText === ''}\n          >\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={handleExecute}\n              disabled={!canRun}\n            >\n              {t('workflow.buttons.run')}\n            </Button>\n          </Tooltip>\n        )}\n      </Grid>\n    </Grid>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CodeSnippet, ErrorPanel } from '@backstage/core-components';\n\nimport { makeStyles } from 'tss-react/mui';\n\nimport { WorkflowFormatDTO } from '@redhat/backstage-plugin-orchestrator-common';\n\ntype WorkflowEditorProps = {\n  format: WorkflowFormatDTO;\n  loadingWorkflowSource: boolean;\n  workflowSource: string;\n  errorWorkflowSource: Error | undefined;\n};\n\nconst useStyles = makeStyles()(_ => ({\n  codeSnippetCOntainer: {\n    '& pre': {\n      backgroundColor: 'transparent !important',\n    },\n  },\n}));\n\nconst ServerlessWorkflowEditor = ({\n  format,\n  loadingWorkflowSource,\n  workflowSource,\n  errorWorkflowSource,\n}: WorkflowEditorProps) => {\n  const { classes } = useStyles();\n\n  return (\n    <>\n      {errorWorkflowSource && <ErrorPanel error={errorWorkflowSource} />}\n      {!loadingWorkflowSource && !errorWorkflowSource && (\n        <div className={classes.codeSnippetCOntainer}>\n          <CodeSnippet\n            text={workflowSource}\n            language={format}\n            showLineNumbers\n            showCopyCodeButton\n          />\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default ServerlessWorkflowEditor;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { InfoCard } from '@backstage/core-components';\nimport { AboutField } from '@backstage/plugin-catalog';\n\nimport Grid from '@mui/material/Grid';\nimport Skeleton from '@mui/material/Skeleton';\nimport { makeStyles } from 'tss-react/mui';\n\nimport { WorkflowOverviewDTO } from '@redhat/backstage-plugin-orchestrator-common';\n\nimport WorkflowOverviewFormatter from '../../dataFormatters/WorkflowOverviewFormatter';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { WorkflowStatus } from '../ui/WorkflowStatus';\n\nconst useStyles = makeStyles()(() => ({\n  details: {\n    overflowY: 'auto',\n    minHeight: '10rem',\n    maxHeight: '15rem',\n  },\n}));\n\nconst WorkflowDefinitionDetailsCard = ({\n  loading,\n  workflowOverview,\n}: {\n  loading: boolean;\n  workflowOverview?: WorkflowOverviewDTO;\n}) => {\n  const { t } = useTranslation();\n  const { classes } = useStyles();\n\n  const formattedWorkflowOverview = useMemo(\n    () =>\n      workflowOverview\n        ? WorkflowOverviewFormatter.format(workflowOverview)\n        : undefined,\n    [workflowOverview],\n  );\n\n  return (\n    <InfoCard title={t('workflow.details')} className={classes.details}>\n      <Grid container spacing={7} alignContent=\"flex-start\" wrap=\"nowrap\">\n        <Grid item key=\"workflow status\">\n          {/* AboutField requires the value to be defined as a prop as well */}\n          <AboutField\n            label={t('workflow.fields.workflowStatus')}\n            value={formattedWorkflowOverview?.availability}\n          >\n            {loading ? (\n              <Skeleton variant=\"text\" />\n            ) : (\n              <b>\n                <WorkflowStatus\n                  availability={formattedWorkflowOverview?.availability}\n                />\n              </b>\n            )}\n          </AboutField>\n        </Grid>\n        <Grid item md={7}>\n          <AboutField\n            label={t('workflow.fields.description')}\n            value={formattedWorkflowOverview?.description}\n          >\n            {loading ? (\n              <Skeleton variant=\"text\" />\n            ) : (\n              formattedWorkflowOverview?.description\n            )}\n          </AboutField>\n        </Grid>\n      </Grid>\n    </InfoCard>\n  );\n};\n\nexport default WorkflowDefinitionDetailsCard;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useAsync } from 'react-use';\n\nimport { InfoCard, ResponseErrorPanel } from '@backstage/core-components';\nimport { useApi, useRouteRefParams } from '@backstage/core-plugin-api';\nimport { usePermission } from '@backstage/plugin-permission-react';\n\nimport Grid from '@mui/material/Grid';\n\nimport {\n  orchestratorAdminViewPermission,\n  WorkflowOverviewDTO,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { orchestratorApiRef } from '../../api';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { entityWorkflowRouteRef, workflowRouteRef } from '../../routes';\nimport ServerlessWorkflowEditor from './ServerlessWorkflowEditor';\nimport WorkflowDefinitionDetailsCard from './WorkflowDetailsCard';\n\ninterface Props {\n  loadingWorkflowOverview: boolean;\n  workflowOverviewDTO: WorkflowOverviewDTO | undefined;\n  errorWorkflowOverview: Error | undefined;\n}\n\nexport const WorkflowDetailsTabContent = ({\n  loadingWorkflowOverview,\n  workflowOverviewDTO,\n  errorWorkflowOverview,\n}: Props) => {\n  const { t } = useTranslation();\n  const adminView = usePermission({\n    permission: orchestratorAdminViewPermission,\n  });\n  const { workflowId } = useRouteRefParams(workflowRouteRef);\n  const orchestratorApi = useApi(orchestratorApiRef);\n\n  const { loading, value, error } = useAsync(() => {\n    return orchestratorApi.getWorkflowSource(workflowId);\n  }, []);\n\n  const { kind, name, namespace } = useRouteRefParams(entityWorkflowRouteRef);\n  let entityRef: string | undefined = undefined;\n  if (kind && namespace && name) {\n    entityRef = `${kind}:${namespace}/${name}`;\n  }\n\n  return (\n    <Grid container item direction=\"column\" xs={12} spacing={2} wrap=\"nowrap\">\n      {errorWorkflowOverview && (\n        <Grid item>\n          <ResponseErrorPanel error={errorWorkflowOverview} />\n        </Grid>\n      )}\n      <Grid item>\n        <WorkflowDefinitionDetailsCard\n          workflowOverview={workflowOverviewDTO}\n          loading={loadingWorkflowOverview}\n        />\n      </Grid>\n      {workflowOverviewDTO && adminView.allowed && value && !entityRef && (\n        <Grid item>\n          <InfoCard title={t('workflow.definition')}>\n            <ServerlessWorkflowEditor\n              format={workflowOverviewDTO.format}\n              loadingWorkflowSource={loading}\n              workflowSource={value.data}\n              errorWorkflowSource={error}\n            />\n          </InfoCard>\n        </Grid>\n      )}\n    </Grid>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useAsync } from 'react-use';\n\nimport { Content } from '@backstage/core-components';\nimport { useApi, useRouteRefParams } from '@backstage/core-plugin-api';\n\nimport { Grid } from '@material-ui/core';\n\nimport { orchestratorApiRef } from '../../api';\nimport { entityWorkflowRouteRef } from '../../routes';\nimport { WorkflowRunsTabContent } from '../OrchestratorPage/WorkflowRunsTabContent';\nimport { BaseOrchestratorPage } from '../ui/BaseOrchestratorPage';\nimport { RunButton } from '../WorkflowPage/RunButton';\nimport { WorkflowDetailsTabContent } from '../WorkflowPage/WorkflowDetailsTabContent';\n\nexport const CatalogWorkflowPage = () => {\n  const { workflowId, kind, name, namespace } = useRouteRefParams(\n    entityWorkflowRouteRef,\n  );\n  const orchestratorApi = useApi(orchestratorApiRef);\n\n  const {\n    value: workflowOverviewDTO,\n    loading: loadingWorkflowOverview,\n    error: errorWorkflowOverview,\n  } = useAsync(() => {\n    return orchestratorApi.getWorkflowOverview(workflowId);\n  }, []);\n\n  return (\n    <BaseOrchestratorPage\n      title={workflowOverviewDTO?.data.name || workflowId}\n      type={name}\n      typeLink={`/catalog/${namespace}/${kind}/${name}/workflows`}\n      noPadding\n    >\n      <Content>\n        <Grid container spacing={2}>\n          <Grid item xs={12}>\n            <RunButton\n              isAvailable={workflowOverviewDTO?.data.isAvailable}\n              entityRef={`${kind}:${namespace}/${name}`}\n            />\n          </Grid>\n          <Grid item xs={12}>\n            <WorkflowDetailsTabContent\n              loadingWorkflowOverview={loadingWorkflowOverview}\n              workflowOverviewDTO={workflowOverviewDTO?.data}\n              errorWorkflowOverview={errorWorkflowOverview}\n            />\n          </Grid>\n          <Grid item xs={12}>\n            <WorkflowRunsTabContent />\n          </Grid>\n        </Grid>\n      </Content>\n    </BaseOrchestratorPage>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-use-before-define */\n\nimport { JsonObject } from '@backstage/types';\n\nimport { UiSchema } from '@rjsf/utils';\nimport type { JSONSchema7, JSONSchema7Definition } from 'json-schema';\nimport get from 'lodash/get';\nimport merge from 'lodash/merge';\nimport set from 'lodash/set';\n\n/**\n * Extracts the uiSchema from a mixed JSON Schema that includes\n * both standard JSON Schema properties and react-json-schema-form specific\n * UI Schema properties (prefixed with 'ui:'). The function does not modify\n * the original JSON Schema.\n *\n * @param mixedSchema - The JSON Schema that contains both standard and UI Schema properties.\n * @returns An object representing the uiSchema.\n */\n\nconst getSchemaDefinition = (ref: string, rootSchema: JSONSchema7) => {\n  const path = ref.replace(/^#\\//, '').replace(/\\//g, '.');\n  return get(rootSchema, path);\n};\n\nconst getStringAfterDot = (input: string) =>\n  input.startsWith('.') ? input.slice(1) : input;\n\nfunction replaceSparseArrayElementsdWithEmptyObject(value: any): any {\n  /* handle cases where ui: properties exists for some of the itmes in the array, for example: \n    {\n      \"selectedItem\": {\n      \"anyOf\": [\n        ,\n        ,\n        {\n          \"ui:widget\": \"color\",\n        },\n      ],\n    }\n    the function will return \n    {\n      \"selectedItem\": {\n      \"anyOf\": [\n        {},\n        {},\n        {\n          \"ui:widget\": \"color\",\n        },\n      ],\n    }\n  */\n  if (Array.isArray(value)) {\n    return [...value].map(item => {\n      return item ? replaceSparseArrayElementsdWithEmptyObject(item) : {};\n    });\n  } else if (value && typeof value === 'object') {\n    return Object.keys(value).reduce(\n      (acc, key) => {\n        acc[key] = replaceSparseArrayElementsdWithEmptyObject(value[key]);\n        return acc;\n      },\n      {} as Record<string, any>,\n    );\n  }\n  return value;\n}\n\nfunction extractUiSchema(mixedSchema: JSONSchema7): UiSchema<JsonObject> {\n  const rootSchema = mixedSchema;\n  const result = {};\n\n  const processObjectProperties = (\n    properties: {\n      [key: string]: JSONSchema7Definition;\n    },\n    path: string,\n  ) => {\n    for (const [key, value] of Object.entries(properties)) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      processObject(value, `${path}.${key}`);\n    }\n  };\n\n  const processObject = (curSchema: JSONSchema7Definition, path: string) => {\n    if (typeof curSchema === 'boolean') {\n      return;\n    }\n    if (curSchema.$ref) {\n      processObject(getSchemaDefinition(curSchema.$ref, rootSchema), path);\n    } else if (curSchema.properties) {\n      processObjectProperties(curSchema.properties, path);\n    } else if (curSchema.items) {\n      processArraySchema(curSchema, path);\n    } else {\n      processLeafSchema(curSchema, path);\n    }\n    processOrder(curSchema, path);\n    processComposedSchema(curSchema, path);\n  };\n\n  const processOrder = (curSchema: JSONSchema7Definition, path: string) => {\n    const uiOrder = get(curSchema, 'ui:order');\n    if (uiOrder) {\n      const diff = {};\n      set(diff, getStringAfterDot(`${path}.ui:order`), uiOrder);\n      merge(result, diff);\n    }\n  };\n\n  const processLeafSchema = (\n    leafSchema: JSONSchema7Definition,\n    path: string,\n  ) => {\n    for (const [subSchemaKey, value] of Object.entries(leafSchema)) {\n      if (subSchemaKey.startsWith('ui:')) {\n        set(result, getStringAfterDot(`${path}.${subSchemaKey}`), value);\n      }\n    }\n  };\n\n  const processArrayItems = (items: JSONSchema7Definition[], path: string) => {\n    for (let i = 0; i < items.length; ++i) {\n      processObject(items[i], `${path}[${i}]`);\n    }\n  };\n\n  const processArraySchema = (schema: JSONSchema7, path: string) => {\n    if (Array.isArray(schema.items)) {\n      processArrayItems(schema.items, `${path}.items`);\n    } else if (typeof schema.items === 'object') {\n      processObject(schema.items, `${path}.items`);\n    }\n    if (schema.additionalItems && typeof schema.additionalItems === 'object') {\n      processObject(schema.additionalItems, `${path}.additinalItems`);\n    }\n    processLeafSchema(schema, path);\n  };\n\n  const processComposedSchema = (curSchema: JSONSchema7, path: string) => {\n    if (curSchema.anyOf) {\n      processArrayItems(curSchema.anyOf, `${path}.anyOf`);\n    } else if (curSchema.oneOf) {\n      processArrayItems(curSchema.oneOf, `${path}.oneOf`);\n    } else if (curSchema.allOf) {\n      processArrayItems(curSchema.allOf, `${path}.allOf`);\n    } else if (curSchema.then) {\n      processObject(curSchema.then, `${path}`);\n      if (curSchema.else) {\n        processObject(curSchema.else, `${path}`);\n      }\n    }\n  };\n\n  processObject(mixedSchema, '');\n  return replaceSparseArrayElementsdWithEmptyObject(result);\n}\n\nconst addFocusOnFirstElement = (\n  schema: JSONSchema7,\n  uiSchema: UiSchema<JsonObject>,\n  isMultiStep: boolean,\n) => {\n  if (!schema.properties) {\n    return;\n  }\n  if (!isMultiStep) {\n    const firstKey = Object.keys(schema.properties)[0];\n    uiSchema[firstKey] = {\n      ...uiSchema[firstKey],\n      'ui:autofocus': true,\n    };\n  }\n  for (const [stepKey, subSchema] of Object.entries(schema.properties)) {\n    if (typeof subSchema !== 'object') {\n      return;\n    }\n    const _subSchema = subSchema.$ref\n      ? getSchemaDefinition(subSchema.$ref, schema)\n      : subSchema;\n    if (!_subSchema.properties) {\n      return;\n    }\n    const subSchemaFirstKey = Object.keys(_subSchema.properties)[0];\n    uiSchema[stepKey] = {\n      ...uiSchema[stepKey],\n      [subSchemaFirstKey]: {\n        ...uiSchema[stepKey]?.[subSchemaFirstKey],\n        'ui:autofocus': true,\n      },\n    };\n  }\n};\n\nconst generateUiSchema = (\n  schema: JSONSchema7,\n  isMultiStep: boolean,\n): UiSchema<JsonObject> => {\n  const uiSchema = extractUiSchema(schema);\n  addFocusOnFirstElement(schema, uiSchema, isMultiStep);\n  return uiSchema;\n};\n\nexport default generateUiSchema;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, ReactNode, useContext, useMemo, useState } from 'react';\n\nimport { TranslationFunction } from '../hooks/useTranslation';\n\nexport type StepperContext = {\n  activeStep: number;\n  handleNext: () => void;\n  handleBack: () => void;\n  reviewStep: ReactNode;\n  isValidating: boolean;\n  handleValidateStarted: () => void;\n  handleValidateEnded: () => void;\n  t: TranslationFunction;\n};\n\nconst context = createContext<StepperContext | null>(null);\n\nexport const useStepperContext = (): StepperContext => {\n  const multiStepFormContext = useContext(context);\n  if (!multiStepFormContext) {\n    throw new Error('Context StepperContext is not defined');\n  }\n  return multiStepFormContext;\n};\n\nexport const StepperContextProvider = ({\n  children,\n  reviewStep,\n  t,\n}: {\n  children: ReactNode;\n  reviewStep: ReactNode;\n  t: TranslationFunction;\n}) => {\n  const [activeStep, setActiveStep] = useState<number>(0);\n  const [isValidating, setIsValidating] = useState<boolean>(false);\n  const contextData = useMemo(() => {\n    return {\n      activeStep,\n      handleNext: () => {\n        setActiveStep(curActiveStep => curActiveStep + 1);\n      },\n      handleBack: () => setActiveStep(curActiveStep => curActiveStep - 1),\n      reviewStep,\n      isValidating,\n      handleValidateStarted: () => setIsValidating(true),\n      handleValidateEnded: () => setIsValidating(false),\n      t,\n    };\n  }, [t, setActiveStep, activeStep, reviewStep, isValidating, setIsValidating]);\n  return <context.Provider value={contextData}>{children}</context.Provider>;\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport {\n  FormDecoratorProps,\n  OrchestratorFormApi,\n  OrchestratorFormContextProps,\n  OrchestratorFormDecorator,\n} from '@redhat/backstage-plugin-orchestrator-form-api';\n\nclass DefaultFormApi implements OrchestratorFormApi {\n  getFormDecorator(): OrchestratorFormDecorator {\n    // eslint-disable-next-line no-console\n    console.log(\n      'Using the Orchestrator DefaultFormApi (without additional extensions).',\n    );\n\n    return (FormComponent: React.ComponentType<FormDecoratorProps>) =>\n      (props: OrchestratorFormContextProps) => (\n        <FormComponent formContext={props} />\n      );\n  }\n}\n\nexport const defaultFormExtensionsApi = new DefaultFormApi();\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createApiRef, useApiHolder } from '@backstage/core-plugin-api';\nimport { JsonObject } from '@backstage/types';\n\nimport { FormProps } from '@rjsf/core';\nimport { ErrorSchema, UiSchema } from '@rjsf/utils';\nimport type { JSONSchema7 } from 'json-schema';\n\nimport { AuthTokenDescriptor } from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { defaultFormExtensionsApi } from './DefaultFormApi';\n\n/**\n/**\n * @public\n *\n */\nexport type OrchestratorFormContextProps = {\n  schema: JSONSchema7;\n  updateSchema: OrchestratorFormSchemaUpdater;\n  numStepsInMultiStepSchema?: number;\n  uiSchema: UiSchema<JsonObject, JSONSchema7>;\n  formData: JsonObject;\n  setFormData: (data: JsonObject) => void;\n  children: React.ReactNode;\n  onSubmit: (formData: JsonObject) => void;\n  setAuthTokenDescriptors: (\n    authTokenDescriptors: AuthTokenDescriptor[],\n  ) => void;\n  getIsChangedByUser: (id: string) => boolean;\n  setIsChangedByUser: (id: string, isChangedByUser: boolean) => void;\n};\n\n/**\n * @public\n * FormDecoratorProps\n *\n * Type definition for properties passed to a form decorator component.\n * This interface extends selected fields from `FormProps` provided by `react-jsonschema-form`,\n * with additional custom functionality.\n *\n * @see {@link https://rjsf-team.github.io/react-jsonschema-form/docs/api-reference/form-props|RJSF Form Props Documentation}\n *\n * Core properties include:\n * - formData: The form's current data\n * - formContext: Contextual data shared across form components\n * - widgets: Custom widget components for form fields\n * - onChange: Handler for form data changes\n * - customValidate: Custom validation function\n *\n * Additional properties:\n * - getExtraErrors: Async function to fetch additional validation errors.\n *   This replaces the static 'extraErrors' prop from react-jsonschema-form, which can't be used as is, since onSubmit isn't exposed.\n *   The orchestrator form component will call getExtraErrors when running onSubmit.\n */\nexport type FormDecoratorProps = Pick<\n  FormProps<JsonObject, JSONSchema7, OrchestratorFormContextProps>,\n  | 'formData'\n  | 'formContext'\n  | 'widgets'\n  | 'onChange'\n  | 'customValidate'\n  | 'templates'\n> & {\n  getExtraErrors?: (\n    formData: JsonObject,\n    uiSchema: OrchestratorFormContextProps['uiSchema'],\n  ) => Promise<ErrorSchema<JsonObject>> | undefined;\n};\n\n/**\n * @public\n * OrchestratorFormDecorator\n *\n */\nexport type OrchestratorFormDecorator = (\n  FormComponent: React.ComponentType<FormDecoratorProps>,\n) => React.ComponentType<OrchestratorFormContextProps>;\n\n/**\n * @public\n *\n * Expected response received by fetch:url of the SchemaUpdater widget.\n *\n * Key is the JSON Schema placeholder identifier,\n * Value is content the key will be newly assigned to.\n */\nexport type SchemaChunksResponse = {\n  [key: string]: JsonObject;\n};\n\n/**\n * @public\n *\n * Function provided by the Orchestrator down to the OrchestratorFormApi to update the form's JSON Schema on the fly.\n */\nexport type OrchestratorFormSchemaUpdater = (\n  chunks: SchemaChunksResponse,\n) => void;\n\n/**\n * @public\n * OrchestratorFormApi\n * API to be implemented by factory in a custom plugin\n */\nexport interface OrchestratorFormApi {\n  /**\n   * @public\n   * Context wrapping the RJSF form on Workflow execution page, making it available for the custom widgets.\n   *\n   * Must be created by the API to share just a single instance within both the OrchestratorFormApi and\n   * the Orchestrator where the context is actually provided (see OrchestratorFormWrapper).\n   */\n  // getFormContext(): Context<OrchestratorFormContextProps | null>;\n\n  /**\n   * @public\n   * getFormDecorator\n   * return the form decorator\n   */\n  getFormDecorator(): OrchestratorFormDecorator;\n}\n\n/**\n * @public\n * OrchestratorFormApiRef\n *\n */\nexport const orchestratorFormApiRef = createApiRef<OrchestratorFormApi>({\n  id: 'plugin.orchestrator.form',\n});\n\nexport const useOrchestratorFormApiOrDefault = (): OrchestratorFormApi =>\n  useApiHolder().get(orchestratorFormApiRef) ?? defaultFormExtensionsApi;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useStepperContext } from '../utils/StepperContext';\n\nexport type TranslationFunction = (key: string) => string;\n\n// Motivation for passing t in the context:\n// Keep a single set of translation files\n// Avoid introduction new plugin for them\n// Avoid moving them to a common package\n\nexport const useTranslation = (): {\n  t: TranslationFunction;\n} => ({ t: useStepperContext().t });\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { JSONSchema7, JSONSchema7Definition } from 'json-schema';\nimport get from 'lodash/get';\n\n/**\n * Get step entries from the schema sorted by the ui:order property.\n * If the ui:order property is not present, the step entries are sorted by the order of the properties in the schema.\n *\n * @param schema - The schema to get the sorted step entries from.\n * @returns An array of [key, subSchema] pairs, a subSchema conforms a single wizard step.\n */\nexport const getSortedStepEntries = (\n  schema: JSONSchema7,\n): [string, JSONSchema7Definition][] | undefined => {\n  if (!schema.properties) {\n    return undefined;\n  }\n\n  let sortedStepEntries = Object.entries(schema.properties);\n\n  const uiOrder = get(schema, 'ui:order') as string[] | undefined;\n  if (uiOrder && uiOrder.length > 0) {\n    sortedStepEntries = uiOrder\n      .map(key =>\n        schema.properties?.[key] ? [key, schema.properties[key]] : undefined,\n      )\n      .filter(Boolean) as [string, JSONSchema7Definition][];\n\n    Object.entries(schema.properties).forEach(([key, subSchema]) => {\n      if (!uiOrder.includes(key)) {\n        sortedStepEntries.push([key, subSchema]);\n      }\n    });\n  }\n\n  return sortedStepEntries;\n};\n\nexport const getActiveStepKey = (\n  schema: JSONSchema7,\n  activeStep: number,\n): string => {\n  const sortedStepEntries = getSortedStepEntries(schema) ?? [];\n  const activeKey = sortedStepEntries[activeStep]?.[0];\n  if (!activeKey) {\n    throw new Error(\n      `Active step key not found for activeStep: ${activeStep} in schema: ${JSON.stringify(schema)}`,\n    );\n  }\n  return activeKey;\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\n\nimport {\n  createErrorHandler,\n  CustomValidator,\n  ErrorSchema,\n  RJSFValidationError,\n  unwrapErrorHandler,\n  ValidationData,\n  validationDataMerge,\n  ValidatorType,\n} from '@rjsf/utils';\nimport validatorAjv from '@rjsf/validator-ajv8';\nimport _validator from '@rjsf/validator-ajv8';\nimport type { JSONSchema7 } from 'json-schema';\n\nimport { getActiveStepKey } from './getSortedStepEntries';\nimport { useStepperContext } from './StepperContext';\n\n// add the activeStep to the validator to force rjsf form to rerender when activeStep changes. This doesn't happen because it assumes function are equal.\n// see https://github.com/rjsf-team/react-jsonschema-form/blob/v5.18.5/packages/utils/src/deepEquals.ts#L12\n\nexport type ValidatorTypeForceRender = ValidatorType<\n  JsonObject,\n  JSONSchema7\n> & {\n  activeStep: number;\n};\n\nconst useValidator = (isMultiStepSchema: boolean) => {\n  const { activeStep } = useStepperContext();\n  const validator: ValidatorTypeForceRender = {\n    activeStep,\n    validateFormData: (\n      formData: JsonObject,\n      _schema: JSONSchema7,\n      customValidate: CustomValidator<JsonObject, JSONSchema7, any>,\n    ): ValidationData<JsonObject> => {\n      let validationData = validatorAjv.validateFormData(formData, _schema);\n      if (customValidate) {\n        const errorHandler = customValidate(\n          formData,\n          createErrorHandler<JsonObject>(formData),\n        );\n        const userErrorSchema = unwrapErrorHandler<JsonObject>(errorHandler);\n        validationData = validationDataMerge<JsonObject>(\n          validationData,\n          userErrorSchema,\n        );\n      }\n\n      if (!isMultiStepSchema) {\n        return validationData;\n      }\n\n      const activeKey = getActiveStepKey(_schema, activeStep);\n      return {\n        errors: validationData.errors.filter(err =>\n          err.property?.startsWith(`.${activeKey}.`),\n        ),\n        errorSchema: validationData.errorSchema[activeKey] || {},\n      };\n    },\n\n    toErrorList: (\n      errorSchema?: ErrorSchema<any>,\n      fieldPath?: string[],\n    ): RJSFValidationError[] => {\n      return validatorAjv.toErrorList(errorSchema, fieldPath);\n    },\n\n    isValid: (\n      _schema: JSONSchema7,\n      formData: JsonObject | undefined,\n      rootSchema: JSONSchema7,\n    ) => {\n      return validatorAjv.isValid(_schema, formData, rootSchema);\n    },\n\n    rawValidation: (_schema: JSONSchema7, formData?: JsonObject) =>\n      validatorAjv.rawValidation(_schema, formData),\n  };\n\n  return validator;\n};\n\nexport default useValidator;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useEffect } from 'react';\n\nimport { JsonObject } from '@backstage/types/index';\n\nimport { Widget } from '@rjsf/utils';\nimport type { JSONSchema7 } from 'json-schema';\n\nimport { AuthTokenDescriptor } from '@redhat/backstage-plugin-orchestrator-common';\nimport { OrchestratorFormContextProps } from '@redhat/backstage-plugin-orchestrator-form-api';\n\ntype UiProps = {\n  authTokenDescriptors?: AuthTokenDescriptor[];\n};\n\nexport const AuthRequester: Widget<\n  JsonObject,\n  JSONSchema7,\n  OrchestratorFormContextProps\n> = props => {\n  const setAuthTokenDescriptors = props.formContext?.setAuthTokenDescriptors;\n  const uiProps = (props.options?.props ?? {}) as UiProps;\n\n  useEffect(() => {\n    if (setAuthTokenDescriptors) {\n      setAuthTokenDescriptors(uiProps.authTokenDescriptors || []);\n    }\n  }, [setAuthTokenDescriptors, uiProps.authTokenDescriptors]);\n\n  return <></>;\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ReactNode, useEffect, useRef } from 'react';\n\nimport Button from '@mui/material/Button';\nimport CircularProgress from '@mui/material/CircularProgress';\n\n/**\n * @public\n * Button with loading state.\n */\nconst SubmitButton = ({\n  submitting,\n  handleClick,\n  children,\n  focusOnMount,\n}: {\n  submitting: boolean;\n  handleClick?: () => void;\n  children: ReactNode;\n  focusOnMount?: boolean;\n}) => {\n  const ref = useRef<HTMLButtonElement>(null);\n  useEffect(() => {\n    if (focusOnMount) {\n      ref.current?.focus();\n    }\n  }, [focusOnMount]);\n  return (\n    <Button\n      ref={ref}\n      variant=\"contained\"\n      color=\"primary\"\n      onClick={handleClick}\n      disabled={submitting}\n      type=\"submit\"\n      startIcon={submitting ? <CircularProgress size=\"1rem\" /> : null}\n      // work around for using react 18 with material 4 causes button to crash when pressing enter, see https://github.com/mui/material-ui/issues/30953\n      // this will be resolved when upgrading to material 5\n      disableRipple\n    >\n      {children}\n    </Button>\n  );\n};\n\nexport default SubmitButton;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Button from '@mui/material/Button';\nimport Step from '@mui/material/Step';\nimport StepLabel from '@mui/material/StepLabel';\nimport Stepper from '@mui/material/Stepper';\nimport Typography from '@mui/material/Typography';\nimport { makeStyles } from 'tss-react/mui';\n\nimport { useTranslation } from '../hooks/useTranslation';\nimport { useStepperContext } from '../utils/StepperContext';\nimport SubmitButton from './SubmitButton';\n\nconst useStyles = makeStyles()(theme => ({\n  // Hotfix: this should be fixed in the theme\n  step: {\n    '.Mui-disabled': {\n      backgroundColor: 'inherit !important',\n    },\n  },\n  regularButton: {\n    // hotifx for https://issues.redhat.com/browse/FLPATH-1825\n    backgroundColor: 'inherit !important',\n  },\n  footer: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'right',\n    marginTop: theme.spacing(2),\n  },\n  formWrapper: {\n    padding: theme.spacing(2),\n  },\n}));\n\nexport type OrchestratorFormStep = {\n  content: React.ReactNode;\n  title: string;\n  key: string;\n};\n\nconst OrchestratorFormStepper = ({\n  steps,\n}: {\n  steps: OrchestratorFormStep[];\n}) => {\n  const { t } = useTranslation();\n  const { classes } = useStyles();\n  const { activeStep, reviewStep } = useStepperContext();\n  const stepsWithReview = [\n    ...steps,\n    { content: reviewStep, title: t('common.review'), key: 'review' },\n  ];\n\n  return (\n    <>\n      <Stepper\n        activeStep={activeStep}\n        variant=\"elevation\"\n        style={{ overflowX: 'auto' }}\n        alternativeLabel\n      >\n        {stepsWithReview?.map((step, index) => (\n          <Step key={step.key} className={classes.step}>\n            <StepLabel\n              aria-label={`Step ${index + 1} ${step.title}`}\n              aria-disabled=\"false\"\n              tabIndex={0}\n            >\n              <Typography variant=\"h6\" component=\"h2\">\n                {step.title}\n              </Typography>\n            </StepLabel>\n          </Step>\n        ))}\n      </Stepper>\n      <div className={classes.formWrapper}>\n        {stepsWithReview[activeStep].content}\n      </div>\n    </>\n  );\n};\n\nexport const OrchestratorFormToolbar = () => {\n  const { t } = useTranslation();\n  const { activeStep, handleBack, isValidating } = useStepperContext();\n  const { classes } = useStyles();\n\n  return (\n    <div className={classes.footer}>\n      <Button\n        disabled={activeStep === 0}\n        onClick={handleBack}\n        className={classes.regularButton}\n      >\n        {t('common.back')}\n      </Button>\n      <SubmitButton submitting={isValidating}>{t('common.next')}</SubmitButton>\n    </div>\n  );\n};\n\nexport default OrchestratorFormStepper;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useMemo } from 'react';\n\nimport { JsonObject } from '@backstage/types';\n\nimport ObjectField from '@rjsf/core/lib/components/fields/ObjectField';\nimport { ErrorSchema, FieldProps, IdSchema } from '@rjsf/utils';\nimport type { JSONSchema7 } from 'json-schema';\n\nimport { useTranslation } from '../hooks/useTranslation';\nimport { getSortedStepEntries } from '../utils/getSortedStepEntries';\nimport OrchestratorFormStepper, {\n  OrchestratorFormStep,\n  OrchestratorFormToolbar,\n} from './OrchestratorFormStepper';\n\nconst StepperObjectField = ({\n  formData,\n  schema,\n  uiSchema,\n  onChange,\n  registry,\n  idSchema,\n  errorSchema,\n  ...props\n}: FieldProps<JsonObject, JSONSchema7>) => {\n  const { t } = useTranslation();\n\n  const sortedStepEntries = useMemo(\n    () => getSortedStepEntries(schema),\n    [schema],\n  );\n  if (sortedStepEntries === undefined) {\n    throw new Error(t('stepperObjectField.error'));\n  }\n\n  const steps = sortedStepEntries.reduce<OrchestratorFormStep[]>(\n    (prev, [key, subSchema]) => {\n      if (typeof subSchema === 'boolean') {\n        return prev;\n      }\n\n      return [\n        ...prev,\n        {\n          content: (\n            <>\n              <ObjectField<JsonObject, JSONSchema7>\n                {...props}\n                schema={{ ...subSchema, title: '' }} // the title is in the step\n                uiSchema={uiSchema?.[key] || {}}\n                formData={(formData?.[key] as JsonObject) || {}}\n                onChange={data => {\n                  onChange({ ...formData, [key]: data });\n                }}\n                idSchema={idSchema[key] as IdSchema<JsonObject>}\n                registry={{\n                  ...registry,\n                  fields: {\n                    ...registry.fields,\n                    ObjectField: ObjectField, // undo override of objectfield\n                  },\n                }}\n                errorSchema={errorSchema?.[key] as ErrorSchema<JsonObject>}\n              />\n              <OrchestratorFormToolbar />\n            </>\n          ),\n          title: subSchema.title || key,\n          key,\n        },\n      ];\n    },\n    [],\n  );\n  return <OrchestratorFormStepper steps={steps} />;\n};\n\nexport default StepperObjectField;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState } from 'react';\n\nimport { ErrorPanel } from '@backstage/core-components';\nimport { JsonObject } from '@backstage/types';\n\nimport Grid from '@mui/material/Grid';\nimport { withTheme } from '@rjsf/core';\nimport { Theme as MuiTheme } from '@rjsf/material-ui';\nimport { ErrorSchema } from '@rjsf/utils';\nimport type { JSONSchema7 } from 'json-schema';\nimport omit from 'lodash/omit';\n\nimport {\n  FormDecoratorProps,\n  OrchestratorFormContextProps,\n  useOrchestratorFormApiOrDefault,\n} from '@redhat/backstage-plugin-orchestrator-form-api';\n\nimport { useTranslation } from '../hooks/useTranslation';\nimport { getActiveStepKey } from '../utils/getSortedStepEntries';\nimport { useStepperContext } from '../utils/StepperContext';\nimport useValidator from '../utils/useValidator';\nimport { AuthRequester } from './AuthRequester';\nimport StepperObjectField from './StepperObjectField';\n\nconst MuiForm = withTheme<\n  JsonObject,\n  JSONSchema7,\n  OrchestratorFormContextProps\n>(MuiTheme);\n\nconst FormComponent = (decoratorProps: FormDecoratorProps) => {\n  const formContext = decoratorProps.formContext;\n\n  const [extraErrors, setExtraErrors] = useState<\n    ErrorSchema<JsonObject> | undefined\n  >();\n  const numStepsInMultiStepSchema = formContext?.numStepsInMultiStepSchema;\n  const isMultiStep = numStepsInMultiStepSchema !== undefined;\n  const { handleNext, activeStep, handleValidateStarted, handleValidateEnded } =\n    useStepperContext();\n  const [validationError, setValidationError] = useState<Error | undefined>();\n  const validator = useValidator(isMultiStep);\n  const { t } = useTranslation();\n\n  if (!formContext) {\n    return <div>{t('formDecorator.error')}</div>;\n  }\n\n  const {\n    uiSchema,\n    schema,\n    onSubmit: _onSubmit,\n    children,\n    formData,\n    setFormData,\n  } = formContext;\n\n  const getActiveKey = () => {\n    if (!isMultiStep) {\n      return undefined;\n    }\n\n    return getActiveStepKey(schema, activeStep);\n  };\n\n  const onSubmit = async (_formData: JsonObject) => {\n    setExtraErrors(undefined);\n    let _extraErrors: ErrorSchema<JsonObject> | undefined = undefined;\n    let _validationError: Error | undefined = undefined;\n    if (decoratorProps.getExtraErrors) {\n      try {\n        handleValidateStarted();\n        _extraErrors = await decoratorProps.getExtraErrors(formData, uiSchema);\n        const activeKey = getActiveKey();\n        setExtraErrors(\n          activeKey && _extraErrors?.[activeKey]\n            ? (_extraErrors[activeKey] as ErrorSchema<JsonObject>)\n            : _extraErrors,\n        );\n      } catch (err) {\n        _validationError = err as Error;\n      } finally {\n        handleValidateEnded();\n      }\n    }\n    setValidationError(_validationError);\n    if (\n      (!_extraErrors || Object.keys(_extraErrors).length === 0) &&\n      !_validationError &&\n      activeStep < (numStepsInMultiStepSchema ?? 1)\n    ) {\n      _onSubmit(_formData);\n      handleNext();\n    }\n  };\n\n  return (\n    <Grid container spacing={2} direction=\"column\" wrap=\"nowrap\">\n      {validationError && (\n        <Grid item>\n          <ErrorPanel error={validationError} />\n        </Grid>\n      )}\n      <Grid item>\n        <MuiForm\n          {...omit(decoratorProps, 'getExtraErrors')}\n          widgets={{ AuthRequester, ...decoratorProps.widgets }}\n          fields={isMultiStep ? { ObjectField: StepperObjectField } : {}}\n          uiSchema={uiSchema}\n          validator={validator}\n          schema={schema}\n          formData={formData}\n          formContext={formContext}\n          noHtml5Validate\n          extraErrors={extraErrors}\n          onSubmit={e => onSubmit(e.formData || {})}\n          onChange={e => {\n            setFormData(e.formData || {});\n            if (decoratorProps.onChange) {\n              decoratorProps.onChange(e);\n            }\n          }}\n        >\n          {children}\n        </MuiForm>\n      </Grid>\n    </Grid>\n  );\n};\n\nconst OrchestratorFormWrapper = (props: OrchestratorFormContextProps) => {\n  const formApi = useOrchestratorFormApiOrDefault();\n\n  const NewComponent = useMemo(() => {\n    const formDecorator = formApi.getFormDecorator();\n    return formDecorator(FormComponent);\n  }, [formApi]);\n\n  return <NewComponent {...props} />;\n};\n\nexport default OrchestratorFormWrapper;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { JsonObject, JsonValue } from '@backstage/types';\n\nexport function isJsonObject(value?: JsonValue): value is JsonObject {\n  return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject, JsonValue } from '@backstage/types';\n\nimport type { JSONSchema7 } from 'json-schema';\nimport { JsonSchema, Draft07 as JSONSchema } from 'json-schema-library';\n\nimport { isJsonObject } from '@redhat/backstage-plugin-orchestrator-common';\n\nexport function processSchema(\n  key: string,\n  value: JsonValue | undefined,\n  schema: JSONSchema7,\n  formState: JsonObject,\n): JsonObject {\n  const parsedSchema = new JSONSchema(schema);\n  const definitionInSchema =\n    key === ''\n      ? (schema as JsonSchema)\n      : parsedSchema.getSchema({\n          pointer: `#/${key}`,\n          data: formState,\n        });\n\n  const name = definitionInSchema?.title ?? key;\n  if (definitionInSchema) {\n    if (definitionInSchema['ui:widget'] === 'password') {\n      return { [name]: '******' };\n    }\n\n    if (isJsonObject(value)) {\n      // Recurse nested objects\n      const nestedValue = Object.entries(value).reduce(\n        (prev, [nestedKey, _nestedValue]) => {\n          const curKey = key ? `${key}/${nestedKey}` : nestedKey;\n          return {\n            ...prev,\n            ...processSchema(curKey, _nestedValue, schema, formState),\n          };\n        },\n        {},\n      );\n\n      return { [name]: nestedValue };\n    }\n  }\n\n  return { [name]: value };\n}\n\nfunction generateReviewTableData(\n  schema: JSONSchema7,\n  data: JsonObject,\n): JsonObject {\n  schema.title = '';\n  const result = processSchema('', data, schema, data);\n  return result[''] as JsonObject;\n}\n\nexport default generateReviewTableData;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { Content, StructuredMetadataTable } from '@backstage/core-components';\nimport { JsonObject } from '@backstage/types';\n\nimport Box from '@mui/material/Box';\nimport Button from '@mui/material/Button';\nimport Paper from '@mui/material/Paper';\nimport type { JSONSchema7 } from 'json-schema';\nimport { makeStyles } from 'tss-react/mui';\n\nimport { useTranslation } from '../hooks/useTranslation';\nimport generateReviewTableData from '../utils/generateReviewTableData';\nimport { useStepperContext } from '../utils/StepperContext';\nimport SubmitButton from './SubmitButton';\n\nconst useStyles = makeStyles()(theme => ({\n  backButton: {\n    marginRight: theme.spacing(1),\n  },\n  footer: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'right',\n    marginTop: theme.spacing(2),\n  },\n  paper: {\n    // Workaround since the StructuredMetadataTable is neither responsive as it simply uses <table> nor can be customized via props or styles.\n    '& > table > tbody > tr': {\n      '& > td:nth-child(1)': {\n        minWidth: '10rem',\n        width: '25%',\n      },\n      '& > td:nth-child(2)': {\n        display: 'flex',\n        flexDirection: 'row',\n        justifyContent: 'left',\n      },\n    },\n  },\n}));\n\nconst ReviewStep = ({\n  busy,\n  schema,\n  data,\n  handleExecute,\n}: {\n  busy: boolean;\n  schema: JSONSchema7;\n  data: JsonObject;\n  handleExecute: () => void;\n}) => {\n  const { t } = useTranslation();\n\n  const { classes } = useStyles();\n  const { handleBack } = useStepperContext();\n  const displayData = useMemo<JsonObject>(() => {\n    return generateReviewTableData(schema, data);\n  }, [schema, data]);\n\n  return (\n    <Content noPadding>\n      <Paper square elevation={0} className={classes.paper}>\n        <StructuredMetadataTable dense metadata={displayData} />\n        <Box mb={4} />\n        <div className={classes.footer}>\n          <Button\n            onClick={handleBack}\n            className={classes.backButton}\n            disabled={busy}\n          >\n            {t('common.back')}\n          </Button>\n          <SubmitButton\n            handleClick={handleExecute}\n            submitting={busy}\n            focusOnMount\n          >\n            {t('common.run')}\n          </SubmitButton>\n        </div>\n      </Paper>\n    </Content>\n  );\n};\n\nexport default ReviewStep;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useMemo } from 'react';\n\nimport { OrchestratorFormContextProps } from '@redhat/backstage-plugin-orchestrator-form-api';\n\nimport OrchestratorFormStepper, {\n  OrchestratorFormStep,\n  OrchestratorFormToolbar,\n} from './OrchestratorFormStepper';\nimport OrchestratorFormWrapper from './OrchestratorFormWrapper';\n\ntype SingleStepFormProps = Pick<\n  OrchestratorFormContextProps,\n  | 'schema'\n  | 'updateSchema'\n  | 'onSubmit'\n  | 'uiSchema'\n  | 'formData'\n  | 'setFormData'\n  | 'setAuthTokenDescriptors'\n  | 'getIsChangedByUser'\n  | 'setIsChangedByUser'\n>;\n\nconst SingleStepForm = (props: SingleStepFormProps) => {\n  const steps = useMemo<OrchestratorFormStep[]>(() => {\n    return [\n      {\n        title: props.schema.title ?? 'Inputs',\n        key: 'schema',\n        content: (\n          <OrchestratorFormWrapper\n            {...props}\n            schema={{ ...props.schema, title: '' }}\n          >\n            <OrchestratorFormToolbar />\n          </OrchestratorFormWrapper>\n        ),\n      },\n    ];\n  }, [props]);\n  return <OrchestratorFormStepper steps={steps} />;\n};\n\nexport default SingleStepForm;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Fragment, useCallback, useMemo, useState } from 'react';\n\nimport { JsonObject } from '@backstage/types';\n\nimport { UiSchema } from '@rjsf/utils';\nimport type { JSONSchema7, JSONSchema7Definition } from 'json-schema';\nimport cloneDeep from 'lodash/cloneDeep';\nimport get from 'lodash/get';\n\nimport { OrchestratorFormContextProps } from '@redhat/backstage-plugin-orchestrator-form-api';\n\nimport { TranslationFunction } from '../hooks/useTranslation';\nimport generateUiSchema from '../utils/generateUiSchema';\nimport { StepperContextProvider } from '../utils/StepperContext';\nimport OrchestratorFormWrapper from './OrchestratorFormWrapper';\nimport ReviewStep from './ReviewStep';\nimport SingleStepForm from './SingleStepForm';\n\nconst getNumSteps = (schema: JSONSchema7): number | undefined => {\n  if (schema.type !== 'object' || !schema.properties) return undefined;\n  const isMultiStep = Object.values(schema.properties).every(\n    prop => (prop as JSONSchema7).type === 'object',\n  );\n  return isMultiStep ? Object.keys(schema.properties).length : undefined;\n};\n\n/**\n * @public\n * OrchestratorForm component properties\n */\nexport type OrchestratorFormProps = {\n  schema: JSONSchema7;\n  updateSchema: OrchestratorFormContextProps['updateSchema'];\n  setAuthTokenDescriptors: OrchestratorFormContextProps['setAuthTokenDescriptors'];\n  isExecuting: boolean;\n  handleExecute: (parameters: JsonObject) => Promise<void>;\n  initialFormData: JsonObject;\n  t: TranslationFunction;\n};\n\n/**\n * Remove hidden steps from the schema.\n *\n * A wizard step is removed when\n *   \"type\": \"object\"\n *   \"ui:widget\": \"hidden\"\n *   and properties are empty (\"properties\": {})\n *\n * @param schema - The schema to remove hidden steps from.\n * @returns The schema with hidden steps removed.\n */\nconst removeHiddenSteps = (schema: JSONSchema7): JSONSchema7 => {\n  if (typeof schema.properties === 'object') {\n    const hiddenSteps = Object.entries(schema.properties)\n      .map(([key, value]: [string, JSONSchema7Definition]) => {\n        const uiWidget = get(value, 'ui:widget');\n        if (\n          typeof value !== 'boolean' &&\n          value.type === 'object' &&\n          uiWidget === 'hidden' &&\n          value.properties &&\n          Object.keys(value.properties).length === 0\n        ) {\n          return key;\n        }\n        return undefined;\n      })\n      .filter(Boolean) as string[];\n\n    if (hiddenSteps.length > 0) {\n      const newSchema = cloneDeep(schema);\n      hiddenSteps.forEach(step => {\n        delete newSchema.properties?.[step];\n      });\n\n      return newSchema;\n    }\n  }\n\n  return schema;\n};\n\n/**\n * @public\n * The component contains the react-json-schema-form and serves as an extensible form. It allows loading a custom plugin decorator to override the default react-json-schema-form properties.\n */\nconst OrchestratorForm = ({\n  schema: rawSchema,\n  updateSchema,\n  handleExecute,\n  isExecuting,\n  initialFormData,\n  setAuthTokenDescriptors,\n  t,\n}: OrchestratorFormProps) => {\n  // make the form a controlled component so the state will remain when moving between steps. see https://rjsf-team.github.io/react-jsonschema-form/docs/quickstart#controlled-component\n  const [formData, setFormData] = useState<JsonObject>(\n    initialFormData ? () => structuredClone(initialFormData) : {},\n  );\n\n  const [changedByUserMap, setChangedByUserMap] = useState<\n    Record<string, boolean>\n  >({});\n  const getIsChangedByUser = useCallback(\n    (id: string) => !!changedByUserMap[id],\n    [changedByUserMap],\n  );\n  const setIsChangedByUser = useCallback(\n    (id: string, isChangedByUser: boolean) => {\n      setChangedByUserMap(prev => ({ ...prev, [id]: isChangedByUser }));\n    },\n    [],\n  );\n\n  const schema = useMemo(() => removeHiddenSteps(rawSchema), [rawSchema]);\n\n  const numStepsInMultiStepSchema = useMemo(\n    () => getNumSteps(schema),\n    [schema],\n  );\n  const isMultiStep = numStepsInMultiStepSchema !== undefined;\n\n  const _handleExecute = useCallback(() => {\n    handleExecute(formData);\n  }, [formData, handleExecute]);\n\n  const onSubmit = useCallback(\n    (_formData: JsonObject) => {\n      setFormData(_formData);\n    },\n    [setFormData],\n  );\n\n  const uiSchema = useMemo<UiSchema<JsonObject>>(() => {\n    return generateUiSchema(schema, isMultiStep);\n  }, [schema, isMultiStep]);\n\n  const reviewStep = useMemo(\n    () => (\n      <ReviewStep\n        data={formData}\n        schema={schema}\n        busy={isExecuting}\n        handleExecute={_handleExecute}\n        // no schema update here\n      />\n    ),\n    [formData, schema, isExecuting, _handleExecute],\n  );\n\n  return (\n    <StepperContextProvider reviewStep={reviewStep} t={t}>\n      {isMultiStep ? (\n        <OrchestratorFormWrapper\n          schema={schema}\n          updateSchema={updateSchema}\n          numStepsInMultiStepSchema={numStepsInMultiStepSchema}\n          onSubmit={onSubmit}\n          uiSchema={uiSchema}\n          formData={formData}\n          setFormData={setFormData}\n          setAuthTokenDescriptors={setAuthTokenDescriptors}\n          getIsChangedByUser={getIsChangedByUser}\n          setIsChangedByUser={setIsChangedByUser}\n        >\n          <Fragment />\n        </OrchestratorFormWrapper> // it is required to pass the fragment so rjsf won't generate a Submit button\n      ) : (\n        <SingleStepForm\n          schema={schema}\n          updateSchema={updateSchema}\n          onSubmit={onSubmit}\n          uiSchema={uiSchema}\n          formData={formData}\n          setFormData={setFormData}\n          setAuthTokenDescriptors={setAuthTokenDescriptors}\n          getIsChangedByUser={getIsChangedByUser}\n          setIsChangedByUser={setIsChangedByUser}\n        />\n      )}\n    </StepperContextProvider>\n  );\n};\n\nexport default OrchestratorForm;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useCallback } from 'react';\n\nimport {\n  AnyApiFactory,\n  githubAuthApiRef,\n  gitlabAuthApiRef,\n  microsoftAuthApiRef,\n  OAuthApi,\n  OpenIdConnectApi,\n  useApi,\n  useApiHolder,\n  useApp,\n} from '@backstage/core-plugin-api';\n\nimport {\n  AuthToken,\n  AuthTokenDescriptor,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nconst isAuthApi = (api: any): api is OAuthApi => {\n  return api && typeof api.getAccessToken === 'function';\n};\n\nconst isOpenIdAuthApi = (api: any): api is OpenIdConnectApi => {\n  return api && 'getIdToken' in api && typeof api.getIdToken === 'function';\n};\n\nexport const useOrchestratorAuth = () => {\n  const app = useApp();\n  const apiHolder = useApiHolder();\n  const githubAuthApi = useApi(githubAuthApiRef);\n  const gitlabAuthApi = useApi(gitlabAuthApiRef);\n  const microsoftAuthApi = useApi(microsoftAuthApiRef);\n\n  const getProviderToken = useCallback(\n    async (\n      api: unknown,\n      tokenDescriptor: AuthTokenDescriptor,\n    ): Promise<string> => {\n      if (tokenDescriptor.tokenType === 'openId') {\n        if (isOpenIdAuthApi(api)) {\n          return await api.getIdToken();\n        }\n        throw new Error(\n          `${tokenDescriptor.provider} auth API does not support OpenID Connect tokens, since it does not implement the getIdToken method`,\n        );\n      } else if (\n        !tokenDescriptor.tokenType ||\n        tokenDescriptor.tokenType === 'oauth'\n      ) {\n        if (isAuthApi(api)) {\n          return await api.getAccessToken(tokenDescriptor.scope);\n        }\n        throw new Error(\n          `${tokenDescriptor.provider} auth API does not support OAuth tokens, since it does not implement the getAccessToken method`,\n        );\n      } else {\n        throw new Error(\n          `Unsupported token type: ${tokenDescriptor.tokenType}. The supported token types are: openId and oauth`,\n        );\n      }\n    },\n    [],\n  );\n\n  const findCustomProvider = useCallback(\n    async (providerApiId: string): Promise<unknown> => {\n      const allPlugins = app.getPlugins();\n\n      // For APIs deployed within plugins\n      const apiRef = allPlugins\n        .flatMap(plugin => Array.from(plugin.getApis()))\n        .find((api: AnyApiFactory) => api.api.id === providerApiId)?.api;\n\n      if (apiRef) {\n        const api = apiHolder.get(apiRef);\n        if (!api) {\n          throw new Error(\n            `API with id \"${providerApiId}\" was not found in the API holder. The API is provided by a plugin.`,\n          );\n        }\n        return api;\n      }\n\n      // Try to find a statically added api ref, like the 'internal.auth.oidc'\n      // by https://github.com/redhat-developer/rhdh/blob/main/packages/app/src/api/AuthApiRefs.ts\n      // Hint: If this approach proves to be working, we could use it for the other apis as well.\n      // @ts-ignore\n      const allApis = apiHolder.apis as Map<string, object>;\n      const api = allApis.get(providerApiId);\n      if (!api) {\n        throw new Error(\n          `API with id \"${providerApiId}\" was not found in the API holder.`,\n        );\n      }\n      return api;\n    },\n    [app, apiHolder],\n  );\n\n  const getToken = useCallback(\n    async (tokenDescriptor: AuthTokenDescriptor): Promise<AuthToken> => {\n      let authApi: unknown;\n\n      switch (tokenDescriptor.provider.toLocaleLowerCase('en-US')) {\n        case 'github':\n          authApi = githubAuthApi;\n          break;\n        case 'gitlab':\n          authApi = gitlabAuthApi;\n          break;\n        case 'microsoft':\n          authApi = microsoftAuthApi;\n          break;\n        default:\n          if (!tokenDescriptor.customProviderApiId) {\n            throw new Error(\n              `Custom authentication provider API id is required for provider: ${tokenDescriptor.provider}`,\n            );\n          }\n          authApi = await findCustomProvider(\n            tokenDescriptor.customProviderApiId,\n          );\n          break;\n      }\n\n      const token = await getProviderToken(authApi, tokenDescriptor);\n      return {\n        token,\n        provider: tokenDescriptor.provider,\n      };\n    },\n    [\n      githubAuthApi,\n      gitlabAuthApi,\n      microsoftAuthApi,\n      findCustomProvider,\n      getProviderToken,\n    ],\n  );\n\n  const authenticate = useCallback(\n    async (\n      tokenDescriptors: AuthTokenDescriptor[],\n    ): Promise<Array<AuthToken>> => {\n      if (!app) {\n        throw new Error('App context is required for authentication');\n      }\n\n      const authTokens: Array<AuthToken> = [];\n      for (const tokenDescriptor of tokenDescriptors) {\n        authTokens.push(await getToken(tokenDescriptor));\n      }\n      return authTokens;\n    },\n    [app, getToken],\n  );\n\n  return {\n    authenticate,\n  };\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isError } from '@backstage/errors';\n\nexport const getErrorObject = (err: unknown): Error => {\n  if (isError(err)) {\n    return err;\n  }\n  if (typeof err === 'string') {\n    return new Error(err);\n  }\n  return new Error('Unexpected error');\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { JsonObject } from '@backstage/types';\n\nimport Alert from '@mui/material/Alert';\nimport AlertTitle from '@mui/material/AlertTitle';\nimport Grid from '@mui/material/Grid';\n\nimport { SubmitButton } from '@redhat/backstage-plugin-orchestrator-form-react';\n\nimport { useTranslation } from '../../hooks/useTranslation';\n\nconst MissingSchemaNotice = ({\n  isExecuting,\n  handleExecute,\n}: {\n  isExecuting: boolean;\n  handleExecute: (parameters: JsonObject) => Promise<void>;\n}) => {\n  const { t } = useTranslation();\n  return (\n    <Grid container spacing={2}>\n      <Grid item xs={12}>\n        <Alert severity=\"info\" style={{ width: '100%' }}>\n          <AlertTitle>{t('messages.missingJsonSchema.title')}</AlertTitle>\n          {t('messages.missingJsonSchema.message')}\n          <br />\n          To enable a form-based input, please provide a valid JSON schema in\n          the <code>dataInputSchema</code> property of your workflow definition\n          file.\n        </Alert>\n      </Grid>\n      <Grid item xs={12}>\n        <SubmitButton\n          submitting={isExecuting}\n          handleClick={() => handleExecute({})}\n        >\n          Run\n        </SubmitButton>\n      </Grid>\n    </Grid>\n  );\n};\n\nexport default MissingSchemaNotice;\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { JsonObject } from '@backstage/types';\n\nimport { JSONSchema7 } from 'json-schema';\nimport isEqual from 'lodash/isEqual';\n\nimport { OrchestratorFormSchemaUpdater } from '@redhat/backstage-plugin-orchestrator-form-api';\n\n// Stops searching and replacing after first hit\nconst deepSearchAndFirstReplace = (\n  schemaProperties: JSONSchema7['properties'],\n  placeholderId: string,\n  chunk: JsonObject,\n): boolean => {\n  if (!schemaProperties) {\n    return false;\n  }\n\n  if (schemaProperties[placeholderId]) {\n    // hit\n    if (!isEqual(schemaProperties[placeholderId], chunk)) {\n      schemaProperties[placeholderId] = chunk;\n    }\n    return true;\n  }\n\n  for (const key of Object.keys(schemaProperties)) {\n    if (typeof schemaProperties[key] === 'object') {\n      // to make tsc happy\n      const subproperties = (schemaProperties[key] as JSONSchema7).properties;\n\n      if (deepSearchAndFirstReplace(subproperties, placeholderId, chunk)) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n};\n\nexport const getSchemaUpdater: (\n  schema: JSONSchema7 | undefined,\n  setSchema: (schema: JSONSchema7) => void,\n) => OrchestratorFormSchemaUpdater = (schema, setSchema) => chunks => {\n  if (!schema?.properties) {\n    return;\n  }\n\n  const newSchema = structuredClone(schema);\n  for (const [placeholderId, chunk] of Object.entries(chunks)) {\n    deepSearchAndFirstReplace(newSchema.properties, placeholderId, chunk);\n  }\n\n  if (!isEqual(schema, newSchema)) {\n    setSchema(newSchema);\n  }\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { useAsync } from 'react-use';\n\nimport {\n  InfoCard,\n  Progress,\n  ResponseErrorPanel,\n  useQueryParamState,\n} from '@backstage/core-components';\nimport {\n  useApi,\n  useRouteRef,\n  useRouteRefParams,\n} from '@backstage/core-plugin-api';\nimport type { JsonObject } from '@backstage/types';\n\nimport Grid from '@mui/material/Grid';\nimport type { JSONSchema7 } from 'json-schema';\n\nimport {\n  AuthTokenDescriptor,\n  InputSchemaResponseDTO,\n  QUERY_PARAM_INSTANCE_ID,\n} from '@redhat/backstage-plugin-orchestrator-common';\nimport {\n  OrchestratorForm,\n  TranslationFunction,\n} from '@redhat/backstage-plugin-orchestrator-form-react';\n\nimport { orchestratorApiRef } from '../../api';\nimport { useOrchestratorAuth } from '../../hooks/useOrchestratorAuth';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport {\n  entityInstanceRouteRef,\n  executeWorkflowRouteRef,\n  workflowInstanceRouteRef,\n} from '../../routes';\nimport { getErrorObject } from '../../utils/ErrorUtils';\nimport { BaseOrchestratorPage } from '../ui/BaseOrchestratorPage';\nimport MissingSchemaNotice from './MissingSchemaNotice';\nimport { getSchemaUpdater } from './schemaUpdater';\n\nexport const ExecuteWorkflowPage = () => {\n  const { t } = useTranslation();\n  const [searchParams] = useSearchParams();\n  const targetEntity = searchParams.get('targetEntity');\n  const orchestratorApi = useApi(orchestratorApiRef);\n  const { authenticate } = useOrchestratorAuth();\n  const { workflowId } = useRouteRefParams(executeWorkflowRouteRef);\n  const [isExecuting, setIsExecuting] = useState(false);\n  const [updateError, setUpdateError] = useState<Error>();\n  const [instanceId] = useQueryParamState<string>(QUERY_PARAM_INSTANCE_ID);\n  const navigate = useNavigate();\n  const instanceLink = useRouteRef(workflowInstanceRouteRef);\n  const entityInstanceLink = useRouteRef(entityInstanceRouteRef);\n  const {\n    value,\n    loading,\n    error: responseError,\n  } = useAsync(async (): Promise<InputSchemaResponseDTO> => {\n    const res = await orchestratorApi.getWorkflowDataInputSchema(\n      workflowId,\n      instanceId,\n    );\n    return res.data;\n  }, [orchestratorApi, workflowId]);\n\n  const [schema, setSchema] = useState<JSONSchema7 | undefined>();\n  const [authTokenDescriptors, setAuthTokenDescriptors] = useState<\n    AuthTokenDescriptor[]\n  >([]);\n\n  useEffect(() => {\n    setSchema(value?.inputSchema);\n  }, [value]);\n\n  const updateSchema = useMemo(\n    () => getSchemaUpdater(schema, setSchema),\n    [schema],\n  );\n\n  const initialFormData = value?.data ?? {};\n  const {\n    value: workflowName,\n    loading: workflowNameLoading,\n    error: workflowNameError,\n  } = useAsync(async (): Promise<string> => {\n    const res = await orchestratorApi.getWorkflowOverview(workflowId);\n    return res.data.name || '';\n  }, [orchestratorApi, workflowId]);\n\n  const [kind, namespace, name] = targetEntity?.split(/[:\\/]/) || [];\n\n  const handleExecute = useCallback(\n    async (parameters: JsonObject) => {\n      setUpdateError(undefined);\n      try {\n        setIsExecuting(true);\n        const authTokens = await authenticate(authTokenDescriptors);\n        const response = await orchestratorApi.executeWorkflow({\n          workflowId,\n          parameters,\n          authTokens,\n          targetEntity: targetEntity ?? undefined,\n        });\n        const url = targetEntity\n          ? entityInstanceLink({\n              namespace,\n              kind,\n              name,\n              workflowId: workflowId,\n              instanceId: response.data.id,\n            })\n          : instanceLink({ instanceId: response.data.id });\n        navigate(url);\n      } catch (err) {\n        setUpdateError(getErrorObject(err));\n      } finally {\n        setIsExecuting(false);\n      }\n    },\n    [\n      orchestratorApi,\n      workflowId,\n      navigate,\n      instanceLink,\n      authTokenDescriptors,\n      authenticate,\n      targetEntity,\n      entityInstanceLink,\n      kind,\n      namespace,\n      name,\n    ],\n  );\n\n  const error = responseError || workflowNameError;\n  let pageContent;\n\n  if (\n    loading ||\n    workflowNameLoading ||\n    (!loading && value?.inputSchema && !schema) // wait for useEffect to setSchema\n  ) {\n    pageContent = <Progress />;\n  } else if (error) {\n    pageContent = <ResponseErrorPanel error={error} />;\n  } else {\n    pageContent = (\n      <Grid container spacing={2} direction=\"column\" wrap=\"nowrap\">\n        {updateError && (\n          <Grid item>\n            <ResponseErrorPanel error={updateError} />\n          </Grid>\n        )}\n        <Grid item>\n          <InfoCard title={t('run.title')}>\n            {!!schema ? (\n              <OrchestratorForm\n                schema={schema}\n                updateSchema={updateSchema}\n                handleExecute={handleExecute}\n                isExecuting={isExecuting}\n                initialFormData={initialFormData}\n                setAuthTokenDescriptors={setAuthTokenDescriptors}\n                t={t as unknown as TranslationFunction}\n              />\n            ) : (\n              <MissingSchemaNotice\n                handleExecute={handleExecute}\n                isExecuting={isExecuting}\n              />\n            )}\n          </InfoCard>\n        </Grid>\n      </Grid>\n    );\n  }\n\n  return (\n    <BaseOrchestratorPage\n      noPadding={workflowNameLoading}\n      title={workflowName}\n      type=\"Workflows\"\n      typeLink={\n        targetEntity\n          ? `/catalog/${namespace}/${kind}/${name}/workflows`\n          : '/orchestrator'\n      }\n    >\n      {pageContent}\n    </BaseOrchestratorPage>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TabbedLayout } from '@backstage/core-components';\n\nimport { Box } from '@material-ui/core';\nimport { makeStyles } from 'tss-react/mui';\n\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { workflowInstancesRouteRef } from '../../routes';\nimport { useIsDarkMode } from '../../utils/isDarkMode';\nimport { BaseOrchestratorPage } from '../ui/BaseOrchestratorPage';\nimport { WorkflowRunsTabContent } from './WorkflowRunsTabContent';\nimport { WorkflowsTabContent } from './WorkflowsTabContent';\n\nconst useStyles = makeStyles<{ isDarkMode: boolean }>()(\n  (_, { isDarkMode }) => ({\n    tabbedLayout: {\n      '& .Mui-selected': {\n        color: isDarkMode ? '#ffffff !important' : '#151515 !important',\n      },\n    },\n  }),\n);\n\nexport const OrchestratorPage = () => {\n  const { t } = useTranslation();\n  const isDarkMode = useIsDarkMode();\n  const { classes } = useStyles({ isDarkMode });\n\n  return (\n    <BaseOrchestratorPage title={t('page.title')} noPadding>\n      <Box className={classes.tabbedLayout}>\n        <TabbedLayout>\n          <TabbedLayout.Route path=\"/\" title={t('page.tabs.workflows')}>\n            <WorkflowsTabContent />\n          </TabbedLayout.Route>\n          <TabbedLayout.Route\n            path={workflowInstancesRouteRef.path}\n            title={t('page.tabs.allRuns')}\n          >\n            <WorkflowRunsTabContent />\n          </TabbedLayout.Route>\n        </TabbedLayout>\n      </Box>\n    </BaseOrchestratorPage>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types/index';\n\nimport { isJsonObject } from '@redhat/backstage-plugin-orchestrator-common';\n\n/*\n * Recursively searches through a JSON object and its nested objects,\n * returning the first property for which the provided predicate returns true.\n *\n * @example\n * const result = deepSearchObject(schema, obj => obj['ui:widget'] === 'AuthRequester');\n */\nexport const deepSearchObject = (\n  obj: JsonObject,\n  predicate: (obj: JsonObject) => boolean,\n): JsonObject | undefined => {\n  if (predicate(obj)) {\n    return obj;\n  }\n\n  for (const [_, value] of Object.entries(obj)) {\n    if (isJsonObject(value)) {\n      const result = deepSearchObject(value as JsonObject, predicate);\n      if (result !== undefined) {\n        return result;\n      }\n    }\n  }\n\n  return undefined;\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAsync } from 'react-use';\n\nimport {\n  ContentHeader,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\nimport {\n  useApi,\n  useRouteRef,\n  useRouteRefParams,\n} from '@backstage/core-plugin-api';\nimport { TranslationFunction } from '@backstage/core-plugin-api/alpha';\nimport { JsonObject } from '@backstage/types';\n\nimport ArrowDropDown from '@mui/icons-material/ArrowDropDown';\nimport Close from '@mui/icons-material/Close';\nimport Error from '@mui/icons-material/Error';\nimport Start from '@mui/icons-material/Start';\nimport SwipeRightAltOutlined from '@mui/icons-material/SwipeRightAltOutlined';\nimport Alert from '@mui/material/Alert';\nimport AlertTitle from '@mui/material/AlertTitle';\nimport Box from '@mui/material/Box';\nimport Button from '@mui/material/Button';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Grid from '@mui/material/Grid';\nimport IconButton from '@mui/material/IconButton';\nimport Menu from '@mui/material/Menu';\nimport MenuItem from '@mui/material/MenuItem';\nimport Snackbar from '@mui/material/Snackbar';\nimport Tooltip from '@mui/material/Tooltip';\nimport Typography from '@mui/material/Typography';\nimport { makeStyles } from 'tss-react/mui';\n\nimport {\n  AuthTokenDescriptor,\n  isJsonObject,\n  orchestratorWorkflowUsePermission,\n  orchestratorWorkflowUseSpecificPermission,\n  ProcessInstanceDTO,\n  ProcessInstanceStatusDTO,\n  QUERY_PARAM_INSTANCE_ID,\n} from '@redhat/backstage-plugin-orchestrator-common';\n\nimport { orchestratorApiRef } from '../../api';\nimport { SHORT_REFRESH_INTERVAL } from '../../constants';\nimport { useOrchestratorAuth } from '../../hooks/useOrchestratorAuth';\nimport { usePermissionArrayDecision } from '../../hooks/usePermissionArray';\nimport usePolling from '../../hooks/usePolling';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport {\n  entityInstanceRouteRef,\n  executeWorkflowRouteRef,\n  workflowInstanceRouteRef,\n} from '../../routes';\nimport { orchestratorTranslationRef } from '../../translations';\nimport { deepSearchObject } from '../../utils/deepSearchObject';\nimport { isNonNullable } from '../../utils/TypeGuards';\nimport { buildUrl } from '../../utils/UrlUtils';\nimport { Trans } from '../Trans';\nimport { BaseOrchestratorPage } from '../ui/BaseOrchestratorPage';\nimport { InfoDialog } from '../ui/InfoDialog';\nimport { WorkflowInstancePageContent } from './WorkflowInstancePageContent';\n\nconst useStyles = makeStyles()(theme => ({\n  abortButton: {\n    backgroundColor: theme.palette.error.dark,\n    color: theme.palette.getContrastText(theme.palette.error.dark),\n    '&:hover': {\n      backgroundColor: theme.palette.error.dark,\n      filter: 'brightness(90%)',\n    },\n  },\n  modalText: {\n    marginBottom: theme.spacing(2),\n  },\n  errorColor: {\n    color: theme.palette.error.dark,\n  },\n  menu: {\n    // workaround for theme issue in RHDH\n    '& ul': {\n      display: 'flex',\n      flexDirection: 'column',\n      '& li': {\n        padding: '6px 16px',\n        justifyContent: 'left',\n      },\n    },\n  },\n}));\n\nexport type AbortConfirmationDialogActionsProps = {\n  handleSubmit: () => void;\n  handleCancel: () => void;\n  isAborting: boolean;\n  canAbort: boolean;\n};\n\nconst AbortConfirmationDialogContent = ({\n  canAbort,\n}: {\n  canAbort: boolean;\n}) => {\n  const { t } = useTranslation();\n  const { classes } = useStyles();\n  return (\n    <div>\n      <Box className={classes.modalText}>\n        <Typography variant=\"h6\">{t('run.abort.warning')}</Typography>\n      </Box>\n      {!canAbort && (\n        <Box sx={{ width: '100%' }}>\n          <Alert severity=\"info\">\n            <AlertTitle>{t('run.abort.completed.title')}</AlertTitle>\n            {t('run.abort.completed.message')}\n          </Alert>\n        </Box>\n      )}\n    </div>\n  );\n};\n\nconst AbortConfirmationDialogActions = (\n  props: AbortConfirmationDialogActionsProps,\n) => {\n  const { t } = useTranslation();\n  const { classes } = useStyles();\n  return (\n    <>\n      <Button\n        onClick={props.handleSubmit}\n        variant=\"contained\"\n        className={classes.abortButton}\n        startIcon={props.isAborting ? <CircularProgress size=\"1rem\" /> : null}\n        disabled={props.isAborting || !props.canAbort}\n      >\n        {t('run.abort.button')}\n      </Button>\n      <Button\n        onClick={props.handleCancel}\n        variant=\"outlined\"\n        color=\"primary\"\n        disabled={props.isAborting}\n      >\n        {t('common.cancel')}\n      </Button>\n    </>\n  );\n};\n\n// For re-trigger, the wizard is not rendered, so there is no place where to instantiate the AuthRequester widget.\n// Let's parse the data input schema and try to find & interpret it.\nconst getAuthTokenDescriptors = async (\n  dataInputSchema: JsonObject | undefined,\n): Promise<AuthTokenDescriptor[] | undefined> => {\n  if (!dataInputSchema) {\n    return undefined;\n  }\n\n  const authRequester = deepSearchObject(\n    dataInputSchema,\n    (obj: JsonObject): boolean => {\n      const uiWidget = obj['ui:widget'];\n      const uiProps = obj['ui:props'];\n\n      const authTokenDescriptors = isJsonObject(uiProps)\n        ? uiProps.authTokenDescriptors\n        : undefined;\n      return (\n        uiWidget === 'AuthRequester' && Array.isArray(authTokenDescriptors)\n      );\n    },\n  );\n  if (!authRequester) {\n    return undefined;\n  }\n\n  const uiProps = (authRequester as JsonObject)['ui:props'] as JsonObject;\n  return uiProps.authTokenDescriptors as AuthTokenDescriptor[];\n};\n\n// hack\ntype LocalTranslationFunction =\n  | TranslationFunction<typeof orchestratorTranslationRef.T>\n  | ((key: string, params?: Record<string, string>) => string);\n\nexport const WorkflowInstancePage = () => {\n  const { t } = useTranslation() as { t: LocalTranslationFunction };\n  const { classes } = useStyles();\n\n  const navigate = useNavigate();\n  const orchestratorApi = useApi(orchestratorApiRef);\n  const { authenticate } = useOrchestratorAuth();\n  const executeWorkflowLink = useRouteRef(executeWorkflowRouteRef);\n  const { instanceId } = useRouteRefParams(workflowInstanceRouteRef);\n  const { kind, name, namespace } = useRouteRefParams(entityInstanceRouteRef);\n\n  let entityRef: string | undefined = undefined;\n  if (kind && namespace && name) {\n    entityRef = `${kind}:${namespace}/${name}`;\n  }\n  const [isAbortConfirmationDialogOpen, setIsAbortConfirmationDialogOpen] =\n    useState(false);\n\n  const [isAborting, setIsAborting] = useState(false);\n  const [isAbortSnackbarOpen, setIsAbortSnackbarOpen] = useState(false);\n  const [abortError, setAbortError] = useState('');\n\n  const [isRetrigger, setIsRetrigger] = useState(false);\n  const [isRetriggerSnackbarOpen, setIsRetriggerSnackbarOpen] = useState(false);\n  const [retriggerError, setRetriggerError] = useState('');\n\n  const handleAbortBarClose = () => {\n    setIsAbortSnackbarOpen(false);\n  };\n  const handleRerunBarClose = () => {\n    setIsRetriggerSnackbarOpen(false);\n  };\n\n  const fetchInstance = useCallback(async () => {\n    if (!instanceId) {\n      return undefined;\n    }\n    const res = await orchestratorApi.getInstance(instanceId);\n    return res.data;\n  }, [instanceId, orchestratorApi]);\n\n  const { loading, error, value, restart } = usePolling<\n    ProcessInstanceDTO | undefined\n  >(\n    fetchInstance,\n    SHORT_REFRESH_INTERVAL,\n    (curValue: ProcessInstanceDTO | undefined) =>\n      !!curValue &&\n      (curValue.state === ProcessInstanceStatusDTO.Active ||\n        curValue.state === ProcessInstanceStatusDTO.Pending ||\n        !curValue.state),\n  );\n\n  const workflowId = value?.processId;\n  const permittedToUse = usePermissionArrayDecision(\n    workflowId\n      ? [\n          orchestratorWorkflowUsePermission,\n          orchestratorWorkflowUseSpecificPermission(workflowId),\n        ]\n      : [orchestratorWorkflowUsePermission],\n  );\n\n  const { value: inputSchema, error: inputSchemaError } =\n    useAsync(async (): Promise<JsonObject | undefined> => {\n      if (!workflowId) {\n        return undefined;\n      }\n\n      const res = await orchestratorApi.getWorkflowDataInputSchema(\n        workflowId,\n        instanceId,\n      );\n      return res.data?.inputSchema;\n    }, [orchestratorApi, workflowId]);\n\n  const canAbort =\n    value?.state === ProcessInstanceStatusDTO.Active ||\n    value?.state === ProcessInstanceStatusDTO.Error;\n\n  const canRerun =\n    value?.state === ProcessInstanceStatusDTO.Completed ||\n    value?.state === ProcessInstanceStatusDTO.Aborted ||\n    value?.state === ProcessInstanceStatusDTO.Error;\n\n  const toggleAbortConfirmationDialog = useCallback(() => {\n    setIsAbortConfirmationDialogOpen(prev => !prev);\n  }, []);\n\n  const handleAbort = useCallback(async () => {\n    if (value) {\n      setIsAborting(true);\n\n      try {\n        await orchestratorApi.abortWorkflowInstance(value.id);\n        restart();\n      } catch (e) {\n        const res = await fetchInstance();\n        if (res?.state === ProcessInstanceStatusDTO.Completed) {\n          setAbortError(t('workflow.errors.abortFailed'));\n          restart();\n        } else {\n          setAbortError(\n            t('workflow.errors.abortFailed', { reason: (e as Error).message }),\n          );\n        }\n        setIsAbortSnackbarOpen(true);\n      } finally {\n        setIsAborting(false);\n        toggleAbortConfirmationDialog();\n      }\n    }\n  }, [\n    t,\n    orchestratorApi,\n    restart,\n    value,\n    toggleAbortConfirmationDialog,\n    fetchInstance,\n  ]);\n\n  const handleRerun = useCallback(() => {\n    if (!value) {\n      return;\n    }\n    const routeUrl = !entityRef\n      ? executeWorkflowLink({\n          workflowId: value.processId,\n        })\n      : `${executeWorkflowLink({ workflowId: value.processId })}?targetEntity=${entityRef}`;\n\n    const urlToNavigate = buildUrl(routeUrl, {\n      [QUERY_PARAM_INSTANCE_ID]: value.id,\n    });\n    navigate(urlToNavigate);\n  }, [value, navigate, executeWorkflowLink, entityRef]);\n\n  const handleRetrigger = async () => {\n    if (value) {\n      setIsRetrigger(true);\n      try {\n        const authTokenDescriptors = await getAuthTokenDescriptors(inputSchema);\n        let authTokens = undefined;\n        if (authTokenDescriptors && authTokenDescriptors.length > 0) {\n          authTokens = await authenticate(authTokenDescriptors);\n        }\n        await orchestratorApi.retriggerInstance(\n          value.processId,\n          value.id,\n          authTokens,\n        );\n        restart();\n      } catch (retriggerInstanceError) {\n        if (retriggerInstanceError.toString().includes('Failed Node ID')) {\n          setRetriggerError(t('workflow.buttons.runFailedAgain'));\n        } else {\n          setRetriggerError(\n            t('workflow.errors.retriggerFailed', {\n              reason: (retriggerInstanceError as Error).message,\n            }),\n          );\n        }\n        setIsRetriggerSnackbarOpen(true);\n      } finally {\n        setIsRetrigger(false);\n      }\n    }\n  };\n\n  const anchorRef = useRef(null);\n  const [openRerunMenu, setOpenRerunMenu] = useState(false);\n\n  const handleClick = () => {\n    setOpenRerunMenu(prev => !prev);\n  };\n\n  const handleCloseMenu = () => {\n    setOpenRerunMenu(false);\n  };\n\n  const handleOptionClick = (option: 'retrigger' | 'rerun') => {\n    handleCloseMenu();\n    if (option === 'rerun') handleRerun();\n    else if (option === 'retrigger') handleRetrigger();\n  };\n\n  const combinedError: Error | undefined = error || inputSchemaError;\n\n  const title = (\n    <Trans\n      message=\"run.pageTitle\"\n      params={{ processName: value?.processName }}\n    />\n  ) as unknown as string;\n\n  return (\n    <BaseOrchestratorPage title={title}>\n      {loading ? <Progress /> : null}\n      {combinedError ? <ResponseErrorPanel error={combinedError} /> : null}\n      {!loading && isNonNullable(value) ? (\n        <>\n          <ContentHeader title=\"\">\n            <InfoDialog\n              title={t('run.abort.title')}\n              titleIcon={<Error className={classes.errorColor} />}\n              onClose={toggleAbortConfirmationDialog}\n              open={isAbortConfirmationDialogOpen}\n              dialogActions={\n                <AbortConfirmationDialogActions\n                  handleCancel={toggleAbortConfirmationDialog}\n                  handleSubmit={handleAbort}\n                  isAborting={isAborting}\n                  canAbort={canAbort}\n                />\n              }\n            >\n              <AbortConfirmationDialogContent canAbort={canAbort} />\n            </InfoDialog>\n            <Grid container item justifyContent=\"flex-end\" spacing={1}>\n              <Grid item>\n                {canAbort && (\n                  <Tooltip\n                    title={t('tooltips.userNotAuthorizedAbort')}\n                    disableHoverListener={permittedToUse.allowed}\n                  >\n                    <Button\n                      variant=\"outlined\"\n                      color=\"primary\"\n                      disabled={!permittedToUse.allowed}\n                      onClick={toggleAbortConfirmationDialog}\n                    >\n                      {t('run.abort.button')}\n                    </Button>\n                  </Tooltip>\n                )}\n              </Grid>\n              <Grid item>\n                <Tooltip\n                  title={t('tooltips.userNotAuthorizedExecute')}\n                  disableHoverListener={permittedToUse.allowed}\n                >\n                  <Button\n                    ref={anchorRef}\n                    variant=\"contained\"\n                    color=\"primary\"\n                    startIcon={\n                      isRetrigger ? <CircularProgress size=\"1rem\" /> : null\n                    }\n                    disabled={!permittedToUse.allowed || !canRerun}\n                    onClick={\n                      value?.state === ProcessInstanceStatusDTO.Error\n                        ? handleClick\n                        : handleRerun\n                    }\n                    endIcon={\n                      value?.state === ProcessInstanceStatusDTO.Error ? (\n                        <ArrowDropDown />\n                      ) : null\n                    }\n                  >\n                    {value.state === ProcessInstanceStatusDTO.Active ? (\n                      <>\n                        <CircularProgress color=\"inherit\" size=\"0.75rem\" />\n                        &nbsp;{t('workflow.buttons.running')}\n                      </>\n                    ) : (\n                      t('workflow.buttons.runAgain')\n                    )}\n                  </Button>\n                </Tooltip>\n\n                <Menu\n                  anchorEl={anchorRef.current}\n                  open={openRerunMenu}\n                  onClose={handleCloseMenu}\n                  anchorOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'right',\n                  }}\n                  transformOrigin={{\n                    vertical: 'top',\n                    horizontal: 'right',\n                  }}\n                  className={classes.menu}\n                >\n                  <MenuItem onClick={() => handleOptionClick('rerun')}>\n                    <Start />\n                    Entire workflow\n                  </MenuItem>\n                  <MenuItem\n                    onClick={() => handleOptionClick('retrigger')}\n                    disabled={!inputSchema}\n                  >\n                    <SwipeRightAltOutlined />\n                    {t('workflow.buttons.fromFailurePoint')}\n                  </MenuItem>\n                </Menu>\n              </Grid>\n            </Grid>\n          </ContentHeader>\n          <Snackbar\n            open={isAbortSnackbarOpen}\n            onClose={handleAbortBarClose}\n            anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\n          >\n            <Alert\n              severity=\"error\"\n              action={\n                <IconButton\n                  size=\"small\"\n                  aria-label=\"close\"\n                  color=\"inherit\"\n                  onClick={handleAbortBarClose}\n                >\n                  <Close fontSize=\"small\" />\n                </IconButton>\n              }\n            >\n              {abortError}\n            </Alert>\n          </Snackbar>\n          <Snackbar\n            open={isRetriggerSnackbarOpen}\n            onClose={handleRerunBarClose}\n            anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\n          >\n            <Alert\n              severity=\"error\"\n              action={\n                <IconButton\n                  size=\"small\"\n                  aria-label=\"close\"\n                  color=\"inherit\"\n                  onClick={handleRerunBarClose}\n                >\n                  <Close fontSize=\"small\" />\n                </IconButton>\n              }\n            >\n              {retriggerError}\n            </Alert>\n          </Snackbar>\n          <WorkflowInstancePageContent instance={value} />\n        </>\n      ) : null}\n    </BaseOrchestratorPage>\n  );\n};\nWorkflowInstancePage.displayName = 'WorkflowInstancePage';\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useAsync } from 'react-use';\n\nimport { TabbedLayout } from '@backstage/core-components';\nimport { useApi, useRouteRefParams } from '@backstage/core-plugin-api';\n\nimport { Box } from '@material-ui/core';\nimport Grid from '@mui/material/Grid';\nimport { makeStyles } from 'tss-react/mui';\n\nimport { orchestratorApiRef } from '../../api';\nimport { useTranslation } from '../../hooks/useTranslation';\nimport { workflowRouteRef, workflowRunsRoutePath } from '../../routes';\nimport { useIsDarkMode } from '../../utils/isDarkMode';\nimport { WorkflowRunsTabContent } from '../OrchestratorPage/WorkflowRunsTabContent';\nimport { BaseOrchestratorPage } from '../ui/BaseOrchestratorPage';\nimport { RunButton } from './RunButton';\nimport { WorkflowDetailsTabContent } from './WorkflowDetailsTabContent';\n\nconst useStyles = makeStyles<{ isDarkMode: boolean }>()(\n  (_, { isDarkMode }) => ({\n    tabbedLayout: {\n      '& .Mui-selected': {\n        color: isDarkMode ? '#ffffff !important' : '#151515 !important',\n      },\n    },\n  }),\n);\n\nexport const WorkflowPage = () => {\n  const { t } = useTranslation();\n  const { workflowId } = useRouteRefParams(workflowRouteRef);\n  const orchestratorApi = useApi(orchestratorApiRef);\n  const isDarkMode = useIsDarkMode();\n  const { classes } = useStyles({ isDarkMode });\n\n  const {\n    value: workflowOverviewDTO,\n    loading: loadingWorkflowOverview,\n    error: errorWorkflowOverview,\n  } = useAsync(() => {\n    return orchestratorApi.getWorkflowOverview(workflowId);\n  }, []);\n\n  return (\n    <BaseOrchestratorPage\n      title={workflowOverviewDTO?.data.name || workflowId}\n      type=\"Orchestrator\"\n      typeLink=\"/orchestrator\"\n      noPadding\n    >\n      <Box className={classes.tabbedLayout}>\n        <TabbedLayout>\n          <TabbedLayout.Route path=\"/\" title={t('page.tabs.workflowDetails')}>\n            <Grid container spacing={2}>\n              <RunButton isAvailable={workflowOverviewDTO?.data.isAvailable} />\n              <WorkflowDetailsTabContent\n                loadingWorkflowOverview={loadingWorkflowOverview}\n                workflowOverviewDTO={workflowOverviewDTO?.data}\n                errorWorkflowOverview={errorWorkflowOverview}\n              />\n            </Grid>\n          </TabbedLayout.Route>\n          <TabbedLayout.Route\n            path={workflowRunsRoutePath}\n            title={t('page.tabs.workflowRuns')}\n          >\n            <Grid container spacing={2}>\n              <RunButton isAvailable={workflowOverviewDTO?.data.isAvailable} />\n              <WorkflowRunsTabContent />\n            </Grid>\n          </TabbedLayout.Route>\n        </TabbedLayout>\n      </Box>\n    </BaseOrchestratorPage>\n  );\n};\n","/*\n * Copyright Red Hat, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Route, Routes } from 'react-router-dom';\n\nimport {\n  entityInstanceRouteRef,\n  entityWorkflowRouteRef,\n  executeWorkflowRouteRef,\n  workflowInstanceRouteRef,\n  workflowRouteRef,\n} from '../routes';\nimport { CatalogWorkflowPage } from './catalogComponents/CatalogWorkflowPage';\nimport { ExecuteWorkflowPage } from './ExecuteWorkflowPage/ExecuteWorkflowPage';\nimport { OrchestratorPage } from './OrchestratorPage/OrchestratorPage';\nimport { WorkflowInstancePage } from './WorkflowInstancePage/WorkflowInstancePage';\nimport { WorkflowPage } from './WorkflowPage/WorkflowPage';\n\nexport const Router = () => {\n  return (\n    // relative to orchestrator/\n    <Routes>\n      <Route path=\"/*\" element={<OrchestratorPage />} />\n      <Route path={`${workflowRouteRef.path}/*`} element={<WorkflowPage />} />\n      <Route\n        path={executeWorkflowRouteRef.path}\n        element={<ExecuteWorkflowPage />}\n      />\n      <Route\n        path={workflowInstanceRouteRef.path}\n        element={<WorkflowInstancePage />}\n      />\n      <Route\n        path={entityWorkflowRouteRef.path}\n        element={<CatalogWorkflowPage />}\n      />\n      <Route\n        path={entityInstanceRouteRef.path}\n        element={<WorkflowInstancePage />}\n      />\n    </Routes>\n  );\n};\n"],"names":["Trans","message","params","t","useTranslation","useStyles","makeStyles","theme","root","display","flexDirection","alignItems","marginTop","select","width","label","color","palette","text","primary","fontSize","typography","paddingRight","fontWeight","ALL_ITEMS","Selector","includeAll","otherProps","classes","selectItems","useMemo","value","items","handleChange","useCallback","item","onChange","div","className","Typography","Select","selected","margin","displayName","AllItems","VariablesDialog","open","onClose","instanceVariables","isDarkMode","useIsDarkMode","hasVariables","Object","keys","length","InfoDialog","title","dialogActions","Button","variant","onClick","wideDialog","entries","map","key","Box","mt","mb","capitalize","JsonCodeBlock","WorkflowInputs","loading","responseError","cardClassName","inputs","data","InfoCard","subheader","i","divider","Progress","ResponseErrorPanel","error","StructuredMetadataTable","dense","metadata","isNonNullable","compareNodes","nodeA","nodeB","aEnter","moment","enter","bEnter","isBefore","isAfter","exit","aExit","bExit","id","Paragraph","props","style","marginBottom","component","children","WorkflowProgressNodeIcon","status","useWorkflowInstanceStateColors","ProcessInstanceStatusDTO","Error","Tooltip","Completed","CheckCircle","Active","HourglassTop","Aborted","Cancel","Suspended","PauseCircle","Pending","WorkflowProgressNode","model","paddingLeft","name","small","Moment","fromNow","Date","VALUE_UNAVAILABLE","fromNodeInstanceToWorkflowProgressNodeModel","workflowStatus","workflowError","node","nodeIndex","nodes","isLastNode","definitionId","nodeDefinitionId","WorkflowProgress","workflowNodes","emptyState","defaultEmptyState","structuredClone","sort","QUERY_PARAM_INSTANCE_ID","buildUrl","baseUrl","queryParams","queryString","filter","undefined","encodeURIComponent","join","closeBtn","position","right","top","RefForwardingWorkflowDescriptionModal","forwardedRef","workflow","runWorkflowLink","navigate","useNavigate","content","paragraph","itemId","description","Dialog","_","ref","maxWidth","fullWidth","DialogTitle","IconButton","aria-label","Close","DialogContent","DialogActions","disabled","WorkflowDescriptionModal","forwardRef","outputGrid","textTransform","links","padding","values","errorIcon","main","finalStates","ResultMessage","resultMessage","executionSummary","errorMessage","toString","executionSummaryArray","getTimeFromExecutionSummary","keyword","matchingMessage","find","str","includes","timeMatch","match","formattedDate","toLocaleString","alertProps","time","severity","MarkdownContent","activeMessage","formattedTime","waitingMessage","nodeMatch","startedTime","CircularProgress","size","checkIfWaiting","sx","Alert","AlertTitle","NextWorkflows","instanceId","nextWorkflows","orchestratorApi","useApi","orchestratorApiRef","executeWorkflowLink","useRouteRef","executeWorkflowRouteRef","currentOpenedWorkflowDescriptionModalID","setCurrentOpenedWorkflowDescriptionModalID","useState","currentWorkflow","setCurrentWorkflow","setWorkflowError","workflowId","openWorkflowDescriptionModal","getWorkflowOverview","then","catch","closeWorkflowDescriptionModal","sectionLabel","Grid","xs","AboutField","List","disablePadding","ListItem","disableGutters","Link","to","WorkflowOutputs","outputs","format","markdowns","valuesAsObject","reduce","Array","isArray","JSON","stringify","md","WorkflowResult","instance","result","workflowdata","state","container","alignContent","spacing","maxHeight","WorkflowRunDetails","details","useAsync","async","workflowPageLink","workflowRouteRef","b","processName","WorkflowInstanceStatusIndicator","WorkflowStatus","availability","isAvailable","overflow","noWrap","CopyTextButton","tooltipText","tooltipDelay","duration","start","mapProcessInstanceToDetails","end","diff","humanize","started","toDate","processId","topRowCard","height","bottomRowCard","recommendedLabelContainer","whiteSpace","recommendedLabel","titleContainer","justifyContent","WorkflowInstancePageContent","hasOwnProperty","getWorkflowDataInputSchema","isVariablesDialogOpen","setIsVariablesDialogOpen","toggleVariablesDialog","prev","viewVariables","usePermission","permission","orchestratorAdminViewPermission","allowed","e","preventDefault","textAlign","Content","noPadding","WorkflowRunsTabContent","statuses","makeSelectItemsFromProcessInstanceValues","entityInstanceLink","entityInstanceRouteRef","kind","namespace","useRouteRefParams","entityWorkflowRouteRef","entityRef","workflowInstanceLink","workflowInstanceRouteRef","statusSelectorValue","setStatusSelectorValue","startedSelectorValue","setStartedSelectorValue","page","setPage","pageSize","setPageSize","DEFAULT_TABLE_PAGE_SIZE","orderByField","setOrderByField","orderDirection","setOrderDirection","getFilter","workflowIdFilter","operator","field","statusFilter","startedFilter","dateRange","currentDate","endOfToday","setHours","startOfToday","toISOString","startOfYesterday","setDate","getDate","endOfYesterday","startOfLast7Days","startOfCurrentMonth","filters","nested","Boolean","fetchInstances","instances","paginationInfo","offset","orderBy","PaginationInfoDTOOrderDirectionEnum","Asc","Desc","listInstances","usePolling","applyBackendSort","item1","item2","item1Index","findIndex","curItem","item2Index","columns","render","sorting","customSort","hasNextPage","slice","enablePaging","ErrorPanel","value_","flexGrow","count","OverrideBackstageTable","removeOutline","isLoading","options","paging","onOrderChange","orderBy_","orderDirection_","components","Toolbar","TablePagination","onPageChange","page_","onRowsPerPageChange","parseInt","target","rowsPerPage","labelDisplayedRows","from","rowsPerPageOptions","nextIconButtonProps","BaseOrchestratorPage","subtitle","type","typeLink","Page","themeId","Header","RunButton","loadingPermission","canRun","usePermissionArrayDecision","orchestratorWorkflowUsePermission","orchestratorWorkflowUseSpecificPermission","Skeleton","disableHoverListener","codeSnippetCOntainer","backgroundColor","loadingWorkflowSource","workflowSource","errorWorkflowSource","CodeSnippet","language","showLineNumbers","showCopyCodeButton","overflowY","minHeight","workflowOverview","formattedWorkflowOverview","WorkflowOverviewFormatter","wrap","WorkflowDetailsTabContent","loadingWorkflowOverview","workflowOverviewDTO","errorWorkflowOverview","adminView","getWorkflowSource","direction","WorkflowDefinitionDetailsCard","ServerlessWorkflowEditor","CatalogWorkflowPage","getSchemaDefinition","rootSchema","path","replace","get","getStringAfterDot","input","startsWith","replaceSparseArrayElementsdWithEmptyObject","acc","extractUiSchema","mixedSchema","processObject","curSchema","$ref","properties","processObjectProperties","processArraySchema","processLeafSchema","processOrder","processComposedSchema","uiOrder","set","merge","leafSchema","subSchemaKey","processArrayItems","schema","additionalItems","anyOf","oneOf","allOf","else","context","createContext","useStepperContext","multiStepFormContext","useContext","StepperContextProvider","reviewStep","activeStep","setActiveStep","isValidating","setIsValidating","contextData","handleNext","curActiveStep","handleBack","handleValidateStarted","handleValidateEnded","Provider","defaultFormExtensionsApi","getFormDecorator","console","log","FormComponent","formContext","orchestratorFormApiRef","createApiRef","getSortedStepEntries","sortedStepEntries","forEach","subSchema","push","getActiveStepKey","activeKey","AuthRequester","setAuthTokenDescriptors","uiProps","useEffect","authTokenDescriptors","submitting","handleClick","focusOnMount","useRef","current","focus","startIcon","disableRipple","step","regularButton","footer","formWrapper","OrchestratorFormToolbar","SubmitButton","steps","stepsWithReview","Stepper","overflowX","alternativeLabel","index","Step","StepLabel","aria-disabled","tabIndex","formData","uiSchema","registry","idSchema","errorSchema","ObjectField","fields","OrchestratorFormStepper","MuiForm","withTheme","MuiTheme","decoratorProps","extraErrors","setExtraErrors","numStepsInMultiStepSchema","isMultiStep","validationError","setValidationError","validator","isMultiStepSchema","validateFormData","_schema","customValidate","validationData","validatorAjv","errorHandler","createErrorHandler","userErrorSchema","unwrapErrorHandler","validationDataMerge","errors","err","property","toErrorList","fieldPath","isValid","rawValidation","useValidator","onSubmit","_onSubmit","setFormData","omit","widgets","StepperObjectField","noHtml5Validate","_formData","_extraErrors","_validationError","getExtraErrors","getActiveKey","formApi","useApiHolder","NewComponent","formDecorator","isJsonObject","processSchema","formState","parsedSchema","JSONSchema","definitionInSchema","getSchema","pointer","nestedValue","nestedKey","_nestedValue","backButton","marginRight","paper","minWidth","busy","handleExecute","displayData","generateReviewTableData","Paper","square","elevation","OrchestratorFormWrapper","rawSchema","updateSchema","isExecuting","initialFormData","changedByUserMap","setChangedByUserMap","getIsChangedByUser","setIsChangedByUser","isChangedByUser","hiddenSteps","uiWidget","newSchema","cloneDeep","removeHiddenSteps","every","prop","getNumSteps","_handleExecute","firstKey","stepKey","_subSchema","subSchemaFirstKey","addFocusOnFirstElement","generateUiSchema","ReviewStep","Fragment","SingleStepForm","useOrchestratorAuth","app","useApp","apiHolder","githubAuthApi","githubAuthApiRef","gitlabAuthApi","gitlabAuthApiRef","microsoftAuthApi","microsoftAuthApiRef","getProviderToken","api","tokenDescriptor","tokenType","getIdToken","isOpenIdAuthApi","provider","getAccessToken","isAuthApi","scope","findCustomProvider","providerApiId","allPlugins","apiRef","getPlugins","flatMap","plugin","getApis","apis","getToken","authApi","toLocaleLowerCase","customProviderApiId","token","authenticate","tokenDescriptors","authTokens","br","code","deepSearchAndFirstReplace","schemaProperties","placeholderId","chunk","isEqual","subproperties","ExecuteWorkflowPage","searchParams","useSearchParams","targetEntity","setIsExecuting","updateError","setUpdateError","useQueryParamState","instanceLink","setSchema","inputSchema","chunks","getSchemaUpdater","workflowName","workflowNameLoading","workflowNameError","split","parameters","response","executeWorkflow","url","isError","getErrorObject","pageContent","OrchestratorForm","MissingSchemaNotice","tabbedLayout","OrchestratorPage","TabbedLayout","Route","WorkflowsTabContent","workflowInstancesRouteRef","deepSearchObject","obj","predicate","abortButton","dark","getContrastText","modalText","errorColor","menu","AbortConfirmationDialogContent","canAbort","AbortConfirmationDialogActions","handleSubmit","isAborting","handleCancel","WorkflowInstancePage","isAbortConfirmationDialogOpen","setIsAbortConfirmationDialogOpen","setIsAborting","isAbortSnackbarOpen","setIsAbortSnackbarOpen","abortError","setAbortError","isRetrigger","setIsRetrigger","isRetriggerSnackbarOpen","setIsRetriggerSnackbarOpen","retriggerError","setRetriggerError","handleAbortBarClose","handleRerunBarClose","fetchInstance","getInstance","restart","SHORT_REFRESH_INTERVAL","curValue","permittedToUse","inputSchemaError","res","canRerun","toggleAbortConfirmationDialog","handleAbort","abortWorkflowInstance","reason","handleRerun","urlToNavigate","anchorRef","openRerunMenu","setOpenRerunMenu","handleCloseMenu","handleOptionClick","option","dataInputSchema","authRequester","getAuthTokenDescriptors","retriggerInstance","retriggerInstanceError","handleRetrigger","combinedError","ContentHeader","titleIcon","endIcon","ArrowDropDown","Menu","anchorEl","anchorOrigin","vertical","horizontal","transformOrigin","MenuItem","Start","SwipeRightAltOutlined","Snackbar","action","WorkflowPage","workflowRunsRoutePath","Router","Routes","element"],"sourceRoot":""}